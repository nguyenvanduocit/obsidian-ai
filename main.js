var sy=Object.create;var Ti=Object.defineProperty;var iy=Object.getOwnPropertyDescriptor;var ay=Object.getOwnPropertyNames;var oy=Object.getPrototypeOf,uy=Object.prototype.hasOwnProperty;var cy=(r,e,t)=>e in r?Ti(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var qe=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),jc=(r,e)=>{for(var t in e)Ti(r,t,{get:e[t],enumerable:!0})},df=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of ay(e))!uy.call(r,s)&&s!==t&&Ti(r,s,{get:()=>e[s],enumerable:!(n=iy(e,s))||n.enumerable});return r};var pt=(r,e,t)=>(t=r!=null?sy(oy(r)):{},df(e||!r||!r.__esModule?Ti(t,"default",{value:r,enumerable:!0}):t,r)),ly=r=>df(Ti({},"__esModule",{value:!0}),r);var Sr=(r,e,t)=>(cy(r,typeof e!="symbol"?e+"":e,t),t);var lh=qe((MT,ch)=>{"use strict";ch.exports=function(r,e){if(typeof r!="string")throw new TypeError("Expected a string");return e=typeof e=="undefined"?"_":e,r.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}});var yh=qe((LT,pl)=>{"use strict";var Zy=/[\p{Lu}]/u,Hy=/[\p{Ll}]/u,dh=/^[\p{Lu}](?![\p{Lu}])/gu,ph=/([\p{Alpha}\p{N}_]|$)/u,mh=/[_.\- ]+/,Gy=new RegExp("^"+mh.source),fh=new RegExp(mh.source+ph.source,"gu"),hh=new RegExp("\\d+"+ph.source,"gu"),Jy=(r,e,t)=>{let n=!1,s=!1,i=!1;for(let a=0;a<r.length;a++){let o=r[a];n&&Zy.test(o)?(r=r.slice(0,a)+"-"+r.slice(a),n=!1,i=s,s=!0,a++):s&&i&&Hy.test(o)?(r=r.slice(0,a-1)+"-"+r.slice(a-1),i=s,s=!1,n=!0):(n=e(o)===o&&t(o)!==o,i=s,s=t(o)===o&&e(o)!==o)}return r},Wy=(r,e)=>(dh.lastIndex=0,r.replace(dh,t=>e(t))),Yy=(r,e)=>(fh.lastIndex=0,hh.lastIndex=0,r.replace(fh,(t,n)=>e(n)).replace(hh,t=>e(t))),gh=(r,e)=>{if(!(typeof r=="string"||Array.isArray(r)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(r)?r=r.map(i=>i.trim()).filter(i=>i.length).join("-"):r=r.trim(),r.length===0)return"";let t=e.locale===!1?i=>i.toLowerCase():i=>i.toLocaleLowerCase(e.locale),n=e.locale===!1?i=>i.toUpperCase():i=>i.toLocaleUpperCase(e.locale);return r.length===1?e.pascalCase?n(r):t(r):(r!==t(r)&&(r=Jy(r,t,n)),r=r.replace(Gy,""),e.preserveConsecutiveUppercase?r=Wy(r,t):r=t(r),e.pascalCase&&(r=n(r.charAt(0))+r.slice(1)),Yy(r,n))};pl.exports=gh;pl.exports.default=gh});var Mh=qe((aP,$h)=>{function at(r,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(r)),this._timeouts=r,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}$h.exports=at;at.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};at.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};at.prototype.retry=function(r){if(this._timeout&&clearTimeout(this._timeout),!r)return!1;var e=new Date().getTime();if(r&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(r),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(r);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t),this._options.unref&&this._timer.unref(),!0};at.prototype.attempt=function(r,e){this._fn=r,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};at.prototype.try=function(r){console.log("Using RetryOperation.try() is deprecated"),this.attempt(r)};at.prototype.start=function(r){console.log("Using RetryOperation.start() is deprecated"),this.attempt(r)};at.prototype.start=at.prototype.try;at.prototype.errors=function(){return this._errors};at.prototype.attempts=function(){return this._attempts};at.prototype.mainError=function(){if(this._errors.length===0)return null;for(var r={},e=null,t=0,n=0;n<this._errors.length;n++){var s=this._errors[n],i=s.message,a=(r[i]||0)+1;r[i]=a,a>=t&&(e=s,t=a)}return e}});var Lh=qe(En=>{var Eb=Mh();En.operation=function(r){var e=En.timeouts(r);return new Eb(e,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})};En.timeouts=function(r){if(r instanceof Array)return[].concat(r);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var t in r)e[t]=r[t];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],s=0;s<e.retries;s++)n.push(this.createTimeout(s,e));return r&&r.forever&&!n.length&&n.push(this.createTimeout(s,e)),n.sort(function(i,a){return i-a}),n};En.createTimeout=function(r,e){var t=e.randomize?Math.random()+1:1,n=Math.round(t*Math.max(e.minTimeout,1)*Math.pow(e.factor,r));return n=Math.min(n,e.maxTimeout),n};En.wrap=function(r,e,t){if(e instanceof Array&&(t=e,e=null),!t){t=[];for(var n in r)typeof r[n]=="function"&&t.push(n)}for(var s=0;s<t.length;s++){var i=t[s],a=r[i];r[i]=function(u){var c=En.operation(e),l=Array.prototype.slice.call(arguments,1),d=l.pop();l.push(function(f){c.retry(f)||(f&&(arguments[0]=c.mainError()),d.apply(this,arguments))}),c.attempt(function(){u.apply(r,l)})}.bind(r,a),r[i].options=e}}});var Bh=qe((uP,Dh)=>{Dh.exports=Lh()});var Yo=qe((cP,Wo)=>{"use strict";var Sb=Bh(),Tb=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],Jo=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},Pb=(r,e,t)=>{let n=t.retries-(e-1);return r.attemptNumber=e,r.retriesLeft=n,r},kb=r=>Tb.includes(r),Fh=(r,e)=>new Promise((t,n)=>{e={onFailedAttempt:()=>{},retries:10,...e};let s=Sb.operation(e);s.attempt(async i=>{try{t(await r(i))}catch(a){if(!(a instanceof Error)){n(new TypeError(`Non-error was thrown: "${a}". You should only throw errors.`));return}if(a instanceof Jo)s.stop(),n(a.originalError);else if(a instanceof TypeError&&!kb(a.message))s.stop(),n(a);else{Pb(a,i,e);try{await e.onFailedAttempt(a)}catch(o){n(o);return}s.retry(a)||n(s.mainError())}}})});Wo.exports=Fh;Wo.exports.default=Fh;Wo.exports.AbortError=Jo});var zh=qe((lP,Al)=>{"use strict";var Ib=Object.prototype.hasOwnProperty,De="~";function ra(){}Object.create&&(ra.prototype=Object.create(null),new ra().__proto__||(De=!1));function Cb(r,e,t){this.fn=r,this.context=e,this.once=t||!1}function Uh(r,e,t,n,s){if(typeof t!="function")throw new TypeError("The listener must be a function");var i=new Cb(t,n||r,s),a=De?De+e:e;return r._events[a]?r._events[a].fn?r._events[a]=[r._events[a],i]:r._events[a].push(i):(r._events[a]=i,r._eventsCount++),r}function Xo(r,e){--r._eventsCount===0?r._events=new ra:delete r._events[e]}function Re(){this._events=new ra,this._eventsCount=0}Re.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)Ib.call(t,n)&&e.push(De?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};Re.prototype.listeners=function(e){var t=De?De+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,i=n.length,a=new Array(i);s<i;s++)a[s]=n[s].fn;return a};Re.prototype.listenerCount=function(e){var t=De?De+e:e,n=this._events[t];return n?n.fn?1:n.length:0};Re.prototype.emit=function(e,t,n,s,i,a){var o=De?De+e:e;if(!this._events[o])return!1;var u=this._events[o],c=arguments.length,l,d;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,s),!0;case 5:return u.fn.call(u.context,t,n,s,i),!0;case 6:return u.fn.call(u.context,t,n,s,i,a),!0}for(d=1,l=new Array(c-1);d<c;d++)l[d-1]=arguments[d];u.fn.apply(u.context,l)}else{var f=u.length,h;for(d=0;d<f;d++)switch(u[d].once&&this.removeListener(e,u[d].fn,void 0,!0),c){case 1:u[d].fn.call(u[d].context);break;case 2:u[d].fn.call(u[d].context,t);break;case 3:u[d].fn.call(u[d].context,t,n);break;case 4:u[d].fn.call(u[d].context,t,n,s);break;default:if(!l)for(h=1,l=new Array(c-1);h<c;h++)l[h-1]=arguments[h];u[d].fn.apply(u[d].context,l)}}return!0};Re.prototype.on=function(e,t,n){return Uh(this,e,t,n,!1)};Re.prototype.once=function(e,t,n){return Uh(this,e,t,n,!0)};Re.prototype.removeListener=function(e,t,n,s){var i=De?De+e:e;if(!this._events[i])return this;if(!t)return Xo(this,i),this;var a=this._events[i];if(a.fn)a.fn===t&&(!s||a.once)&&(!n||a.context===n)&&Xo(this,i);else{for(var o=0,u=[],c=a.length;o<c;o++)(a[o].fn!==t||s&&!a[o].once||n&&a[o].context!==n)&&u.push(a[o]);u.length?this._events[i]=u.length===1?u[0]:u:Xo(this,i)}return this};Re.prototype.removeAllListeners=function(e){var t;return e?(t=De?De+e:e,this._events[t]&&Xo(this,t)):(this._events=new ra,this._eventsCount=0),this};Re.prototype.off=Re.prototype.removeListener;Re.prototype.addListener=Re.prototype.on;Re.prefixed=De;Re.EventEmitter=Re;typeof Al!="undefined"&&(Al.exports=Re)});var qh=qe((dP,Kh)=>{"use strict";Kh.exports=(r,e)=>(e=e||(()=>{}),r.then(t=>new Promise(n=>{n(e())}).then(()=>t),t=>new Promise(n=>{n(e())}).then(()=>{throw t})))});var Zh=qe((fP,eu)=>{"use strict";var Nb=qh(),Qo=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},Vh=(r,e,t)=>new Promise((n,s)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){n(r);return}let i=setTimeout(()=>{if(typeof t=="function"){try{n(t())}catch(u){s(u)}return}let a=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new Qo(a);typeof r.cancel=="function"&&r.cancel(),s(o)},e);Nb(r.then(n,s),()=>{clearTimeout(i)})});eu.exports=Vh;eu.exports.default=Vh;eu.exports.TimeoutError=Qo});var Hh=qe(Ol=>{"use strict";Object.defineProperty(Ol,"__esModule",{value:!0});function Rb(r,e,t){let n=0,s=r.length;for(;s>0;){let i=s/2|0,a=n+i;t(r[a],e)<=0?(n=++a,s-=i+1):s=i}return n}Ol.default=Rb});var Gh=qe(Sl=>{"use strict";Object.defineProperty(Sl,"__esModule",{value:!0});var jb=Hh(),El=class{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);let n={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(n);return}let s=jb.default(this._queue,n,(i,a)=>a.priority-i.priority);this._queue.splice(s,0,n)}dequeue(){let e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}};Sl.default=El});var ru=qe(Pl=>{"use strict";Object.defineProperty(Pl,"__esModule",{value:!0});var $b=zh(),Jh=Zh(),Mb=Gh(),tu=()=>{},Lb=new Jh.TimeoutError,Tl=class extends $b{constructor(e){var t,n,s,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=tu,this._resolveIdle=tu,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:Mb.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(i=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=tu,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=tu,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(this._intervalId===void 0){let t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((n,s)=>{let i=async()=>{this._pendingCount++,this._intervalCount++;try{let a=this._timeout===void 0&&t.timeout===void 0?e():Jh.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&s(Lb)});n(await a)}catch(a){s(a)}this._next()};this._queue.enqueue(i,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}};Pl.default=Tl});var Qh=qe(su=>{"use strict";su.byteLength=Ub;su.toByteArray=Kb;su.fromByteArray=Zb;var zt=[],ot=[],Fb=typeof Uint8Array!="undefined"?Uint8Array:Array,kl="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Sn=0,Yh=kl.length;Sn<Yh;++Sn)zt[Sn]=kl[Sn],ot[kl.charCodeAt(Sn)]=Sn;var Sn,Yh;ot[45]=62;ot[95]=63;function Xh(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function Ub(r){var e=Xh(r),t=e[0],n=e[1];return(t+n)*3/4-n}function zb(r,e,t){return(e+t)*3/4-t}function Kb(r){var e,t=Xh(r),n=t[0],s=t[1],i=new Fb(zb(r,n,s)),a=0,o=s>0?n-4:n,u;for(u=0;u<o;u+=4)e=ot[r.charCodeAt(u)]<<18|ot[r.charCodeAt(u+1)]<<12|ot[r.charCodeAt(u+2)]<<6|ot[r.charCodeAt(u+3)],i[a++]=e>>16&255,i[a++]=e>>8&255,i[a++]=e&255;return s===2&&(e=ot[r.charCodeAt(u)]<<2|ot[r.charCodeAt(u+1)]>>4,i[a++]=e&255),s===1&&(e=ot[r.charCodeAt(u)]<<10|ot[r.charCodeAt(u+1)]<<4|ot[r.charCodeAt(u+2)]>>2,i[a++]=e>>8&255,i[a++]=e&255),i}function qb(r){return zt[r>>18&63]+zt[r>>12&63]+zt[r>>6&63]+zt[r&63]}function Vb(r,e,t){for(var n,s=[],i=e;i<t;i+=3)n=(r[i]<<16&16711680)+(r[i+1]<<8&65280)+(r[i+2]&255),s.push(qb(n));return s.join("")}function Zb(r){for(var e,t=r.length,n=t%3,s=[],i=16383,a=0,o=t-n;a<o;a+=i)s.push(Vb(r,a,a+i>o?o:a+i));return n===1?(e=r[t-1],s.push(zt[e>>2]+zt[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],s.push(zt[e>>10]+zt[e>>4&63]+zt[e<<2&63]+"=")),s.join("")}});var yp=qe((zP,gp)=>{"use strict";var pp=(r=0)=>e=>`\x1B[${38+r};5;${e}m`,mp=(r=0)=>(e,t,n)=>`\x1B[${38+r};2;${e};${t};${n}m`;function nw(){let r=new Map,e={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};e.color.gray=e.color.blackBright,e.bgColor.bgGray=e.bgColor.bgBlackBright,e.color.grey=e.color.blackBright,e.bgColor.bgGrey=e.bgColor.bgBlackBright;for(let[t,n]of Object.entries(e)){for(let[s,i]of Object.entries(n))e[s]={open:`\x1B[${i[0]}m`,close:`\x1B[${i[1]}m`},n[s]=e[s],r.set(i[0],i[1]);Object.defineProperty(e,t,{value:n,enumerable:!1})}return Object.defineProperty(e,"codes",{value:r,enumerable:!1}),e.color.close="\x1B[39m",e.bgColor.close="\x1B[49m",e.color.ansi256=pp(),e.color.ansi16m=mp(),e.bgColor.ansi256=pp(10),e.bgColor.ansi16m=mp(10),Object.defineProperties(e,{rgbToAnsi256:{value:(t,n,s)=>t===n&&n===s?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(n/255*5)+Math.round(s/255*5),enumerable:!1},hexToRgb:{value:t=>{let n=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(t.toString(16));if(!n)return[0,0,0];let{colorString:s}=n.groups;s.length===3&&(s=s.split("").map(a=>a+a).join(""));let i=Number.parseInt(s,16);return[i>>16&255,i>>8&255,i&255]},enumerable:!1},hexToAnsi256:{value:t=>e.rgbToAnsi256(...e.hexToRgb(t)),enumerable:!1}}),e}Object.defineProperty(gp,"exports",{enumerable:!0,get:nw})});var G0={};jc(G0,{default:()=>Rc});module.exports=ly(G0);var ht=require("obsidian");var so=Symbol.for("yaml.alias"),io=Symbol.for("yaml.document"),mt=Symbol.for("yaml.map"),$c=Symbol.for("yaml.pair"),nt=Symbol.for("yaml.scalar"),Qt=Symbol.for("yaml.seq"),Le=Symbol.for("yaml.node.type"),gt=r=>!!r&&typeof r=="object"&&r[Le]===so,er=r=>!!r&&typeof r=="object"&&r[Le]===io,yt=r=>!!r&&typeof r=="object"&&r[Le]===mt,Y=r=>!!r&&typeof r=="object"&&r[Le]===$c,G=r=>!!r&&typeof r=="object"&&r[Le]===nt,bt=r=>!!r&&typeof r=="object"&&r[Le]===Qt;function ne(r){if(r&&typeof r=="object")switch(r[Le]){case mt:case Qt:return!0}return!1}function ee(r){if(r&&typeof r=="object")switch(r[Le]){case so:case mt:case nt:case Qt:return!0}return!1}var ff=r=>(G(r)||ne(r))&&!!r.anchor;var Ve=Symbol("break visit"),hf=Symbol("skip children"),Lt=Symbol("remove node");function _t(r,e){let t=pf(e);er(r)?As(null,r.contents,t,Object.freeze([r]))===Lt&&(r.contents=null):As(null,r,t,Object.freeze([]))}_t.BREAK=Ve;_t.SKIP=hf;_t.REMOVE=Lt;function As(r,e,t,n){let s=mf(r,e,t,n);if(ee(s)||Y(s))return gf(r,n,s),As(r,s,t,n);if(typeof s!="symbol"){if(ne(e)){n=Object.freeze(n.concat(e));for(let i=0;i<e.items.length;++i){let a=As(i,e.items[i],t,n);if(typeof a=="number")i=a-1;else{if(a===Ve)return Ve;a===Lt&&(e.items.splice(i,1),i-=1)}}}else if(Y(e)){n=Object.freeze(n.concat(e));let i=As("key",e.key,t,n);if(i===Ve)return Ve;i===Lt&&(e.key=null);let a=As("value",e.value,t,n);if(a===Ve)return Ve;a===Lt&&(e.value=null)}}return s}async function ao(r,e){let t=pf(e);er(r)?await Os(null,r.contents,t,Object.freeze([r]))===Lt&&(r.contents=null):await Os(null,r,t,Object.freeze([]))}ao.BREAK=Ve;ao.SKIP=hf;ao.REMOVE=Lt;async function Os(r,e,t,n){let s=await mf(r,e,t,n);if(ee(s)||Y(s))return gf(r,n,s),Os(r,s,t,n);if(typeof s!="symbol"){if(ne(e)){n=Object.freeze(n.concat(e));for(let i=0;i<e.items.length;++i){let a=await Os(i,e.items[i],t,n);if(typeof a=="number")i=a-1;else{if(a===Ve)return Ve;a===Lt&&(e.items.splice(i,1),i-=1)}}}else if(Y(e)){n=Object.freeze(n.concat(e));let i=await Os("key",e.key,t,n);if(i===Ve)return Ve;i===Lt&&(e.key=null);let a=await Os("value",e.value,t,n);if(a===Ve)return Ve;a===Lt&&(e.value=null)}}return s}function pf(r){return typeof r=="object"&&(r.Collection||r.Node||r.Value)?Object.assign({Alias:r.Node,Map:r.Node,Scalar:r.Node,Seq:r.Node},r.Value&&{Map:r.Value,Scalar:r.Value,Seq:r.Value},r.Collection&&{Map:r.Collection,Seq:r.Collection},r):r}function mf(r,e,t,n){var s,i,a,o,u;if(typeof t=="function")return t(r,e,n);if(yt(e))return(s=t.Map)==null?void 0:s.call(t,r,e,n);if(bt(e))return(i=t.Seq)==null?void 0:i.call(t,r,e,n);if(Y(e))return(a=t.Pair)==null?void 0:a.call(t,r,e,n);if(G(e))return(o=t.Scalar)==null?void 0:o.call(t,r,e,n);if(gt(e))return(u=t.Alias)==null?void 0:u.call(t,r,e,n)}function gf(r,e,t){let n=e[e.length-1];if(ne(n))n.items[r]=t;else if(Y(n))r==="key"?n.key=t:n.value=t;else if(er(n))n.contents=t;else{let s=gt(n)?"alias":"scalar";throw new Error(`Cannot replace node with ${s} parent`)}}var dy={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},fy=r=>r.replace(/[!,[\]{}]/g,e=>dy[e]),Dt=class r{constructor(e,t){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},r.defaultYaml,e),this.tags=Object.assign({},r.defaultTags,t)}clone(){let e=new r(this.yaml,this.tags);return e.docStart=this.docStart,e}atDocument(){let e=new r(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:r.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},r.defaultTags);break}return e}add(e,t){this.atNextDocument&&(this.yaml={explicit:r.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},r.defaultTags),this.atNextDocument=!1);let n=e.trim().split(/[ \t]+/),s=n.shift();switch(s){case"%TAG":{if(n.length!==2&&(t(0,"%TAG directive should contain exactly two parts"),n.length<2))return!1;let[i,a]=n;return this.tags[i]=a,!0}case"%YAML":{if(this.yaml.explicit=!0,n.length!==1)return t(0,"%YAML directive should contain exactly one part"),!1;let[i]=n;if(i==="1.1"||i==="1.2")return this.yaml.version=i,!0;{let a=/^\d+\.\d+$/.test(i);return t(6,`Unsupported YAML version ${i}`,a),!1}}default:return t(0,`Unknown directive ${s}`,!0),!1}}tagName(e,t){if(e==="!")return"!";if(e[0]!=="!")return t(`Not a valid tag: ${e}`),null;if(e[1]==="<"){let a=e.slice(2,-1);return a==="!"||a==="!!"?(t(`Verbatim tags aren't resolved, so ${e} is invalid.`),null):(e[e.length-1]!==">"&&t("Verbatim tags must end with a >"),a)}let[,n,s]=e.match(/^(.*!)([^!]*)$/s);s||t(`The ${e} tag has no suffix`);let i=this.tags[n];if(i)try{return i+decodeURIComponent(s)}catch(a){return t(String(a)),null}return n==="!"?e:(t(`Could not resolve tag: ${e}`),null)}tagString(e){for(let[t,n]of Object.entries(this.tags))if(e.startsWith(n))return t+fy(e.substring(n.length));return e[0]==="!"?e:`!<${e}>`}toString(e){let t=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],n=Object.entries(this.tags),s;if(e&&n.length>0&&ee(e.contents)){let i={};_t(e.contents,(a,o)=>{ee(o)&&o.tag&&(i[o.tag]=!0)}),s=Object.keys(i)}else s=[];for(let[i,a]of n)i==="!!"&&a==="tag:yaml.org,2002:"||(!e||s.some(o=>o.startsWith(a)))&&t.push(`%TAG ${i} ${a}`);return t.join(`
`)}};Dt.defaultYaml={explicit:!1,version:"1.2"};Dt.defaultTags={"!!":"tag:yaml.org,2002:"};function oo(r){if(/[\x00-\x19\s,[\]{}]/.test(r)){let t=`Anchor must not contain whitespace or control characters: ${JSON.stringify(r)}`;throw new Error(t)}return!0}function Mc(r){let e=new Set;return _t(r,{Value(t,n){n.anchor&&e.add(n.anchor)}}),e}function Lc(r,e){for(let t=1;;++t){let n=`${r}${t}`;if(!e.has(n))return n}}function yf(r,e){let t=[],n=new Map,s=null;return{onAnchor:i=>{t.push(i),s||(s=Mc(r));let a=Lc(e,s);return s.add(a),a},setAnchors:()=>{for(let i of t){let a=n.get(i);if(typeof a=="object"&&a.anchor&&(G(a.node)||ne(a.node)))a.node.anchor=a.anchor;else{let o=new Error("Failed to resolve repeated object (this should not happen)");throw o.source=i,o}}},sourceObjects:n}}function Tr(r,e,t,n){if(n&&typeof n=="object")if(Array.isArray(n))for(let s=0,i=n.length;s<i;++s){let a=n[s],o=Tr(r,n,String(s),a);o===void 0?delete n[s]:o!==a&&(n[s]=o)}else if(n instanceof Map)for(let s of Array.from(n.keys())){let i=n.get(s),a=Tr(r,n,s,i);a===void 0?n.delete(s):a!==i&&n.set(s,a)}else if(n instanceof Set)for(let s of Array.from(n)){let i=Tr(r,n,s,s);i===void 0?n.delete(s):i!==s&&(n.delete(s),n.add(i))}else for(let[s,i]of Object.entries(n)){let a=Tr(r,n,s,i);a===void 0?delete n[s]:a!==i&&(n[s]=a)}return r.call(e,t,n)}function be(r,e,t){if(Array.isArray(r))return r.map((n,s)=>be(n,String(s),t));if(r&&typeof r.toJSON=="function"){if(!t||!ff(r))return r.toJSON(e,t);let n={aliasCount:0,count:1,res:void 0};t.anchors.set(r,n),t.onCreate=i=>{n.res=i,delete t.onCreate};let s=r.toJSON(e,t);return t.onCreate&&t.onCreate(s),s}return typeof r=="bigint"&&!(t!=null&&t.keep)?Number(r):r}var Pr=class{constructor(e){Object.defineProperty(this,Le,{value:e})}clone(){let e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(e.range=this.range.slice()),e}toJS(e,{mapAsMap:t,maxAliasCount:n,onAnchor:s,reviver:i}={}){if(!er(e))throw new TypeError("A document argument is required");let a={anchors:new Map,doc:e,keep:!0,mapAsMap:t===!0,mapKeyWarned:!1,maxAliasCount:typeof n=="number"?n:100},o=be(this,"",a);if(typeof s=="function")for(let{count:u,res:c}of a.anchors.values())s(c,u);return typeof i=="function"?Tr(i,{"":o},"",o):o}};var tr=class extends Pr{constructor(e){super(so),this.source=e,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(e){let t;return _t(e,{Node:(n,s)=>{if(s===this)return _t.BREAK;s.anchor===this.source&&(t=s)}}),t}toJSON(e,t){if(!t)return{source:this.source};let{anchors:n,doc:s,maxAliasCount:i}=t,a=this.resolve(s);if(!a){let u=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(u)}let o=n.get(a);if(o||(be(a,null,t),o=n.get(a)),!o||o.res===void 0){let u="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(u)}if(i>=0&&(o.count+=1,o.aliasCount===0&&(o.aliasCount=uo(s,a,n)),o.count*o.aliasCount>i)){let u="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(u)}return o.res}toString(e,t,n){let s=`*${this.source}`;if(e){if(oo(this.source),e.options.verifyAliasOrder&&!e.anchors.has(this.source)){let i=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(i)}if(e.implicitKey)return`${s} `}return s}};function uo(r,e,t){if(gt(e)){let n=e.resolve(r),s=t&&n&&t.get(n);return s?s.count*s.aliasCount:0}else if(ne(e)){let n=0;for(let s of e.items){let i=uo(r,s,t);i>n&&(n=i)}return n}else if(Y(e)){let n=uo(r,e.key,t),s=uo(r,e.value,t);return Math.max(n,s)}return 1}var co=r=>!r||typeof r!="function"&&typeof r!="object",N=class extends Pr{constructor(e){super(nt),this.value=e}toJSON(e,t){return t!=null&&t.keep?this.value:be(this.value,e,t)}toString(){return String(this.value)}};N.BLOCK_FOLDED="BLOCK_FOLDED";N.BLOCK_LITERAL="BLOCK_LITERAL";N.PLAIN="PLAIN";N.QUOTE_DOUBLE="QUOTE_DOUBLE";N.QUOTE_SINGLE="QUOTE_SINGLE";var hy="tag:yaml.org,2002:";function py(r,e,t){var n;if(e){let s=t.filter(a=>a.tag===e),i=(n=s.find(a=>!a.format))!=null?n:s[0];if(!i)throw new Error(`Tag ${e} not found`);return i}return t.find(s=>{var i;return((i=s.identify)==null?void 0:i.call(s,r))&&!s.format})}function rr(r,e,t){var d,f,h;if(er(r)&&(r=r.contents),ee(r))return r;if(Y(r)){let p=(f=(d=t.schema[mt]).createNode)==null?void 0:f.call(d,t.schema,null,t);return p.items.push(r),p}(r instanceof String||r instanceof Number||r instanceof Boolean||typeof BigInt!="undefined"&&r instanceof BigInt)&&(r=r.valueOf());let{aliasDuplicateObjects:n,onAnchor:s,onTagObj:i,schema:a,sourceObjects:o}=t,u;if(n&&r&&typeof r=="object"){if(u=o.get(r),u)return u.anchor||(u.anchor=s(r)),new tr(u.anchor);u={anchor:null,node:null},o.set(r,u)}e!=null&&e.startsWith("!!")&&(e=hy+e.slice(2));let c=py(r,e,a.tags);if(!c){if(r&&typeof r.toJSON=="function"&&(r=r.toJSON()),!r||typeof r!="object"){let p=new N(r);return u&&(u.node=p),p}c=r instanceof Map?a[mt]:Symbol.iterator in Object(r)?a[Qt]:a[mt]}i&&(i(c),delete t.onTagObj);let l=c!=null&&c.createNode?c.createNode(t.schema,r,t):typeof((h=c==null?void 0:c.nodeClass)==null?void 0:h.from)=="function"?c.nodeClass.from(t.schema,r,t):new N(r);return e?l.tag=e:c.default||(l.tag=c.tag),u&&(u.node=l),l}function Pi(r,e,t){let n=t;for(let s=e.length-1;s>=0;--s){let i=e[s];if(typeof i=="number"&&Number.isInteger(i)&&i>=0){let a=[];a[i]=n,n=a}else n=new Map([[i,n]])}return rr(n,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:r,sourceObjects:new Map})}var Es=r=>r==null||typeof r=="object"&&!!r[Symbol.iterator]().next().done,dn=class extends Pr{constructor(e,t){super(e),Object.defineProperty(this,"schema",{value:t,configurable:!0,enumerable:!1,writable:!0})}clone(e){let t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return e&&(t.schema=e),t.items=t.items.map(n=>ee(n)||Y(n)?n.clone(e):n),this.range&&(t.range=this.range.slice()),t}addIn(e,t){if(Es(e))this.add(t);else{let[n,...s]=e,i=this.get(n,!0);if(ne(i))i.addIn(s,t);else if(i===void 0&&this.schema)this.set(n,Pi(this.schema,s,t));else throw new Error(`Expected YAML collection at ${n}. Remaining path: ${s}`)}}deleteIn(e){let[t,...n]=e;if(n.length===0)return this.delete(t);let s=this.get(t,!0);if(ne(s))return s.deleteIn(n);throw new Error(`Expected YAML collection at ${t}. Remaining path: ${n}`)}getIn(e,t){let[n,...s]=e,i=this.get(n,!0);return s.length===0?!t&&G(i)?i.value:i:ne(i)?i.getIn(s,t):void 0}hasAllNullValues(e){return this.items.every(t=>{if(!Y(t))return!1;let n=t.value;return n==null||e&&G(n)&&n.value==null&&!n.commentBefore&&!n.comment&&!n.tag})}hasIn(e){let[t,...n]=e;if(n.length===0)return this.has(t);let s=this.get(t,!0);return ne(s)?s.hasIn(n):!1}setIn(e,t){let[n,...s]=e;if(s.length===0)this.set(n,t);else{let i=this.get(n,!0);if(ne(i))i.setIn(s,t);else if(i===void 0&&this.schema)this.set(n,Pi(this.schema,s,t));else throw new Error(`Expected YAML collection at ${n}. Remaining path: ${s}`)}}};dn.maxFlowStringSingleLineLength=60;var bf=r=>r.replace(/^(?!$)(?: $)?/gm,"#");function st(r,e){return/^\n+$/.test(r)?r.substring(1):e?r.replace(/^(?! *$)/gm,e):r}var Bt=(r,e,t)=>r.endsWith(`
`)?st(t,e):t.includes(`
`)?`
`+st(t,e):(r.endsWith(" ")?"":" ")+t;var Dc="flow",lo="block",ki="quoted";function Ii(r,e,t="flow",{indentAtStart:n,lineWidth:s=80,minContentWidth:i=20,onFold:a,onOverflow:o}={}){if(!s||s<0)return r;let u=Math.max(1+i,1+s-e.length);if(r.length<=u)return r;let c=[],l={},d=s-e.length;typeof n=="number"&&(n>s-Math.max(2,i)?c.push(0):d=s-n);let f,h,p=!1,m=-1,g=-1,y=-1;t===lo&&(m=_f(r,m,e.length),m!==-1&&(d=m+u));for(let O;O=r[m+=1];){if(t===ki&&O==="\\"){switch(g=m,r[m+1]){case"x":m+=3;break;case"u":m+=5;break;case"U":m+=9;break;default:m+=1}y=m}if(O===`
`)t===lo&&(m=_f(r,m,e.length)),d=m+e.length+u,f=void 0;else{if(O===" "&&h&&h!==" "&&h!==`
`&&h!=="	"){let E=r[m+1];E&&E!==" "&&E!==`
`&&E!=="	"&&(f=m)}if(m>=d)if(f)c.push(f),d=f+u,f=void 0;else if(t===ki){for(;h===" "||h==="	";)h=O,O=r[m+=1],p=!0;let E=m>y+1?m-2:g-1;if(l[E])return r;c.push(E),l[E]=!0,d=E+u,f=void 0}else p=!0}h=O}if(p&&o&&o(),c.length===0)return r;a&&a();let b=r.slice(0,c[0]);for(let O=0;O<c.length;++O){let E=c[O],T=c[O+1]||r.length;E===0?b=`
${e}${r.slice(0,T)}`:(t===ki&&l[E]&&(b+=`${r[E]}\\`),b+=`
${e}${r.slice(E+1,T)}`)}return b}function _f(r,e,t){let n=e,s=e+1,i=r[s];for(;i===" "||i==="	";)if(e<s+t)i=r[++e];else{do i=r[++e];while(i&&i!==`
`);n=e,s=e+1,i=r[s]}return n}var ho=(r,e)=>({indentAtStart:e?r.indent.length:r.indentAtStart,lineWidth:r.options.lineWidth,minContentWidth:r.options.minContentWidth}),po=r=>/^(%|---|\.\.\.)/m.test(r);function my(r,e,t){if(!e||e<0)return!1;let n=e-t,s=r.length;if(s<=n)return!1;for(let i=0,a=0;i<s;++i)if(r[i]===`
`){if(i-a>n)return!0;if(a=i+1,s-a<=n)return!1}return!0}function Ci(r,e){let t=JSON.stringify(r);if(e.options.doubleQuotedAsJSON)return t;let{implicitKey:n}=e,s=e.options.doubleQuotedMinMultiLineLength,i=e.indent||(po(r)?"  ":""),a="",o=0;for(let u=0,c=t[u];c;c=t[++u])if(c===" "&&t[u+1]==="\\"&&t[u+2]==="n"&&(a+=t.slice(o,u)+"\\ ",u+=1,o=u,c="\\"),c==="\\")switch(t[u+1]){case"u":{a+=t.slice(o,u);let l=t.substr(u+2,4);switch(l){case"0000":a+="\\0";break;case"0007":a+="\\a";break;case"000b":a+="\\v";break;case"001b":a+="\\e";break;case"0085":a+="\\N";break;case"00a0":a+="\\_";break;case"2028":a+="\\L";break;case"2029":a+="\\P";break;default:l.substr(0,2)==="00"?a+="\\x"+l.substr(2):a+=t.substr(u,6)}u+=5,o=u+1}break;case"n":if(n||t[u+2]==='"'||t.length<s)u+=1;else{for(a+=t.slice(o,u)+`

`;t[u+2]==="\\"&&t[u+3]==="n"&&t[u+4]!=='"';)a+=`
`,u+=2;a+=i,t[u+2]===" "&&(a+="\\"),u+=1,o=u+1}break;default:u+=1}return a=o?a+t.slice(o):t,n?a:Ii(a,i,ki,ho(e,!1))}function Bc(r,e){if(e.options.singleQuote===!1||e.implicitKey&&r.includes(`
`)||/[ \t]\n|\n[ \t]/.test(r))return Ci(r,e);let t=e.indent||(po(r)?"  ":""),n="'"+r.replace(/'/g,"''").replace(/\n+/g,`$&
${t}`)+"'";return e.implicitKey?n:Ii(n,t,Dc,ho(e,!1))}function Ss(r,e){let{singleQuote:t}=e.options,n;if(t===!1)n=Ci;else{let s=r.includes('"'),i=r.includes("'");s&&!i?n=Bc:i&&!s?n=Ci:n=t?Bc:Ci}return n(r,e)}var Fc;try{Fc=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch(r){Fc=/\n+(?!\n|$)/g}function fo({comment:r,type:e,value:t},n,s,i){let{blockQuote:a,commentString:o,lineWidth:u}=n.options;if(!a||/\n[\t ]+$/.test(t)||/^\s*$/.test(t))return Ss(t,n);let c=n.indent||(n.forceBlockIndent||po(t)?"  ":""),l=a==="literal"?!0:a==="folded"||e===N.BLOCK_FOLDED?!1:e===N.BLOCK_LITERAL?!0:!my(t,u,c.length);if(!t)return l?`|
`:`>
`;let d,f;for(f=t.length;f>0;--f){let _=t[f-1];if(_!==`
`&&_!=="	"&&_!==" ")break}let h=t.substring(f),p=h.indexOf(`
`);p===-1?d="-":t===h||p!==h.length-1?(d="+",i&&i()):d="",h&&(t=t.slice(0,-h.length),h[h.length-1]===`
`&&(h=h.slice(0,-1)),h=h.replace(Fc,`$&${c}`));let m=!1,g,y=-1;for(g=0;g<t.length;++g){let _=t[g];if(_===" ")m=!0;else if(_===`
`)y=g;else break}let b=t.substring(0,y<g?y+1:g);b&&(t=t.substring(b.length),b=b.replace(/\n+/g,`$&${c}`));let E=(l?"|":">")+(m?c?"2":"1":"")+d;if(r&&(E+=" "+o(r.replace(/ ?[\r\n]+/g," ")),s&&s()),l)return t=t.replace(/\n+/g,`$&${c}`),`${E}
${c}${b}${t}${h}`;t=t.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${c}`);let T=Ii(`${b}${t}${h}`,c,lo,ho(n,!0));return`${E}
${c}${T}`}function gy(r,e,t,n){let{type:s,value:i}=r,{actualString:a,implicitKey:o,indent:u,indentStep:c,inFlow:l}=e;if(o&&i.includes(`
`)||l&&/[[\]{},]/.test(i))return Ss(i,e);if(!i||/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(i))return o||l||!i.includes(`
`)?Ss(i,e):fo(r,e,t,n);if(!o&&!l&&s!==N.PLAIN&&i.includes(`
`))return fo(r,e,t,n);if(po(i)){if(u==="")return e.forceBlockIndent=!0,fo(r,e,t,n);if(o&&u===c)return Ss(i,e)}let d=i.replace(/\n+/g,`$&
${u}`);if(a){let f=m=>{var g;return m.default&&m.tag!=="tag:yaml.org,2002:str"&&((g=m.test)==null?void 0:g.test(d))},{compat:h,tags:p}=e.doc.schema;if(p.some(f)||h!=null&&h.some(f))return Ss(i,e)}return o?d:Ii(d,u,Dc,ho(e,!1))}function fn(r,e,t,n){let{implicitKey:s,inFlow:i}=e,a=typeof r.value=="string"?r:Object.assign({},r,{value:String(r.value)}),{type:o}=r;o!==N.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(a.value)&&(o=N.QUOTE_DOUBLE);let u=l=>{switch(l){case N.BLOCK_FOLDED:case N.BLOCK_LITERAL:return s||i?Ss(a.value,e):fo(a,e,t,n);case N.QUOTE_DOUBLE:return Ci(a.value,e);case N.QUOTE_SINGLE:return Bc(a.value,e);case N.PLAIN:return gy(a,e,t,n);default:return null}},c=u(o);if(c===null){let{defaultKeyType:l,defaultStringType:d}=e.options,f=s&&l||d;if(c=u(f),c===null)throw new Error(`Unsupported default string type ${f}`)}return c}function mo(r,e){let t=Object.assign({blockQuote:!0,commentString:bf,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},r.schema.toStringOptions,e),n;switch(t.collectionStyle){case"block":n=!1;break;case"flow":n=!0;break;default:n=null}return{anchors:new Set,doc:r,flowCollectionPadding:t.flowCollectionPadding?" ":"",indent:"",indentStep:typeof t.indent=="number"?" ".repeat(t.indent):"  ",inFlow:n,options:t}}function yy(r,e){var s,i,a,o;if(e.tag){let u=r.filter(c=>c.tag===e.tag);if(u.length>0)return(s=u.find(c=>c.format===e.format))!=null?s:u[0]}let t,n;if(G(e)){n=e.value;let u=r.filter(c=>{var l;return(l=c.identify)==null?void 0:l.call(c,n)});t=(i=u.find(c=>c.format===e.format))!=null?i:u.find(c=>!c.format)}else n=e,t=r.find(u=>u.nodeClass&&n instanceof u.nodeClass);if(!t){let u=(o=(a=n==null?void 0:n.constructor)==null?void 0:a.name)!=null?o:typeof n;throw new Error(`Tag not resolved for ${u} value`)}return t}function by(r,e,{anchors:t,doc:n}){if(!n.directives)return"";let s=[],i=(G(r)||ne(r))&&r.anchor;i&&oo(i)&&(t.add(i),s.push(`&${i}`));let a=r.tag?r.tag:e.default?null:e.tag;return a&&s.push(n.directives.tagString(a)),s.join(" ")}function nr(r,e,t,n){var u,c;if(Y(r))return r.toString(e,t,n);if(gt(r)){if(e.doc.directives)return r.toString(e);if((u=e.resolvedAliases)!=null&&u.has(r))throw new TypeError("Cannot stringify circular structure without alias nodes");e.resolvedAliases?e.resolvedAliases.add(r):e.resolvedAliases=new Set([r]),r=r.resolve(e.doc)}let s,i=ee(r)?r:e.doc.createNode(r,{onTagObj:l=>s=l});s||(s=yy(e.doc.schema.tags,i));let a=by(i,s,e);a.length>0&&(e.indentAtStart=((c=e.indentAtStart)!=null?c:0)+a.length+1);let o=typeof s.stringify=="function"?s.stringify(i,e,t,n):G(i)?fn(i,e,t,n):i.toString(e,t,n);return a?G(i)||o[0]==="{"||o[0]==="["?`${a} ${o}`:`${a}
${e.indent}${o}`:o}function wf({key:r,value:e},t,n,s){var F,S;let{allNullValues:i,doc:a,indent:o,indentStep:u,options:{commentString:c,indentSeq:l,simpleKeys:d}}=t,f=ee(r)&&r.comment||null;if(d){if(f)throw new Error("With simple keys, key nodes cannot have comments");if(ne(r)){let M="With simple keys, collection cannot be used as a key value";throw new Error(M)}}let h=!d&&(!r||f&&e==null&&!t.inFlow||ne(r)||(G(r)?r.type===N.BLOCK_FOLDED||r.type===N.BLOCK_LITERAL:typeof r=="object"));t=Object.assign({},t,{allNullValues:!1,implicitKey:!h&&(d||!i),indent:o+u});let p=!1,m=!1,g=nr(r,t,()=>p=!0,()=>m=!0);if(!h&&!t.inFlow&&g.length>1024){if(d)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");h=!0}if(t.inFlow){if(i||e==null)return p&&n&&n(),g===""?"?":h?`? ${g}`:g}else if(i&&!d||e==null&&h)return g=`? ${g}`,f&&!p?g+=Bt(g,t.indent,c(f)):m&&s&&s(),g;p&&(f=null),h?(f&&(g+=Bt(g,t.indent,c(f))),g=`? ${g}
${o}:`):(g=`${g}:`,f&&(g+=Bt(g,t.indent,c(f))));let y,b,O;ee(e)?(y=!!e.spaceBefore,b=e.commentBefore,O=e.comment):(y=!1,b=null,O=null,e&&typeof e=="object"&&(e=a.createNode(e))),t.implicitKey=!1,!h&&!f&&G(e)&&(t.indentAtStart=g.length+1),m=!1,!l&&u.length>=2&&!t.inFlow&&!h&&bt(e)&&!e.flow&&!e.tag&&!e.anchor&&(t.indent=t.indent.substring(2));let E=!1,T=nr(e,t,()=>E=!0,()=>m=!0),_=" ";if(f||y||b){if(_=y?`
`:"",b){let M=c(b);_+=`
${st(M,t.indent)}`}T===""&&!t.inFlow?_===`
`&&(_=`

`):_+=`
${t.indent}`}else if(!h&&ne(e)){let M=T[0],te=T.indexOf(`
`),ie=te!==-1,rt=(S=(F=t.inFlow)!=null?F:e.flow)!=null?S:e.items.length===0;if(ie||!rt){let Ee=!1;if(ie&&(M==="&"||M==="!")){let ve=T.indexOf(" ");M==="&"&&ve!==-1&&ve<te&&T[ve+1]==="!"&&(ve=T.indexOf(" ",ve+1)),(ve===-1||te<ve)&&(Ee=!0)}Ee||(_=`
${t.indent}`)}}else(T===""||T[0]===`
`)&&(_="");return g+=_+T,t.inFlow?E&&n&&n():O&&!E?g+=Bt(g,t.indent,c(O)):m&&s&&s(),g}function go(r,e){(r==="debug"||r==="warn")&&(typeof process!="undefined"&&process.emitWarning?process.emitWarning(e):console.warn(e))}var vf="<<";function yo(r,e,{key:t,value:n}){if(r!=null&&r.doc.schema.merge&&_y(t))if(n=gt(n)?n.resolve(r.doc):n,bt(n))for(let s of n.items)Uc(r,e,s);else if(Array.isArray(n))for(let s of n)Uc(r,e,s);else Uc(r,e,n);else{let s=be(t,"",r);if(e instanceof Map)e.set(s,be(n,s,r));else if(e instanceof Set)e.add(s);else{let i=wy(t,s,r),a=be(n,i,r);i in e?Object.defineProperty(e,i,{value:a,writable:!0,enumerable:!0,configurable:!0}):e[i]=a}}return e}var _y=r=>r===vf||G(r)&&r.value===vf&&(!r.type||r.type===N.PLAIN);function Uc(r,e,t){let n=r&&gt(t)?t.resolve(r.doc):t;if(!yt(n))throw new Error("Merge sources must be maps or map aliases");let s=n.toJSON(null,r,Map);for(let[i,a]of s)e instanceof Map?e.has(i)||e.set(i,a):e instanceof Set?e.add(i):Object.prototype.hasOwnProperty.call(e,i)||Object.defineProperty(e,i,{value:a,writable:!0,enumerable:!0,configurable:!0});return e}function wy(r,e,t){if(e===null)return"";if(typeof e!="object")return String(e);if(ee(r)&&(t!=null&&t.doc)){let n=mo(t.doc,{});n.anchors=new Set;for(let i of t.anchors.keys())n.anchors.add(i.anchor);n.inFlow=!0,n.inStringifyKey=!0;let s=r.toString(n);if(!t.mapKeyWarned){let i=JSON.stringify(s);i.length>40&&(i=i.substring(0,36)+'..."'),go(t.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${i}. Set mapAsMap: true to use object keys.`),t.mapKeyWarned=!0}return s}return JSON.stringify(e)}function Ts(r,e,t){let n=rr(r,void 0,t),s=rr(e,void 0,t);return new he(n,s)}var he=class r{constructor(e,t=null){Object.defineProperty(this,Le,{value:$c}),this.key=e,this.value=t}clone(e){let{key:t,value:n}=this;return ee(t)&&(t=t.clone(e)),ee(n)&&(n=n.clone(e)),new r(t,n)}toJSON(e,t){let n=t!=null&&t.mapAsMap?new Map:{};return yo(t,n,this)}toString(e,t,n){return e!=null&&e.doc?wf(this,e,t,n):JSON.stringify(this)}};function _o(r,e,t){var i;return(((i=e.inFlow)!=null?i:r.flow)?xy:vy)(r,e,t)}function vy({comment:r,items:e},t,{blockItemPrefix:n,flowChars:s,itemIndent:i,onChompKeep:a,onComment:o}){let{indent:u,options:{commentString:c}}=t,l=Object.assign({},t,{indent:i,type:null}),d=!1,f=[];for(let p=0;p<e.length;++p){let m=e[p],g=null;if(ee(m))!d&&m.spaceBefore&&f.push(""),bo(t,f,m.commentBefore,d),m.comment&&(g=m.comment);else if(Y(m)){let b=ee(m.key)?m.key:null;b&&(!d&&b.spaceBefore&&f.push(""),bo(t,f,b.commentBefore,d))}d=!1;let y=nr(m,l,()=>g=null,()=>d=!0);g&&(y+=Bt(y,i,c(g))),d&&g&&(d=!1),f.push(n+y)}let h;if(f.length===0)h=s.start+s.end;else{h=f[0];for(let p=1;p<f.length;++p){let m=f[p];h+=m?`
${u}${m}`:`
`}}return r?(h+=`
`+st(c(r),u),o&&o()):d&&a&&a(),h}function xy({items:r},e,{flowChars:t,itemIndent:n}){let{indent:s,indentStep:i,flowCollectionPadding:a,options:{commentString:o}}=e;n+=i;let u=Object.assign({},e,{indent:n,inFlow:!0,type:null}),c=!1,l=0,d=[];for(let p=0;p<r.length;++p){let m=r[p],g=null;if(ee(m))m.spaceBefore&&d.push(""),bo(e,d,m.commentBefore,!1),m.comment&&(g=m.comment);else if(Y(m)){let b=ee(m.key)?m.key:null;b&&(b.spaceBefore&&d.push(""),bo(e,d,b.commentBefore,!1),b.comment&&(c=!0));let O=ee(m.value)?m.value:null;O?(O.comment&&(g=O.comment),O.commentBefore&&(c=!0)):m.value==null&&(b!=null&&b.comment)&&(g=b.comment)}g&&(c=!0);let y=nr(m,u,()=>g=null);p<r.length-1&&(y+=","),g&&(y+=Bt(y,n,o(g))),!c&&(d.length>l||y.includes(`
`))&&(c=!0),d.push(y),l=d.length}let{start:f,end:h}=t;if(d.length===0)return f+h;if(!c){let p=d.reduce((m,g)=>m+g.length+2,2);c=e.options.lineWidth>0&&p>e.options.lineWidth}if(c){let p=f;for(let m of d)p+=m?`
${i}${s}${m}`:`
`;return`${p}
${s}${h}`}else return`${f}${a}${d.join(" ")}${a}${h}`}function bo({indent:r,options:{commentString:e}},t,n,s){if(n&&s&&(n=n.replace(/^\n+/,"")),n){let i=st(e(n),r);t.push(i.trimStart())}}function kr(r,e){let t=G(e)?e.value:e;for(let n of r)if(Y(n)&&(n.key===e||n.key===t||G(n.key)&&n.key.value===t))return n}var me=class extends dn{static get tagName(){return"tag:yaml.org,2002:map"}constructor(e){super(mt,e),this.items=[]}static from(e,t,n){let{keepUndefined:s,replacer:i}=n,a=new this(e),o=(u,c)=>{if(typeof i=="function")c=i.call(t,u,c);else if(Array.isArray(i)&&!i.includes(u))return;(c!==void 0||s)&&a.items.push(Ts(u,c,n))};if(t instanceof Map)for(let[u,c]of t)o(u,c);else if(t&&typeof t=="object")for(let u of Object.keys(t))o(u,t[u]);return typeof e.sortMapEntries=="function"&&a.items.sort(e.sortMapEntries),a}add(e,t){var a;let n;Y(e)?n=e:!e||typeof e!="object"||!("key"in e)?n=new he(e,e==null?void 0:e.value):n=new he(e.key,e.value);let s=kr(this.items,n.key),i=(a=this.schema)==null?void 0:a.sortMapEntries;if(s){if(!t)throw new Error(`Key ${n.key} already set`);G(s.value)&&co(n.value)?s.value.value=n.value:s.value=n.value}else if(i){let o=this.items.findIndex(u=>i(n,u)<0);o===-1?this.items.push(n):this.items.splice(o,0,n)}else this.items.push(n)}delete(e){let t=kr(this.items,e);return t?this.items.splice(this.items.indexOf(t),1).length>0:!1}get(e,t){var i;let n=kr(this.items,e),s=n==null?void 0:n.value;return(i=!t&&G(s)?s.value:s)!=null?i:void 0}has(e){return!!kr(this.items,e)}set(e,t){this.add(new he(e,t),!0)}toJSON(e,t,n){let s=n?new n:t!=null&&t.mapAsMap?new Map:{};t!=null&&t.onCreate&&t.onCreate(s);for(let i of this.items)yo(t,s,i);return s}toString(e,t,n){if(!e)return JSON.stringify(this);for(let s of this.items)if(!Y(s))throw new Error(`Map items must all be pairs; found ${JSON.stringify(s)} instead`);return!e.allNullValues&&this.hasAllNullValues(!1)&&(e=Object.assign({},e,{allNullValues:!0})),_o(this,e,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:e.indent||"",onChompKeep:n,onComment:t})}};var wt={collection:"map",default:!0,nodeClass:me,tag:"tag:yaml.org,2002:map",resolve(r,e){return yt(r)||e("Expected a mapping for this tag"),r},createNode:(r,e,t)=>me.from(r,e,t)};var Ie=class extends dn{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(e){super(Qt,e),this.items=[]}add(e){this.items.push(e)}delete(e){let t=wo(e);return typeof t!="number"?!1:this.items.splice(t,1).length>0}get(e,t){let n=wo(e);if(typeof n!="number")return;let s=this.items[n];return!t&&G(s)?s.value:s}has(e){let t=wo(e);return typeof t=="number"&&t<this.items.length}set(e,t){let n=wo(e);if(typeof n!="number")throw new Error(`Expected a valid index, not ${e}.`);let s=this.items[n];G(s)&&co(t)?s.value=t:this.items[n]=t}toJSON(e,t){let n=[];t!=null&&t.onCreate&&t.onCreate(n);let s=0;for(let i of this.items)n.push(be(i,String(s++),t));return n}toString(e,t,n){return e?_o(this,e,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(e.indent||"")+"  ",onChompKeep:n,onComment:t}):JSON.stringify(this)}static from(e,t,n){let{replacer:s}=n,i=new this(e);if(t&&Symbol.iterator in Object(t)){let a=0;for(let o of t){if(typeof s=="function"){let u=t instanceof Set?o:String(a++);o=s.call(t,u,o)}i.items.push(rr(o,void 0,n))}}return i}};function wo(r){let e=G(r)?r.value:r;return e&&typeof e=="string"&&(e=Number(e)),typeof e=="number"&&Number.isInteger(e)&&e>=0?e:null}var vt={collection:"seq",default:!0,nodeClass:Ie,tag:"tag:yaml.org,2002:seq",resolve(r,e){return bt(r)||e("Expected a sequence for this tag"),r},createNode:(r,e,t)=>Ie.from(r,e,t)};var Ir={identify:r=>typeof r=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:r=>r,stringify(r,e,t,n){return e=Object.assign({actualString:!0},e),fn(r,e,t,n)}};var hn={identify:r=>r==null,createNode:()=>new N(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new N(null),stringify:({source:r},e)=>typeof r=="string"&&hn.test.test(r)?r:e.options.nullStr};var Ni={identify:r=>typeof r=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:r=>new N(r[0]==="t"||r[0]==="T"),stringify({source:r,value:e},t){if(r&&Ni.test.test(r)){let n=r[0]==="t"||r[0]==="T";if(e===n)return r}return e?t.options.trueStr:t.options.falseStr}};function Ce({format:r,minFractionDigits:e,tag:t,value:n}){if(typeof n=="bigint")return String(n);let s=typeof n=="number"?n:Number(n);if(!isFinite(s))return isNaN(s)?".nan":s<0?"-.inf":".inf";let i=JSON.stringify(n);if(!r&&e&&(!t||t==="tag:yaml.org,2002:float")&&/^\d/.test(i)){let a=i.indexOf(".");a<0&&(a=i.length,i+=".");let o=e-(i.length-a-1);for(;o-- >0;)i+="0"}return i}var vo={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF|nan|NaN|NAN))$/,resolve:r=>r.slice(-3).toLowerCase()==="nan"?NaN:r[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:Ce},xo={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:r=>parseFloat(r),stringify(r){let e=Number(r.value);return isFinite(e)?e.toExponential():Ce(r)}},Ao={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(r){let e=new N(parseFloat(r)),t=r.indexOf(".");return t!==-1&&r[r.length-1]==="0"&&(e.minFractionDigits=r.length-t-1),e},stringify:Ce};var Oo=r=>typeof r=="bigint"||Number.isInteger(r),zc=(r,e,t,{intAsBigInt:n})=>n?BigInt(r):parseInt(r.substring(e),t);function xf(r,e,t){let{value:n}=r;return Oo(n)&&n>=0?t+n.toString(e):Ce(r)}var Eo={identify:r=>Oo(r)&&r>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(r,e,t)=>zc(r,2,8,t),stringify:r=>xf(r,8,"0o")},So={identify:Oo,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(r,e,t)=>zc(r,0,10,t),stringify:Ce},To={identify:r=>Oo(r)&&r>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(r,e,t)=>zc(r,2,16,t),stringify:r=>xf(r,16,"0x")};var Af=[wt,vt,Ir,hn,Ni,Eo,So,To,vo,xo,Ao];function Of(r){return typeof r=="bigint"||Number.isInteger(r)}var Po=({value:r})=>JSON.stringify(r),Ay=[{identify:r=>typeof r=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:r=>r,stringify:Po},{identify:r=>r==null,createNode:()=>new N(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:Po},{identify:r=>typeof r=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true|false$/,resolve:r=>r==="true",stringify:Po},{identify:Of,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(r,e,{intAsBigInt:t})=>t?BigInt(r):parseInt(r,10),stringify:({value:r})=>Of(r)?r.toString():JSON.stringify(r)},{identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:r=>parseFloat(r),stringify:Po}],Oy={default:!0,tag:"",test:/^/,resolve(r,e){return e(`Unresolved plain scalar ${JSON.stringify(r)}`),r}},Ef=[wt,vt].concat(Ay,Oy);var Ri={identify:r=>r instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(r,e){if(typeof Buffer=="function")return Buffer.from(r,"base64");if(typeof atob=="function"){let t=atob(r.replace(/[\n\r]/g,"")),n=new Uint8Array(t.length);for(let s=0;s<t.length;++s)n[s]=t.charCodeAt(s);return n}else return e("This environment does not support reading binary tags; either Buffer or atob is required"),r},stringify({comment:r,type:e,value:t},n,s,i){let a=t,o;if(typeof Buffer=="function")o=a instanceof Buffer?a.toString("base64"):Buffer.from(a.buffer).toString("base64");else if(typeof btoa=="function"){let u="";for(let c=0;c<a.length;++c)u+=String.fromCharCode(a[c]);o=btoa(u)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(e||(e=N.BLOCK_LITERAL),e!==N.QUOTE_DOUBLE){let u=Math.max(n.options.lineWidth-n.indent.length,n.options.minContentWidth),c=Math.ceil(o.length/u),l=new Array(c);for(let d=0,f=0;d<c;++d,f+=u)l[d]=o.substr(f,u);o=l.join(e===N.BLOCK_LITERAL?`
`:" ")}return fn({comment:r,type:e,value:o},n,s,i)}};function Kc(r,e){var t;if(bt(r))for(let n=0;n<r.items.length;++n){let s=r.items[n];if(!Y(s)){if(yt(s)){s.items.length>1&&e("Each pair must have its own sequence indicator");let i=s.items[0]||new he(new N(null));if(s.commentBefore&&(i.key.commentBefore=i.key.commentBefore?`${s.commentBefore}
${i.key.commentBefore}`:s.commentBefore),s.comment){let a=(t=i.value)!=null?t:i.key;a.comment=a.comment?`${s.comment}
${a.comment}`:s.comment}s=i}r.items[n]=Y(s)?s:new he(s)}}else e("Expected a sequence for this tag");return r}function qc(r,e,t){let{replacer:n}=t,s=new Ie(r);s.tag="tag:yaml.org,2002:pairs";let i=0;if(e&&Symbol.iterator in Object(e))for(let a of e){typeof n=="function"&&(a=n.call(e,String(i++),a));let o,u;if(Array.isArray(a))if(a.length===2)o=a[0],u=a[1];else throw new TypeError(`Expected [key, value] tuple: ${a}`);else if(a&&a instanceof Object){let c=Object.keys(a);if(c.length===1)o=c[0],u=a[o];else throw new TypeError(`Expected tuple with one key, not ${c.length} keys`)}else o=a;s.items.push(Ts(o,u,t))}return s}var ji={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:Kc,createNode:qc};var Ps=class r extends Ie{constructor(){super(),this.add=me.prototype.add.bind(this),this.delete=me.prototype.delete.bind(this),this.get=me.prototype.get.bind(this),this.has=me.prototype.has.bind(this),this.set=me.prototype.set.bind(this),this.tag=r.tag}toJSON(e,t){if(!t)return super.toJSON(e);let n=new Map;t!=null&&t.onCreate&&t.onCreate(n);for(let s of this.items){let i,a;if(Y(s)?(i=be(s.key,"",t),a=be(s.value,i,t)):i=be(s,"",t),n.has(i))throw new Error("Ordered maps must not include duplicate keys");n.set(i,a)}return n}static from(e,t,n){let s=qc(e,t,n),i=new this;return i.items=s.items,i}};Ps.tag="tag:yaml.org,2002:omap";var $i={collection:"seq",identify:r=>r instanceof Map,nodeClass:Ps,default:!1,tag:"tag:yaml.org,2002:omap",resolve(r,e){let t=Kc(r,e),n=[];for(let{key:s}of t.items)G(s)&&(n.includes(s.value)?e(`Ordered maps must not include duplicate keys: ${s.value}`):n.push(s.value));return Object.assign(new Ps,t)},createNode:(r,e,t)=>Ps.from(r,e,t)};function Sf({value:r,source:e},t){return e&&(r?Vc:Zc).test.test(e)?e:r?t.options.trueStr:t.options.falseStr}var Vc={identify:r=>r===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new N(!0),stringify:Sf},Zc={identify:r=>r===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/i,resolve:()=>new N(!1),stringify:Sf};var Tf={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?\.(?:inf|Inf|INF|nan|NaN|NAN)$/,resolve:r=>r.slice(-3).toLowerCase()==="nan"?NaN:r[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:Ce},Pf={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:r=>parseFloat(r.replace(/_/g,"")),stringify(r){let e=Number(r.value);return isFinite(e)?e.toExponential():Ce(r)}},kf={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(r){let e=new N(parseFloat(r.replace(/_/g,""))),t=r.indexOf(".");if(t!==-1){let n=r.substring(t+1).replace(/_/g,"");n[n.length-1]==="0"&&(e.minFractionDigits=n.length)}return e},stringify:Ce};var Mi=r=>typeof r=="bigint"||Number.isInteger(r);function ko(r,e,t,{intAsBigInt:n}){let s=r[0];if((s==="-"||s==="+")&&(e+=1),r=r.substring(e).replace(/_/g,""),n){switch(t){case 2:r=`0b${r}`;break;case 8:r=`0o${r}`;break;case 16:r=`0x${r}`;break}let a=BigInt(r);return s==="-"?BigInt(-1)*a:a}let i=parseInt(r,t);return s==="-"?-1*i:i}function Hc(r,e,t){let{value:n}=r;if(Mi(n)){let s=n.toString(e);return n<0?"-"+t+s.substr(1):t+s}return Ce(r)}var If={identify:Mi,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(r,e,t)=>ko(r,2,2,t),stringify:r=>Hc(r,2,"0b")},Cf={identify:Mi,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(r,e,t)=>ko(r,1,8,t),stringify:r=>Hc(r,8,"0")},Nf={identify:Mi,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(r,e,t)=>ko(r,0,10,t),stringify:Ce},Rf={identify:Mi,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(r,e,t)=>ko(r,2,16,t),stringify:r=>Hc(r,16,"0x")};var ks=class r extends me{constructor(e){super(e),this.tag=r.tag}add(e){let t;Y(e)?t=e:e&&typeof e=="object"&&"key"in e&&"value"in e&&e.value===null?t=new he(e.key,null):t=new he(e,null),kr(this.items,t.key)||this.items.push(t)}get(e,t){let n=kr(this.items,e);return!t&&Y(n)?G(n.key)?n.key.value:n.key:n}set(e,t){if(typeof t!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof t}`);let n=kr(this.items,e);n&&!t?this.items.splice(this.items.indexOf(n),1):!n&&t&&this.items.push(new he(e))}toJSON(e,t){return super.toJSON(e,t,Set)}toString(e,t,n){if(!e)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},e,{allNullValues:!0}),t,n);throw new Error("Set items must all have null values")}static from(e,t,n){let{replacer:s}=n,i=new this(e);if(t&&Symbol.iterator in Object(t))for(let a of t)typeof s=="function"&&(a=s.call(t,a,a)),i.items.push(Ts(a,null,n));return i}};ks.tag="tag:yaml.org,2002:set";var Li={collection:"map",identify:r=>r instanceof Set,nodeClass:ks,default:!1,tag:"tag:yaml.org,2002:set",createNode:(r,e,t)=>ks.from(r,e,t),resolve(r,e){if(yt(r)){if(r.hasAllNullValues(!0))return Object.assign(new ks,r);e("Set items must all have null values")}else e("Expected a mapping for this tag");return r}};function Gc(r,e){let t=r[0],n=t==="-"||t==="+"?r.substring(1):r,s=a=>e?BigInt(a):Number(a),i=n.replace(/_/g,"").split(":").reduce((a,o)=>a*s(60)+s(o),s(0));return t==="-"?s(-1)*i:i}function jf(r){let{value:e}=r,t=a=>a;if(typeof e=="bigint")t=a=>BigInt(a);else if(isNaN(e)||!isFinite(e))return Ce(r);let n="";e<0&&(n="-",e*=t(-1));let s=t(60),i=[e%s];return e<60?i.unshift(0):(e=(e-i[0])/s,i.unshift(e%s),e>=60&&(e=(e-i[0])/s,i.unshift(e))),n+i.map(a=>String(a).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}var Io={identify:r=>typeof r=="bigint"||Number.isInteger(r),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(r,e,{intAsBigInt:t})=>Gc(r,t),stringify:jf},Co={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:r=>Gc(r,!1),stringify:jf},Is={identify:r=>r instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(r){let e=r.match(Is.test);if(!e)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");let[,t,n,s,i,a,o]=e.map(Number),u=e[7]?Number((e[7]+"00").substr(1,3)):0,c=Date.UTC(t,n-1,s,i||0,a||0,o||0,u),l=e[8];if(l&&l!=="Z"){let d=Gc(l,!1);Math.abs(d)<30&&(d*=60),c-=6e4*d}return new Date(c)},stringify:({value:r})=>r.toISOString().replace(/((T00:00)?:00)?\.000Z$/,"")};var Jc=[wt,vt,Ir,hn,Vc,Zc,If,Cf,Nf,Rf,Tf,Pf,kf,Ri,$i,ji,Li,Io,Co,Is];var $f=new Map([["core",Af],["failsafe",[wt,vt,Ir]],["json",Ef],["yaml11",Jc],["yaml-1.1",Jc]]),Mf={binary:Ri,bool:Ni,float:Ao,floatExp:xo,floatNaN:vo,floatTime:Co,int:So,intHex:To,intOct:Eo,intTime:Io,map:wt,null:hn,omap:$i,pairs:ji,seq:vt,set:Li,timestamp:Is},Lf={"tag:yaml.org,2002:binary":Ri,"tag:yaml.org,2002:omap":$i,"tag:yaml.org,2002:pairs":ji,"tag:yaml.org,2002:set":Li,"tag:yaml.org,2002:timestamp":Is};function No(r,e){let t=$f.get(e);if(!t)if(Array.isArray(r))t=[];else{let n=Array.from($f.keys()).filter(s=>s!=="yaml11").map(s=>JSON.stringify(s)).join(", ");throw new Error(`Unknown schema "${e}"; use one of ${n} or define customTags array`)}if(Array.isArray(r))for(let n of r)t=t.concat(n);else typeof r=="function"&&(t=r(t.slice()));return t.map(n=>{if(typeof n!="string")return n;let s=Mf[n];if(s)return s;let i=Object.keys(Mf).map(a=>JSON.stringify(a)).join(", ");throw new Error(`Unknown custom tag "${n}"; use one of ${i}`)})}var Ey=(r,e)=>r.key<e.key?-1:r.key>e.key?1:0,Di=class r{constructor({compat:e,customTags:t,merge:n,resolveKnownTags:s,schema:i,sortMapEntries:a,toStringDefaults:o}){this.compat=Array.isArray(e)?No(e,"compat"):e?No(null,e):null,this.merge=!!n,this.name=typeof i=="string"&&i||"core",this.knownTags=s?Lf:{},this.tags=No(t,this.name),this.toStringOptions=o!=null?o:null,Object.defineProperty(this,mt,{value:wt}),Object.defineProperty(this,nt,{value:Ir}),Object.defineProperty(this,Qt,{value:vt}),this.sortMapEntries=typeof a=="function"?a:a===!0?Ey:null}clone(){let e=Object.create(r.prototype,Object.getOwnPropertyDescriptors(this));return e.tags=this.tags.slice(),e}};function Df(r,e){var u;let t=[],n=e.directives===!0;if(e.directives!==!1&&r.directives){let c=r.directives.toString(r);c?(t.push(c),n=!0):r.directives.docStart&&(n=!0)}n&&t.push("---");let s=mo(r,e),{commentString:i}=s.options;if(r.commentBefore){t.length!==1&&t.unshift("");let c=i(r.commentBefore);t.unshift(st(c,""))}let a=!1,o=null;if(r.contents){if(ee(r.contents)){if(r.contents.spaceBefore&&n&&t.push(""),r.contents.commentBefore){let d=i(r.contents.commentBefore);t.push(st(d,""))}s.forceBlockIndent=!!r.comment,o=r.contents.comment}let c=o?void 0:()=>a=!0,l=nr(r.contents,s,()=>o=null,c);o&&(l+=Bt(l,"",i(o))),(l[0]==="|"||l[0]===">")&&t[t.length-1]==="---"?t[t.length-1]=`--- ${l}`:t.push(l)}else t.push(nr(r.contents,s));if((u=r.directives)!=null&&u.docEnd)if(r.comment){let c=i(r.comment);c.includes(`
`)?(t.push("..."),t.push(st(c,""))):t.push(`... ${c}`)}else t.push("...");else{let c=r.comment;c&&a&&(c=c.replace(/^\n+/,"")),c&&((!a||o)&&t[t.length-1]!==""&&t.push(""),t.push(st(i(c),"")))}return t.join(`
`)+`
`}var sr=class r{constructor(e,t,n){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,Le,{value:io});let s=null;typeof t=="function"||Array.isArray(t)?s=t:n===void 0&&t&&(n=t,t=void 0);let i=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,uniqueKeys:!0,version:"1.2"},n);this.options=i;let{version:a}=i;n!=null&&n._directives?(this.directives=n._directives.atDocument(),this.directives.yaml.explicit&&(a=this.directives.yaml.version)):this.directives=new Dt({version:a}),this.setSchema(a,n),this.contents=e===void 0?null:this.createNode(e,s,n)}clone(){let e=Object.create(r.prototype,{[Le]:{value:io}});return e.commentBefore=this.commentBefore,e.comment=this.comment,e.errors=this.errors.slice(),e.warnings=this.warnings.slice(),e.options=Object.assign({},this.options),this.directives&&(e.directives=this.directives.clone()),e.schema=this.schema.clone(),e.contents=ee(this.contents)?this.contents.clone(e.schema):this.contents,this.range&&(e.range=this.range.slice()),e}add(e){Cs(this.contents)&&this.contents.add(e)}addIn(e,t){Cs(this.contents)&&this.contents.addIn(e,t)}createAlias(e,t){if(!e.anchor){let n=Mc(this);e.anchor=!t||n.has(t)?Lc(t||"a",n):t}return new tr(e.anchor)}createNode(e,t,n){let s;if(typeof t=="function")e=t.call({"":e},"",e),s=t;else if(Array.isArray(t)){let g=b=>typeof b=="number"||b instanceof String||b instanceof Number,y=t.filter(g).map(String);y.length>0&&(t=t.concat(y)),s=t}else n===void 0&&t&&(n=t,t=void 0);let{aliasDuplicateObjects:i,anchorPrefix:a,flow:o,keepUndefined:u,onTagObj:c,tag:l}=n!=null?n:{},{onAnchor:d,setAnchors:f,sourceObjects:h}=yf(this,a||"a"),p={aliasDuplicateObjects:i!=null?i:!0,keepUndefined:u!=null?u:!1,onAnchor:d,onTagObj:c,replacer:s,schema:this.schema,sourceObjects:h},m=rr(e,l,p);return o&&ne(m)&&(m.flow=!0),f(),m}createPair(e,t,n={}){let s=this.createNode(e,null,n),i=this.createNode(t,null,n);return new he(s,i)}delete(e){return Cs(this.contents)?this.contents.delete(e):!1}deleteIn(e){return Es(e)?this.contents==null?!1:(this.contents=null,!0):Cs(this.contents)?this.contents.deleteIn(e):!1}get(e,t){return ne(this.contents)?this.contents.get(e,t):void 0}getIn(e,t){return Es(e)?!t&&G(this.contents)?this.contents.value:this.contents:ne(this.contents)?this.contents.getIn(e,t):void 0}has(e){return ne(this.contents)?this.contents.has(e):!1}hasIn(e){return Es(e)?this.contents!==void 0:ne(this.contents)?this.contents.hasIn(e):!1}set(e,t){this.contents==null?this.contents=Pi(this.schema,[e],t):Cs(this.contents)&&this.contents.set(e,t)}setIn(e,t){Es(e)?this.contents=t:this.contents==null?this.contents=Pi(this.schema,Array.from(e),t):Cs(this.contents)&&this.contents.setIn(e,t)}setSchema(e,t={}){typeof e=="number"&&(e=String(e));let n;switch(e){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new Dt({version:"1.1"}),n={merge:!0,resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=e:this.directives=new Dt({version:e}),n={merge:!1,resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,n=null;break;default:{let s=JSON.stringify(e);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${s}`)}}if(t.schema instanceof Object)this.schema=t.schema;else if(n)this.schema=new Di(Object.assign(n,t));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:e,jsonArg:t,mapAsMap:n,maxAliasCount:s,onAnchor:i,reviver:a}={}){let o={anchors:new Map,doc:this,keep:!e,mapAsMap:n===!0,mapKeyWarned:!1,maxAliasCount:typeof s=="number"?s:100},u=be(this.contents,t!=null?t:"",o);if(typeof i=="function")for(let{count:c,res:l}of o.anchors.values())i(l,c);return typeof a=="function"?Tr(a,{"":u},"",u):u}toJSON(e,t){return this.toJS({json:!0,jsonArg:e,mapAsMap:!1,onAnchor:t})}toString(e={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in e&&(!Number.isInteger(e.indent)||Number(e.indent)<=0)){let t=JSON.stringify(e.indent);throw new Error(`"indent" option must be a positive integer, not ${t}`)}return Df(this,e)}};function Cs(r){if(ne(r))return!0;throw new Error("Expected a YAML collection as document contents")}var Bi=class extends Error{constructor(e,t,n,s){super(),this.name=e,this.code=n,this.message=s,this.pos=t}},xt=class extends Bi{constructor(e,t,n){super("YAMLParseError",e,t,n)}},Fi=class extends Bi{constructor(e,t,n){super("YAMLWarning",e,t,n)}},Wc=(r,e)=>t=>{if(t.pos[0]===-1)return;t.linePos=t.pos.map(o=>e.linePos(o));let{line:n,col:s}=t.linePos[0];t.message+=` at line ${n}, column ${s}`;let i=s-1,a=r.substring(e.lineStarts[n-1],e.lineStarts[n]).replace(/[\n\r]+$/,"");if(i>=60&&a.length>80){let o=Math.min(i-39,a.length-79);a="\u2026"+a.substring(o),i-=o-1}if(a.length>80&&(a=a.substring(0,79)+"\u2026"),n>1&&/^ *$/.test(a.substring(0,i))){let o=r.substring(e.lineStarts[n-2],e.lineStarts[n-1]);o.length>80&&(o=o.substring(0,79)+`\u2026
`),a=o+a}if(/[^ ]/.test(a)){let o=1,u=t.linePos[1];u&&u.line===n&&u.col>s&&(o=Math.max(1,Math.min(u.col-s,80-i)));let c=" ".repeat(i)+"^".repeat(o);t.message+=`:

${a}
${c}
`}};function Ft(r,{flow:e,indicator:t,next:n,offset:s,onError:i,startOnNewline:a}){let o=!1,u=a,c=a,l="",d="",f=!1,h=!1,p=!1,m=null,g=null,y=null,b=null,O=null;for(let _ of r)switch(p&&(_.type!=="space"&&_.type!=="newline"&&_.type!=="comma"&&i(_.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),p=!1),_.type){case"space":!e&&u&&t!=="doc-start"&&_.source[0]==="	"&&i(_,"TAB_AS_INDENT","Tabs are not allowed as indentation"),c=!0;break;case"comment":{c||i(_,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");let F=_.source.substring(1)||" ";l?l+=d+F:l=F,d="",u=!1;break}case"newline":u?l?l+=_.source:o=!0:d+=_.source,u=!0,f=!0,(m||g)&&(h=!0),c=!0;break;case"anchor":m&&i(_,"MULTIPLE_ANCHORS","A node can have at most one anchor"),_.source.endsWith(":")&&i(_.offset+_.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),m=_,O===null&&(O=_.offset),u=!1,c=!1,p=!0;break;case"tag":{g&&i(_,"MULTIPLE_TAGS","A node can have at most one tag"),g=_,O===null&&(O=_.offset),u=!1,c=!1,p=!0;break}case t:(m||g)&&i(_,"BAD_PROP_ORDER",`Anchors and tags must be after the ${_.source} indicator`),b&&i(_,"UNEXPECTED_TOKEN",`Unexpected ${_.source} in ${e!=null?e:"collection"}`),b=_,u=!1,c=!1;break;case"comma":if(e){y&&i(_,"UNEXPECTED_TOKEN",`Unexpected , in ${e}`),y=_,u=!1,c=!1;break}default:i(_,"UNEXPECTED_TOKEN",`Unexpected ${_.type} token`),u=!1,c=!1}let E=r[r.length-1],T=E?E.offset+E.source.length:s;return p&&n&&n.type!=="space"&&n.type!=="newline"&&n.type!=="comma"&&(n.type!=="scalar"||n.source!=="")&&i(n.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),{comma:y,found:b,spaceBefore:o,comment:l,hasNewline:f,hasNewlineAfterProp:h,anchor:m,tag:g,end:T,start:O!=null?O:T}}function Cr(r){if(!r)return null;switch(r.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(r.source.includes(`
`))return!0;if(r.end){for(let e of r.end)if(e.type==="newline")return!0}return!1;case"flow-collection":for(let e of r.items){for(let t of e.start)if(t.type==="newline")return!0;if(e.sep){for(let t of e.sep)if(t.type==="newline")return!0}if(Cr(e.key)||Cr(e.value))return!0}return!1;default:return!0}}function Ui(r,e,t){if((e==null?void 0:e.type)==="flow-collection"){let n=e.end[0];n.indent===r&&(n.source==="]"||n.source==="}")&&Cr(e)&&t(n,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}function Ro(r,e,t){let{uniqueKeys:n}=r.options;if(n===!1)return!1;let s=typeof n=="function"?n:(i,a)=>i===a||G(i)&&G(a)&&i.value===a.value&&!(i.value==="<<"&&r.schema.merge);return e.some(i=>s(i.key,t))}var Bf="All mapping items must start at the same column";function Ff({composeNode:r,composeEmptyNode:e},t,n,s,i){var l,d;let a=(l=i==null?void 0:i.nodeClass)!=null?l:me,o=new a(t.schema);t.atRoot&&(t.atRoot=!1);let u=n.offset,c=null;for(let f of n.items){let{start:h,key:p,sep:m,value:g}=f,y=Ft(h,{indicator:"explicit-key-ind",next:p!=null?p:m==null?void 0:m[0],offset:u,onError:s,startOnNewline:!0}),b=!y.found;if(b){if(p&&(p.type==="block-seq"?s(u,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in p&&p.indent!==n.indent&&s(u,"BAD_INDENT",Bf)),!y.anchor&&!y.tag&&!m){c=y.end,y.comment&&(o.comment?o.comment+=`
`+y.comment:o.comment=y.comment);continue}(y.hasNewlineAfterProp||Cr(p))&&s(p!=null?p:h[h.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else((d=y.found)==null?void 0:d.indent)!==n.indent&&s(u,"BAD_INDENT",Bf);let O=y.end,E=p?r(t,p,y,s):e(t,O,h,null,y,s);t.schema.compat&&Ui(n.indent,p,s),Ro(t,o.items,E)&&s(O,"DUPLICATE_KEY","Map keys must be unique");let T=Ft(m!=null?m:[],{indicator:"map-value-ind",next:g,offset:E.range[2],onError:s,startOnNewline:!p||p.type==="block-scalar"});if(u=T.end,T.found){b&&((g==null?void 0:g.type)==="block-map"&&!T.hasNewline&&s(u,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),t.options.strict&&y.start<T.found.offset-1024&&s(E.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));let _=g?r(t,g,T,s):e(t,u,m,null,T,s);t.schema.compat&&Ui(n.indent,g,s),u=_.range[2];let F=new he(E,_);t.options.keepSourceTokens&&(F.srcToken=f),o.items.push(F)}else{b&&s(E.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),T.comment&&(E.comment?E.comment+=`
`+T.comment:E.comment=T.comment);let _=new he(E);t.options.keepSourceTokens&&(_.srcToken=f),o.items.push(_)}}return c&&c<u&&s(c,"IMPOSSIBLE","Map comment with trailing content"),o.range=[n.offset,u,c!=null?c:u],o}function Uf({composeNode:r,composeEmptyNode:e},t,n,s,i){var l;let a=(l=i==null?void 0:i.nodeClass)!=null?l:Ie,o=new a(t.schema);t.atRoot&&(t.atRoot=!1);let u=n.offset,c=null;for(let{start:d,value:f}of n.items){let h=Ft(d,{indicator:"seq-item-ind",next:f,offset:u,onError:s,startOnNewline:!0});if(!h.found)if(h.anchor||h.tag||f)f&&f.type==="block-seq"?s(h.end,"BAD_INDENT","All sequence items must start at the same column"):s(u,"MISSING_CHAR","Sequence item without - indicator");else{c=h.end,h.comment&&(o.comment=h.comment);continue}let p=f?r(t,f,h,s):e(t,h.end,d,null,h,s);t.schema.compat&&Ui(n.indent,f,s),u=p.range[2],o.items.push(p)}return o.range=[n.offset,u,c!=null?c:u],o}function Ut(r,e,t,n){let s="";if(r){let i=!1,a="";for(let o of r){let{source:u,type:c}=o;switch(c){case"space":i=!0;break;case"comment":{t&&!i&&n(o,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");let l=u.substring(1)||" ";s?s+=a+l:s=l,a="";break}case"newline":s&&(a+=u),i=!0;break;default:n(o,"UNEXPECTED_TOKEN",`Unexpected ${c} at node end`)}e+=u.length}}return{comment:s,offset:e}}var Yc="Block collections are not allowed within flow collections",Xc=r=>r&&(r.type==="block-map"||r.type==="block-seq");function zf({composeNode:r,composeEmptyNode:e},t,n,s,i){var g,y;let a=n.start.source==="{",o=a?"flow map":"flow sequence",u=(g=i==null?void 0:i.nodeClass)!=null?g:a?me:Ie,c=new u(t.schema);c.flow=!0;let l=t.atRoot;l&&(t.atRoot=!1);let d=n.offset+n.start.source.length;for(let b=0;b<n.items.length;++b){let O=n.items[b],{start:E,key:T,sep:_,value:F}=O,S=Ft(E,{flow:o,indicator:"explicit-key-ind",next:T!=null?T:_==null?void 0:_[0],offset:d,onError:s,startOnNewline:!1});if(!S.found){if(!S.anchor&&!S.tag&&!_&&!F){b===0&&S.comma?s(S.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${o}`):b<n.items.length-1&&s(S.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${o}`),S.comment&&(c.comment?c.comment+=`
`+S.comment:c.comment=S.comment),d=S.end;continue}!a&&t.options.strict&&Cr(T)&&s(T,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(b===0)S.comma&&s(S.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${o}`);else if(S.comma||s(S.start,"MISSING_CHAR",`Missing , between ${o} items`),S.comment){let M="";e:for(let te of E)switch(te.type){case"comma":case"space":break;case"comment":M=te.source.substring(1);break e;default:break e}if(M){let te=c.items[c.items.length-1];Y(te)&&(te=(y=te.value)!=null?y:te.key),te.comment?te.comment+=`
`+M:te.comment=M,S.comment=S.comment.substring(M.length+1)}}if(!a&&!_&&!S.found){let M=F?r(t,F,S,s):e(t,S.end,_,null,S,s);c.items.push(M),d=M.range[2],Xc(F)&&s(M.range,"BLOCK_IN_FLOW",Yc)}else{let M=S.end,te=T?r(t,T,S,s):e(t,M,E,null,S,s);Xc(T)&&s(te.range,"BLOCK_IN_FLOW",Yc);let ie=Ft(_!=null?_:[],{flow:o,indicator:"map-value-ind",next:F,offset:te.range[2],onError:s,startOnNewline:!1});if(ie.found){if(!a&&!S.found&&t.options.strict){if(_)for(let ve of _){if(ve===ie.found)break;if(ve.type==="newline"){s(ve,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}S.start<ie.found.offset-1024&&s(ie.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else F&&("source"in F&&F.source&&F.source[0]===":"?s(F,"MISSING_CHAR",`Missing space after : in ${o}`):s(ie.start,"MISSING_CHAR",`Missing , or : between ${o} items`));let rt=F?r(t,F,ie,s):ie.found?e(t,ie.end,_,null,ie,s):null;rt?Xc(F)&&s(rt.range,"BLOCK_IN_FLOW",Yc):ie.comment&&(te.comment?te.comment+=`
`+ie.comment:te.comment=ie.comment);let Ee=new he(te,rt);if(t.options.keepSourceTokens&&(Ee.srcToken=O),a){let ve=c;Ro(t,ve.items,te)&&s(M,"DUPLICATE_KEY","Map keys must be unique"),ve.items.push(Ee)}else{let ve=new me(t.schema);ve.flow=!0,ve.items.push(Ee),c.items.push(ve)}d=rt?rt.range[2]:ie.end}}let f=a?"}":"]",[h,...p]=n.end,m=d;if(h&&h.source===f)m=h.offset+h.source.length;else{let b=o[0].toUpperCase()+o.substring(1),O=l?`${b} must end with a ${f}`:`${b} in block collection must be sufficiently indented and end with a ${f}`;s(d,l?"MISSING_CHAR":"BAD_INDENT",O),h&&h.source.length!==1&&p.unshift(h)}if(p.length>0){let b=Ut(p,m,t.options.strict,s);b.comment&&(c.comment?c.comment+=`
`+b.comment:c.comment=b.comment),c.range=[n.offset,m,b.offset]}else c.range=[n.offset,m,m];return c}function Qc(r,e,t,n,s,i){let a=t.type==="block-map"?Ff(r,e,t,n,i):t.type==="block-seq"?Uf(r,e,t,n,i):zf(r,e,t,n,i),o=a.constructor;return s==="!"||s===o.tagName?(a.tag=o.tagName,a):(s&&(a.tag=s),a)}function Kf(r,e,t,n,s){var d,f;let i=n?e.directives.tagName(n.source,h=>s(n,"TAG_RESOLVE_FAILED",h)):null,a=t.type==="block-map"?"map":t.type==="block-seq"?"seq":t.start.source==="{"?"map":"seq";if(!n||!i||i==="!"||i===me.tagName&&a==="map"||i===Ie.tagName&&a==="seq"||!a)return Qc(r,e,t,s,i);let o=e.schema.tags.find(h=>h.tag===i&&h.collection===a);if(!o){let h=e.schema.knownTags[i];if(h&&h.collection===a)e.schema.tags.push(Object.assign({},h,{default:!1})),o=h;else return h!=null&&h.collection?s(n,"BAD_COLLECTION_TYPE",`${h.tag} used for ${a} collection, but expects ${h.collection}`,!0):s(n,"TAG_RESOLVE_FAILED",`Unresolved tag: ${i}`,!0),Qc(r,e,t,s,i)}let u=Qc(r,e,t,s,i,o),c=(f=(d=o.resolve)==null?void 0:d.call(o,u,h=>s(n,"TAG_RESOLVE_FAILED",h),e.options))!=null?f:u,l=ee(c)?c:new N(c);return l.range=u.range,l.tag=i,o!=null&&o.format&&(l.format=o.format),l}function el(r,e,t){let n=r.offset,s=Sy(r,e,t);if(!s)return{value:"",type:null,comment:"",range:[n,n,n]};let i=s.mode===">"?N.BLOCK_FOLDED:N.BLOCK_LITERAL,a=r.source?Ty(r.source):[],o=a.length;for(let m=a.length-1;m>=0;--m){let g=a[m][1];if(g===""||g==="\r")o=m;else break}if(o===0){let m=s.chomp==="+"&&a.length>0?`
`.repeat(Math.max(1,a.length-1)):"",g=n+s.length;return r.source&&(g+=r.source.length),{value:m,type:i,comment:s.comment,range:[n,g,g]}}let u=r.indent+s.indent,c=r.offset+s.length,l=0;for(let m=0;m<o;++m){let[g,y]=a[m];if(y===""||y==="\r")s.indent===0&&g.length>u&&(u=g.length);else{g.length<u&&t(c+g.length,"MISSING_CHAR","Block scalars with more-indented leading empty lines must use an explicit indentation indicator"),s.indent===0&&(u=g.length),l=m;break}c+=g.length+y.length+1}for(let m=a.length-1;m>=o;--m)a[m][0].length>u&&(o=m+1);let d="",f="",h=!1;for(let m=0;m<l;++m)d+=a[m][0].slice(u)+`
`;for(let m=l;m<o;++m){let[g,y]=a[m];c+=g.length+y.length+1;let b=y[y.length-1]==="\r";if(b&&(y=y.slice(0,-1)),y&&g.length<u){let E=`Block scalar lines must not be less indented than their ${s.indent?"explicit indentation indicator":"first line"}`;t(c-y.length-(b?2:1),"BAD_INDENT",E),g=""}i===N.BLOCK_LITERAL?(d+=f+g.slice(u)+y,f=`
`):g.length>u||y[0]==="	"?(f===" "?f=`
`:!h&&f===`
`&&(f=`

`),d+=f+g.slice(u)+y,f=`
`,h=!0):y===""?f===`
`?d+=`
`:f=`
`:(d+=f+y,f=" ",h=!1)}switch(s.chomp){case"-":break;case"+":for(let m=o;m<a.length;++m)d+=`
`+a[m][0].slice(u);d[d.length-1]!==`
`&&(d+=`
`);break;default:d+=`
`}let p=n+s.length+r.source.length;return{value:d,type:i,comment:s.comment,range:[n,p,p]}}function Sy({offset:r,props:e},t,n){if(e[0].type!=="block-scalar-header")return n(e[0],"IMPOSSIBLE","Block scalar header not found"),null;let{source:s}=e[0],i=s[0],a=0,o="",u=-1;for(let f=1;f<s.length;++f){let h=s[f];if(!o&&(h==="-"||h==="+"))o=h;else{let p=Number(h);!a&&p?a=p:u===-1&&(u=r+f)}}u!==-1&&n(u,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${s}`);let c=!1,l="",d=s.length;for(let f=1;f<e.length;++f){let h=e[f];switch(h.type){case"space":c=!0;case"newline":d+=h.source.length;break;case"comment":t&&!c&&n(h,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),d+=h.source.length,l=h.source.substring(1);break;case"error":n(h,"UNEXPECTED_TOKEN",h.message),d+=h.source.length;break;default:{let p=`Unexpected token in block scalar header: ${h.type}`;n(h,"UNEXPECTED_TOKEN",p);let m=h.source;m&&typeof m=="string"&&(d+=m.length)}}}return{mode:i,indent:a,chomp:o,comment:l,length:d}}function Ty(r){let e=r.split(/\n( *)/),t=e[0],n=t.match(/^( *)/),i=[n!=null&&n[1]?[n[1],t.slice(n[1].length)]:["",t]];for(let a=1;a<e.length;a+=2)i.push([e[a],e[a+1]]);return i}function tl(r,e,t){let{offset:n,type:s,source:i,end:a}=r,o,u,c=(f,h,p)=>t(n+f,h,p);switch(s){case"scalar":o=N.PLAIN,u=Py(i,c);break;case"single-quoted-scalar":o=N.QUOTE_SINGLE,u=ky(i,c);break;case"double-quoted-scalar":o=N.QUOTE_DOUBLE,u=Iy(i,c);break;default:return t(r,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${s}`),{value:"",type:null,comment:"",range:[n,n+i.length,n+i.length]}}let l=n+i.length,d=Ut(a,l,e,t);return{value:u,type:o,comment:d.comment,range:[n,l,d.offset]}}function Py(r,e){let t="";switch(r[0]){case"	":t="a tab character";break;case",":t="flow indicator character ,";break;case"%":t="directive indicator character %";break;case"|":case">":{t=`block scalar indicator ${r[0]}`;break}case"@":case"`":{t=`reserved character ${r[0]}`;break}}return t&&e(0,"BAD_SCALAR_START",`Plain value cannot start with ${t}`),qf(r)}function ky(r,e){return(r[r.length-1]!=="'"||r.length===1)&&e(r.length,"MISSING_CHAR","Missing closing 'quote"),qf(r.slice(1,-1)).replace(/''/g,"'")}function qf(r){var u;let e,t;try{e=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),t=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch(c){e=/(.*?)[ \t]*\r?\n/sy,t=/[ \t]*(.*?)[ \t]*\r?\n/sy}let n=e.exec(r);if(!n)return r;let s=n[1],i=" ",a=e.lastIndex;for(t.lastIndex=a;n=t.exec(r);)n[1]===""?i===`
`?s+=i:i=`
`:(s+=i+n[1],i=" "),a=t.lastIndex;let o=/[ \t]*(.*)/sy;return o.lastIndex=a,n=o.exec(r),s+i+((u=n==null?void 0:n[1])!=null?u:"")}function Iy(r,e){let t="";for(let n=1;n<r.length-1;++n){let s=r[n];if(!(s==="\r"&&r[n+1]===`
`))if(s===`
`){let{fold:i,offset:a}=Cy(r,n);t+=i,n=a}else if(s==="\\"){let i=r[++n],a=Ny[i];if(a)t+=a;else if(i===`
`)for(i=r[n+1];i===" "||i==="	";)i=r[++n+1];else if(i==="\r"&&r[n+1]===`
`)for(i=r[++n+1];i===" "||i==="	";)i=r[++n+1];else if(i==="x"||i==="u"||i==="U"){let o={x:2,u:4,U:8}[i];t+=Ry(r,n+1,o,e),n+=o}else{let o=r.substr(n-1,2);e(n-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${o}`),t+=o}}else if(s===" "||s==="	"){let i=n,a=r[n+1];for(;a===" "||a==="	";)a=r[++n+1];a!==`
`&&!(a==="\r"&&r[n+2]===`
`)&&(t+=n>i?r.slice(i,n+1):s)}else t+=s}return(r[r.length-1]!=='"'||r.length===1)&&e(r.length,"MISSING_CHAR",'Missing closing "quote'),t}function Cy(r,e){let t="",n=r[e+1];for(;(n===" "||n==="	"||n===`
`||n==="\r")&&!(n==="\r"&&r[e+2]!==`
`);)n===`
`&&(t+=`
`),e+=1,n=r[e+1];return t||(t=" "),{fold:t,offset:e}}var Ny={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"\x85",_:"\xA0",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"};function Ry(r,e,t,n){let s=r.substr(e,t),a=s.length===t&&/^[0-9a-fA-F]+$/.test(s)?parseInt(s,16):NaN;if(isNaN(a)){let o=r.substr(e-2,t+2);return n(e-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${o}`),o}return String.fromCodePoint(a)}function rl(r,e,t,n){let{value:s,type:i,comment:a,range:o}=e.type==="block-scalar"?el(e,r.options.strict,n):tl(e,r.options.strict,n),u=t?r.directives.tagName(t.source,d=>n(t,"TAG_RESOLVE_FAILED",d)):null,c=t&&u?jy(r.schema,s,u,t,n):e.type==="scalar"?$y(r,s,e,n):r.schema[nt],l;try{let d=c.resolve(s,f=>n(t!=null?t:e,"TAG_RESOLVE_FAILED",f),r.options);l=G(d)?d:new N(d)}catch(d){let f=d instanceof Error?d.message:String(d);n(t!=null?t:e,"TAG_RESOLVE_FAILED",f),l=new N(s)}return l.range=o,l.source=s,i&&(l.type=i),u&&(l.tag=u),c.format&&(l.format=c.format),a&&(l.comment=a),l}function jy(r,e,t,n,s){var o;if(t==="!")return r[nt];let i=[];for(let u of r.tags)if(!u.collection&&u.tag===t)if(u.default&&u.test)i.push(u);else return u;for(let u of i)if((o=u.test)!=null&&o.test(e))return u;let a=r.knownTags[t];return a&&!a.collection?(r.tags.push(Object.assign({},a,{default:!1,test:void 0})),a):(s(n,"TAG_RESOLVE_FAILED",`Unresolved tag: ${t}`,t!=="tag:yaml.org,2002:str"),r[nt])}function $y({directives:r,schema:e},t,n,s){var a;let i=e.tags.find(o=>{var u;return o.default&&((u=o.test)==null?void 0:u.test(t))})||e[nt];if(e.compat){let o=(a=e.compat.find(u=>{var c;return u.default&&((c=u.test)==null?void 0:c.test(t))}))!=null?a:e[nt];if(i.tag!==o.tag){let u=r.tagString(i.tag),c=r.tagString(o.tag),l=`Value may be parsed as either ${u} or ${c}`;s(n,"TAG_RESOLVE_FAILED",l,!0)}}return i}function Vf(r,e,t){if(e){t===null&&(t=e.length);for(let n=t-1;n>=0;--n){let s=e[n];switch(s.type){case"space":case"comment":case"newline":r-=s.source.length;continue}for(s=e[++n];(s==null?void 0:s.type)==="space";)r+=s.source.length,s=e[++n];break}}return r}var My={composeNode:nl,composeEmptyNode:jo};function nl(r,e,t,n){let{spaceBefore:s,comment:i,anchor:a,tag:o}=t,u,c=!0;switch(e.type){case"alias":u=Ly(r,e,n),(a||o)&&n(e,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":u=rl(r,e,o,n),a&&(u.anchor=a.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":u=Kf(My,r,e,o,n),a&&(u.anchor=a.source.substring(1));break;default:{let l=e.type==="error"?e.message:`Unsupported token (type: ${e.type})`;n(e,"UNEXPECTED_TOKEN",l),u=jo(r,e.offset,void 0,null,t,n),c=!1}}return a&&u.anchor===""&&n(a,"BAD_ALIAS","Anchor cannot be an empty string"),s&&(u.spaceBefore=!0),i&&(e.type==="scalar"&&e.source===""?u.comment=i:u.commentBefore=i),r.options.keepSourceTokens&&c&&(u.srcToken=e),u}function jo(r,e,t,n,{spaceBefore:s,comment:i,anchor:a,tag:o,end:u},c){let l={type:"scalar",offset:Vf(e,t,n),indent:-1,source:""},d=rl(r,l,o,c);return a&&(d.anchor=a.source.substring(1),d.anchor===""&&c(a,"BAD_ALIAS","Anchor cannot be an empty string")),s&&(d.spaceBefore=!0),i&&(d.comment=i,d.range[2]=u),d}function Ly({options:r},{offset:e,source:t,end:n},s){let i=new tr(t.substring(1));i.source===""&&s(e,"BAD_ALIAS","Alias cannot be an empty string"),i.source.endsWith(":")&&s(e+t.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);let a=e+t.length,o=Ut(n,a,r.strict,s);return i.range=[e,a,o.offset],o.comment&&(i.comment=o.comment),i}function Zf(r,e,{offset:t,start:n,value:s,end:i},a){let o=Object.assign({_directives:e},r),u=new sr(void 0,o),c={atRoot:!0,directives:u.directives,options:u.options,schema:u.schema},l=Ft(n,{indicator:"doc-start",next:s!=null?s:i==null?void 0:i[0],offset:t,onError:a,startOnNewline:!0});l.found&&(u.directives.docStart=!0,s&&(s.type==="block-map"||s.type==="block-seq")&&!l.hasNewline&&a(l.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),u.contents=s?nl(c,s,l,a):jo(c,l.end,n,null,l,a);let d=u.contents.range[2],f=Ut(i,d,!1,a);return f.comment&&(u.comment=f.comment),u.range=[t,d,f.offset],u}function zi(r){if(typeof r=="number")return[r,r+1];if(Array.isArray(r))return r.length===2?r:[r[0],r[1]];let{offset:e,source:t}=r;return[e,e+(typeof t=="string"?t.length:1)]}function Hf(r){var s;let e="",t=!1,n=!1;for(let i=0;i<r.length;++i){let a=r[i];switch(a[0]){case"#":e+=(e===""?"":n?`

`:`
`)+(a.substring(1)||" "),t=!0,n=!1;break;case"%":((s=r[i+1])==null?void 0:s[0])!=="#"&&(i+=1),t=!1;break;default:t||(n=!0),t=!1}}return{comment:e,afterEmptyLine:n}}var Ki=class{constructor(e={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(t,n,s,i)=>{let a=zi(t);i?this.warnings.push(new Fi(a,n,s)):this.errors.push(new xt(a,n,s))},this.directives=new Dt({version:e.version||"1.2"}),this.options=e}decorate(e,t){let{comment:n,afterEmptyLine:s}=Hf(this.prelude);if(n){let i=e.contents;if(t)e.comment=e.comment?`${e.comment}
${n}`:n;else if(s||e.directives.docStart||!i)e.commentBefore=n;else if(ne(i)&&!i.flow&&i.items.length>0){let a=i.items[0];Y(a)&&(a=a.key);let o=a.commentBefore;a.commentBefore=o?`${n}
${o}`:n}else{let a=i.commentBefore;i.commentBefore=a?`${n}
${a}`:n}}t?(Array.prototype.push.apply(e.errors,this.errors),Array.prototype.push.apply(e.warnings,this.warnings)):(e.errors=this.errors,e.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:Hf(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(e,t=!1,n=-1){for(let s of e)yield*this.next(s);yield*this.end(t,n)}*next(e){switch(e.type){case"directive":this.directives.add(e.source,(t,n,s)=>{let i=zi(e);i[0]+=t,this.onError(i,"BAD_DIRECTIVE",n,s)}),this.prelude.push(e.source),this.atDirectives=!0;break;case"document":{let t=Zf(this.options,this.directives,e,this.onError);this.atDirectives&&!t.directives.docStart&&this.onError(e,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(t,!1),this.doc&&(yield this.doc),this.doc=t,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(e.source);break;case"error":{let t=e.source?`${e.message}: ${JSON.stringify(e.source)}`:e.message,n=new xt(zi(e),"UNEXPECTED_TOKEN",t);this.atDirectives||!this.doc?this.errors.push(n):this.doc.errors.push(n);break}case"doc-end":{if(!this.doc){let n="Unexpected doc-end without preceding document";this.errors.push(new xt(zi(e),"UNEXPECTED_TOKEN",n));break}this.doc.directives.docEnd=!0;let t=Ut(e.end,e.offset+e.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),t.comment){let n=this.doc.comment;this.doc.comment=n?`${n}
${t.comment}`:t.comment}this.doc.range[2]=t.offset;break}default:this.errors.push(new xt(zi(e),"UNEXPECTED_TOKEN",`Unsupported token ${e.type}`))}}*end(e=!1,t=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(e){let n=Object.assign({_directives:this.directives},this.options),s=new sr(void 0,n);this.atDirectives&&this.onError(t,"MISSING_CHAR","Missing directives-end indicator line"),s.range=[0,t,t],this.decorate(s,!1),yield s}}};var sl=Symbol("break visit"),Dy=Symbol("skip children"),Gf=Symbol("remove item");function pn(r,e){"type"in r&&r.type==="document"&&(r={start:r.start,value:r.value}),Jf(Object.freeze([]),r,e)}pn.BREAK=sl;pn.SKIP=Dy;pn.REMOVE=Gf;pn.itemAtPath=(r,e)=>{let t=r;for(let[n,s]of e){let i=t==null?void 0:t[n];if(i&&"items"in i)t=i.items[s];else return}return t};pn.parentCollection=(r,e)=>{let t=pn.itemAtPath(r,e.slice(0,-1)),n=e[e.length-1][0],s=t==null?void 0:t[n];if(s&&"items"in s)return s;throw new Error("Parent collection not found")};function Jf(r,e,t){let n=t(e,r);if(typeof n=="symbol")return n;for(let s of["key","value"]){let i=e[s];if(i&&"items"in i){for(let a=0;a<i.items.length;++a){let o=Jf(Object.freeze(r.concat([[s,a]])),i.items[a],t);if(typeof o=="number")a=o-1;else{if(o===sl)return sl;o===Gf&&(i.items.splice(a,1),a-=1)}}typeof n=="function"&&s==="key"&&(n=n(e,r))}}return typeof n=="function"?n(e,r):n}var il="\uFEFF",al="",ol="",$o="";function Wf(r){switch(r){case il:return"byte-order-mark";case al:return"doc-mode";case ol:return"flow-error-end";case $o:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(r[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}function it(r){switch(r){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}var Yf="0123456789ABCDEFabcdef".split(""),Fy="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()".split(""),ul=",[]{}".split(""),Uy=` ,[]{}
\r	`.split(""),cl=r=>!r||Uy.includes(r),qi=class{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(e,t=!1){var s;e&&(this.buffer=this.buffer?this.buffer+e:e,this.lineEndPos=null),this.atEnd=!t;let n=(s=this.next)!=null?s:"stream";for(;n&&(t||this.hasChars(1));)n=yield*this.parseNext(n)}atLineEnd(){let e=this.pos,t=this.buffer[e];for(;t===" "||t==="	";)t=this.buffer[++e];return!t||t==="#"||t===`
`?!0:t==="\r"?this.buffer[e+1]===`
`:!1}charAt(e){return this.buffer[this.pos+e]}continueScalar(e){let t=this.buffer[e];if(this.indentNext>0){let n=0;for(;t===" ";)t=this.buffer[++n+e];if(t==="\r"){let s=this.buffer[n+e+1];if(s===`
`||!s&&!this.atEnd)return e+n+1}return t===`
`||n>=this.indentNext||!t&&!this.atEnd?e+n:-1}if(t==="-"||t==="."){let n=this.buffer.substr(e,3);if((n==="---"||n==="...")&&it(this.buffer[e+3]))return-1}return e}getLine(){let e=this.lineEndPos;return(typeof e!="number"||e!==-1&&e<this.pos)&&(e=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=e),e===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[e-1]==="\r"&&(e-=1),this.buffer.substring(this.pos,e))}hasChars(e){return this.pos+e<=this.buffer.length}setNext(e){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=e,null}peek(e){return this.buffer.substr(this.pos,e)}*parseNext(e){switch(e){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let e=this.getLine();if(e===null)return this.setNext("stream");if(e[0]===il&&(yield*this.pushCount(1),e=e.substring(1)),e[0]==="%"){let t=e.length,n=e.indexOf("#");if(n!==-1){let i=e[n-1];(i===" "||i==="	")&&(t=n-1)}for(;;){let i=e[t-1];if(i===" "||i==="	")t-=1;else break}let s=(yield*this.pushCount(t))+(yield*this.pushSpaces(!0));return yield*this.pushCount(e.length-s),this.pushNewline(),"stream"}if(this.atLineEnd()){let t=yield*this.pushSpaces(!0);return yield*this.pushCount(e.length-t),yield*this.pushNewline(),"stream"}return yield al,yield*this.parseLineStart()}*parseLineStart(){let e=this.charAt(0);if(!e&&!this.atEnd)return this.setNext("line-start");if(e==="-"||e==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");let t=this.peek(3);if(t==="---"&&it(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,"doc";if(t==="..."&&it(this.charAt(3)))return yield*this.pushCount(3),"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!it(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){let[e,t]=this.peek(2);if(!t&&!this.atEnd)return this.setNext("block-start");if((e==="-"||e==="?"||e===":")&&it(t)){let n=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=n,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);let e=this.getLine();if(e===null)return this.setNext("doc");let t=yield*this.pushIndicators();switch(e[t]){case"#":yield*this.pushCount(e.length-t);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(cl),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return t+=yield*this.parseBlockScalarHeader(),t+=yield*this.pushSpaces(!0),yield*this.pushCount(e.length-t),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let e,t,n=-1;do e=yield*this.pushNewline(),e>0?(t=yield*this.pushSpaces(!1),this.indentValue=n=t):t=0,t+=yield*this.pushSpaces(!0);while(e+t>0);let s=this.getLine();if(s===null)return this.setNext("flow");if((n!==-1&&n<this.indentNext&&s[0]!=="#"||n===0&&(s.startsWith("---")||s.startsWith("..."))&&it(s[3]))&&!(n===this.indentNext-1&&this.flowLevel===1&&(s[0]==="]"||s[0]==="}")))return this.flowLevel=0,yield ol,yield*this.parseLineStart();let i=0;for(;s[i]===",";)i+=yield*this.pushCount(1),i+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(i+=yield*this.pushIndicators(),s[i]){case void 0:return"flow";case"#":return yield*this.pushCount(s.length-i),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(cl),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{let a=this.charAt(1);if(this.flowKey||it(a)||a===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){let e=this.charAt(0),t=this.buffer.indexOf(e,this.pos+1);if(e==="'")for(;t!==-1&&this.buffer[t+1]==="'";)t=this.buffer.indexOf("'",t+2);else for(;t!==-1;){let i=0;for(;this.buffer[t-1-i]==="\\";)i+=1;if(i%2===0)break;t=this.buffer.indexOf('"',t+1)}let n=this.buffer.substring(0,t),s=n.indexOf(`
`,this.pos);if(s!==-1){for(;s!==-1;){let i=this.continueScalar(s+1);if(i===-1)break;s=n.indexOf(`
`,i)}s!==-1&&(t=s-(n[s-1]==="\r"?2:1))}if(t===-1){if(!this.atEnd)return this.setNext("quoted-scalar");t=this.buffer.length}return yield*this.pushToIndex(t+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let e=this.pos;for(;;){let t=this.buffer[++e];if(t==="+")this.blockScalarKeep=!0;else if(t>"0"&&t<="9")this.blockScalarIndent=Number(t)-1;else if(t!=="-")break}return yield*this.pushUntil(t=>it(t)||t==="#")}*parseBlockScalar(){let e=this.pos-1,t=0,n;e:for(let s=this.pos;n=this.buffer[s];++s)switch(n){case" ":t+=1;break;case`
`:e=s,t=0;break;case"\r":{let i=this.buffer[s+1];if(!i&&!this.atEnd)return this.setNext("block-scalar");if(i===`
`)break}default:break e}if(!n&&!this.atEnd)return this.setNext("block-scalar");if(t>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=t:this.indentNext+=this.blockScalarIndent;do{let s=this.continueScalar(e+1);if(s===-1)break;e=this.buffer.indexOf(`
`,s)}while(e!==-1);if(e===-1){if(!this.atEnd)return this.setNext("block-scalar");e=this.buffer.length}}if(!this.blockScalarKeep)do{let s=e-1,i=this.buffer[s];i==="\r"&&(i=this.buffer[--s]);let a=s;for(;i===" "||i==="	";)i=this.buffer[--s];if(i===`
`&&s>=this.pos&&s+1+t>a)e=s;else break}while(!0);return yield $o,yield*this.pushToIndex(e+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){let e=this.flowLevel>0,t=this.pos-1,n=this.pos-1,s;for(;s=this.buffer[++n];)if(s===":"){let i=this.buffer[n+1];if(it(i)||e&&i===",")break;t=n}else if(it(s)){let i=this.buffer[n+1];if(s==="\r"&&(i===`
`?(n+=1,s=`
`,i=this.buffer[n+1]):t=n),i==="#"||e&&ul.includes(i))break;if(s===`
`){let a=this.continueScalar(n+1);if(a===-1)break;n=Math.max(n,a-2)}}else{if(e&&ul.includes(s))break;t=n}return!s&&!this.atEnd?this.setNext("plain-scalar"):(yield $o,yield*this.pushToIndex(t+1,!0),e?"flow":"doc")}*pushCount(e){return e>0?(yield this.buffer.substr(this.pos,e),this.pos+=e,e):0}*pushToIndex(e,t){let n=this.buffer.slice(this.pos,e);return n?(yield n,this.pos+=n.length,n.length):(t&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(cl))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{let e=this.flowLevel>0,t=this.charAt(1);if(it(t)||e&&ul.includes(t))return e?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let e=this.pos+2,t=this.buffer[e];for(;!it(t)&&t!==">";)t=this.buffer[++e];return yield*this.pushToIndex(t===">"?e+1:e,!1)}else{let e=this.pos+1,t=this.buffer[e];for(;t;)if(Fy.includes(t))t=this.buffer[++e];else if(t==="%"&&Yf.includes(this.buffer[e+1])&&Yf.includes(this.buffer[e+2]))t=this.buffer[e+=3];else break;return yield*this.pushToIndex(e,!1)}}*pushNewline(){let e=this.buffer[this.pos];return e===`
`?yield*this.pushCount(1):e==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(e){let t=this.pos-1,n;do n=this.buffer[++t];while(n===" "||e&&n==="	");let s=t-this.pos;return s>0&&(yield this.buffer.substr(this.pos,s),this.pos=t),s}*pushUntil(e){let t=this.pos,n=this.buffer[t];for(;!e(n);)n=this.buffer[++t];return yield*this.pushToIndex(t,!1)}};var Vi=class{constructor(){this.lineStarts=[],this.addNewLine=e=>this.lineStarts.push(e),this.linePos=e=>{let t=0,n=this.lineStarts.length;for(;t<n;){let i=t+n>>1;this.lineStarts[i]<e?t=i+1:n=i}if(this.lineStarts[t]===e)return{line:t+1,col:1};if(t===0)return{line:0,col:e};let s=this.lineStarts[t-1];return{line:t,col:e-s+1}}}};function At(r,e){for(let t=0;t<r.length;++t)if(r[t].type===e)return!0;return!1}function Xf(r){for(let e=0;e<r.length;++e)switch(r[e].type){case"space":case"comment":case"newline":break;default:return e}return-1}function eh(r){switch(r==null?void 0:r.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function Mo(r){var e;switch(r.type){case"document":return r.start;case"block-map":{let t=r.items[r.items.length-1];return(e=t.sep)!=null?e:t.start}case"block-seq":return r.items[r.items.length-1].start;default:return[]}}function Ns(r){var t;if(r.length===0)return[];let e=r.length;e:for(;--e>=0;)switch(r[e].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;((t=r[++e])==null?void 0:t.type)==="space";);return r.splice(e,r.length)}function Qf(r){if(r.start.type==="flow-seq-start")for(let e of r.items)e.sep&&!e.value&&!At(e.start,"explicit-key-ind")&&!At(e.sep,"map-value-ind")&&(e.key&&(e.value=e.key),delete e.key,eh(e.value)?e.value.end?Array.prototype.push.apply(e.value.end,e.sep):e.value.end=e.sep:Array.prototype.push.apply(e.start,e.sep),delete e.sep)}var Zi=class{constructor(e){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new qi,this.onNewLine=e}*parse(e,t=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(let n of this.lexer.lex(e,t))yield*this.next(n);t||(yield*this.end())}*next(e){if(this.source=e,this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=e.length;return}let t=Wf(e);if(t)if(t==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=t,yield*this.step(),t){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+e.length);break;case"space":this.atNewLine&&e[0]===" "&&(this.indent+=e.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=e.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=e.length}else{let n=`Not a YAML token: ${e}`;yield*this.pop({type:"error",offset:this.offset,message:n,source:e}),this.offset+=e.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){let e=this.peek(1);if(this.type==="doc-end"&&(!e||e.type!=="doc-end")){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!e)return yield*this.stream();switch(e.type){case"document":return yield*this.document(e);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(e);case"block-scalar":return yield*this.blockScalar(e);case"block-map":return yield*this.blockMap(e);case"block-seq":return yield*this.blockSequence(e);case"flow-collection":return yield*this.flowCollection(e);case"doc-end":return yield*this.documentEnd(e)}yield*this.pop()}peek(e){return this.stack[this.stack.length-e]}*pop(e){let t=e!=null?e:this.stack.pop();if(!t)yield{type:"error",offset:this.offset,source:"",message:"Tried to pop an empty stack"};else if(this.stack.length===0)yield t;else{let n=this.peek(1);switch(t.type==="block-scalar"?t.indent="indent"in n?n.indent:0:t.type==="flow-collection"&&n.type==="document"&&(t.indent=0),t.type==="flow-collection"&&Qf(t),n.type){case"document":n.value=t;break;case"block-scalar":n.props.push(t);break;case"block-map":{let s=n.items[n.items.length-1];if(s.value){n.items.push({start:[],key:t,sep:[]}),this.onKeyLine=!0;return}else if(s.sep)s.value=t;else{Object.assign(s,{key:t,sep:[]}),this.onKeyLine=!At(s.start,"explicit-key-ind");return}break}case"block-seq":{let s=n.items[n.items.length-1];s.value?n.items.push({start:[],value:t}):s.value=t;break}case"flow-collection":{let s=n.items[n.items.length-1];!s||s.value?n.items.push({start:[],key:t,sep:[]}):s.sep?s.value=t:Object.assign(s,{key:t,sep:[]});return}default:yield*this.pop(),yield*this.pop(t)}if((n.type==="document"||n.type==="block-map"||n.type==="block-seq")&&(t.type==="block-map"||t.type==="block-seq")){let s=t.items[t.items.length-1];s&&!s.sep&&!s.value&&s.start.length>0&&Xf(s.start)===-1&&(t.indent===0||s.start.every(i=>i.type!=="comment"||i.indent<t.indent))&&(n.type==="document"?n.end=s.start:n.items.push({start:s.start}),t.items.splice(-1,1))}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{let e={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&e.start.push(this.sourceToken),this.stack.push(e);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(e){if(e.value)return yield*this.lineEnd(e);switch(this.type){case"doc-start":{Xf(e.start)!==-1?(yield*this.pop(),yield*this.step()):e.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":e.start.push(this.sourceToken);return}let t=this.startBlockValue(e);t?this.stack.push(t):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(e){if(this.type==="map-value-ind"){let t=Mo(this.peek(2)),n=Ns(t),s;e.end?(s=e.end,s.push(this.sourceToken),delete e.end):s=[this.sourceToken];let i={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:n,key:e,sep:s}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=i}else yield*this.lineEnd(e)}*blockScalar(e){switch(this.type){case"space":case"comment":case"newline":e.props.push(this.sourceToken);return;case"scalar":if(e.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(e){var n;let t=e.items[e.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,t.value){let s="end"in t.value?t.value.end:void 0,i=Array.isArray(s)?s[s.length-1]:void 0;(i==null?void 0:i.type)==="comment"?s==null||s.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else if(t.sep)t.sep.push(this.sourceToken);else{if(this.atIndentedComment(t.start,e.indent)){let s=e.items[e.items.length-2],i=(n=s==null?void 0:s.value)==null?void 0:n.end;if(Array.isArray(i)){Array.prototype.push.apply(i,t.start),i.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return}if(this.indent>=e.indent){let s=!this.onKeyLine&&this.indent===e.indent&&t.sep&&this.type!=="seq-item-ind",i=[];if(s&&t.sep&&!t.value){let a=[];for(let o=0;o<t.sep.length;++o){let u=t.sep[o];switch(u.type){case"newline":a.push(o);break;case"space":break;case"comment":u.indent>e.indent&&(a.length=0);break;default:a.length=0}}a.length>=2&&(i=t.sep.splice(a[1]))}switch(this.type){case"anchor":case"tag":s||t.value?(i.push(this.sourceToken),e.items.push({start:i}),this.onKeyLine=!0):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"explicit-key-ind":!t.sep&&!At(t.start,"explicit-key-ind")?t.start.push(this.sourceToken):s||t.value?(i.push(this.sourceToken),e.items.push({start:i})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]}),this.onKeyLine=!0;return;case"map-value-ind":if(At(t.start,"explicit-key-ind"))if(t.sep)if(t.value)e.items.push({start:[],key:null,sep:[this.sourceToken]});else if(At(t.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:i,key:null,sep:[this.sourceToken]}]});else if(eh(t.key)&&!At(t.sep,"newline")){let a=Ns(t.start),o=t.key,u=t.sep;u.push(this.sourceToken),delete t.key,delete t.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:o,sep:u}]})}else i.length>0?t.sep=t.sep.concat(i,this.sourceToken):t.sep.push(this.sourceToken);else if(At(t.start,"newline"))Object.assign(t,{key:null,sep:[this.sourceToken]});else{let a=Ns(t.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:null,sep:[this.sourceToken]}]})}else t.sep?t.value||s?e.items.push({start:i,key:null,sep:[this.sourceToken]}):At(t.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{let a=this.flowScalar(this.type);s||t.value?(e.items.push({start:i,key:a,sep:[]}),this.onKeyLine=!0):t.sep?this.stack.push(a):(Object.assign(t,{key:a,sep:[]}),this.onKeyLine=!0);return}default:{let a=this.startBlockValue(e);if(a){s&&a.type!=="block-seq"&&At(t.start,"explicit-key-ind")&&e.items.push({start:i}),this.stack.push(a);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(e){var n;let t=e.items[e.items.length-1];switch(this.type){case"newline":if(t.value){let s="end"in t.value?t.value.end:void 0,i=Array.isArray(s)?s[s.length-1]:void 0;(i==null?void 0:i.type)==="comment"?s==null||s.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(t.start,e.indent)){let s=e.items[e.items.length-2],i=(n=s==null?void 0:s.value)==null?void 0:n.end;if(Array.isArray(i)){Array.prototype.push.apply(i,t.start),i.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return;case"anchor":case"tag":if(t.value||this.indent<=e.indent)break;t.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==e.indent)break;t.value||At(t.start,"seq-item-ind")?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return}if(this.indent>e.indent){let s=this.startBlockValue(e);if(s){this.stack.push(s);return}}yield*this.pop(),yield*this.step()}*flowCollection(e){let t=e.items[e.items.length-1];if(this.type==="flow-error-end"){let n;do yield*this.pop(),n=this.peek(1);while(n&&n.type==="flow-collection")}else if(e.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!t||t.sep?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return;case"map-value-ind":!t||t.value?e.items.push({start:[],key:null,sep:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!t||t.value?e.items.push({start:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{let s=this.flowScalar(this.type);!t||t.value?e.items.push({start:[],key:s,sep:[]}):t.sep?this.stack.push(s):Object.assign(t,{key:s,sep:[]});return}case"flow-map-end":case"flow-seq-end":e.end.push(this.sourceToken);return}let n=this.startBlockValue(e);n?this.stack.push(n):(yield*this.pop(),yield*this.step())}else{let n=this.peek(2);if(n.type==="block-map"&&(this.type==="map-value-ind"&&n.indent===e.indent||this.type==="newline"&&!n.items[n.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&n.type!=="flow-collection"){let s=Mo(n),i=Ns(s);Qf(e);let a=e.end.splice(1,e.end.length);a.push(this.sourceToken);let o={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:i,key:e,sep:a}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=o}else yield*this.lineEnd(e)}}flowScalar(e){if(this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}return{type:e,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(e){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;let t=Mo(e),n=Ns(t);return n.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:n}]}}case"map-value-ind":{this.onKeyLine=!0;let t=Mo(e),n=Ns(t);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:n,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(e,t){return this.type!=="comment"||this.indent<=t?!1:e.every(n=>n.type==="newline"||n.type==="space")}*documentEnd(e){this.type!=="doc-mode"&&(e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(e){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}};function zy(r){let e=r.prettyErrors!==!1;return{lineCounter:r.lineCounter||e&&new Vi||null,prettyErrors:e}}function th(r,e={}){let{lineCounter:t,prettyErrors:n}=zy(e),s=new Zi(t==null?void 0:t.addNewLine),i=new Ki(e),a=null;for(let o of i.compose(s.parse(r),!0,r.length))if(!a)a=o;else if(a.options.logLevel!=="silent"){a.errors.push(new xt(o.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return n&&t&&(a.errors.forEach(Wc(r,t)),a.warnings.forEach(Wc(r,t))),a}function mn(r,e,t){let n;typeof e=="function"?n=e:t===void 0&&e&&typeof e=="object"&&(t=e);let s=th(r,t);if(!s)return null;if(s.warnings.forEach(i=>go(s.options.logLevel,i)),s.errors.length>0){if(s.options.logLevel!=="silent")throw s.errors[0];s.errors=[]}return s.toJS(Object.assign({reviver:n},t))}function ll(r,e,t){var s;let n=null;if(typeof e=="function"||Array.isArray(e)?n=e:t===void 0&&e&&(t=e),typeof t=="string"&&(t=t.length),typeof t=="number"){let i=Math.round(t);t=i<1?void 0:i>8?{indent:8}:{indent:i}}if(r===void 0){let{keepUndefined:i}=(s=t!=null?t:e)!=null?s:{};if(!i)return}return new sr(r,n,t).toString(t)}var rh=require("obsidian"),dl=class extends rh.SuggestModal{constructor(e){super(e),this.setPlaceholder("Search for a model...")}getSuggestions(e){return this.models.filter(t=>t.modelName.toLowerCase().includes(e.toLowerCase()))}renderSuggestion(e,t){t.createEl("div",{text:e.modelName})}onChooseSuggestion(e,t){this.onSelected&&this.onSelected.call(this,e)}},Hi,nh=(r,e,t)=>{Hi||(Hi=new dl(r)),Hi.onSelected=t,Hi.models=e,Hi.open()};var sh=require("obsidian"),qy=[{title:"Keyword report",prompt:"Create a keyword report and SEO content plan from 1 keyword."},{title:"TL;DR",prompt:"Condense selected text, article, email into a TLDR for quick understanding and time-saving."},{title:"Grammarly",prompt:"Correct spelling and text grammar."},{title:"FAQ & answers writer",prompt:"Generate FAQ list with answers from the given product or service description."},{title:"Key takeaways",prompt:"Summarize the key takeaways from the given content."},{title:"SILO structure",prompt:"Build a comprehensive SILO framework for a website using the provided keyword. Arrange the sections and categories hierarchically, with the Home page at the top and the more specific pages at the bottom. Utilize your expertise in crafting an effective structure for linking and SEO to reach top positions in Google."},{title:"Effective Keyword Research",prompt:"Calling All Business Owners & Freelancers: Tired of aimlessly targeting keywords? Let us streamline your SEO efforts with an advanced keyword strategy, starting with a single. Benefit from keyword clusters, search intent analysis, and engaging meta descriptions. Wave goodbye to unproductive SEO and welcome a targeted, results-driven strategy. Boost your online presence with our expert keyword strategy and SEO content prompt!"},{title:"Generate keywords",prompt:"Distill some keywords from the given text."}],fl=class extends sh.SuggestModal{getSuggestions(e){return qy.filter(t=>t.title.toLowerCase().includes(e.toLowerCase())||t.prompt.toLowerCase().includes(e.toLowerCase()))}renderSuggestion(e,t){t.createEl("div",{text:e.title}),t.createEl("small",{text:e.prompt.slice(0,100)+"..."})}setChooseSuggestionCallback(e){this.onSelected=e}onChooseSuggestion(e,t){this.onSelected&&this.onSelected.call(this,e)}},Lo,ih=(r,e)=>{Lo||(Lo=new fl(r)),Lo.setChooseSuggestionCallback(e),Lo.open()};var ah=require("obsidian"),Vy=[{name:"Wiki search",config:"```useTool\nname: 'wikiSearch'\n```"},{name:"Vector Search",config:"```useTool\nname: 'vectorSearch'\n```"},{name:"Google Search",config:"```useTool\nname: 'googleSearch'\n```"}],hl=class extends ah.SuggestModal{getSuggestions(e){return Vy.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())||t.config.toLowerCase().includes(e.toLowerCase()))}renderSuggestion(e,t){t.createEl("div",{text:e.name})}setChooseSuggestionCallback(e){this.onSelected=e}onChooseSuggestion(e,t){this.onSelected&&this.onSelected.call(this,e)}},Do,oh=(r,e)=>{Do||(Do=new hl(r)),Do.setChooseSuggestionCallback(e),Do.open()};var uh=require("obsidian"),Bo=class extends uh.Events{constructor(){super()}on(e,t){return super.on(e,t)}trigger(e,...t){return super.trigger(e,...t)}};var dt=require("obsidian");var ue={container:"_container_jyj1d_1",header:"_header_jyj1d_7",title:"_title_jyj1d_18",actions:"_actions_jyj1d_21",inputContainer:"_inputContainer_jyj1d_32",textInput:"_textInput_jyj1d_43",focus:"_focus_jyj1d_60",controls:"_controls_jyj1d_63",attachments:"_attachments_jyj1d_77",messageItem:"_messageItem_jyj1d_82",systemMessage:"_systemMessage_jyj1d_93",humanMessage:"_humanMessage_jyj1d_98",aiMessage:"_aiMessage_jyj1d_101"};var bh=pt(lh(),1),Xy=pt(yh(),1);function _h(r,e){return(e==null?void 0:e[r])||(0,bh.default)(r)}function wh(r,e,t){let n={};for(let s in r)Object.hasOwn(r,s)&&(n[e(s,t)]=r[s]);return n}function vh(r){return Array.isArray(r)?[...r]:{...r}}function Qy(r,e){let t=vh(r);for(let[n,s]of Object.entries(e)){let[i,...a]=n.split(".").reverse(),o=t;for(let u of a.reverse()){if(o[u]===void 0)break;o[u]=vh(o[u]),o=o[u]}o[i]!==void 0&&(o[i]={lc:1,type:"secret",id:[s]})}return t}function ml(r){let e=Object.getPrototypeOf(r);return typeof r.lc_name=="function"&&(typeof e.lc_name!="function"||r.lc_name()!==e.lc_name())?r.lc_name():r.name}var Ot=class r{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,ml(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof r||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},n=Object.keys(this.lc_kwargs).reduce((s,i)=>(s[i]=i in this?this[i]:this.lc_kwargs[i],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(n,Reflect.get(s,"lc_attributes",this));return Object.keys(t).forEach(s=>{let i=this,a=n,[o,...u]=s.split(".").reverse();for(let c of u.reverse()){if(!(c in i)||i[c]===void 0)return;(!(c in a)||a[c]===void 0)&&(typeof i[c]=="object"&&i[c]!=null?a[c]={}:Array.isArray(i[c])&&(a[c]=[])),i=i[c],a=a[c]}o in i&&i[o]!==void 0&&(a[o]=a[o]||i[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:wh(Object.keys(t).length?Qy(n,t):n,_h,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function Rs(r,e){return typeof r=="string"?typeof e=="string"?r+e:[{type:"text",text:r},...e]:Array.isArray(e)?[...r,...e]:[...r,{type:"text",text:e}]}var gn=class extends Ot{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}toChunk(){let e=this._getType();if(e==="human")return new Gi({...this});if(e==="ai")return new ir({...this});if(e==="system")return new Ji({...this});if(e==="function")return new Wi({...this});if(Rr.isInstance(this))return new Yi({...this});throw new Error("Unknown message type.")}};function xh(r){return Array.isArray(r)&&r.every(e=>typeof e.index=="number")}function We(r,e){var n,s;let t={...r};for(let[i,a]of Object.entries(e))if(t[i]==null)t[i]=a;else{if(a==null)continue;if(typeof t[i]!=typeof a||Array.isArray(t[i])!==Array.isArray(a))throw new Error(`field[${i}] already exists in the message chunk, but with a different type.`);if(typeof t[i]=="string")t[i]=t[i]+a;else if(!Array.isArray(t[i])&&typeof t[i]=="object")t[i]=We(t[i],a);else if(i==="tool_calls"&&xh(t[i])&&xh(a))for(let o of a)((n=t[i])==null?void 0:n[o.index])!==void 0?t[i]=(s=t[i])==null?void 0:s.map((u,c)=>{var l,d,f;return c!==o.index?u:{...u,...o,function:{name:(l=o.function.name)!=null?l:u.function.name,arguments:((d=u.function.arguments)!=null?d:"")+((f=o.function.arguments)!=null?f:"")}}}):t[i][o.index]=o;else if(Array.isArray(t[i]))t[i]=t[i].concat(a);else{if(t[i]===a)continue;console.warn(`field[${i}] already exists in this message chunk and value has unsupported type.`)}}return t}var Nr=class extends gn{},Se=class extends gn{static lc_name(){return"HumanMessage"}_getType(){return"human"}},Gi=class r extends Nr{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new r({content:Rs(this.content,e.content),additional_kwargs:We(this.additional_kwargs,e.additional_kwargs),response_metadata:We(this.response_metadata,e.response_metadata)})}},Ne=class extends gn{static lc_name(){return"AIMessage"}_getType(){return"ai"}},ir=class r extends Nr{static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){return new r({content:Rs(this.content,e.content),additional_kwargs:We(this.additional_kwargs,e.additional_kwargs),response_metadata:We(this.response_metadata,e.response_metadata)})}},yn=class extends gn{static lc_name(){return"SystemMessage"}_getType(){return"system"}},Ji=class r extends Nr{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new r({content:Rs(this.content,e.content),additional_kwargs:We(this.additional_kwargs,e.additional_kwargs),response_metadata:We(this.response_metadata,e.response_metadata)})}};var Wi=class r extends Nr{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){var t;return new r({content:Rs(this.content,e.content),additional_kwargs:We(this.additional_kwargs,e.additional_kwargs),response_metadata:We(this.response_metadata,e.response_metadata),name:(t=this.name)!=null?t:""})}};var Fo=class r extends Nr{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new r({content:Rs(this.content,e.content),additional_kwargs:We(this.additional_kwargs,e.additional_kwargs),response_metadata:We(this.response_metadata,e.response_metadata),tool_call_id:this.tool_call_id})}},Rr=class r extends gn{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return r}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}};function bn(r){return typeof(r==null?void 0:r._getType)=="function"}function Ah(r){return bn(r)&&typeof r.concat=="function"}function _n(r){if(typeof r=="string")return new Se(r);if(bn(r))return r;let[e,t]=r;if(e==="human"||e==="user")return new Se({content:t});if(e==="ai"||e==="assistant")return new Ne({content:t});if(e==="system")return new yn({content:t});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}var Yi=class r extends Nr{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new r({content:Rs(this.content,e.content),additional_kwargs:We(this.additional_kwargs,e.additional_kwargs),response_metadata:We(this.response_metadata,e.response_metadata),role:this.role})}};function js(r,e="Human",t="AI"){let n=[];for(let s of r){let i;if(s._getType()==="human")i=e;else if(s._getType()==="ai")i=t;else if(s._getType()==="system")i="System";else if(s._getType()==="function")i="Function";else if(s._getType()==="tool")i="Tool";else if(s._getType()==="generic")i=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);let a=s.name?`${s.name}, `:"";n.push(`${i}: ${a}${s.content}`)}return n.join(`
`)}var wn;(function(r){r.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",r.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",r.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",r.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",r.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(wn||(wn={}));var vn;(function(r){r.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",r.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",r.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",r.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",r.BLOCK_NONE="BLOCK_NONE"})(vn||(vn={}));var Oh;(function(r){r.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",r.NEGLIGIBLE="NEGLIGIBLE",r.LOW="LOW",r.MEDIUM="MEDIUM",r.HIGH="HIGH"})(Oh||(Oh={}));var Eh;(function(r){r.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",r.SAFETY="SAFETY",r.OTHER="OTHER"})(Eh||(Eh={}));var Uo;(function(r){r.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",r.STOP="STOP",r.MAX_TOKENS="MAX_TOKENS",r.SAFETY="SAFETY",r.RECITATION="RECITATION",r.OTHER="OTHER"})(Uo||(Uo={}));var Sh;(function(r){r.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",r.RETRIEVAL_QUERY="RETRIEVAL_QUERY",r.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",r.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",r.CLASSIFICATION="CLASSIFICATION",r.CLUSTERING="CLUSTERING"})(Sh||(Sh={}));var xn=class extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}},zo=class extends xn{constructor(e,t){super(e),this.response=t}};var eb="https://generativelanguage.googleapis.com",tb="v1",rb="0.1.3",nb="genai-js",An;(function(r){r.GENERATE_CONTENT="generateContent",r.STREAM_GENERATE_CONTENT="streamGenerateContent",r.COUNT_TOKENS="countTokens",r.EMBED_CONTENT="embedContent",r.BATCH_EMBED_CONTENTS="batchEmbedContents"})(An||(An={}));var On=class{constructor(e,t,n,s){this.model=e,this.task=t,this.apiKey=n,this.stream=s}toString(){let e=`${eb}/${tb}/models/${this.model}:${this.task}`;return this.stream&&(e+="?alt=sse"),e}};function sb(){return`${nb}/${rb}`}async function ta(r,e){let t;try{if(t=await fetch(r.toString(),{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-client":sb(),"x-goog-api-key":r.apiKey},body:e}),!t.ok){let n="";try{let s=await t.json();n=s.error.message,s.error.details&&(n+=` ${JSON.stringify(s.error.details)}`)}catch(s){}throw new Error(`[${t.status} ${t.statusText}] ${n}`)}}catch(n){let s=new xn(`Error fetching from ${r.toString()}: ${n.message}`);throw s.stack=n.stack,s}return t}function _l(r){return r.text=()=>{if(r.candidates&&r.candidates.length>0){if(r.candidates.length>1&&console.warn(`This response had ${r.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),kh(r.candidates[0]))throw new zo(`${Ko(r)}`,r);return ib(r)}else if(r.promptFeedback)throw new zo(`Text not available. ${Ko(r)}`,r);return""},r}function ib(r){var e,t,n,s;return!((s=(n=(t=(e=r.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0?void 0:t.parts)===null||n===void 0?void 0:n[0])===null||s===void 0)&&s.text?r.candidates[0].content.parts[0].text:""}var ab=[Uo.RECITATION,Uo.SAFETY];function kh(r){return!!r.finishReason&&ab.includes(r.finishReason)}function Ko(r){var e,t,n;let s="";if((!r.candidates||r.candidates.length===0)&&r.promptFeedback)s+="Response was blocked",!((e=r.promptFeedback)===null||e===void 0)&&e.blockReason&&(s+=` due to ${r.promptFeedback.blockReason}`),!((t=r.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(s+=`: ${r.promptFeedback.blockReasonMessage}`);else if(!((n=r.candidates)===null||n===void 0)&&n[0]){let i=r.candidates[0];kh(i)&&(s+=`Candidate was blocked due to ${i.finishReason}`,i.finishMessage&&(s+=`: ${i.finishMessage}`))}return s}function Qi(r){return this instanceof Qi?(this.v=r,this):new Qi(r)}function ob(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),s,i=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(f){n[f]&&(s[f]=function(h){return new Promise(function(p,m){i.push([f,h,p,m])>1||o(f,h)})})}function o(f,h){try{u(n[f](h))}catch(p){d(i[0][3],p)}}function u(f){f.value instanceof Qi?Promise.resolve(f.value.v).then(c,l):d(i[0][2],f)}function c(f){o("next",f)}function l(f){o("throw",f)}function d(f,h){f(h),i.shift(),i.length&&o(i[0][0],i[0][1])}}var Th=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function ub(r){let e=r.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=db(e),[n,s]=t.tee();return{stream:lb(n),response:cb(s)}}async function cb(r){let e=[],t=r.getReader();for(;;){let{done:n,value:s}=await t.read();if(n)return _l(fb(e));e.push(s)}}function lb(r){return ob(this,arguments,function*(){let t=r.getReader();for(;;){let{value:n,done:s}=yield Qi(t.read());if(s)break;yield yield Qi(_l(n))}})}function db(r){let e=r.getReader();return new ReadableStream({start(n){let s="";return i();function i(){return e.read().then(({value:a,done:o})=>{if(o){if(s.trim()){n.error(new xn("Failed to parse stream"));return}n.close();return}s+=a;let u=s.match(Th),c;for(;u;){try{c=JSON.parse(u[1])}catch(l){n.error(new xn(`Error parsing JSON response: "${u[1]}"`));return}n.enqueue(c),s=s.substring(u[0].length),u=s.match(Th)}return i()})}}})}function fb(r){let e=r[r.length-1],t={promptFeedback:e==null?void 0:e.promptFeedback};for(let n of r)if(n.candidates)for(let s of n.candidates){let i=s.index;if(t.candidates||(t.candidates=[]),t.candidates[i]||(t.candidates[i]={index:s.index}),t.candidates[i].citationMetadata=s.citationMetadata,t.candidates[i].finishReason=s.finishReason,t.candidates[i].finishMessage=s.finishMessage,t.candidates[i].safetyRatings=s.safetyRatings,s.content&&s.content.parts){t.candidates[i].content||(t.candidates[i].content={role:s.content.role||"user",parts:[{text:""}]});for(let a of s.content.parts)a.text&&(t.candidates[i].content.parts[0].text+=a.text)}}return t}async function Ih(r,e,t){let n=new On(e,An.STREAM_GENERATE_CONTENT,r,!0),s=await ta(n,JSON.stringify(t));return ub(s)}async function Ch(r,e,t){let n=new On(e,An.GENERATE_CONTENT,r,!1),i=await(await ta(n,JSON.stringify(t))).json();return{response:_l(i)}}function Xi(r,e){let t=[];if(typeof r=="string")t=[{text:r}];else for(let n of r)typeof n=="string"?t.push({text:n}):t.push(n);return{role:e,parts:t}}function gl(r){return r.contents?r:{contents:[Xi(r,"user")]}}function hb(r){return typeof r=="string"||Array.isArray(r)?{content:Xi(r,"user")}:r}var Ph="SILENT_ERROR",yl=class{constructor(e,t,n){this.model=t,this.params=n,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,n!=null&&n.history&&(this._history=n.history.map(s=>{if(!s.role)throw new Error("Missing role for history item: "+JSON.stringify(s));return Xi(s.parts,s.role)}))}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e){var t,n;await this._sendPromise;let s=Xi(e,"user"),i={safetySettings:(t=this.params)===null||t===void 0?void 0:t.safetySettings,generationConfig:(n=this.params)===null||n===void 0?void 0:n.generationConfig,contents:[...this._history,s]},a;return this._sendPromise=this._sendPromise.then(()=>Ch(this._apiKey,this.model,i)).then(o=>{var u;if(o.response.candidates&&o.response.candidates.length>0){this._history.push(s);let c=Object.assign({parts:[],role:"model"},(u=o.response.candidates)===null||u===void 0?void 0:u[0].content);this._history.push(c)}else{let c=Ko(o.response);c&&console.warn(`sendMessage() was unsuccessful. ${c}. Inspect response object for details.`)}a=o}),await this._sendPromise,a}async sendMessageStream(e){var t,n;await this._sendPromise;let s=Xi(e,"user"),i={safetySettings:(t=this.params)===null||t===void 0?void 0:t.safetySettings,generationConfig:(n=this.params)===null||n===void 0?void 0:n.generationConfig,contents:[...this._history,s]},a=Ih(this._apiKey,this.model,i);return this._sendPromise=this._sendPromise.then(()=>a).catch(o=>{throw new Error(Ph)}).then(o=>o.response).then(o=>{if(o.candidates&&o.candidates.length>0){this._history.push(s);let u=Object.assign({},o.candidates[0].content);u.role||(u.role="model"),this._history.push(u)}else{let u=Ko(o);u&&console.warn(`sendMessageStream() was unsuccessful. ${u}. Inspect response object for details.`)}}).catch(o=>{o.message!==Ph&&console.error(o)}),a}};async function pb(r,e,t){let n=new On(e,An.COUNT_TOKENS,r,!1);return(await ta(n,JSON.stringify(Object.assign(Object.assign({},t),{model:e})))).json()}async function mb(r,e,t){let n=new On(e,An.EMBED_CONTENT,r,!1);return(await ta(n,JSON.stringify(t))).json()}async function gb(r,e,t){let n=new On(e,An.BATCH_EMBED_CONTENTS,r,!1),s=t.requests.map(a=>Object.assign(Object.assign({},a),{model:`models/${e}`}));return(await ta(n,JSON.stringify({requests:s}))).json()}var bl=class{constructor(e,t){var n;this.apiKey=e,t.model.startsWith("models/")?this.model=(n=t.model.split("models/"))===null||n===void 0?void 0:n[1]:this.model=t.model,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[]}async generateContent(e){let t=gl(e);return Ch(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings},t))}async generateContentStream(e){let t=gl(e);return Ih(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings},t))}startChat(e){return new yl(this.apiKey,this.model,e)}async countTokens(e){let t=gl(e);return pb(this.apiKey,this.model,t)}async embedContent(e){let t=hb(e);return mb(this.apiKey,this.model,t)}async batchEmbedContents(e){return gb(this.apiKey,this.model,e)}};var ea=class{constructor(e){this.apiKey=e}getGenerativeModel(e){if(!e.model)throw new xn("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new bl(this.apiKey,e)}};var yb=()=>typeof window!="undefined"&&typeof window.document!="undefined",bb=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",_b=()=>typeof window!="undefined"&&window.name==="nodejs"||typeof navigator!="undefined"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Nh=()=>typeof Deno!="undefined",wb=()=>typeof process!="undefined"&&typeof process.versions!="undefined"&&typeof process.versions.node!="undefined"&&!Nh(),vb=()=>{let r;return yb()?r="browser":wb()?r="node":bb()?r="webworker":_b()?r="jsdom":Nh()?r="deno":r="other",r},wl;async function Rh(){return wl===void 0&&(wl={library:"langchain-js",runtime:vb()}),wl}function ae(r){var e;try{return typeof process!="undefined"?(e=process.env)==null?void 0:e[r]:void 0}catch(t){return}}var qo="__run",jr=class r{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new r({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}},ar=class r extends jr{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new r({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}};var xb=typeof window=="object"?window:{},H="0123456789abcdef".split(""),Ab=[-2147483648,8388608,32768,128],Et=[24,16,8,0];var xe=[];function St(r){r?(xe[0]=xe[16]=xe[1]=xe[2]=xe[3]=xe[4]=xe[5]=xe[6]=xe[7]=xe[8]=xe[9]=xe[10]=xe[11]=xe[12]=xe[13]=xe[14]=xe[15]=0,this.blocks=xe):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}St.prototype.update=function(r){if(!this.finalized){var e=typeof r!="string";e&&r.constructor===xb.ArrayBuffer&&(r=new Uint8Array(r));for(var t,n=0,s,i=r.length||0,a=this.blocks;n<i;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),e)for(s=this.start;n<i&&s<64;++n)a[s>>2]|=r[n]<<Et[s++&3];else for(s=this.start;n<i&&s<64;++n)t=r.charCodeAt(n),t<128?a[s>>2]|=t<<Et[s++&3]:t<2048?(a[s>>2]|=(192|t>>6)<<Et[s++&3],a[s>>2]|=(128|t&63)<<Et[s++&3]):t<55296||t>=57344?(a[s>>2]|=(224|t>>12)<<Et[s++&3],a[s>>2]|=(128|t>>6&63)<<Et[s++&3],a[s>>2]|=(128|t&63)<<Et[s++&3]):(t=65536+((t&1023)<<10|r.charCodeAt(++n)&1023),a[s>>2]|=(240|t>>18)<<Et[s++&3],a[s>>2]|=(128|t>>12&63)<<Et[s++&3],a[s>>2]|=(128|t>>6&63)<<Et[s++&3],a[s>>2]|=(128|t&63)<<Et[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=a[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};St.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var r=this.blocks,e=this.lastByteIndex;r[16]=this.block,r[e>>2]|=Ab[e&3],this.block=r[16],e>=56&&(this.hashed||this.hash(),r[0]=this.block,r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0),r[14]=this.hBytes<<3|this.bytes>>>29,r[15]=this.bytes<<3,this.hash()}};St.prototype.hash=function(){var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4,i,a,o,u=this.blocks;for(a=16;a<80;++a)o=u[a-3]^u[a-8]^u[a-14]^u[a-16],u[a]=o<<1|o>>>31;for(a=0;a<20;a+=5)i=e&t|~e&n,o=r<<5|r>>>27,s=o+i+s+1518500249+u[a]<<0,e=e<<30|e>>>2,i=r&e|~r&t,o=s<<5|s>>>27,n=o+i+n+1518500249+u[a+1]<<0,r=r<<30|r>>>2,i=s&r|~s&e,o=n<<5|n>>>27,t=o+i+t+1518500249+u[a+2]<<0,s=s<<30|s>>>2,i=n&s|~n&r,o=t<<5|t>>>27,e=o+i+e+1518500249+u[a+3]<<0,n=n<<30|n>>>2,i=t&n|~t&s,o=e<<5|e>>>27,r=o+i+r+1518500249+u[a+4]<<0,t=t<<30|t>>>2;for(;a<40;a+=5)i=e^t^n,o=r<<5|r>>>27,s=o+i+s+1859775393+u[a]<<0,e=e<<30|e>>>2,i=r^e^t,o=s<<5|s>>>27,n=o+i+n+1859775393+u[a+1]<<0,r=r<<30|r>>>2,i=s^r^e,o=n<<5|n>>>27,t=o+i+t+1859775393+u[a+2]<<0,s=s<<30|s>>>2,i=n^s^r,o=t<<5|t>>>27,e=o+i+e+1859775393+u[a+3]<<0,n=n<<30|n>>>2,i=t^n^s,o=e<<5|e>>>27,r=o+i+r+1859775393+u[a+4]<<0,t=t<<30|t>>>2;for(;a<60;a+=5)i=e&t|e&n|t&n,o=r<<5|r>>>27,s=o+i+s-1894007588+u[a]<<0,e=e<<30|e>>>2,i=r&e|r&t|e&t,o=s<<5|s>>>27,n=o+i+n-1894007588+u[a+1]<<0,r=r<<30|r>>>2,i=s&r|s&e|r&e,o=n<<5|n>>>27,t=o+i+t-1894007588+u[a+2]<<0,s=s<<30|s>>>2,i=n&s|n&r|s&r,o=t<<5|t>>>27,e=o+i+e-1894007588+u[a+3]<<0,n=n<<30|n>>>2,i=t&n|t&s|n&s,o=e<<5|e>>>27,r=o+i+r-1894007588+u[a+4]<<0,t=t<<30|t>>>2;for(;a<80;a+=5)i=e^t^n,o=r<<5|r>>>27,s=o+i+s-899497514+u[a]<<0,e=e<<30|e>>>2,i=r^e^t,o=s<<5|s>>>27,n=o+i+n-899497514+u[a+1]<<0,r=r<<30|r>>>2,i=s^r^e,o=n<<5|n>>>27,t=o+i+t-899497514+u[a+2]<<0,s=s<<30|s>>>2,i=n^s^r,o=t<<5|t>>>27,e=o+i+e-899497514+u[a+3]<<0,n=n<<30|n>>>2,i=t^n^s,o=e<<5|e>>>27,r=o+i+r-899497514+u[a+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+r<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+n<<0,this.h4=this.h4+s<<0};St.prototype.hex=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return H[r>>28&15]+H[r>>24&15]+H[r>>20&15]+H[r>>16&15]+H[r>>12&15]+H[r>>8&15]+H[r>>4&15]+H[r&15]+H[e>>28&15]+H[e>>24&15]+H[e>>20&15]+H[e>>16&15]+H[e>>12&15]+H[e>>8&15]+H[e>>4&15]+H[e&15]+H[t>>28&15]+H[t>>24&15]+H[t>>20&15]+H[t>>16&15]+H[t>>12&15]+H[t>>8&15]+H[t>>4&15]+H[t&15]+H[n>>28&15]+H[n>>24&15]+H[n>>20&15]+H[n>>16&15]+H[n>>12&15]+H[n>>8&15]+H[n>>4&15]+H[n&15]+H[s>>28&15]+H[s>>24&15]+H[s>>20&15]+H[s>>16&15]+H[s>>12&15]+H[s>>8&15]+H[s>>4&15]+H[s&15]};St.prototype.toString=St.prototype.hex;St.prototype.digest=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return[r>>24&255,r>>16&255,r>>8&255,r&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,n>>24&255,n>>16&255,n>>8&255,n&255,s>>24&255,s>>16&255,s>>8&255,s&255]};St.prototype.array=St.prototype.digest;St.prototype.arrayBuffer=function(){this.finalize();var r=new ArrayBuffer(20),e=new DataView(r);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),r};var vl=r=>new St(!0).update(r).hex();var jh=(...r)=>vl(r.join("_"));var xl=class{},Ob=new Map,Vo=class r extends xl{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e!=null?e:new Map}lookup(e,t){var n;return Promise.resolve((n=this.cache.get(jh(e,t)))!=null?n:null)}async update(e,t,n){this.cache.set(jh(e,t),n)}static global(){return new r(Ob)}};var Zo=class extends Ot{},Ho=class extends Zo{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new Se(this.value)]}},Go=class extends Zo{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return js(this.messages)}toChatMessages(){return this.messages}};var Wh=pt(Yo(),1),nu=pt(ru(),1),Db=[400,401,402,403,404,405,406,407,409],Bb=r=>{var t,n,s;if(r.message.startsWith("Cancel")||r.message.startsWith("AbortError")||r.name==="AbortError"||(r==null?void 0:r.code)==="ECONNABORTED")throw r;let e=(n=(t=r==null?void 0:r.response)==null?void 0:t.status)!=null?n:r==null?void 0:r.status;if(e&&Db.includes(+e))throw r;if(((s=r==null?void 0:r.error)==null?void 0:s.code)==="insufficient_quota"){let i=new Error(r==null?void 0:r.message);throw i.name="InsufficientQuotaError",i}},or=class{constructor(e){var n,s,i;Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=(n=e.maxConcurrency)!=null?n:1/0,this.maxRetries=(s=e.maxRetries)!=null?s:6,this.onFailedAttempt=(i=e.onFailedAttempt)!=null?i:Bb;let t="default"in nu.default?nu.default.default:nu.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>(0,Wh.default)(()=>e(...t).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};var ep=pt(Qh(),1);var Hb=Object.defineProperty,Gb=(r,e,t)=>e in r?Hb(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Jb=(r,e,t)=>(Gb(r,typeof e!="symbol"?e+"":e,t),t);function Wb(r,e){let t=Array.from({length:r.length},(n,s)=>({start:s,end:s+1}));for(;t.length>1;){let n=null;for(let s=0;s<t.length-1;s++){let i=r.slice(t[s].start,t[s+1].end),a=e.get(i.join(","));a!=null&&(n==null||a<n[0])&&(n=[a,s])}if(n!=null){let s=n[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function Yb(r,e){return r.length===1?[e.get(r.join(","))]:Wb(r,e).map(t=>e.get(r.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function Xb(r){return r.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var Il=class{constructor(r,e){Sr(this,"specialTokens");Sr(this,"inverseSpecialTokens");Sr(this,"patStr");Sr(this,"textEncoder",new TextEncoder);Sr(this,"textDecoder",new TextDecoder("utf-8"));Sr(this,"rankMap",new Map);Sr(this,"textMap",new Map);this.patStr=r.pat_str;let t=r.bpe_ranks.split(`
`).filter(Boolean).reduce((n,s)=>{let[i,a,...o]=s.split(" "),u=Number.parseInt(a,10);return o.forEach((c,l)=>n[c]=u+l),n},{});for(let[n,s]of Object.entries(t)){let i=ep.default.toByteArray(n);this.rankMap.set(i.join(","),s),this.textMap.set(s,i)}this.specialTokens={...r.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[s,i])=>(n[i]=this.textEncoder.encode(s),n),{})}encode(r,e=[],t="all"){var c;let n=new RegExp(this.patStr,"ug"),s=Il.specialTokenRegex(Object.keys(this.specialTokens)),i=[],a=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(l=>!a.has(l)):t);if(o.size>0){let l=Il.specialTokenRegex([...o]),d=r.match(l);if(d!=null)throw new Error(`The text contains a special token that is not allowed: ${d[0]}`)}let u=0;for(;;){let l=null,d=u;for(;s.lastIndex=d,l=s.exec(r),!(l==null||a.has(l[0]));)d=l.index+1;let f=(c=l==null?void 0:l.index)!=null?c:r.length;for(let p of r.substring(u,f).matchAll(n)){let m=this.textEncoder.encode(p[0]),g=this.rankMap.get(m.join(","));if(g!=null){i.push(g);continue}i.push(...Yb(m,this.rankMap))}if(l==null)break;let h=this.specialTokens[l[0]];i.push(h),u=l.index+l[0].length}return i}decode(r){var i;let e=[],t=0;for(let a=0;a<r.length;++a){let o=r[a],u=(i=this.textMap.get(o))!=null?i:this.inverseSpecialTokens[o];u!=null&&(e.push(u),t+=u.length)}let n=new Uint8Array(t),s=0;for(let a of e)n.set(a,s),s+=a.length;return this.textDecoder.decode(n)}},iu=Il;Jb(iu,"specialTokenRegex",r=>new RegExp(r.map(e=>Xb(e)).join("|"),"g"));function Cl(r){switch(r){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":return"cl100k_base";default:throw new Error("Unknown model")}}var au={},Qb=new or({});async function e_(r){return r in au||(au[r]=Qb.fetch(`https://tiktoken.pages.dev/js/${r}.json`).then(e=>e.json()).then(e=>new iu(e)).catch(e=>{throw delete au[r],e})),await au[r]}async function tp(r){return e_(Cl(r))}var re;(function(r){r.assertEqual=s=>s;function e(s){}r.assertIs=e;function t(s){throw new Error}r.assertNever=t,r.arrayToEnum=s=>{let i={};for(let a of s)i[a]=a;return i},r.getValidEnumValues=s=>{let i=r.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),a={};for(let o of i)a[o]=s[o];return r.objectValues(a)},r.objectValues=s=>r.objectKeys(s).map(function(i){return s[i]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let i=[];for(let a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},r.find=(s,i)=>{for(let a of s)if(i(a))return a},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function n(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}r.joinValues=n,r.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(re||(re={}));var Rl;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Rl||(Rl={}));var P=re.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),$r=r=>{switch(typeof r){case"undefined":return P.undefined;case"string":return P.string;case"number":return isNaN(r)?P.nan:P.number;case"boolean":return P.boolean;case"function":return P.function;case"bigint":return P.bigint;case"symbol":return P.symbol;case"object":return Array.isArray(r)?P.array:r===null?P.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?P.promise:typeof Map!="undefined"&&r instanceof Map?P.map:typeof Set!="undefined"&&r instanceof Set?P.set:typeof Date!="undefined"&&r instanceof Date?P.date:P.object;default:return P.unknown}},x=re.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),t_=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),Ye=class extends Error{constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){let t=e||function(i){return i.message},n={_errors:[]},s=i=>{for(let a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)n._errors.push(t(a));else{let o=n,u=0;for(;u<a.path.length;){let c=a.path[u];u===a.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(a))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return s(this),n}toString(){return this.message}get message(){return JSON.stringify(this.issues,re.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},n=[];for(let s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}};Ye.create=r=>new Ye(r);var na=(r,e)=>{let t;switch(r.code){case x.invalid_type:r.received===P.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case x.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,re.jsonStringifyReplacer)}`;break;case x.unrecognized_keys:t=`Unrecognized key(s) in object: ${re.joinValues(r.keys,", ")}`;break;case x.invalid_union:t="Invalid input";break;case x.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${re.joinValues(r.options)}`;break;case x.invalid_enum_value:t=`Invalid enum value. Expected ${re.joinValues(r.options)}, received '${r.received}'`;break;case x.invalid_arguments:t="Invalid function arguments";break;case x.invalid_return_type:t="Invalid function return type";break;case x.invalid_date:t="Invalid date";break;case x.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:re.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case x.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case x.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case x.custom:t="Invalid input";break;case x.invalid_intersection_types:t="Intersection results could not be merged";break;case x.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case x.not_finite:t="Number must be finite";break;default:t=e.defaultError,re.assertNever(r)}return{message:t}},sp=na;function r_(r){sp=r}function uu(){return sp}var cu=r=>{let{data:e,path:t,errorMaps:n,issueData:s}=r,i=[...t,...s.path||[]],a={...s,path:i},o="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)o=c(a,{data:e,defaultError:o}).message;return{...s,path:i,message:s.message||o}},n_=[];function I(r,e){let t=cu({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,uu(),na].filter(n=>!!n)});r.common.issues.push(t)}var je=class r{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let n=[];for(let s of t){if(s.status==="aborted")return U;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){let n=[];for(let s of t)n.push({key:await s.key,value:await s.value});return r.mergeObjectSync(e,n)}static mergeObjectSync(e,t){let n={};for(let s of t){let{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return U;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value!="undefined"||s.alwaysSet)&&(n[i.value]=a.value)}return{status:e.value,value:n}}},U=Object.freeze({status:"aborted"}),ip=r=>({status:"dirty",value:r}),Be=r=>({status:"valid",value:r}),jl=r=>r.status==="aborted",$l=r=>r.status==="dirty",sa=r=>r.status==="valid",lu=r=>typeof Promise!="undefined"&&r instanceof Promise,j;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(j||(j={}));var ut=class{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},rp=(r,e)=>{if(sa(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new Ye(r.common.issues);return this._error=t,this._error}}};function K(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:n,description:s}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,o)=>a.code!=="invalid_type"?{message:o.defaultError}:typeof o.data=="undefined"?{message:n!=null?n:o.defaultError}:{message:t!=null?t:o.defaultError},description:s}}var q=class{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return $r(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:$r(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new je,ctx:{common:e.parent.common,data:e.data,parsedType:$r(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(lu(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;let s={common:{issues:[],async:(n=t==null?void 0:t.async)!==null&&n!==void 0?n:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:$r(e)},i=this._parseSync({data:e,path:s.path,parent:s});return rp(s,i)}async parseAsync(e,t){let n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){let n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:$r(e)},s=this._parse({data:e,path:n.path,parent:n}),i=await(lu(s)?s:Promise.resolve(s));return rp(n,i)}refine(e,t){let n=s=>typeof t=="string"||typeof t=="undefined"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{let a=e(s),o=()=>i.addIssue({code:x.custom,...n(s)});return typeof Promise!="undefined"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new Xe({schema:this,typeName:w.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Tt.create(this,this._def)}nullable(){return lr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return cr.create(this,this._def)}promise(){return Dr.create(this,this._def)}or(e){return Rn.create([this,e],this._def)}and(e){return jn.create(this,e,this._def)}transform(e){return new Xe({...K(this._def),schema:this,typeName:w.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new Bn({...K(this._def),innerType:this,defaultValue:t,typeName:w.ZodDefault})}brand(){return new pu({typeName:w.ZodBranded,type:this,...K(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new Fs({...K(this._def),innerType:this,catchValue:t,typeName:w.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return ia.create(this,e)}readonly(){return zs.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},s_=/^c[^\s-]{8,}$/i,i_=/^[a-z][a-z0-9]*$/,a_=/^[0-9A-HJKMNP-TV-Z]{26}$/,o_=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,u_=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,c_="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Nl,l_=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,d_=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,f_=r=>r.precision?r.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${r.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${r.precision}}Z$`):r.precision===0?r.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):r.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function h_(r,e){return!!((e==="v4"||!e)&&l_.test(r)||(e==="v6"||!e)&&d_.test(r))}var Mr=class r extends q{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==P.string){let i=this._getOrReturnCtx(e);return I(i,{code:x.invalid_type,expected:P.string,received:i.parsedType}),U}let n=new je,s;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),I(s,{code:x.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),I(s,{code:x.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){let a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(s=this._getOrReturnCtx(e,s),a?I(s,{code:x.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&I(s,{code:x.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")u_.test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"email",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")Nl||(Nl=new RegExp(c_,"u")),Nl.test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"emoji",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")o_.test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"uuid",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")s_.test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"cuid",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")i_.test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"cuid2",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")a_.test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"ulid",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(e.data)}catch(a){s=this._getOrReturnCtx(e,s),I(s,{validation:"url",code:x.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"regex",code:x.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),I(s,{code:x.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),I(s,{code:x.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),I(s,{code:x.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?f_(i).test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{code:x.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="ip"?h_(e.data,i.version)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"ip",code:x.invalid_string,message:i.message}),n.dirty()):re.assertNever(i);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(s=>e.test(s),{validation:t,code:x.invalid_string,...j.errToObj(n)})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...j.errToObj(e)})}url(e){return this._addCheck({kind:"url",...j.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...j.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...j.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...j.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...j.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...j.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...j.errToObj(e)})}datetime(e){var t;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)=="undefined"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,...j.errToObj(e==null?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...j.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...j.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...j.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...j.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...j.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...j.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...j.errToObj(t)})}nonempty(e){return this.min(1,j.errToObj(e))}trim(){return new r({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Mr.create=r=>{var e;return new Mr({checks:[],typeName:w.ZodString,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...K(r)})};function p_(r,e){let t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,i=parseInt(r.toFixed(s).replace(".","")),a=parseInt(e.toFixed(s).replace(".",""));return i%a/Math.pow(10,s)}var Tn=class r extends q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==P.number){let i=this._getOrReturnCtx(e);return I(i,{code:x.invalid_type,expected:P.number,received:i.parsedType}),U}let n,s=new je;for(let i of this._def.checks)i.kind==="int"?re.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),I(n,{code:x.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),I(n,{code:x.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),I(n,{code:x.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?p_(e.data,i.value)!==0&&(n=this._getOrReturnCtx(e,n),I(n,{code:x.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),I(n,{code:x.not_finite,message:i.message}),s.dirty()):re.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,j.toString(t))}gt(e,t){return this.setLimit("min",e,!1,j.toString(t))}lte(e,t){return this.setLimit("max",e,!0,j.toString(t))}lt(e,t){return this.setLimit("max",e,!1,j.toString(t))}setLimit(e,t,n,s){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:j.toString(s)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:j.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:j.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:j.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:j.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:j.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:j.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:j.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:j.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:j.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&re.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}};Tn.create=r=>new Tn({checks:[],typeName:w.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...K(r)});var Pn=class r extends q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==P.bigint){let i=this._getOrReturnCtx(e);return I(i,{code:x.invalid_type,expected:P.bigint,received:i.parsedType}),U}let n,s=new je;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),I(n,{code:x.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),I(n,{code:x.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),I(n,{code:x.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):re.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,j.toString(t))}gt(e,t){return this.setLimit("min",e,!1,j.toString(t))}lte(e,t){return this.setLimit("max",e,!0,j.toString(t))}lt(e,t){return this.setLimit("max",e,!1,j.toString(t))}setLimit(e,t,n,s){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:j.toString(s)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:j.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:j.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:j.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:j.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:j.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Pn.create=r=>{var e;return new Pn({checks:[],typeName:w.ZodBigInt,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...K(r)})};var kn=class extends q{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==P.boolean){let n=this._getOrReturnCtx(e);return I(n,{code:x.invalid_type,expected:P.boolean,received:n.parsedType}),U}return Be(e.data)}};kn.create=r=>new kn({typeName:w.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...K(r)});var In=class r extends q{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==P.date){let i=this._getOrReturnCtx(e);return I(i,{code:x.invalid_type,expected:P.date,received:i.parsedType}),U}if(isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return I(i,{code:x.invalid_date}),U}let n=new je,s;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),I(s,{code:x.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),I(s,{code:x.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):re.assertNever(i);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:j.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:j.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};In.create=r=>new In({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:w.ZodDate,...K(r)});var Ms=class extends q{_parse(e){if(this._getType(e)!==P.symbol){let n=this._getOrReturnCtx(e);return I(n,{code:x.invalid_type,expected:P.symbol,received:n.parsedType}),U}return Be(e.data)}};Ms.create=r=>new Ms({typeName:w.ZodSymbol,...K(r)});var Cn=class extends q{_parse(e){if(this._getType(e)!==P.undefined){let n=this._getOrReturnCtx(e);return I(n,{code:x.invalid_type,expected:P.undefined,received:n.parsedType}),U}return Be(e.data)}};Cn.create=r=>new Cn({typeName:w.ZodUndefined,...K(r)});var Nn=class extends q{_parse(e){if(this._getType(e)!==P.null){let n=this._getOrReturnCtx(e);return I(n,{code:x.invalid_type,expected:P.null,received:n.parsedType}),U}return Be(e.data)}};Nn.create=r=>new Nn({typeName:w.ZodNull,...K(r)});var Lr=class extends q{constructor(){super(...arguments),this._any=!0}_parse(e){return Be(e.data)}};Lr.create=r=>new Lr({typeName:w.ZodAny,...K(r)});var ur=class extends q{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Be(e.data)}};ur.create=r=>new ur({typeName:w.ZodUnknown,...K(r)});var Pt=class extends q{_parse(e){let t=this._getOrReturnCtx(e);return I(t,{code:x.invalid_type,expected:P.never,received:t.parsedType}),U}};Pt.create=r=>new Pt({typeName:w.ZodNever,...K(r)});var Ls=class extends q{_parse(e){if(this._getType(e)!==P.undefined){let n=this._getOrReturnCtx(e);return I(n,{code:x.invalid_type,expected:P.void,received:n.parsedType}),U}return Be(e.data)}};Ls.create=r=>new Ls({typeName:w.ZodVoid,...K(r)});var cr=class r extends q{_parse(e){let{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==P.array)return I(t,{code:x.invalid_type,expected:P.array,received:t.parsedType}),U;if(s.exactLength!==null){let a=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(a||o)&&(I(t,{code:a?x.too_big:x.too_small,minimum:o?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(I(t,{code:x.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(I(t,{code:x.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>s.type._parseAsync(new ut(t,a,t.path,o)))).then(a=>je.mergeArray(n,a));let i=[...t.data].map((a,o)=>s.type._parseSync(new ut(t,a,t.path,o)));return je.mergeArray(n,i)}get element(){return this._def.type}min(e,t){return new r({...this._def,minLength:{value:e,message:j.toString(t)}})}max(e,t){return new r({...this._def,maxLength:{value:e,message:j.toString(t)}})}length(e,t){return new r({...this._def,exactLength:{value:e,message:j.toString(t)}})}nonempty(e){return this.min(1,e)}};cr.create=(r,e)=>new cr({type:r,minLength:null,maxLength:null,exactLength:null,typeName:w.ZodArray,...K(e)});function $s(r){if(r instanceof Ze){let e={};for(let t in r.shape){let n=r.shape[t];e[t]=Tt.create($s(n))}return new Ze({...r._def,shape:()=>e})}else return r instanceof cr?new cr({...r._def,type:$s(r.element)}):r instanceof Tt?Tt.create($s(r.unwrap())):r instanceof lr?lr.create($s(r.unwrap())):r instanceof Kt?Kt.create(r.items.map(e=>$s(e))):r}var Ze=class r extends q{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=re.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==P.object){let c=this._getOrReturnCtx(e);return I(c,{code:x.invalid_type,expected:P.object,received:c.parsedType}),U}let{status:n,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof Pt&&this._def.unknownKeys==="strip"))for(let c in s.data)a.includes(c)||o.push(c);let u=[];for(let c of a){let l=i[c],d=s.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new ut(s,d,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof Pt){let c=this._def.unknownKeys;if(c==="passthrough")for(let l of o)u.push({key:{status:"valid",value:l},value:{status:"valid",value:s.data[l]}});else if(c==="strict")o.length>0&&(I(s,{code:x.unrecognized_keys,keys:o}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let c=this._def.catchall;for(let l of o){let d=s.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new ut(s,d,s.path,l)),alwaysSet:l in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let c=[];for(let l of u){let d=await l.key;c.push({key:d,value:await l.value,alwaysSet:l.alwaysSet})}return c}).then(c=>je.mergeObjectSync(n,c)):je.mergeObjectSync(n,u)}get shape(){return this._def.shape()}strict(e){return j.errToObj,new r({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var s,i,a,o;let u=(a=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,t,n).message)!==null&&a!==void 0?a:n.defaultError;return t.code==="unrecognized_keys"?{message:(o=j.errToObj(e).message)!==null&&o!==void 0?o:u}:{message:u}}}:{}})}strip(){return new r({...this._def,unknownKeys:"strip"})}passthrough(){return new r({...this._def,unknownKeys:"passthrough"})}extend(e){return new r({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new r({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:w.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new r({...this._def,catchall:e})}pick(e){let t={};return re.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new r({...this._def,shape:()=>t})}omit(e){let t={};return re.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new r({...this._def,shape:()=>t})}deepPartial(){return $s(this)}partial(e){let t={};return re.objectKeys(this.shape).forEach(n=>{let s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}),new r({...this._def,shape:()=>t})}required(e){let t={};return re.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof Tt;)i=i._def.innerType;t[n]=i}}),new r({...this._def,shape:()=>t})}keyof(){return ap(re.objectKeys(this.shape))}};Ze.create=(r,e)=>new Ze({shape:()=>r,unknownKeys:"strip",catchall:Pt.create(),typeName:w.ZodObject,...K(e)});Ze.strictCreate=(r,e)=>new Ze({shape:()=>r,unknownKeys:"strict",catchall:Pt.create(),typeName:w.ZodObject,...K(e)});Ze.lazycreate=(r,e)=>new Ze({shape:r,unknownKeys:"strip",catchall:Pt.create(),typeName:w.ZodObject,...K(e)});var Rn=class extends q{_parse(e){let{ctx:t}=this._processInputParams(e),n=this._def.options;function s(i){for(let o of i)if(o.result.status==="valid")return o.result;for(let o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;let a=i.map(o=>new Ye(o.ctx.common.issues));return I(t,{code:x.invalid_union,unionErrors:a}),U}if(t.common.async)return Promise.all(n.map(async i=>{let a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(s);{let i,a=[];for(let u of n){let c={...t,common:{...t.common,issues:[]},parent:null},l=u._parseSync({data:t.data,path:t.path,parent:c});if(l.status==="valid")return l;l.status==="dirty"&&!i&&(i={result:l,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;let o=a.map(u=>new Ye(u));return I(t,{code:x.invalid_union,unionErrors:o}),U}}get options(){return this._def.options}};Rn.create=(r,e)=>new Rn({options:r,typeName:w.ZodUnion,...K(e)});var ou=r=>r instanceof $n?ou(r.schema):r instanceof Xe?ou(r.innerType()):r instanceof Mn?[r.value]:r instanceof Ln?r.options:r instanceof Dn?Object.keys(r.enum):r instanceof Bn?ou(r._def.innerType):r instanceof Cn?[void 0]:r instanceof Nn?[null]:null,du=class r extends q{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==P.object)return I(t,{code:x.invalid_type,expected:P.object,received:t.parsedType}),U;let n=this.discriminator,s=t.data[n],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(I(t,{code:x.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),U)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){let s=new Map;for(let i of t){let a=ou(i.shape[e]);if(!a)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of a){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,i)}}return new r({typeName:w.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...K(n)})}};function Ml(r,e){let t=$r(r),n=$r(e);if(r===e)return{valid:!0,data:r};if(t===P.object&&n===P.object){let s=re.objectKeys(e),i=re.objectKeys(r).filter(o=>s.indexOf(o)!==-1),a={...r,...e};for(let o of i){let u=Ml(r[o],e[o]);if(!u.valid)return{valid:!1};a[o]=u.data}return{valid:!0,data:a}}else if(t===P.array&&n===P.array){if(r.length!==e.length)return{valid:!1};let s=[];for(let i=0;i<r.length;i++){let a=r[i],o=e[i],u=Ml(a,o);if(!u.valid)return{valid:!1};s.push(u.data)}return{valid:!0,data:s}}else return t===P.date&&n===P.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var jn=class extends q{_parse(e){let{status:t,ctx:n}=this._processInputParams(e),s=(i,a)=>{if(jl(i)||jl(a))return U;let o=Ml(i.value,a.value);return o.valid?(($l(i)||$l(a))&&t.dirty(),{status:t.value,value:o.data}):(I(n,{code:x.invalid_intersection_types}),U)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};jn.create=(r,e,t)=>new jn({left:r,right:e,typeName:w.ZodIntersection,...K(t)});var Kt=class r extends q{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==P.array)return I(n,{code:x.invalid_type,expected:P.array,received:n.parsedType}),U;if(n.data.length<this._def.items.length)return I(n,{code:x.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),U;!this._def.rest&&n.data.length>this._def.items.length&&(I(n,{code:x.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...n.data].map((a,o)=>{let u=this._def.items[o]||this._def.rest;return u?u._parse(new ut(n,a,n.path,o)):null}).filter(a=>!!a);return n.common.async?Promise.all(i).then(a=>je.mergeArray(t,a)):je.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new r({...this._def,rest:e})}};Kt.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Kt({items:r,typeName:w.ZodTuple,rest:null,...K(e)})};var fu=class r extends q{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==P.object)return I(n,{code:x.invalid_type,expected:P.object,received:n.parsedType}),U;let s=[],i=this._def.keyType,a=this._def.valueType;for(let o in n.data)s.push({key:i._parse(new ut(n,o,n.path,o)),value:a._parse(new ut(n,n.data[o],n.path,o))});return n.common.async?je.mergeObjectAsync(t,s):je.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof q?new r({keyType:e,valueType:t,typeName:w.ZodRecord,...K(n)}):new r({keyType:Mr.create(),valueType:e,typeName:w.ZodRecord,...K(t)})}},Ds=class extends q{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==P.map)return I(n,{code:x.invalid_type,expected:P.map,received:n.parsedType}),U;let s=this._def.keyType,i=this._def.valueType,a=[...n.data.entries()].map(([o,u],c)=>({key:s._parse(new ut(n,o,n.path,[c,"key"])),value:i._parse(new ut(n,u,n.path,[c,"value"]))}));if(n.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let u of a){let c=await u.key,l=await u.value;if(c.status==="aborted"||l.status==="aborted")return U;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}})}else{let o=new Map;for(let u of a){let c=u.key,l=u.value;if(c.status==="aborted"||l.status==="aborted")return U;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}}}};Ds.create=(r,e,t)=>new Ds({valueType:e,keyType:r,typeName:w.ZodMap,...K(t)});var Bs=class r extends q{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==P.set)return I(n,{code:x.invalid_type,expected:P.set,received:n.parsedType}),U;let s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(I(n,{code:x.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(I(n,{code:x.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());let i=this._def.valueType;function a(u){let c=new Set;for(let l of u){if(l.status==="aborted")return U;l.status==="dirty"&&t.dirty(),c.add(l.value)}return{status:t.value,value:c}}let o=[...n.data.values()].map((u,c)=>i._parse(new ut(n,u,n.path,c)));return n.common.async?Promise.all(o).then(u=>a(u)):a(o)}min(e,t){return new r({...this._def,minSize:{value:e,message:j.toString(t)}})}max(e,t){return new r({...this._def,maxSize:{value:e,message:j.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Bs.create=(r,e)=>new Bs({valueType:r,minSize:null,maxSize:null,typeName:w.ZodSet,...K(e)});var hu=class r extends q{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==P.function)return I(t,{code:x.invalid_type,expected:P.function,received:t.parsedType}),U;function n(o,u){return cu({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,uu(),na].filter(c=>!!c),issueData:{code:x.invalid_arguments,argumentsError:u}})}function s(o,u){return cu({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,uu(),na].filter(c=>!!c),issueData:{code:x.invalid_return_type,returnTypeError:u}})}let i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof Dr){let o=this;return Be(async function(...u){let c=new Ye([]),l=await o._def.args.parseAsync(u,i).catch(h=>{throw c.addIssue(n(u,h)),c}),d=await Reflect.apply(a,this,l);return await o._def.returns._def.type.parseAsync(d,i).catch(h=>{throw c.addIssue(s(d,h)),c})})}else{let o=this;return Be(function(...u){let c=o._def.args.safeParse(u,i);if(!c.success)throw new Ye([n(u,c.error)]);let l=Reflect.apply(a,this,c.data),d=o._def.returns.safeParse(l,i);if(!d.success)throw new Ye([s(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r({...this._def,args:Kt.create(e).rest(ur.create())})}returns(e){return new r({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new r({args:e||Kt.create([]).rest(ur.create()),returns:t||ur.create(),typeName:w.ZodFunction,...K(n)})}},$n=class extends q{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};$n.create=(r,e)=>new $n({getter:r,typeName:w.ZodLazy,...K(e)});var Mn=class extends q{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return I(t,{received:t.data,code:x.invalid_literal,expected:this._def.value}),U}return{status:"valid",value:e.data}}get value(){return this._def.value}};Mn.create=(r,e)=>new Mn({value:r,typeName:w.ZodLiteral,...K(e)});function ap(r,e){return new Ln({values:r,typeName:w.ZodEnum,...K(e)})}var Ln=class r extends q{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),n=this._def.values;return I(t,{expected:re.joinValues(n),received:t.parsedType,code:x.invalid_type}),U}if(this._def.values.indexOf(e.data)===-1){let t=this._getOrReturnCtx(e),n=this._def.values;return I(t,{received:t.data,code:x.invalid_enum_value,options:n}),U}return Be(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e){return r.create(e)}exclude(e){return r.create(this.options.filter(t=>!e.includes(t)))}};Ln.create=ap;var Dn=class extends q{_parse(e){let t=re.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==P.string&&n.parsedType!==P.number){let s=re.objectValues(t);return I(n,{expected:re.joinValues(s),received:n.parsedType,code:x.invalid_type}),U}if(t.indexOf(e.data)===-1){let s=re.objectValues(t);return I(n,{received:n.data,code:x.invalid_enum_value,options:s}),U}return Be(e.data)}get enum(){return this._def.values}};Dn.create=(r,e)=>new Dn({values:r,typeName:w.ZodNativeEnum,...K(e)});var Dr=class extends q{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==P.promise&&t.common.async===!1)return I(t,{code:x.invalid_type,expected:P.promise,received:t.parsedType}),U;let n=t.parsedType===P.promise?t.data:Promise.resolve(t.data);return Be(n.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}};Dr.create=(r,e)=>new Dr({type:r,typeName:w.ZodPromise,...K(e)});var Xe=class extends q{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===w.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:a=>{I(n,a),a.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){let a=s.transform(n.data,i);return n.common.issues.length?{status:"dirty",value:n.data}:n.common.async?Promise.resolve(a).then(o=>this._def.schema._parseAsync({data:o,path:n.path,parent:n})):this._def.schema._parseSync({data:a,path:n.path,parent:n})}if(s.type==="refinement"){let a=o=>{let u=s.refinement(o,i);if(n.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){let o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?U:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?U:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!sa(a))return a;let o=s.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>sa(a)?Promise.resolve(s.transform(a.value,i)).then(o=>({status:t.value,value:o})):a);re.assertNever(s)}};Xe.create=(r,e,t)=>new Xe({schema:r,typeName:w.ZodEffects,effect:e,...K(t)});Xe.createWithPreprocess=(r,e,t)=>new Xe({schema:e,effect:{type:"preprocess",transform:r},typeName:w.ZodEffects,...K(t)});var Tt=class extends q{_parse(e){return this._getType(e)===P.undefined?Be(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Tt.create=(r,e)=>new Tt({innerType:r,typeName:w.ZodOptional,...K(e)});var lr=class extends q{_parse(e){return this._getType(e)===P.null?Be(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};lr.create=(r,e)=>new lr({innerType:r,typeName:w.ZodNullable,...K(e)});var Bn=class extends q{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return t.parsedType===P.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Bn.create=(r,e)=>new Bn({innerType:r,typeName:w.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...K(e)});var Fs=class extends q{_parse(e){let{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return lu(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Ye(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Ye(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Fs.create=(r,e)=>new Fs({innerType:r,typeName:w.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...K(e)});var Us=class extends q{_parse(e){if(this._getType(e)!==P.nan){let n=this._getOrReturnCtx(e);return I(n,{code:x.invalid_type,expected:P.nan,received:n.parsedType}),U}return{status:"valid",value:e.data}}};Us.create=r=>new Us({typeName:w.ZodNaN,...K(r)});var m_=Symbol("zod_brand"),pu=class extends q{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}},ia=class r extends q{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?U:i.status==="dirty"?(t.dirty(),ip(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{let s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?U:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new r({in:e,out:t,typeName:w.ZodPipeline})}},zs=class extends q{_parse(e){let t=this._def.innerType._parse(e);return sa(t)&&(t.value=Object.freeze(t.value)),t}};zs.create=(r,e)=>new zs({innerType:r,typeName:w.ZodReadonly,...K(e)});var op=(r,e={},t)=>r?Lr.create().superRefine((n,s)=>{var i,a;if(!r(n)){let o=typeof e=="function"?e(n):typeof e=="string"?{message:e}:e,u=(a=(i=o.fatal)!==null&&i!==void 0?i:t)!==null&&a!==void 0?a:!0,c=typeof o=="string"?{message:o}:o;s.addIssue({code:"custom",...c,fatal:u})}}):Lr.create(),g_={object:Ze.lazycreate},w;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(w||(w={}));var y_=(r,e={message:`Input not instance of ${r.name}`})=>op(t=>t instanceof r,e),up=Mr.create,cp=Tn.create,b_=Us.create,__=Pn.create,lp=kn.create,w_=In.create,v_=Ms.create,x_=Cn.create,A_=Nn.create,O_=Lr.create,E_=ur.create,S_=Pt.create,T_=Ls.create,P_=cr.create,k_=Ze.create,I_=Ze.strictCreate,C_=Rn.create,N_=du.create,R_=jn.create,j_=Kt.create,$_=fu.create,M_=Ds.create,L_=Bs.create,D_=hu.create,B_=$n.create,F_=Mn.create,U_=Ln.create,z_=Dn.create,K_=Dr.create,np=Xe.create,q_=Tt.create,V_=lr.create,Z_=Xe.createWithPreprocess,H_=ia.create,G_=()=>up().optional(),J_=()=>cp().optional(),W_=()=>lp().optional(),Y_={string:r=>Mr.create({...r,coerce:!0}),number:r=>Tn.create({...r,coerce:!0}),boolean:r=>kn.create({...r,coerce:!0}),bigint:r=>Pn.create({...r,coerce:!0}),date:r=>In.create({...r,coerce:!0})},X_=U,dr=Object.freeze({__proto__:null,defaultErrorMap:na,setErrorMap:r_,getErrorMap:uu,makeIssue:cu,EMPTY_PATH:n_,addIssueToContext:I,ParseStatus:je,INVALID:U,DIRTY:ip,OK:Be,isAborted:jl,isDirty:$l,isValid:sa,isAsync:lu,get util(){return re},get objectUtil(){return Rl},ZodParsedType:P,getParsedType:$r,ZodType:q,ZodString:Mr,ZodNumber:Tn,ZodBigInt:Pn,ZodBoolean:kn,ZodDate:In,ZodSymbol:Ms,ZodUndefined:Cn,ZodNull:Nn,ZodAny:Lr,ZodUnknown:ur,ZodNever:Pt,ZodVoid:Ls,ZodArray:cr,ZodObject:Ze,ZodUnion:Rn,ZodDiscriminatedUnion:du,ZodIntersection:jn,ZodTuple:Kt,ZodRecord:fu,ZodMap:Ds,ZodSet:Bs,ZodFunction:hu,ZodLazy:$n,ZodLiteral:Mn,ZodEnum:Ln,ZodNativeEnum:Dn,ZodPromise:Dr,ZodEffects:Xe,ZodTransformer:Xe,ZodOptional:Tt,ZodNullable:lr,ZodDefault:Bn,ZodCatch:Fs,ZodNaN:Us,BRAND:m_,ZodBranded:pu,ZodPipeline:ia,ZodReadonly:zs,custom:op,Schema:q,ZodSchema:q,late:g_,get ZodFirstPartyTypeKind(){return w},coerce:Y_,any:O_,array:P_,bigint:__,boolean:lp,date:w_,discriminatedUnion:N_,effect:np,enum:U_,function:D_,instanceof:y_,intersection:R_,lazy:B_,literal:F_,map:M_,nan:b_,nativeEnum:z_,never:S_,null:A_,nullable:V_,number:cp,object:k_,oboolean:W_,onumber:J_,optional:q_,ostring:G_,pipeline:H_,preprocess:Z_,promise:K_,record:$_,set:L_,strictObject:I_,string:up,symbol:v_,transformer:np,tuple:j_,undefined:x_,union:C_,unknown:E_,void:T_,NEVER:X_,ZodIssueCode:x,quotelessJson:t_,ZodError:Ye});var ad=pt(Yo(),1);var mu,Q_=new Uint8Array(16);function Ll(){if(!mu&&(mu=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!mu))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return mu(Q_)}var dp=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function ew(r){return typeof r=="string"&&dp.test(r)}var aa=ew;var Te=[];for(let r=0;r<256;++r)Te.push((r+256).toString(16).slice(1));function fp(r,e=0){return Te[r[e+0]]+Te[r[e+1]]+Te[r[e+2]]+Te[r[e+3]]+"-"+Te[r[e+4]]+Te[r[e+5]]+"-"+Te[r[e+6]]+Te[r[e+7]]+"-"+Te[r[e+8]]+Te[r[e+9]]+"-"+Te[r[e+10]]+Te[r[e+11]]+Te[r[e+12]]+Te[r[e+13]]+Te[r[e+14]]+Te[r[e+15]]}var tw=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Dl={randomUUID:tw};function rw(r,e,t){if(Dl.randomUUID&&!e&&!r)return Dl.randomUUID();r=r||{};let n=r.random||(r.rng||Ll)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=n[s];return e}return fp(n)}var Fe=rw;var Bl=class{},Fn=class r extends Bl{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,ml(this.constructor)]}constructor(e){var t,n,s,i,a;super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:ae("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=(t=e.ignoreLLM)!=null?t:this.ignoreLLM,this.ignoreChain=(n=e.ignoreChain)!=null?n:this.ignoreChain,this.ignoreAgent=(s=e.ignoreAgent)!=null?s:this.ignoreAgent,this.ignoreRetriever=(i=e.ignoreRetriever)!=null?i:this.ignoreRetriever,this.awaitHandlers=(a=e._awaitHandler)!=null?a:this.awaitHandlers)}copy(){return new this.constructor(this)}toJSON(){return Ot.prototype.toJSON.call(this)}toJSONNotImplemented(){return Ot.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends r{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Fe()}),Object.assign(this,e)}}return new t}};var Ul=pt(yp(),1);function Fl(r,e){return r&&!Array.isArray(r)&&typeof r=="object"?r:{[e]:r}}function sw(r){return r.replace(/[-:.]/g,"")}function iw(r,e){return sw(`${new Date(r).toISOString().slice(0,-1)}000Z`)+e}var kt=class extends Fn{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}async _startTrace(e){var s;let t=iw(e.start_time,e.id),n={...e};if(n.parent_run_id!==void 0){let i=this.runMap.get(n.parent_run_id);i&&(this._addChildRun(i,n),i.child_execution_order=Math.max(i.child_execution_order,n.child_execution_order),n.trace_id=i.trace_id,i.dotted_order!==void 0&&(n.dotted_order=[i.dotted_order,t].join(".")))}else n.trace_id=n.id,n.dotted_order=t;this.runMap.set(n.id,n),await((s=this.onRunCreate)==null?void 0:s.call(this,n))}async _endTrace(e){var n;let t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((n=this.onRunUpdate)==null?void 0:n.call(this,e))}_getExecutionOrder(e){let t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,n,s,i,a,o,u){var h;let c=this._getExecutionOrder(s),l=Date.now(),d=o?{...i,metadata:o}:i,f={id:n,name:u!=null?u:e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d!=null?d:{},tags:a||[]};return await this._startTrace(f),await((h=this.onLLMStart)==null?void 0:h.call(this,f)),f}async handleChatModelStart(e,t,n,s,i,a,o,u){var h;let c=this._getExecutionOrder(s),l=Date.now(),d=o?{...i,metadata:o}:i,f={id:n,name:u!=null?u:e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d!=null?d:{},tags:a||[]};return await this._startTrace(f),await((h=this.onLLMStart)==null?void 0:h.call(this,f)),f}async handleLLMEnd(e,t){var s;let n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="llm")throw new Error("No LLM run to end.");return n.end_time=Date.now(),n.outputs=e,n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onLLMEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleLLMError(e,t){var s;let n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="llm")throw new Error("No LLM run to end.");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onLLMError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleChainStart(e,t,n,s,i,a,o,u){var f;let c=this._getExecutionOrder(s),l=Date.now(),d={id:n,name:u!=null?u:e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:o!=null?o:"chain",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return await this._startTrace(d),await((f=this.onChainStart)==null?void 0:f.call(this,d)),d}async handleChainEnd(e,t,n,s,i){var o;let a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=Fl(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=Fl(i.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleChainError(e,t,n,s,i){var o;let a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=Fl(i.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleToolStart(e,t,n,s,i,a,o){var d;let u=this._getExecutionOrder(s),c=Date.now(),l={id:n,name:o!=null?o:e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:u,child_execution_order:u,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return await this._startTrace(l),await((d=this.onToolStart)==null?void 0:d.call(this,l)),l}async handleToolEnd(e,t){var s;let n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onToolEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleToolError(e,t){var s;let n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onToolError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleAgentAction(e,t){var i;let n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="chain")return;let s=n;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentAction)==null?void 0:i.call(this,n))}async handleAgentEnd(e,t){var s;let n=this.runMap.get(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,n)))}async handleRetrieverStart(e,t,n,s,i,a,o){var d;let u=this._getExecutionOrder(s),c=Date.now(),l={id:n,name:o!=null?o:e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:u,child_execution_order:u,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return await this._startTrace(l),await((d=this.onRetrieverStart)==null?void 0:d.call(this,l)),l}async handleRetrieverEnd(e,t){var s;let n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onRetrieverEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleRetrieverError(e,t){var s;let n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onRetrieverError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleText(e,t){var s;let n=this.runMap.get(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,n)))}async handleLLMNewToken(e,t,n,s,i,a){var u;let o=this.runMap.get(n);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:a==null?void 0:a.chunk}}),await((u=this.onLLMNewToken)==null?void 0:u.call(this,o,e,{chunk:a==null?void 0:a.chunk})),o}};function Ue(r,e){return`${r.open}${e}${r.close}`}function It(r,e){try{return JSON.stringify(r,null,2)}catch(t){return e}}function Br(r){if(!r.end_time)return"";let e=r.end_time-r.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}var{color:He}=Ul.default,oa=class extends kt{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],n=e;for(;n.parent_run_id;){let s=this.runMap.get(n.parent_run_id);if(s)t.push(s),n=s;else break}return t}getBreadcrumbs(e){let n=[...this.getParents(e).reverse(),e].map((s,i,a)=>{let o=`${s.execution_order}:${s.run_type}:${s.name}`;return i===a.length-1?Ue(Ul.default.bold,o):o}).join(" > ");return Ue(He.grey,n)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${Ue(He.green,"[chain/start]")} [${t}] Entering Chain run with input: ${It(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ue(He.cyan,"[chain/end]")} [${t}] [${Br(e)}] Exiting Chain run with output: ${It(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${Ue(He.red,"[chain/error]")} [${t}] [${Br(e)}] Chain run errored with error: ${It(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${Ue(He.green,"[llm/start]")} [${t}] Entering LLM run with input: ${It(n,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ue(He.cyan,"[llm/end]")} [${t}] [${Br(e)}] Exiting LLM run with output: ${It(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${Ue(He.red,"[llm/error]")} [${t}] [${Br(e)}] LLM run errored with error: ${It(e.error,"[error]")}`)}onToolStart(e){var n;let t=this.getBreadcrumbs(e);console.log(`${Ue(He.green,"[tool/start]")} [${t}] Entering Tool run with input: "${(n=e.inputs.input)==null?void 0:n.trim()}"`)}onToolEnd(e){var n,s;let t=this.getBreadcrumbs(e);console.log(`${Ue(He.cyan,"[tool/end]")} [${t}] [${Br(e)}] Exiting Tool run with output: "${(s=(n=e.outputs)==null?void 0:n.output)==null?void 0:s.trim()}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${Ue(He.red,"[tool/error]")} [${t}] [${Br(e)}] Tool run errored with error: ${It(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${Ue(He.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${It(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ue(He.cyan,"[retriever/end]")} [${t}] [${Br(e)}] Exiting Retriever run with output: ${It(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${Ue(He.red,"[retriever/error]")} [${t}] [${Br(e)}] Retriever run errored with error: ${It(e.error,"[error]")}`)}onAgentAction(e){let t=e,n=this.getBreadcrumbs(e);console.log(`${Ue(He.blue,"[agent/action]")} [${n}] Agent selected action: ${It(t.actions[t.actions.length-1],"[action]")}`)}};var bp=pt(Yo(),1),gu=pt(ru(),1),aw=[400,401,403,404,405,406,407,408],ow=[409],ua=class{constructor(e){var n,s;Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=(n=e.maxConcurrency)!=null?n:1/0,this.maxRetries=(s=e.maxRetries)!=null?s:6;let t="default"in gu.default?gu.default.default:gu.default;this.queue=new t({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){let n=this.onFailedResponseHook;return this.queue.add(()=>(0,bp.default)(()=>e(...t).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.message.startsWith("AbortError")||(s==null?void 0:s.code)==="ECONNABORTED")throw s;let i=s==null?void 0:s.response,a=i==null?void 0:i.status;if(a){if(aw.includes(+a))throw s;if(ow.includes(+a))return;n&&await n(i)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};function zl(r){return typeof(r==null?void 0:r._getType)=="function"}function Kl(r){let e={type:r._getType(),data:{content:r.content}};return r!=null&&r.additional_kwargs&&Object.keys(r.additional_kwargs).length>0&&(e.data.additional_kwargs={...r.additional_kwargs}),e}var fr,uw=()=>typeof window!="undefined"&&typeof window.document!="undefined",cw=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",lw=()=>typeof window!="undefined"&&window.name==="nodejs"||typeof navigator!="undefined"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),_p=()=>typeof Deno!="undefined",dw=()=>typeof process!="undefined"&&typeof process.versions!="undefined"&&typeof process.versions.node!="undefined"&&!_p(),fw=()=>fr||(uw()?fr="browser":dw()?fr="node":cw()?fr="webworker":lw()?fr="jsdom":_p()?fr="deno":fr="other",fr),ql;async function Zl(){if(ql===void 0){let r=fw(),e=pw();ql={library:"langsmith",runtime:r,sdk:"langsmith-js",sdk_version:yu,...e}}return ql}function wp(){let r=hw()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(let[n,s]of Object.entries(r))n.startsWith("LANGCHAIN_")&&typeof s=="string"&&!t.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[n]=s);return e}function hw(){try{return typeof process!="undefined"&&process.env?Object.entries(process.env).reduce((r,[e,t])=>(r[e]=String(t),r),{}):void 0}catch(r){return}}function hr(r){var e;try{return typeof process!="undefined"?(e=process.env)==null?void 0:e[r]:void 0}catch(t){return}}var Vl;function pw(){if(Vl!==void 0)return Vl;let r=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(let t of r){let n=hr(t);n!==void 0&&(e[t]=n)}return Vl=e,e}async function vp(r){let e=await Zl(),t=wp();return r.map(n=>{var a,o;let s=(a=n.extra)!=null?a:{},i=s.metadata;return n.extra={...s,runtime:{...e,...s==null?void 0:s.runtime},metadata:{...t,...t.revision_id||n.revision_id?{revision_id:(o=n.revision_id)!=null?o:t.revision_id}:{},...i}},n})}var mw=()=>{let r=hr("LANGCHAIN_TRACING_SAMPLING_RATE");if(r===void 0)return;let e=parseFloat(r);if(e<0||e>1)throw new Error(`LANGCHAIN_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},gw=r=>{let t=r.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"},Fr=async(r,e)=>{let t=await r.text();if(!r.ok)throw new Error(`Failed to ${e}: ${r.status} ${r.statusText} ${t}`)};async function yw(r){let e=[];for await(let t of r)e.push(t);return e}function Hl(r){if(r!==void 0)return r.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}function le(r){if(!aa(r))throw new Error(`Invalid UUID: ${r}`)}var bw=async r=>{var e;if((r==null?void 0:r.status)===429){let t=parseInt((e=r.headers.get("retry-after"))!=null?e:"30",10)*1e3;if(t>0)return await new Promise(n=>setTimeout(n,t)),!0}return!1},Gl=class{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]})}get size(){return this.items.length}push(e){return new Promise(t=>{this.items.push([e,t])})}pop(e){if(e<1)throw new Error("Number of items to pop off may not be less than 1.");let t=[];for(;t.length<e&&this.items.length;){let n=this.items.shift();if(n)t.push(n);else break}return[t.map(n=>n[0]),()=>t.forEach(n=>n[1]())]}},_w=20971520,Ks=class r{constructor(e={}){var n,s,i,a,o,u,c,l,d,f,h;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sampledPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Gl}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=r.getDefaultClientConfig();this.tracingSampleRate=mw(),this.apiUrl=(s=Hl((n=e.apiUrl)!=null?n:t.apiUrl))!=null?s:"",this.apiKey=Hl((i=e.apiKey)!=null?i:t.apiKey),this.webUrl=Hl((a=e.webUrl)!=null?a:t.webUrl),this.timeout_ms=(o=e.timeout_ms)!=null?o:12e3,this.caller=new ua((u=e.callerOptions)!=null?u:{}),this.batchIngestCaller=new ua({...(c=e.callerOptions)!=null?c:{},onFailedResponseHook:bw}),this.hideInputs=(l=e.hideInputs)!=null?l:t.hideInputs,this.hideOutputs=(d=e.hideOutputs)!=null?d:t.hideOutputs,this.autoBatchTracing=(f=e.autoBatchTracing)!=null?f:this.autoBatchTracing,this.pendingAutoBatchedRunLimit=(h=e.pendingAutoBatchedRunLimit)!=null?h:this.pendingAutoBatchedRunLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){var i;let e=hr("LANGCHAIN_API_KEY"),t=(i=hr("LANGCHAIN_ENDPOINT"))!=null?i:"https://api.smith.langchain.com",n=hr("LANGCHAIN_HIDE_INPUTS")==="true",s=hr("LANGCHAIN_HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:gw(this.apiUrl)?(this.webUrl="http://localhost","http://localhost"):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com","https://dev.smith.langchain.com"):(this.webUrl="https://smith.langchain.com","https://smith.langchain.com")}get headers(){let e={"User-Agent":`langsmith-js/${yu}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){let t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){var a;let n=(a=t==null?void 0:t.toString())!=null?a:"",s=`${this.apiUrl}${e}?${n}`,i=await this.caller.call(fetch,s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok)throw new Error(`Failed to fetch ${e}: ${i.status} ${i.statusText}`);return i}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams){let n=Number(t.get("offset"))||0,s=Number(t.get("limit"))||100;for(;;){t.set("offset",String(n)),t.set("limit",String(s));let i=`${this.apiUrl}${e}?${t}`,a=await this.caller.call(fetch,i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!a.ok)throw new Error(`Failed to fetch ${e}: ${a.status} ${a.statusText}`);let o=await a.json();if(o.length===0||(yield o,o.length<s))break;n+=o.length}}async*_getCursorPaginatedList(e,t=null,n="POST",s="runs"){let i=t?{...t}:{};for(;;){let o=await(await this.caller.call(fetch,`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(i)})).json();if(!o||!o[s])break;yield o[s];let u=o.cursors;if(!u||!u.next)break;i.cursor=u.next}}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){let n=[];for(let s of e)this.sampledPostUuids.has(s.id)&&(n.push(s),this.sampledPostUuids.delete(s.id));return n}else{let n=[];for(let s of e)Math.random()<this.tracingSampleRate&&(n.push(s),this.sampledPostUuids.add(s.id));return n}}async drainAutoBatchQueue(){for(;this.autoBatchQueue.size>=0;){let[e,t]=this.autoBatchQueue.pop(this.pendingAutoBatchedRunLimit);if(!e.length){t();return}try{await this.batchIngestRuns({runCreates:e.filter(n=>n.action==="create").map(n=>n.item),runUpdates:e.filter(n=>n.action==="update").map(n=>n.item)})}finally{t()}}}async processRunOperation(e,t){let n=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0;let s=this.autoBatchQueue.push(e);return(t||this.autoBatchQueue.size>this.pendingAutoBatchedRunLimit)&&await this.drainAutoBatchQueue(),this.autoBatchQueue.size>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)},n?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),s}async _getServerInfo(){let e=await fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!e.ok)throw await e.text(),new Error("Failed to retrieve server info.");return e.json()}async batchEndpointIsSupported(){try{this.serverInfo=await this._getServerInfo()}catch(e){return!1}return!0}async createRun(e){var o;if(!this._filterForSampling([e]).length)return;let t={...this.headers,"Content-Type":"application/json"},n=e.project_name;delete e.project_name;let s=this.prepareRunCreateOrUpdateInputs({session_name:n,...e,start_time:(o=e.start_time)!=null?o:Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){this.processRunOperation({action:"create",item:s}).catch(console.error);return}let i=await vp([s]),a=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(i[0]),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Fr(a,"create run")}async batchIngestRuns({runCreates:e,runUpdates:t}){var c,l,d,f,h;if(e===void 0&&t===void 0)return;let n=(c=e==null?void 0:e.map(p=>this.prepareRunCreateOrUpdateInputs(p)))!=null?c:[],s=(l=t==null?void 0:t.map(p=>this.prepareRunCreateOrUpdateInputs(p)))!=null?l:[];if(n.length>0&&s.length>0){let p=n.reduce((g,y)=>(y.id&&(g[y.id]=y),g),{}),m=[];for(let g of s)g.id!==void 0&&p[g.id]?p[g.id]={...p[g.id],...g}:m.push(g);n=Object.values(p),s=m}let i={post:this._filterForSampling(n),patch:this._filterForSampling(s,!0)};if(!i.post.length&&!i.patch.length)return;if(n=await vp(n),this.batchEndpointSupported===void 0&&(this.batchEndpointSupported=await this.batchEndpointIsSupported()),!this.batchEndpointSupported){this.autoBatchTracing=!1;for(let p of i.post)await this.createRun(p);for(let p of i.patch)p.id!==void 0&&await this.updateRun(p.id,p);return}let a=(h=(f=(d=this.serverInfo)==null?void 0:d.batch_ingest_config)==null?void 0:f.size_limit_bytes)!=null?h:_w,o={post:[],patch:[]},u=0;for(let p of["post","patch"]){let m=p,g=i[m].reverse(),y=g.pop();for(;y!==void 0;){let b=JSON.stringify(y);u>0&&u+b.length>a&&(await this._postBatchIngestRuns(JSON.stringify(o)),u=0,o.post=[],o.patch=[]),u+=b.length,o[m].push(y),y=g.pop()}}(o.post.length>0||o.patch.length>0)&&await this._postBatchIngestRuns(JSON.stringify(o))}async _postBatchIngestRuns(e){let t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},n=await this.batchIngestCaller.call(fetch,`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Fr(n,"batch create run")}async updateRun(e,t){le(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));let n={...t,id:e};if(!this._filterForSampling([n],!0).length)return;if(this.autoBatchTracing&&n.trace_id!==void 0&&n.dotted_order!==void 0){if(t.end_time!==void 0&&n.parent_run_id===void 0){await this.processRunOperation({action:"update",item:n},!0);return}else this.processRunOperation({action:"update",item:n}).catch(console.error);return}let s={...this.headers,"Content-Type":"application/json"},i=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Fr(i,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){le(e);let n=await this._get(`/runs/${e}`);return t&&n.child_run_ids&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:t,projectOpts:n}){if(t!==void 0){let s;t.session_id?s=t.session_id:n!=null&&n.projectName?s=(await this.readProject({projectName:n==null?void 0:n.projectName})).id:n!=null&&n.projectId?s=n==null?void 0:n.projectId:s=(await this.readProject({projectName:hr("LANGCHAIN_PROJECT")||"default"})).id;let i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){let s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await yw(this.listRuns({id:e.child_run_ids})),n={},s={};t.sort((i,a)=>{var o,u;return((o=i==null?void 0:i.dotted_order)!=null?o:"").localeCompare((u=a==null?void 0:a.dotted_order)!=null?u:"")});for(let i of t){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);i.parent_run_id in n||(n[i.parent_run_id]=[]),n[i.parent_run_id].push(i),s[i.id]=i}e.child_runs=n[e.id]||[];for(let i in n)i!==e.id&&(s[i].child_runs=n[i]);return e}async*listRuns(e){let{projectId:t,projectName:n,parentRunId:s,traceId:i,referenceExampleId:a,startTime:o,executionOrder:u,runType:c,error:l,id:d,query:f,filter:h,traceFilter:p,treeFilter:m,limit:g}=e,y=[];if(t&&(y=Array.isArray(t)?t:[t]),n){let O=Array.isArray(n)?n:[n],E=await Promise.all(O.map(T=>this.readProject({projectName:T}).then(_=>_.id)));y.push(...E)}let b={session:y.length?y:null,run_type:c,reference_example:a,query:f,filter:h,trace_filter:p,tree_filter:m,execution_order:u,parent_run:s,start_time:o?o.toISOString():null,error:l,id:d,limit:g,trace:i};for await(let O of this._getCursorPaginatedList("/runs/query",b))yield*O}async shareRun(e,{shareId:t}={}){let n={run_id:e,share_token:t||Fe()};le(e);let i=await(await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(i===null||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){le(e);let t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Fr(t,"unshare run")}async readRunSharedLink(e){le(e);let n=await(await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let n=new URLSearchParams({share_token:e});if(t!==void 0)for(let a of t)n.append("id",a);return le(e),await(await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),le(e);let s=await(await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);let n={dataset_id:e};le(e);let i=await(await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){le(e);let t=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Fr(t,"unshare dataset")}async readSharedDataset(e){return le(e),await(await this.caller.call(fetch,`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createProject({projectName:e,description:t=null,metadata:n=null,upsert:s=!1,projectExtra:i=null,referenceDatasetId:a=null}){let o=s?"?upsert=true":"",u=`${this.apiUrl}/sessions${o}`,c=i||{};n&&(c.metadata=n);let l={name:e,extra:c,description:t};a!==null&&(l.reference_dataset_id=a);let d=await this.caller.call(fetch,u,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),f=await d.json();if(!d.ok)throw new Error(`Failed to create session ${e}: ${d.status} ${d.statusText}`);return f}async updateProject(e,{name:t=null,description:n=null,metadata:s=null,projectExtra:i=null,endTime:a=null}){let o=`${this.apiUrl}/sessions/${e}`,u=i;s&&(u={...u||{},metadata:s});let c={name:t,extra:u,description:n,end_time:a?new Date(a).toISOString():null},l=await this.caller.call(fetch,o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),d=await l.json();if(!l.ok)throw new Error(`Failed to update project ${e}: ${l.status} ${l.statusText}`);return d}async hasProject({projectId:e,projectName:t}){let n="/sessions",s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)le(e),n+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");let i=await this.caller.call(fetch,`${this.apiUrl}${n}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{let a=await i.json();return i.ok?Array.isArray(a)?a.length>0:!0:!1}catch(a){return!1}}async readProject({projectId:e,projectName:t,includeStats:n}){let s="/sessions",i=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)le(e),s+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide projectName or projectId");n!==void 0&&i.append("include_stats",n.toString());let a=await this._get(s,i),o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=a[0]}else o=a;return o}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:n,referenceDatasetId:s,referenceDatasetName:i,referenceFree:a}={}){let o=new URLSearchParams;if(e!==void 0)for(let u of e)o.append("id",u);if(t!==void 0&&o.append("name",t),n!==void 0&&o.append("name_contains",n),s!==void 0)o.append("reference_dataset",s);else if(i!==void 0){let u=await this.readDataset({datasetName:i});o.append("reference_dataset",u.id)}a!==void 0&&o.append("reference_free",a.toString());for await(let u of this._getPaginated("/sessions",o))yield*u}async deleteProject({projectId:e,projectName:t}){let n;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:t})).id:n=e,le(n);let s=await this.caller.call(fetch,`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Fr(s,`delete session ${n} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:n,outputKeys:s,description:i,dataType:a,name:o}){let u=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,t),n.forEach(f=>{c.append("input_keys",f)}),s.forEach(f=>{c.append("output_keys",f)}),i&&c.append("description",i),a&&c.append("data_type",a),o&&c.append("name",o);let l=await this.caller.call(fetch,u,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!l.ok){let f=await l.json();throw f.detail&&f.detail.includes("already exists")?new Error(`Dataset ${t} already exists`):new Error(`Failed to upload CSV: ${l.status} ${l.statusText}`)}return await l.json()}async createDataset(e,{description:t,dataType:n}={}){let s={name:e,description:t};n&&(s.data_type=n);let i=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok){let o=await i.json();throw o.detail&&o.detail.includes("already exists")?new Error(`Dataset ${e} already exists`):new Error(`Failed to create dataset ${i.status} ${i.statusText}`)}return await i.json()}async readDataset({datasetId:e,datasetName:t}){let n="/datasets",s=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)le(e),n+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");let i=await this._get(n,s),a;if(Array.isArray(i)){if(i.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=i[0]}else a=i;return a}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:n,toVersion:s}){let i=e;if(i===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(await this.readDataset({datasetName:t})).id);let a=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${i}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){let n="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:n,datasetName:s,datasetNameContains:i}={}){let a="/datasets",o=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(n!==void 0)for(let u of n)o.append("id",u);s!==void 0&&o.append("name",s),i!==void 0&&o.append("name_contains",i);for await(let u of this._getPaginated(a,o))yield*u}async deleteDataset({datasetId:e,datasetName:t}){let n="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)le(s),n+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");let i=await this.caller.call(fetch,this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok)throw new Error(`Failed to delete ${n}: ${i.status} ${i.statusText}`);await i.json()}async createExample(e,t,{datasetId:n,datasetName:s,createdAt:i,exampleId:a}){let o=n;if(o===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(o!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");o===void 0&&(o=(await this.readDataset({datasetName:s})).id);let u=i||new Date,c={dataset_id:o,inputs:e,outputs:t,created_at:u==null?void 0:u.toISOString(),id:a},l=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!l.ok)throw new Error(`Failed to create example: ${l.status} ${l.statusText}`);return await l.json()}async createExamples(e){let{inputs:t,outputs:n,sourceRunIds:s,exampleIds:i,datasetId:a,datasetName:o}=e,u=a;if(u===void 0&&o===void 0)throw new Error("Must provide either datasetName or datasetId");if(u!==void 0&&o!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");u===void 0&&(u=(await this.readDataset({datasetName:o})).id);let c=t.map((f,h)=>({dataset_id:u,inputs:f,outputs:n?n[h]:void 0,id:i?i[h]:void 0,source_run_id:s?s[h]:void 0})),l=await this.caller.call(fetch,`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!l.ok)throw new Error(`Failed to create examples: ${l.status} ${l.statusText}`);return await l.json()}async createLLMExample(e,t,n){return this.createExample({input:e},{output:t},n)}async createChatExample(e,t,n){let s=e.map(a=>zl(a)?Kl(a):a),i=zl(t)?Kl(t):t;return this.createExample({input:s},{output:i},n)}async readExample(e){le(e);let t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:n,asOf:s,inlineS3Urls:i}={}){let a;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)a=e;else if(t!==void 0)a=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");let o=new URLSearchParams({dataset:a}),u=s?typeof s=="string"?s:s==null?void 0:s.toISOString():void 0;u&&o.append("as_of",u);let c=i!=null?i:!0;if(o.append("inline_s3_urls",c.toString()),n!==void 0)for(let l of n)o.append("id",l);for await(let l of this._getPaginated("/examples",o))yield*l}async deleteExample(e){le(e);let t=`/examples/${e}`,n=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw new Error(`Failed to delete ${t}: ${n.status} ${n.statusText}`);await n.json()}async updateExample(e,t){le(e);let n=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw new Error(`Failed to update example ${e}: ${n.status} ${n.statusText}`);return await n.json()}async evaluateRun(e,t,{sourceInfo:n,loadChildRuns:s,referenceExample:i}={loadChildRuns:!1}){var l;let a;if(typeof e=="string")a=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)a=e;else throw new Error(`Invalid run type: ${typeof e}`);a.reference_example_id!==null&&a.reference_example_id!==void 0&&(i=await this.readExample(a.reference_example_id));let o=await t.evaluateRun(a,i),u=n!=null?n:{};o.evaluatorInfo&&(u={...u,...o.evaluatorInfo});let c=(l=o.targetRunId)!=null?l:a.id;return await this.createFeedback(c,o.key,{score:o==null?void 0:o.score,value:o==null?void 0:o.value,comment:o==null?void 0:o.comment,correction:o==null?void 0:o.correction,sourceInfo:u,feedbackSourceType:"model",sourceRunId:o==null?void 0:o.sourceRunId})}async createFeedback(e,t,{score:n,value:s,correction:i,comment:a,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:c,feedbackId:l,feedbackConfig:d}){var g;let f={type:u!=null?u:"api",metadata:o!=null?o:{}};c!==void 0&&(f==null?void 0:f.metadata)!==void 0&&!f.metadata.__run&&(f.metadata.__run={run_id:c}),(f==null?void 0:f.metadata)!==void 0&&((g=f.metadata.__run)==null?void 0:g.run_id)!==void 0&&le(f.metadata.__run.run_id);let h={id:l!=null?l:Fe(),run_id:e,key:t,score:n,value:s,correction:i,comment:a,feedback_source:f,feedbackConfig:d},p=`${this.apiUrl}/feedback`,m=await this.caller.call(fetch,p,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(h),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Fr(m,"create feedback"),h}async updateFeedback(e,{score:t,value:n,correction:s,comment:i}){let a={};t!=null&&(a.score=t),n!=null&&(a.value=n),s!=null&&(a.correction=s),i!=null&&(a.comment=i),le(e);let o=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Fr(o,"update feedback")}async readFeedback(e){le(e);let t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){le(e);let t=`/feedback/${e}`,n=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw new Error(`Failed to delete ${t}: ${n.status} ${n.statusText}`);await n.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){let s=new URLSearchParams;if(e&&s.append("run",e.join(",")),t)for(let i of t)s.append("key",i);if(n)for(let i of n)s.append("source",i);for await(let i of this._getPaginated("/feedback",s))yield*i}async createPresignedFeedbackToken(e,t,{expiration:n,feedbackConfig:s}={}){let i={run_id:e,feedback_key:t,feedback_config:s};return n?typeof n=="string"?i.expires_at=n:(n!=null&&n.hours||n!=null&&n.minutes||n!=null&&n.days)&&(i.expires_in=n):i.expires_in={hours:3},await(await this.caller.call(fetch,`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){le(e);let t=new URLSearchParams({run_id:e});for await(let n of this._getPaginated("/feedback/tokens",t))yield*n}};var yu="0.1.14";var ca=class extends kt{constructor(e={}){var i;super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{exampleId:t,projectName:n,client:s}=e;this.projectName=(i=n!=null?n:ae("LANGCHAIN_PROJECT"))!=null?i:ae("LANGCHAIN_SESSION"),this.exampleId=t,this.client=s!=null?s:new Ks({})}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await Rh()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){let t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){let t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}};async function xp(){return new ca}var bu=pt(ru(),1),Jl;function ww(){let r="default"in bu.default?bu.default.default:bu.default;return new r({autoStart:!0,concurrency:1})}async function Ae(r,e){e===!0?await r():(typeof Jl=="undefined"&&(Jl=ww()),Jl.add(r))}ae("LANGCHAIN_TRACING_V2")==="true"&&ae("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"&&["[WARN]: You have enabled LangSmith tracing without backgrounding callbacks.","[WARN]: If you are not using a serverless environment where you must wait for tracing calls to finish,",'[WARN]: we suggest setting "process.env.LANGCHAIN_CALLBACKS_BACKGROUND=true" to avoid additional latency.'].join(`
`);function Ap(r){return r?Array.isArray(r)||"name"in r?{callbacks:r}:r:{}}var Wl=class{setHandler(e){return this.setHandlers([e])}},qs=class{constructor(e,t,n,s,i,a,o,u){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:u})}async handleText(e){await Promise.all(this.handlers.map(t=>Ae(async()=>{var n;try{await((n=t.handleText)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleText: ${s}`)}},t.awaitHandlers)))}},Yl=class extends qs{getChild(e){let t=new Oe(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>Ae(async()=>{var n;if(!t.ignoreRetriever)try{await((n=t.handleRetrieverEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>Ae(async()=>{var n;if(!t.ignoreRetriever)try{await((n=t.handleRetrieverError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${s}`)}},t.awaitHandlers)))}},_u=class extends qs{async handleLLMNewToken(e,t,n,s,i,a){await Promise.all(this.handlers.map(o=>Ae(async()=>{var u;if(!o.ignoreLLM)try{await((u=o.handleLLMNewToken)==null?void 0:u.call(o,e,t!=null?t:{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a))}catch(c){console.error(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${c}`)}},o.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>Ae(async()=>{var n;if(!t.ignoreLLM)try{await((n=t.handleLLMError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${s}`)}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>Ae(async()=>{var n;if(!t.ignoreLLM)try{await((n=t.handleLLMEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${s}`)}},t.awaitHandlers)))}},Xl=class extends qs{getChild(e){let t=new Oe(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,n,s,i){await Promise.all(this.handlers.map(a=>Ae(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainError)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(u){console.error(`Error in handler ${a.constructor.name}, handleChainError: ${u}`)}},a.awaitHandlers)))}async handleChainEnd(e,t,n,s,i){await Promise.all(this.handlers.map(a=>Ae(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainEnd)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(u){console.error(`Error in handler ${a.constructor.name}, handleChainEnd: ${u}`)}},a.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>Ae(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentAction)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${s}`)}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>Ae(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${s}`)}},t.awaitHandlers)))}},Ql=class extends qs{getChild(e){let t=new Oe(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>Ae(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${s}`)}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>Ae(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${s}`)}},t.awaitHandlers)))}},Oe=class r extends Wl{constructor(e,t){var n,s,i,a,o,u;super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(n=t==null?void 0:t.handlers)!=null?n:this.handlers,this.inheritableHandlers=(s=t==null?void 0:t.inheritableHandlers)!=null?s:this.inheritableHandlers,this.tags=(i=t==null?void 0:t.tags)!=null?i:this.tags,this.inheritableTags=(a=t==null?void 0:t.inheritableTags)!=null?a:this.inheritableTags,this.metadata=(o=t==null?void 0:t.metadata)!=null?o:this.metadata,this.inheritableMetadata=(u=t==null?void 0:t.inheritableMetadata)!=null?u:this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,n=void 0,s=void 0,i=void 0,a=void 0,o=void 0,u=void 0){return Promise.all(t.map(async c=>{let l=Fe();return await Promise.all(this.handlers.map(d=>Ae(async()=>{var f;if(!d.ignoreLLM)try{await((f=d.handleLLMStart)==null?void 0:f.call(d,e,[c],l,this._parentRunId,i,this.tags,this.metadata,u))}catch(h){console.error(`Error in handler ${d.constructor.name}, handleLLMStart: ${h}`)}},d.awaitHandlers))),new _u(l,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,n=void 0,s=void 0,i=void 0,a=void 0,o=void 0,u=void 0){return Promise.all(t.map(async c=>{let l=Fe();return await Promise.all(this.handlers.map(d=>Ae(async()=>{var f,h;if(!d.ignoreLLM)try{if(d.handleChatModelStart)await((f=d.handleChatModelStart)==null?void 0:f.call(d,e,[c],l,this._parentRunId,i,this.tags,this.metadata,u));else if(d.handleLLMStart){let p=js(c);await((h=d.handleLLMStart)==null?void 0:h.call(d,e,[p],l,this._parentRunId,i,this.tags,this.metadata,u))}}catch(p){console.error(`Error in handler ${d.constructor.name}, handleLLMStart: ${p}`)}},d.awaitHandlers))),new _u(l,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,n=Fe(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>Ae(async()=>{var c;if(!u.ignoreChain)try{await((c=u.handleChainStart)==null?void 0:c.call(u,e,t,n,this._parentRunId,this.tags,this.metadata,s,o))}catch(l){console.error(`Error in handler ${u.constructor.name}, handleChainStart: ${l}`)}},u.awaitHandlers))),new Xl(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,n=Fe(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>Ae(async()=>{var c;if(!u.ignoreAgent)try{await((c=u.handleToolStart)==null?void 0:c.call(u,e,t,n,this._parentRunId,this.tags,this.metadata,o))}catch(l){console.error(`Error in handler ${u.constructor.name}, handleToolStart: ${l}`)}},u.awaitHandlers))),new Ql(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,n=Fe(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>Ae(async()=>{var c;if(!u.ignoreRetriever)try{await((c=u.handleRetrieverStart)==null?void 0:c.call(u,e,t,n,this._parentRunId,this.tags,this.metadata,o))}catch(l){console.error(`Error in handler ${u.constructor.name}, handleRetrieverStart: ${l}`)}},u.awaitHandlers))),new Yl(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(let n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let n=new r(this._parentRunId);for(let s of this.handlers){let i=this.inheritableHandlers.includes(s);n.addHandler(s,i)}for(let s of this.tags){let i=this.inheritableTags.includes(s);n.addTags([s],i)}for(let s of Object.keys(this.metadata)){let i=Object.keys(this.inheritableMetadata).includes(s);n.addMetadata({[s]:this.metadata[s]},i)}for(let s of e)n.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===s.name)||n.addHandler(s,t);return n}static fromHandlers(e){class t extends Fn{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Fe()}),Object.assign(this,e)}}let n=new this;return n.addHandler(new t),n}static async configure(e,t,n,s,i,a,o){var f,h;let u;(e||t)&&(Array.isArray(e)||!e?(u=new r,u.setHandlers((f=e==null?void 0:e.map(la))!=null?f:[],!0)):u=e,u=u.copy(Array.isArray(t)?t.map(la):t==null?void 0:t.handlers,!1));let c=ae("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),l=ae("LANGCHAIN_TRACING_V2")==="true",d=l||((h=ae("LANGCHAIN_TRACING"))!=null?h:!1);if(c||d){if(u||(u=new r),c&&!u.handlers.some(p=>p.name===oa.prototype.name)){let p=new oa;u.addHandler(p,!0)}d&&!u.handlers.some(p=>p.name==="langchain_tracer")&&l&&u.addHandler(await xp(),!0)}return(n||s)&&u&&(u.addTags(n!=null?n:[]),u.addTags(s!=null?s:[],!1)),(i||a)&&u&&(u.addMetadata(i!=null?i:{}),u.addMetadata(a!=null?a:{},!1)),u}};function la(r){return"name"in r?r:Fn.fromMethods(r)}var ed={};jc(ed,{JsonPatchError:()=>pe,_areEquals:()=>fa,applyOperation:()=>zn,applyPatch:()=>Ur,applyReducer:()=>Ow,deepClone:()=>xw,getValueByPointer:()=>Ou,validate:()=>Ep,validator:()=>Eu});var vw=Object.prototype.hasOwnProperty;function vu(r,e){return vw.call(r,e)}function xu(r){if(Array.isArray(r)){let t=new Array(r.length);for(let n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(r);let e=[];for(let t in r)vu(r,t)&&e.push(t);return e}function $e(r){switch(typeof r){case"object":return JSON.parse(JSON.stringify(r));case"undefined":return null;default:return r}}function Au(r){let e=0,t=r.length,n;for(;e<t;){if(n=r.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function qt(r){return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}function da(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}function wu(r){if(r===void 0)return!0;if(r){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(wu(r[t]))return!0}else if(typeof r=="object"){let t=xu(r),n=t.length;for(var e=0;e<n;e++)if(wu(r[t[e]]))return!0}}return!1}function Op(r,e){let t=[r];for(let n in e){let s=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof s!="undefined"&&t.push(`${n}: ${s}`)}return t.join(`
`)}var Un=class extends Error{constructor(e,t,n,s,i){super(Op(e,{name:t,index:n,operation:s,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=Op(e,{name:t,index:n,operation:s,tree:i})}};var pe=Un,xw=$e,Vs={add:function(r,e,t){return r[e]=this.value,{newDocument:t}},remove:function(r,e,t){var n=r[e];return delete r[e],{newDocument:t,removed:n}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:function(r,e,t){let n=Ou(t,this.path);n&&(n=$e(n));let s=zn(t,{op:"remove",path:this.from}).removed;return zn(t,{op:"add",path:this.path,value:s}),{newDocument:t,removed:n}},copy:function(r,e,t){let n=Ou(t,this.from);return zn(t,{op:"add",path:this.path,value:$e(n)}),{newDocument:t}},test:function(r,e,t){return{newDocument:t,test:fa(r[e],this.value)}},_get:function(r,e,t){return this.value=r[e],{newDocument:t}}},Aw={add:function(r,e,t){return Au(e)?r.splice(e,0,this.value):r[e]=this.value,{newDocument:t,index:e}},remove:function(r,e,t){var n=r.splice(e,1);return{newDocument:t,removed:n[0]}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:Vs.move,copy:Vs.copy,test:Vs.test,_get:Vs._get};function Ou(r,e){if(e=="")return r;var t={op:"_get",path:e};return zn(r,t),t.value}function zn(r,e,t=!1,n=!0,s=!0,i=0){if(t&&(typeof t=="function"?t(e,0,r,e.path):Eu(e,0)),e.path===""){let a={newDocument:r};if(e.op==="add")return a.newDocument=e.value,a;if(e.op==="replace")return a.newDocument=e.value,a.removed=r,a;if(e.op==="move"||e.op==="copy")return a.newDocument=Ou(r,e.from),e.op==="move"&&(a.removed=r),a;if(e.op==="test"){if(a.test=fa(r,e.value),a.test===!1)throw new pe("Test operation failed","TEST_OPERATION_FAILED",i,e,r);return a.newDocument=r,a}else{if(e.op==="remove")return a.removed=r,a.newDocument=null,a;if(e.op==="_get")return e.value=r,a;if(t)throw new pe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,e,r);return a}}else{n||(r=$e(r));let o=(e.path||"").split("/"),u=r,c=1,l=o.length,d,f,h;for(typeof t=="function"?h=t:h=Eu;;){if(f=o[c],f&&f.indexOf("~")!=-1&&(f=da(f)),s&&(f=="__proto__"||f=="prototype"&&c>0&&o[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(u[f]===void 0?d=o.slice(0,c).join("/"):c==l-1&&(d=e.path),d!==void 0&&h(e,0,r,d)),c++,Array.isArray(u)){if(f==="-")f=u.length;else{if(t&&!Au(f))throw new pe("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,e,r);Au(f)&&(f=~~f)}if(c>=l){if(t&&e.op==="add"&&f>u.length)throw new pe("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,e,r);let p=Aw[e.op].call(e,u,f,r);if(p.test===!1)throw new pe("Test operation failed","TEST_OPERATION_FAILED",i,e,r);return p}}else if(c>=l){let p=Vs[e.op].call(e,u,f,r);if(p.test===!1)throw new pe("Test operation failed","TEST_OPERATION_FAILED",i,e,r);return p}if(u=u[f],t&&c<l&&(!u||typeof u!="object"))throw new pe("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,e,r)}}}function Ur(r,e,t,n=!0,s=!0){if(t&&!Array.isArray(e))throw new pe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(r=$e(r));let i=new Array(e.length);for(let a=0,o=e.length;a<o;a++)i[a]=zn(r,e[a],t,!0,s,a),r=i[a].newDocument;return i.newDocument=r,i}function Ow(r,e,t){let n=zn(r,e);if(n.test===!1)throw new pe("Test operation failed","TEST_OPERATION_FAILED",t,e,r);return n.newDocument}function Eu(r,e,t,n){if(typeof r!="object"||r===null||Array.isArray(r))throw new pe("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,r,t);if(Vs[r.op]){if(typeof r.path!="string")throw new pe("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,r,t);if(r.path.indexOf("/")!==0&&r.path.length>0)throw new pe('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,r,t);if((r.op==="move"||r.op==="copy")&&typeof r.from!="string")throw new pe("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&r.value===void 0)throw new pe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&wu(r.value))throw new pe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,r,t);if(t){if(r.op=="add"){var s=r.path.split("/").length,i=n.split("/").length;if(s!==i+1&&s!==i)throw new pe("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,r,t)}else if(r.op==="replace"||r.op==="remove"||r.op==="_get"){if(r.path!==n)throw new pe("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,r,t)}else if(r.op==="move"||r.op==="copy"){var a={op:"_get",path:r.from,value:void 0},o=Ep([a],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new pe("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,r,t)}}}else throw new pe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,r,t)}function Ep(r,e,t){try{if(!Array.isArray(r))throw new pe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Ur($e(e),$e(r),t||!0);else{t=t||Eu;for(var n=0;n<r.length;n++)t(r[n],n,e,void 0)}}catch(s){if(s instanceof pe)return s;throw s}}function fa(r,e){if(r===e)return!0;if(r&&e&&typeof r=="object"&&typeof e=="object"){var t=Array.isArray(r),n=Array.isArray(e),s,i,a;if(t&&n){if(i=r.length,i!=e.length)return!1;for(s=i;s--!==0;)if(!fa(r[s],e[s]))return!1;return!0}if(t!=n)return!1;var o=Object.keys(r);if(i=o.length,i!==Object.keys(e).length)return!1;for(s=i;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=i;s--!==0;)if(a=o[s],!fa(r[a],e[a]))return!1;return!0}return r!==r&&e!==e}function Sp(r,e,t,n,s){if(e!==r){typeof e.toJSON=="function"&&(e=e.toJSON());for(var i=xu(e),a=xu(r),o=!1,u=!1,c=a.length-1;c>=0;c--){var l=a[c],d=r[l];if(vu(e,l)&&!(e[l]===void 0&&d!==void 0&&Array.isArray(e)===!1)){var f=e[l];typeof d=="object"&&d!=null&&typeof f=="object"&&f!=null&&Array.isArray(d)===Array.isArray(f)?Sp(d,f,t,n+"/"+qt(l),s):d!==f&&(o=!0,s&&t.push({op:"test",path:n+"/"+qt(l),value:$e(d)}),t.push({op:"replace",path:n+"/"+qt(l),value:$e(f)}))}else Array.isArray(r)===Array.isArray(e)?(s&&t.push({op:"test",path:n+"/"+qt(l),value:$e(d)}),t.push({op:"remove",path:n+"/"+qt(l)}),u=!0):(s&&t.push({op:"test",path:n,value:r}),t.push({op:"replace",path:n,value:e}),o=!0)}if(!(!u&&i.length==a.length))for(var c=0;c<i.length;c++){var l=i[c];!vu(r,l)&&e[l]!==void 0&&t.push({op:"add",path:n+"/"+qt(l),value:$e(e[l])})}}}function Su(r,e,t=!1){var n=[];return Sp(r,e,n,"",t),n}var Bk={...ed,JsonPatchError:Un,deepClone:$e,escapePathComponent:qt,unescapePathComponent:da};var Vt=class r extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){let t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}static fromReadableStream(e){let t=e.getReader();return new r({start(n){return s();function s(){return t.read().then(({done:i,value:a})=>{if(i){n.close();return}return n.enqueue(a),s()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new r({async pull(t){let{value:n,done:s}=await e.next();s&&t.close(),t.enqueue(n)},async cancel(t){await e.return(t)}})}};function td(r,e=2){let t=Array.from({length:e},()=>[]);return t.map(async function*(s){for(;;)if(s.length===0){let i=await r.next();for(let a of t)a.push(i)}else{if(s[0].done)return;yield s.shift().value}})}function Zt(r,e){if(Array.isArray(r)&&Array.isArray(e))return r.concat(e);if(typeof r=="string"&&typeof e=="string")return r+e;if(typeof r=="number"&&typeof e=="number")return r+e;if("concat"in r&&typeof r.concat=="function")return r.concat(e);if(typeof r=="object"&&typeof e=="object"){let t={...r};for(let[n,s]of Object.entries(e))n in t&&!Array.isArray(t[n])?t[n]=Zt(t[n],s):t[n]=s;return t}else throw new Error(`Cannot concat ${typeof r} and ${typeof e}`)}var pr=class{constructor(e,t){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e,this.setup=new Promise((n,s)=>{this.firstResult=e.next(),t?this.firstResult.then(t).then(n,s):this.firstResult.then(i=>n(void 0),s)})}async next(...e){return this.firstResultUsed?this.generator.next(...e):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}};async function Tp(r,e,t,...n){let s=new pr(e,t),i=await s.setup;return{output:r(s,i,...n),setup:i}}var Ct=class{constructor(e){var t;Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=(t=e.ops)!=null?t:[]}concat(e){let t=this.ops.concat(e.ops),n=Ur({},t);return new ha({ops:t,state:n[n.length-1].newDocument})}},ha=class r extends Ct{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),n=Ur(this.state,e.ops);return new r({ops:t,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){let t=Ur({},e.ops);return new r({ops:e.ops,state:t[t.length-1].newDocument})}};async function Pp(r,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:t}=r;if(["retriever","llm","prompt"].includes(r.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function kp(r,e){let{outputs:t}=r;return e==="original"||["retriever","llm","prompt"].includes(r.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function Ew(r){return r!==void 0&&r.message!==void 0}var pa=class extends kt{constructor(e){var t,n;super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=(t=e==null?void 0:e.autoClose)!=null?t:!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(n=e==null?void 0:e._schemaFormat)!=null?n:this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Vt.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){var s;if(e.id===this.rootId)return!1;let t=(s=e.tags)!=null?s:[],n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||t.find(i=>{var a;return(a=this.includeTags)==null?void 0:a.includes(i)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&t.every(i=>{var a;return!((a=this.excludeTags)!=null&&a.includes(i))})),n}async*tapOutputIterable(e,t){for await(let n of t){if(e!==this.rootId){let s=this.keyMapByRunId[e];s&&await this.writer.write(new Ct({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){var s,i,a;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Ct({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;let n={id:e.id,name:e.name,type:e.run_type,tags:(s=e.tags)!=null?s:[],metadata:(a=(i=e.extra)==null?void 0:i.metadata)!=null?a:{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await Pp(e,this._schemaFormat)),await this.writer.write(new Ct({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{let t=this.keyMapByRunId[e.id];if(t===void 0)return;let n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:await Pp(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:await kp(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let s=new Ct({ops:n});await this.writer.write(s)}finally{if(e.id===this.rootId){let t=new Ct({ops:[{op:"replace",path:"/final_output",value:await kp(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,n){let s=this.keyMapByRunId[e.id];if(s===void 0)return;let i=e.inputs.messages!==void 0,a;i?Ew(n==null?void 0:n.chunk)?a=n==null?void 0:n.chunk:a=new ir(t):a=t;let o=new Ct({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${s}/streamed_output/-`,value:a}]});await this.writer.write(o)}};var rd=class{getStore(){}run(e,t){t()}},nd=class{constructor(){Object.defineProperty(this,"asyncLocalStorage",{enumerable:!0,configurable:!0,writable:!0,value:new rd}),Object.defineProperty(this,"hasBeenInitialized",{enumerable:!0,configurable:!0,writable:!0,value:!1})}getInstance(){return this.asyncLocalStorage}initializeGlobalInstance(e){this.hasBeenInitialized||(this.hasBeenInitialized=!0,this.asyncLocalStorage=e)}},ma=new nd;var Tu=25;async function Ht(r){return Oe.configure(r==null?void 0:r.callbacks,void 0,r==null?void 0:r.tags,void 0,r==null?void 0:r.metadata)}function sd(...r){var t,n,s;let e={};for(let i of r.filter(a=>!!a))for(let a of Object.keys(i))if(a==="metadata")e[a]={...e[a],...i[a]};else if(a==="tags"){let o=(t=e[a])!=null?t:[];e[a]=[...new Set(o.concat((n=i[a])!=null?n:[]))]}else if(a==="configurable")e[a]={...e[a],...i[a]};else if(a==="callbacks"){let o=e.callbacks,u=i.callbacks;if(Array.isArray(u))if(!o)e.callbacks=u;else if(Array.isArray(o))e.callbacks=o.concat(u);else{let c=o.copy();for(let l of u)c.addHandler(la(l),!0);e.callbacks=c}else if(u)if(!o)e.callbacks=u;else if(Array.isArray(o)){let c=u.copy();for(let l of o)c.addHandler(la(l),!0);e.callbacks=c}else e.callbacks=new Oe(u._parentRunId,{handlers:o.handlers.concat(u.handlers),inheritableHandlers:o.inheritableHandlers.concat(u.inheritableHandlers),tags:Array.from(new Set(o.tags.concat(u.tags))),inheritableTags:Array.from(new Set(o.inheritableTags.concat(u.inheritableTags))),metadata:{...o.metadata,...u.metadata}})}else{let o=a;e[o]=(s=i[o])!=null?s:e[o]}return e}var Sw=new Set(["string","number","boolean"]);function oe(r){var n;let e=r!=null?r:ma.getInstance().getStore(),t={tags:[],metadata:{},callbacks:void 0,recursionLimit:25};if(e&&(t={...t,...e}),e!=null&&e.configurable)for(let s of Object.keys(e.configurable))Sw.has(typeof e.configurable[s])&&!((n=t.metadata)!=null&&n[s])&&(t.metadata||(t.metadata={}),t.metadata[s]=e.configurable[s]);return t}function Pe(r={},{callbacks:e,maxConcurrency:t,recursionLimit:n,runName:s,configurable:i}={}){let a=oe(r);return e!==void 0&&(delete a.runName,a.callbacks=e),n!==void 0&&(a.recursionLimit=n),t!==void 0&&(a.maxConcurrency=t),s!==void 0&&(a.runName=s),i!==void 0&&(a.configurable={...a.configurable,...i}),a}var ga=class extends kt{constructor({config:e,onStart:t,onEnd:n,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&(this.argOnStart.length===1?await this.argOnStart(e):this.argOnStart.length===2&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(this.argOnError.length===1?await this.argOnError(e):this.argOnError.length===2&&await this.argOnError(e,this.config)):this.argOnEnd&&(this.argOnEnd.length===1?await this.argOnEnd(e):this.argOnEnd.length===2&&await this.argOnEnd(e,this.config)))}};function ku(r){return r?r.lc_runnable:!1}var Pu=class{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){var i;let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0,s=(i=e.tags)!=null?i:[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(t)),this.includeTags!==void 0&&(n=n||s.some(a=>{var o;return(o=this.includeTags)==null?void 0:o.includes(a)})),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(n=n&&s.every(a=>{var o;return!((o=this.excludeTags)!=null&&o.includes(a))})),n}};function id(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function X(r,e,t,n,s){r[e]=t,id(r,e,n,s)}var Ip={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"string",mapStrategy:"entries",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",emailStrategy:"format:email"},Cp=r=>typeof r=="string"?{...Ip,name:r}:{...Ip,...r};function Np(){return{}}function Rp(r,e){var n,s;let t={type:"array"};return((s=(n=r.type)==null?void 0:n._def)==null?void 0:s.typeName)!==w.ZodAny&&(t.items=D(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&X(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&X(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(X(t,"minItems",r.exactLength.value,r.exactLength.message,e),X(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function jp(r,e){let t={type:"integer",format:"int64"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?X(t,"minimum",n.value,n.message,e):X(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),X(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?X(t,"maximum",n.value,n.message,e):X(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),X(t,"maximum",n.value,n.message,e));break;case"multipleOf":X(t,"multipleOf",n.value,n.message,e);break}return t}function $p(){return{type:"boolean"}}function Mp(r,e){return D(r.type._def,e)}var Lp=(r,e)=>D(r.innerType._def,e);function Dp(r,e){return e.dateStrategy=="integer"?Tw(r,e):{type:"string",format:"date-time"}}var Tw=(r,e)=>{let t={type:"integer",format:"unix-time"};for(let n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"&&X(t,"minimum",n.value,n.message,e);break;case"max":e.target==="jsonSchema7"&&X(t,"maximum",n.value,n.message,e);break}return t};function Bp(r,e){return{...D(r.innerType._def,e),default:r.defaultValue()}}function Fp(r,e){return e.effectStrategy==="input"?D(r.schema._def,e):{}}function Up(r){return{type:"string",enum:r.values}}var Pw=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function zp(r,e){let t=[D(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),D(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,s=[];return t.forEach(i=>{if(Pw(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(n=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){let{additionalProperties:o,...u}=i;a=u}else n=void 0;s.push(a)}}),s.length?{allOf:s,...n}:void 0}function Kp(r,e){let t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}var ya={cuid:"^[cC][^\\s-]{8,}$",cuid2:"^[a-z][a-z0-9]*$",ulid:"^[0-9A-HJKMNP-TV-Z]{26}$",email:"^(?!\\.)(?!.*\\.\\.)([a-zA-Z0-9_+-\\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\\-]*\\.)+[a-zA-Z]{2,}$",emoji:"^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",uuid:"^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$",ipv4:"^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$",ipv6:"^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$"};function Iu(r,e){let t={type:"string"};function n(s){return e.patternStrategy==="escape"?kw(s):s}if(r.checks)for(let s of r.checks)switch(s.kind){case"min":X(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e);break;case"max":X(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Kn(t,"email",s.message,e);break;case"format:idn-email":Kn(t,"idn-email",s.message,e);break;case"pattern:zod":mr(t,ya.email,s.message,e);break}break;case"url":Kn(t,"uri",s.message,e);break;case"uuid":Kn(t,"uuid",s.message,e);break;case"regex":mr(t,s.regex.source,s.message,e);break;case"cuid":mr(t,ya.cuid,s.message,e);break;case"cuid2":mr(t,ya.cuid2,s.message,e);break;case"startsWith":mr(t,"^"+n(s.value),s.message,e);break;case"endsWith":mr(t,n(s.value)+"$",s.message,e);break;case"datetime":Kn(t,"date-time",s.message,e);break;case"length":X(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e),X(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"includes":{mr(t,n(s.value),s.message,e);break}case"ip":{s.version!=="v6"&&Kn(t,"ipv4",s.message,e),s.version!=="v4"&&Kn(t,"ipv6",s.message,e);break}case"emoji":mr(t,ya.emoji,s.message,e);break;case"ulid":{mr(t,ya.ulid,s.message,e);break}case"toLowerCase":case"toUpperCase":case"trim":break;default:}return t}var kw=r=>Array.from(r).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Kn=(r,e,t,n)=>{var s;r.format||(s=r.anyOf)!=null&&s.some(i=>i.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):X(r,"format",e,t,n)},mr=(r,e,t,n)=>{var s;r.pattern||(s=r.allOf)!=null&&s.some(i=>i.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:e,...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):X(r,"pattern",e,t,n)};function Cu(r,e){var n,s,i,a,o;if(e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===w.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((u,c)=>{var l;return{...u,[c]:(l=D(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",c]}))!=null?l:{}}},{}),additionalProperties:!1};let t={type:"object",additionalProperties:(s=D(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]}))!=null?s:{}};if(e.target==="openApi3")return t;if(((i=r.keyType)==null?void 0:i._def.typeName)===w.ZodString&&((a=r.keyType._def.checks)!=null&&a.length)){let u=Object.entries(Iu(r.keyType._def,e)).reduce((c,[l,d])=>l==="type"?c:{...c,[l]:d},{});return{...t,propertyNames:u}}else if(((o=r.keyType)==null?void 0:o._def.typeName)===w.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};return t}function qp(r,e){if(e.mapStrategy==="record")return Cu(r,e);let t=D(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=D(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function Vp(r){let e=r.values,n=Object.keys(r.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(n.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function Zp(){return{not:{}}}function Hp(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var ba={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Jp(r,e){if(e.target==="openApi3")return Gp(r,e);let t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in ba&&(!n._def.checks||!n._def.checks.length))){let n=t.reduce((s,i)=>{let a=ba[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=t.reduce((s,i)=>{let a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){let s=n.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(i=>!n.includes(i))],[])};return Gp(r,e)}var Gp=(r,e)=>{let t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>D(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function Wp(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:ba[r.innerType._def.typeName],nullable:!0}:{type:[ba[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=D(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}let t=D(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function Yp(r,e){let t={type:"number"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"int":t.type="integer",id(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?X(t,"minimum",n.value,n.message,e):X(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),X(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?X(t,"maximum",n.value,n.message,e):X(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),X(t,"maximum",n.value,n.message,e));break;case"multipleOf":X(t,"multipleOf",n.value,n.message,e);break}return t}function Xp(r,e){var n;let t={type:"object",...Object.entries(r.shape()).reduce((s,[i,a])=>{if(a===void 0||a._def===void 0)return s;let o=D(a._def,{...e,currentPath:[...e.currentPath,"properties",i],propertyPath:[...e.currentPath,"properties",i]});return o===void 0?s:{properties:{...s.properties,[i]:o},required:a.isOptional()?s.required:[...s.required,i]}},{properties:{},required:[]}),additionalProperties:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":(n=D(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]}))!=null?n:!0};return t.required.length||delete t.required,t}var Qp=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return D(r.innerType._def,e);let t=D(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}};var em=(r,e)=>{if(e.pipeStrategy==="input")return D(r.in._def,e);if(e.pipeStrategy==="output")return D(r.out._def,e);let t=D(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=D(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function tm(r,e){return D(r.type._def,e)}function rm(r,e){let n={type:"array",uniqueItems:!0,items:D(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&X(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&X(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function nm(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>D(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:D(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>D(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function sm(){return{not:{}}}function im(){return{}}var am=(r,e)=>D(r.innerType._def,e);function D(r,e,t=!1){let n=e.seen.get(r);if(n&&!t){let a=Iw(n,e);if(a!==void 0)return a}let s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);let i=Nw(r,r.typeName,e);return i&&Rw(r,e,i),s.jsonSchema=i,i}var Iw=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:Cw(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((t,n)=>e.currentPath[n]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},Cw=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},Nw=(r,e,t)=>{switch(e){case w.ZodString:return Iu(r,t);case w.ZodNumber:return Yp(r,t);case w.ZodObject:return Xp(r,t);case w.ZodBigInt:return jp(r,t);case w.ZodBoolean:return $p();case w.ZodDate:return Dp(r,t);case w.ZodUndefined:return sm();case w.ZodNull:return Hp(t);case w.ZodArray:return Rp(r,t);case w.ZodUnion:case w.ZodDiscriminatedUnion:return Jp(r,t);case w.ZodIntersection:return zp(r,t);case w.ZodTuple:return nm(r,t);case w.ZodRecord:return Cu(r,t);case w.ZodLiteral:return Kp(r,t);case w.ZodEnum:return Up(r);case w.ZodNativeEnum:return Vp(r);case w.ZodNullable:return Wp(r,t);case w.ZodOptional:return Qp(r,t);case w.ZodMap:return qp(r,t);case w.ZodSet:return rm(r,t);case w.ZodLazy:return D(r.getter()._def,t);case w.ZodPromise:return tm(r,t);case w.ZodNaN:case w.ZodNever:return Zp();case w.ZodEffects:return Fp(r,t);case w.ZodAny:return Np();case w.ZodUnknown:return im();case w.ZodDefault:return Bp(r,t);case w.ZodBranded:return Mp(r,t);case w.ZodReadonly:return am(r,t);case w.ZodCatch:return Lp(r,t);case w.ZodPipeline:return em(r,t);case w.ZodFunction:case w.ZodVoid:case w.ZodSymbol:return;default:return(n=>{})(e)}},Rw=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t);var om=r=>{let e=Cp(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};var qn=(r,e)=>{var o;let t=om(e),n=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((u,[c,l])=>{var d;return{...u,[c]:(d=D(l._def,{...t,currentPath:[...t.basePath,t.definitionPath,c]},!0))!=null?d:{}}},{}):void 0,s=typeof e=="string"?e:e==null?void 0:e.name,i=(o=D(r._def,s===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,s]},!1))!=null?o:{},a=s===void 0?n?{...i,[t.definitionPath]:n}:i:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...n,[s]:i}};return t.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),a};function jw(r){return ku(r.data)?{type:"runnable",data:{id:r.data.lc_id,name:r.data.getName()}}:{type:"schema",data:{...qn(r.data.schema),title:r.data.name}}}var _a=class{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){let e={};return Object.values(this.nodes).forEach((t,n)=>{e[t.id]=aa(t.id)?n:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...jw(t)})),edges:this.edges.map(t=>t.data?{source:e[t.source],target:e[t.target],data:t.data}:{source:e[t.source],target:e[t.target]})}}addNode(e,t){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);let n=t||Fe(),s={id:n,data:e};return this.nodes[n]=s,s}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,n){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);let s={source:e.id,target:t.id,data:n};return this.edges.push(s),s}firstNode(){let e=new Set(this.edges.map(n=>n.target)),t=[];return Object.values(this.nodes).forEach(n=>{e.has(n.id)||t.push(n)}),t[0]}lastNode(){let e=new Set(this.edges.map(n=>n.source)),t=[];return Object.values(this.nodes).forEach(n=>{e.has(n.id)||t.push(n)}),t[0]}extend(e){Object.entries(e.nodes).forEach(([t,n])=>{this.nodes[t]=n}),this.edges=[...this.edges,...e.edges]}trimFirstNode(){let e=this.firstNode();if(e){let t=this.edges.filter(n=>n.source===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}trimLastNode(){let e=this.lastNode();if(e){let t=this.edges.filter(n=>n.target===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}};function ke(r,e){return r&&!Array.isArray(r)&&!(r instanceof Date)&&typeof r=="object"?r:{[e]:r}}var ce=class extends Ot{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){var n,s;let t=(s=(n=this.name)!=null?n:this.constructor.lc_name())!=null?s:this.constructor.name;return e?`${t}${e}`:t}bind(e){return new zr({bound:this,kwargs:e,config:{}})}map(){return new Nu({bound:this})}withRetry(e){return new Ru({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new zr({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new ju({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)){if(e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);return e.map(oe)}return Array.from({length:t},()=>oe(e))}async batch(e,t,n){var u,c;let s=this._getOptionsList(t!=null?t:{},e.length),i=(c=(u=s[0])==null?void 0:u.maxConcurrency)!=null?c:n==null?void 0:n.maxConcurrency,a=new or({maxConcurrency:i,onFailedAttempt:l=>{throw l}}),o=e.map((l,d)=>a.call(async()=>{try{return await this.invoke(l,s[d])}catch(f){if(n!=null&&n.returnExceptions)return f;throw f}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){let n=new pr(this._streamIterator(e,oe(t)));return await n.setup,Vt.fromAsyncGenerator(n)}_separateRunnableConfigFromCallOptions(e={}){let t=oe({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency}),n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,[t,n]}async _callWithConfig(e,t,n){var u;let s=oe(n),i=await Ht(s),a=await(i==null?void 0:i.handleChainStart(this.toJSON(),ke(t,"input"),void 0,s==null?void 0:s.runType,void 0,void 0,(u=s==null?void 0:s.runName)!=null?u:this.getName())),o;try{o=await e.call(this,t,s,a)}catch(c){throw await(a==null?void 0:a.handleChainError(c)),c}return await(a==null?void 0:a.handleChainEnd(ke(o,"output"))),o}async _batchWithConfig(e,t,n,s){let i=this._getOptionsList(n!=null?n:{},t.length),a=await Promise.all(i.map(Ht)),o=await Promise.all(a.map((c,l)=>{var d;return c==null?void 0:c.handleChainStart(this.toJSON(),ke(t[l],"input"),void 0,i[l].runType,void 0,void 0,(d=i[l].runName)!=null?d:this.getName())})),u;try{u=await e.call(this,t,i,o,s)}catch(c){throw await Promise.all(o.map(l=>l==null?void 0:l.handleChainError(c))),c}return await Promise.all(o.map(c=>c==null?void 0:c.handleChainEnd(ke(u,"output")))),u}async*_transformStreamWithConfig(e,t,n){let s,i=!0,a,o=!0,u=oe(n),c=await Ht(u);async function*l(){for await(let f of e){if(i)if(s===void 0)s=f;else try{s=Zt(s,f)}catch(h){s=void 0,i=!1}yield f}}let d;try{let f=await Tp(t.bind(this),l(),async()=>{var g;return c==null?void 0:c.handleChainStart(this.toJSON(),{input:""},void 0,u==null?void 0:u.runType,void 0,void 0,(g=u==null?void 0:u.runName)!=null?g:this.getName())},u);d=f.setup;let h=g=>g.name==="log_stream_tracer",p=d==null?void 0:d.handlers.find(h),m=f.output;p!==void 0&&d!==void 0&&(m=await p.tapOutputIterable(d.runId,f.output));for await(let g of m)if(yield g,o)if(a===void 0)a=g;else try{a=Zt(a,g)}catch(y){a=void 0,o=!1}}catch(f){throw await(d==null?void 0:d.handleChainError(f,void 0,void 0,void 0,{inputs:ke(s,"input")})),f}await(d==null?void 0:d.handleChainEnd(a!=null?a:{},void 0,void 0,void 0,{inputs:ke(s,"input")}))}getGraph(e){let t=new _a,n=t.addNode({name:`${this.getName()}Input`,schema:dr.any()}),s=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:dr.any()});return t.addEdge(n,s),t.addEdge(s,i),t}pipe(e){return new Zs({first:this,last:gr(e)})}pick(e){return this.pipe(new $u(e))}assign(e){return this.pipe(new Hs(new Kr({steps:e})))}async*transform(e,t){let n;for await(let s of e)n===void 0?n=s:n=Zt(n,s);yield*this._streamIterator(n,oe(t))}async*streamLog(e,t,n){let s=new pa({...n,autoClose:!1,_schemaFormat:"original"}),i=oe(t);yield*this._streamLog(e,s,i)}async*_streamLog(e,t,n){let{callbacks:s}=n;if(s===void 0)n.callbacks=[t];else if(Array.isArray(s))n.callbacks=s.concat([t]);else{let u=s.copy();u.inheritableHandlers.push(t),n.callbacks=u}let i=this.stream(e,n);async function a(){try{let u=await i;for await(let c of u){let l=new Ct({ops:[{op:"add",path:"/streamed_output/-",value:c}]});await t.writer.write(l)}}finally{await t.writer.close()}}let o=a();try{for await(let u of t)yield u}finally{await o}}async*streamEvents(e,t,n){var p,m,g;if(t.version!=="v1")throw new Error('Only version "v1" of the events schema is currently supported.');let s,i=!1,a=oe(t),o=(p=a.tags)!=null?p:[],u=(m=a.metadata)!=null?m:{},c=(g=a.runName)!=null?g:this.getName(),l=new pa({...n,autoClose:!1,_schemaFormat:"streaming_events"}),d=new Pu({...n}),f=this._streamLog(e,l,a);for await(let y of f){if(s?s=s.concat(y):s=ha.fromRunLogPatch(y),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;let T={...s.state},_={run_id:T.id,event:`on_${T.type}_start`,name:c,tags:o,metadata:u,data:{input:e}};d.includeEvent(_,T.type)&&(yield _)}let b=y.ops.filter(T=>T.path.startsWith("/logs/")).map(T=>T.path.split("/")[2]),O=[...new Set(b)];for(let T of O){let _,F={},S=s.state.logs[T];if(S.end_time===void 0?S.streamed_output.length>0?_="stream":_="start":_="end",_==="start")S.inputs!==void 0&&(F.input=S.inputs);else if(_==="end")S.inputs!==void 0&&(F.input=S.inputs),F.output=S.final_output;else if(_==="stream"){let M=S.streamed_output.length;if(M!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${M} instead. Encountered in: "${S.name}"`);F={chunk:S.streamed_output[0]},S.streamed_output=[]}yield{event:`on_${S.type}_${_}`,name:S.name,run_id:S.id,tags:S.tags,metadata:S.metadata,data:F}}let{state:E}=s;if(E.streamed_output.length>0){let T=E.streamed_output.length;if(T!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${T} instead. Encountered in: "${E.name}"`);let _={chunk:E.streamed_output[0]};E.streamed_output=[];let F={event:`on_${E.type}_stream`,run_id:E.id,tags:o,metadata:u,name:c,data:_};d.includeEvent(F,E.type)&&(yield F)}}let h=s==null?void 0:s.state;if(h!==void 0){let y={event:`on_${h.type}_end`,name:c,run_id:h.id,tags:o,metadata:u,data:{output:h.final_output}};d.includeEvent(y,h.type)&&(yield y)}}static isRunnable(e){return ku(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new zr({bound:this,config:{},configFactories:[s=>({callbacks:[new ga({config:s,onStart:e,onEnd:t,onError:n})]})]})}},zr=class r extends ce{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){let t=sd(this.config,...e);return sd(t,...this.configFactories?await Promise.all(this.configFactories.map(async n=>await n(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(oe(t),this.kwargs))}async batch(e,t,n){let s=Array.isArray(t)?await Promise.all(t.map(async i=>this._mergeConfig(oe(i),this.kwargs))):await this._mergeConfig(oe(t),this.kwargs);return this.bound.batch(e,s,n)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(oe(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(oe(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(oe(t),this.kwargs))}async*streamEvents(e,t,n){yield*this.bound.streamEvents(e,{...await this._mergeConfig(oe(t),this.kwargs),version:t.version},n)}static isRunnableBinding(e){return e.bound&&ce.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:n}){return new r({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new ga({config:s,onStart:e,onEnd:t,onError:n})]})]})}},Nu=class r extends ce{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new r({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,n){return this.bound.batch(e,Pe(t,{callbacks:n==null?void 0:n.getChild()}))}withListeners({onStart:e,onEnd:t,onError:n}){return new r({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:n})})}},Ru=class extends zr{static lc_name(){return"RunnableRetry"}constructor(e){var t,n;super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=(t=e.maxAttemptNumber)!=null?t:this.maxAttemptNumber,this.onFailedAttempt=(n=e.onFailedAttempt)!=null?n:this.onFailedAttempt}_patchConfigForRetry(e,t,n){let s=e>1?`retry:attempt:${e}`:void 0;return Pe(t,{callbacks:n==null?void 0:n.getChild(s)})}async _invoke(e,t,n){return(0,ad.default)(s=>super.invoke(e,this._patchConfigForRetry(s,t,n)),{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,n,s){let i={};try{await(0,ad.default)(async a=>{let o=e.map((f,h)=>h).filter(f=>i[f.toString()]===void 0||i[f.toString()]instanceof Error),u=o.map(f=>e[f]),c=o.map(f=>this._patchConfigForRetry(a,t==null?void 0:t[f],n==null?void 0:n[f])),l=await super.batch(u,c,{...s,returnExceptions:!0}),d;for(let f=0;f<l.length;f+=1){let h=l[f],p=o[f];h instanceof Error&&d===void 0&&(d=h),i[p.toString()]=h}if(d)throw d;return l},{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if((s==null?void 0:s.returnExceptions)!==!0)throw a}return Object.keys(i).sort((a,o)=>parseInt(a,10)-parseInt(o,10)).map(a=>i[parseInt(a,10)])}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}},Zs=class r extends ce{static lc_name(){return"RunnableSequence"}constructor(e){var t;super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=(t=e.middle)!=null?t:this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){let n=oe(t),s=await Ht(n),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),ke(e,"input"),void 0,void 0,void 0,void 0,n==null?void 0:n.runName)),a=e,o;try{let u=[this.first,...this.middle];for(let c=0;c<u.length;c+=1)a=await u[c].invoke(a,Pe(n,{callbacks:i==null?void 0:i.getChild(`seq:step:${c+1}`)}));o=await this.last.invoke(a,Pe(n,{callbacks:i==null?void 0:i.getChild(`seq:step:${this.steps.length}`)}))}catch(u){throw await(i==null?void 0:i.handleChainError(u)),u}return await(i==null?void 0:i.handleChainEnd(ke(o,"output"))),o}async batch(e,t,n){let s=this._getOptionsList(t!=null?t:{},e.length),i=await Promise.all(s.map(Ht)),a=await Promise.all(i.map((u,c)=>u==null?void 0:u.handleChainStart(this.toJSON(),ke(e[c],"input"),void 0,void 0,void 0,void 0,s[c].runName))),o=e;try{for(let u=0;u<this.steps.length;u+=1)o=await this.steps[u].batch(o,a.map((l,d)=>{let f=l==null?void 0:l.getChild(`seq:step:${u+1}`);return Pe(s[d],{callbacks:f})}),n)}catch(u){throw await Promise.all(a.map(c=>c==null?void 0:c.handleChainError(u))),u}return await Promise.all(a.map(u=>u==null?void 0:u.handleChainEnd(ke(o,"output")))),o}async*_streamIterator(e,t){let n=await Ht(t),s=await(n==null?void 0:n.handleChainStart(this.toJSON(),ke(e,"input"),void 0,void 0,void 0,void 0,t==null?void 0:t.runName)),i=[this.first,...this.middle,this.last],a=!0,o;async function*u(){yield e}try{let c=i[0].transform(u(),Pe(t,{callbacks:s==null?void 0:s.getChild("seq:step:1")}));for(let l=1;l<i.length;l+=1)c=await i[l].transform(c,Pe(t,{callbacks:s==null?void 0:s.getChild(`seq:step:${l+1}`)}));for await(let l of c)if(yield l,a)if(o===void 0)o=l;else try{o=Zt(o,l)}catch(d){o=void 0,a=!1}}catch(c){throw await(s==null?void 0:s.handleChainError(c)),c}await(s==null?void 0:s.handleChainEnd(ke(o,"output")))}getGraph(e){let t=new _a,n=null;return this.steps.forEach((s,i)=>{let a=s.getGraph(e);i!==0&&a.trimFirstNode(),i!==this.steps.length-1&&a.trimLastNode(),t.extend(a);let o=a.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);n&&t.addEdge(n,o),n=a.lastNode()}),t}pipe(e){var t;return r.isRunnableSequence(e)?new r({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:(t=this.name)!=null?t:e.name}):new r({first:this.first,middle:[...this.middle,this.last],last:gr(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&ce.isRunnable(e)}static from([e,...t],n){return new r({first:gr(e),middle:t.slice(0,-1).map(gr),last:gr(t[t.length-1]),name:n})}},Kr=class r extends ce{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(let[t,n]of Object.entries(e.steps))this.steps[t]=gr(n)}static from(e){return new r({steps:e})}async invoke(e,t){let n=oe(t),s=await Ht(n),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),{input:e},void 0,void 0,void 0,void 0,n==null?void 0:n.runName)),a={};try{await Promise.all(Object.entries(this.steps).map(async([o,u])=>{a[o]=await u.invoke(e,Pe(n,{callbacks:i==null?void 0:i.getChild(`map:key:${o}`)}))}))}catch(o){throw await(i==null?void 0:i.handleChainError(o)),o}return await(i==null?void 0:i.handleChainEnd(a)),a}async*_transform(e,t,n){let s={...this.steps},i=td(e,Object.keys(s).length),a=new Map(Object.entries(s).map(([o,u],c)=>{let l=u.transform(i[c],Pe(n,{callbacks:t==null?void 0:t.getChild(`map:key:${o}`)}));return[o,l.next().then(d=>({key:o,gen:l,result:d}))]}));for(;a.size;){let{key:o,result:u,gen:c}=await Promise.race(a.values());a.delete(o),u.done||(yield{[o]:u.value},a.set(o,c.next().then(l=>({key:o,gen:c,result:l}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}let s=new pr(this.transform(n(),t));return await s.setup,Vt.fromAsyncGenerator(s)}},wa=class r extends ce{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}static from(e){return new r({func:e})}async _invoke(e,t,n){return new Promise((s,i)=>{var o;let a=Pe(t,{callbacks:n==null?void 0:n.getChild(),recursionLimit:((o=t==null?void 0:t.recursionLimit)!=null?o:Tu)-1});ma.getInstance().run(a,async()=>{var u;try{let c=await this.func(e,{...a,config:a});if(c&&ce.isRunnable(c)){if((t==null?void 0:t.recursionLimit)===0)throw new Error("Recursion limit reached.");c=await c.invoke(e,{...a,recursionLimit:((u=a.recursionLimit)!=null?u:Tu)-1})}s(c)}catch(c){i(c)}})})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async*_transform(e,t,n){var a;let s;for await(let o of e)if(s===void 0)s=o;else try{s=Zt(s,o)}catch(u){s=o}let i=await new Promise((o,u)=>{ma.getInstance().run(n,async()=>{try{let c=await this.func(s,{...n,config:n});o(c)}catch(c){u(c)}})});if(i&&ce.isRunnable(i)){if((n==null?void 0:n.recursionLimit)===0)throw new Error("Recursion limit reached.");let o=await i.stream(s,Pe(n,{callbacks:t==null?void 0:t.getChild(),recursionLimit:((a=n==null?void 0:n.recursionLimit)!=null?a:Tu)-1}));for await(let u of o)yield u}else yield i}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}let s=new pr(this.transform(n(),t));return await s.setup,Vt.fromAsyncGenerator(s)}};var ju=class extends ce{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(let e of this.fallbacks)yield e}async invoke(e,t){let n=await Oe.configure(t==null?void 0:t.callbacks,void 0,t==null?void 0:t.tags,void 0,t==null?void 0:t.metadata),s=await(n==null?void 0:n.handleChainStart(this.toJSON(),ke(e,"input"),void 0,void 0,void 0,void 0,t==null?void 0:t.runName)),i;for(let a of this.runnables())try{let o=await a.invoke(e,Pe(t,{callbacks:s==null?void 0:s.getChild()}));return await(s==null?void 0:s.handleChainEnd(ke(o,"output"))),o}catch(o){i===void 0&&(i=o)}throw i===void 0?new Error("No error stored at end of fallback."):(await(s==null?void 0:s.handleChainError(i)),i)}async batch(e,t,n){if(n!=null&&n.returnExceptions)throw new Error("Not implemented.");let s=this._getOptionsList(t!=null?t:{},e.length),i=await Promise.all(s.map(u=>Oe.configure(u==null?void 0:u.callbacks,void 0,u==null?void 0:u.tags,void 0,u==null?void 0:u.metadata))),a=await Promise.all(i.map((u,c)=>u==null?void 0:u.handleChainStart(this.toJSON(),ke(e[c],"input"),void 0,void 0,void 0,void 0,s[c].runName))),o;for(let u of this.runnables())try{let c=await u.batch(e,a.map((l,d)=>Pe(s[d],{callbacks:l==null?void 0:l.getChild()})),n);return await Promise.all(a.map((l,d)=>l==null?void 0:l.handleChainEnd(ke(c[d],"output")))),c}catch(c){o===void 0&&(o=c)}throw o?(await Promise.all(a.map(u=>u==null?void 0:u.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}};function gr(r){if(typeof r=="function")return new wa({func:r});if(ce.isRunnable(r))return r;if(!Array.isArray(r)&&typeof r=="object"){let e={};for(let[t,n]of Object.entries(r))e[t]=gr(n);return new Kr({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}var Hs=class extends ce{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Kr&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){let n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){let s=this.mapper.getStepsKeys(),[i,a]=td(e),o=this.mapper.transform(a,Pe(n,{callbacks:t==null?void 0:t.getChild()})),u=o.next();for await(let c of i){if(typeof c!="object"||Array.isArray(c))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof c}`);let l=Object.fromEntries(Object.entries(c).filter(([d])=>!s.includes(d)));Object.keys(l).length>0&&(yield l)}yield(await u).value;for await(let c of o)yield c}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}let s=new pr(this.transform(n(),t));return await s.setup,Vt.fromAsyncGenerator(s)}},$u=class extends ce{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{let t=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(let t of e){let n=await this._pick(t);n!==void 0&&(yield n)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}let s=new pr(this.transform(n(),t));return await s.setup,Vt.fromAsyncGenerator(s)}};var $w=r=>r.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":r.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":r.startsWith("gpt-4-32k")?"gpt-4-32k":r.startsWith("gpt-4-")?"gpt-4":r;var Mw=()=>!1,va=class extends ce{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){var t,n,s;super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=(t=e.verbose)!=null?t:Mw(),this.callbacks=e.callbacks,this.tags=(n=e.tags)!=null?n:[],this.metadata=(s=e.metadata)!=null?s:{}}},xa=class extends va{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...n}){super({callbacks:e!=null?e:t,...n}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof n.cache=="object"?this.cache=n.cache:n.cache?this.cache=Vo.global():this.cache=void 0,this.caller=new or(n!=null?n:{})}async getNumTokens(e){if(typeof e!="string")return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await tp("modelName"in this?$w(this.modelName):"gpt2")}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}return t}static _convertInputToPromptValue(e){return typeof e=="string"?new Ho(e):Array.isArray(e)?new Go(e.map(_n)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall(e){let t={...this._identifyingParams(),...e,_type:this._llmType(),_model:this._modelType()};return Object.entries(t).filter(([i,a])=>a!==void 0).map(([i,a])=>`${i}:${JSON.stringify(a)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}};var Gs=class r extends xa{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){let[t,n]=super._separateRunnableConfigFromCallOptions(e);return n!=null&&n.timeout&&!n.signal&&(n.signal=AbortSignal.timeout(n.timeout)),[t,n]}async invoke(e,t){let n=r._convertInputToPromptValue(e);return(await this.generatePrompt([n],t,t==null?void 0:t.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,n){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===r.prototype._streamResponseChunks)yield this.invoke(e,t);else{let s=r._convertInputToPromptValue(e).toChatMessages(),[i,a]=this._separateRunnableConfigFromCallOptions(t),o=await Oe.configure(i.callbacks,this.callbacks,i.tags,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),u={options:a,invocation_params:this==null?void 0:this.invocationParams(a),batch_size:1},c=await(o==null?void 0:o.handleChatModelStart(this.toJSON(),[s],void 0,void 0,u,void 0,void 0,i.runName)),l;try{for await(let d of this._streamResponseChunks(s,a,c==null?void 0:c[0]))d.message.response_metadata={...d.generationInfo,...d.message.response_metadata},yield d.message,l?l=l.concat(d):l=d}catch(d){throw await Promise.all((c!=null?c:[]).map(f=>f==null?void 0:f.handleLLMError(d))),d}await Promise.all((c!=null?c:[]).map(d=>d==null?void 0:d.handleLLMEnd({generations:[[l]]})))}}async _generateUncached(e,t,n){var f;let s=e.map(h=>h.map(_n)),i=await Oe.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),a={options:t,invocation_params:this==null?void 0:this.invocationParams(t),batch_size:1},o=await(i==null?void 0:i.handleChatModelStart(this.toJSON(),s,void 0,void 0,a,void 0,void 0,n.runName)),u=await Promise.allSettled(s.map((h,p)=>this._generate(h,{...t,promptIndex:p},o==null?void 0:o[p]))),c=[],l=[];await Promise.all(u.map(async(h,p)=>{var m,g;if(h.status==="fulfilled"){let y=h.value;for(let b of y.generations)b.message.response_metadata={...b.generationInfo,...b.message.response_metadata};return y.generations.length===1&&(y.generations[0].message.response_metadata={...y.llmOutput,...y.generations[0].message.response_metadata}),c[p]=y.generations,l[p]=y.llmOutput,(m=o==null?void 0:o[p])==null?void 0:m.handleLLMEnd({generations:[y.generations],llmOutput:y.llmOutput})}else return await((g=o==null?void 0:o[p])==null?void 0:g.handleLLMError(h.reason)),Promise.reject(h.reason)}));let d={generations:c,llmOutput:l.length?(f=this._combineLLMOutput)==null?void 0:f.call(this,...l):void 0};return Object.defineProperty(d,qo,{value:o?{runIds:o==null?void 0:o.map(h=>h.runId)}:void 0,configurable:!0}),d}async _generateCached({messages:e,cache:t,llmStringKey:n,parsedOptions:s,handledOptions:i}){let a=e.map(m=>m.map(_n)),o=await Oe.configure(i.callbacks,this.callbacks,i.tags,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),u={options:s,invocation_params:this==null?void 0:this.invocationParams(s),batch_size:1,cached:!0},c=await(o==null?void 0:o.handleChatModelStart(this.toJSON(),a,void 0,void 0,u,void 0,void 0,i.runName)),l=[],f=(await Promise.allSettled(a.map(async(m,g)=>{let y=r._convertInputToPromptValue(m).toString(),b=await t.lookup(y,n);return b==null&&l.push(g),b}))).map((m,g)=>({result:m,runManager:c==null?void 0:c[g]})).filter(({result:m})=>m.status==="fulfilled"&&m.value!=null||m.status==="rejected"),h=[];await Promise.all(f.map(async({result:m,runManager:g},y)=>{if(m.status==="fulfilled"){let b=m.value;return h[y]=b,b.length&&await(g==null?void 0:g.handleLLMNewToken(b[0].text)),g==null?void 0:g.handleLLMEnd({generations:[b]})}else return await(g==null?void 0:g.handleLLMError(m.reason)),Promise.reject(m.reason)}));let p={generations:h,missingPromptIndices:l};return Object.defineProperty(p,qo,{value:c?{runIds:c==null?void 0:c.map(m=>m.runId)}:void 0,configurable:!0}),p}async generate(e,t,n){var h,p;let s;Array.isArray(t)?s={stop:t}:s=t;let i=e.map(m=>m.map(_n)),[a,o]=this._separateRunnableConfigFromCallOptions(s);if(a.callbacks=(h=a.callbacks)!=null?h:n,!this.cache)return this._generateUncached(i,o,a);let{cache:u}=this,c=this._getSerializedCacheKeyParametersForCall(o),{generations:l,missingPromptIndices:d}=await this._generateCached({messages:i,cache:u,llmStringKey:c,parsedOptions:o,handledOptions:a}),f={};if(d.length>0){let m=await this._generateUncached(d.map(g=>i[g]),o,a);await Promise.all(m.generations.map(async(g,y)=>{let b=d[y];l[b]=g;let O=r._convertInputToPromptValue(i[b]).toString();return u.update(O,c,g)})),f=(p=m.llmOutput)!=null?p:{}}return{generations:l,llmOutput:f}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,n){let s=e.map(i=>i.toChatMessages());return this.generate(s,t,n)}async call(e,t,n){return(await this.generate([e.map(_n)],t,n)).generations[0][0].message}async callPrompt(e,t,n){let s=e.toChatMessages();return this.call(s,t,n)}async predictMessages(e,t,n){return this.call(e,t,n)}async predict(e,t,n){let s=new Se(e),i=await this.call([s],t,n);if(typeof i.content!="string")throw new Error("Cannot use predict when output is not a string.");return i.content}};function Lw(r){var t;let e=r._getType();return Rr.isInstance(r)?r.role:(t=r.name)!=null?t:e}function Dw(r){switch(r){case"ai":case"model":return"model";case"system":case"human":return"user";default:throw new Error(`Unknown / unsupported author: ${r}`)}}function Bw(r,e){return typeof r=="string"?[{text:r}]:r.map(t=>{if(t.type==="text")return{text:t.text};if(t.type==="image_url"){if(!e)throw new Error("This model does not support images");if(typeof t.image_url!="string")throw new Error("Please provide image as base64 encoded data URL");let[n,s]=t.image_url.split(",");if(!n.startsWith("data:"))throw new Error("Please provide image as base64 encoded data URL");let[i,a]=n.replace(/^data:/,"").split(";");if(a!=="base64")throw new Error("Please provide image as base64 encoded data URL");return{inlineData:{data:s,mimeType:i}}}throw new Error(`Unknown content type ${t.type}`)})}function od(r,e){return r.reduce((t,n,s)=>{if(!bn(n))throw new Error("Unsupported message input");let i=Lw(n);if(i==="system"&&s!==0)throw new Error("System message should be the first one");let a=Dw(i),o=t.content[t.content.length];if(!t.mergeWithPreviousContent&&o&&o.role===a)throw new Error("Google Generative AI requires alternate messages between authors");let u=Bw(n.content,e);if(t.mergeWithPreviousContent){let l=t.content[t.content.length-1];if(!l)throw new Error("There was a problem parsing your system message. Please try a prompt without one.");return l.parts.push(...u),{mergeWithPreviousContent:!1,content:t.content}}let c={role:a,parts:u};return{mergeWithPreviousContent:i==="system",content:[...t.content,c]}},{content:[],mergeWithPreviousContent:!1}).content}function um(r){var a,o;if(!r.candidates||r.candidates.length===0||!r.candidates[0])return{generations:[],llmOutput:{filters:r.promptFeedback}};let[e]=r.candidates,{content:t,...n}=e,s=(o=(a=t==null?void 0:t.parts[0])==null?void 0:a.text)!=null?o:"";return{generations:[{text:s,message:new Ne({content:s,name:t?t.role:void 0,additional_kwargs:n}),generationInfo:n}]}}function cm(r){var i,a;if(!r.candidates||r.candidates.length===0)return null;let[e]=r.candidates,{content:t,...n}=e,s=(a=(i=t==null?void 0:t.parts[0])==null?void 0:i.text)!=null?a:"";return new ar({text:s,message:new ir({content:s,name:t?t.role:void 0,additional_kwargs:{}}),generationInfo:n})}var Mu=class extends Gs{static lc_name(){return"googlegenerativeai"}get lc_secrets(){return{apiKey:"GOOGLE_API_KEY"}}get _isMultimodalModel(){return this.modelName.includes("vision")}constructor(e){var t,n,s,i,a,o,u,c,l,d;if(super(e!=null?e:{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gemini-pro"}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxOutputTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"safetySettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.modelName=(n=(t=e==null?void 0:e.modelName)==null?void 0:t.replace(/^models\//,""))!=null?n:this.modelName,this.maxOutputTokens=(s=e==null?void 0:e.maxOutputTokens)!=null?s:this.maxOutputTokens,this.maxOutputTokens&&this.maxOutputTokens<0)throw new Error("`maxOutputTokens` must be a positive integer");if(this.temperature=(i=e==null?void 0:e.temperature)!=null?i:this.temperature,this.temperature&&(this.temperature<0||this.temperature>1))throw new Error("`temperature` must be in the range of [0.0,1.0]");if(this.topP=(a=e==null?void 0:e.topP)!=null?a:this.topP,this.topP&&this.topP<0)throw new Error("`topP` must be a positive integer");if(this.topP&&this.topP>1)throw new Error("`topP` must be below 1.");if(this.topK=(o=e==null?void 0:e.topK)!=null?o:this.topK,this.topK&&this.topK<0)throw new Error("`topK` must be a positive integer");if(this.stopSequences=(u=e==null?void 0:e.stopSequences)!=null?u:this.stopSequences,this.apiKey=(c=e==null?void 0:e.apiKey)!=null?c:ae("GOOGLE_API_KEY"),!this.apiKey)throw new Error("Please set an API key for Google GenerativeAI in the environment variable GOOGLE_API_KEY or in the `apiKey` field of the ChatGoogleGenerativeAI constructor");if(this.safetySettings=(l=e==null?void 0:e.safetySettings)!=null?l:this.safetySettings,this.safetySettings&&this.safetySettings.length>0&&new Set(this.safetySettings.map(h=>h.category)).size!==this.safetySettings.length)throw new Error("The categories in `safetySettings` array must be unique");this.streaming=(d=e==null?void 0:e.streaming)!=null?d:this.streaming,this.client=new ea(this.apiKey).getGenerativeModel({model:this.modelName,safetySettings:this.safetySettings,generationConfig:{candidateCount:1,stopSequences:this.stopSequences,maxOutputTokens:this.maxOutputTokens,temperature:this.temperature,topP:this.topP,topK:this.topK}})}_combineLLMOutput(){return[]}_llmType(){return"googlegenerativeai"}async _generate(e,t,n){var o,u,c;let s=od(e,this._isMultimodalModel);if(this.streaming){let l={},d=this._streamResponseChunks(e,t,n),f={};for await(let p of d){let m=(u=(o=p.generationInfo)==null?void 0:o.completion)!=null?u:0;f[m]===void 0?f[m]=p:f[m]=f[m].concat(p)}return{generations:Object.entries(f).sort(([p],[m])=>parseInt(p,10)-parseInt(m,10)).map(([p,m])=>m),llmOutput:{estimatedTokenUsage:l}}}let i=await this.caller.callWithOptions({signal:t==null?void 0:t.signal},async()=>{var d;let l;try{l=await this.client.generateContent({contents:s})}catch(f){throw(d=f.message)!=null&&d.includes("400 Bad Request")&&(f.status=400),f}return l}),a=um(i.response);return await(n==null?void 0:n.handleLLMNewToken((c=a.generations[0].text)!=null?c:"")),a}async*_streamResponseChunks(e,t,n){var a;let s=od(e,this._isMultimodalModel),i=await this.caller.callWithOptions({signal:t==null?void 0:t.signal},async()=>{let{stream:o}=await this.client.generateContentStream({contents:s});return o});for await(let o of i){let u=cm(o);u&&(yield u,await(n==null?void 0:n.handleLLMNewToken((a=u.text)!=null?a:"")))}}};var Vn="4.29.2";var dm=!1,Zn,ud,Uw,zw,Kw,cd,qw,Lu,ld,dd,fd,Du,hd;function fm(r,e={auto:!1}){if(dm)throw new Error(`you must \`import 'openai/shims/${r.kind}'\` before importing anything else from openai`);if(Zn)throw new Error(`can't \`import 'openai/shims/${r.kind}'\` after \`import 'openai/shims/${Zn}'\``);dm=e.auto,Zn=r.kind,ud=r.fetch,Uw=r.Request,zw=r.Response,Kw=r.Headers,cd=r.FormData,qw=r.Blob,Lu=r.File,ld=r.ReadableStream,dd=r.getMultipartRequestOptions,fd=r.getDefaultAgent,Du=r.fileFromPath,hd=r.isFsReadStream}var Bu=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function hm({manuallyImported:r}={}){let e=r?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n",t,n,s,i;try{t=fetch,n=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:s,Headers:i,FormData:typeof FormData!="undefined"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob!="undefined"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File!="undefined"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream!="undefined"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new Bu(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}Zn||fm(hm(),{auto:!0});var pd={};jc(pd,{APIConnectionError:()=>yr,APIConnectionTimeoutError:()=>br,APIError:()=>ye,APIUserAbortError:()=>ge,AuthenticationError:()=>Ws,BadRequestError:()=>Js,ConflictError:()=>Qs,InternalServerError:()=>ri,NotFoundError:()=>Xs,OpenAIError:()=>z,PermissionDeniedError:()=>Ys,RateLimitError:()=>ti,UnprocessableEntityError:()=>ei});var z=class extends Error{},ye=class r extends z{constructor(e,t,n,s){super(`${r.makeMessage(e,t,n)}`),this.status=e,this.headers=s;let i=t;this.error=i,this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,n){let s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e)return new yr({cause:Fu(t)});let i=t==null?void 0:t.error;return e===400?new Js(e,i,n,s):e===401?new Ws(e,i,n,s):e===403?new Ys(e,i,n,s):e===404?new Xs(e,i,n,s):e===409?new Qs(e,i,n,s):e===422?new ei(e,i,n,s):e===429?new ti(e,i,n,s):e>=500?new ri(e,i,n,s):new r(e,i,n,s)}},ge=class extends ye{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}},yr=class extends ye{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}},br=class extends yr{constructor({message:e}={}){super({message:e!=null?e:"Request timed out."})}},Js=class extends ye{constructor(){super(...arguments),this.status=400}},Ws=class extends ye{constructor(){super(...arguments),this.status=401}},Ys=class extends ye{constructor(){super(...arguments),this.status=403}},Xs=class extends ye{constructor(){super(...arguments),this.status=404}},Qs=class extends ye{constructor(){super(...arguments),this.status=409}},ei=class extends ye{constructor(){super(...arguments),this.status=422}},ti=class extends ye{constructor(){super(...arguments),this.status=429}},ri=class extends ye{};var _r=class r{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1,s=new md;async function*i(){if(!e.body)throw t.abort(),new z("Attempted to iterate over a response with no body");let o=new ni,u=pm(e.body);for await(let c of u)for(let l of o.decode(c)){let d=s.decode(l);d&&(yield d)}for(let c of o.flush()){let l=s.decode(c);l&&(yield l)}}async function*a(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let o=!1;try{for await(let u of i())if(!o){if(u.data.startsWith("[DONE]")){o=!0;continue}if(u.event===null){let c;try{c=JSON.parse(u.data)}catch(l){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),l}if(c&&c.error)throw new ye(void 0,c.error,void 0,void 0);yield c}else{let c;try{c=JSON.parse(u.data)}catch(l){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),l}if(u.event=="error")throw new ye(void 0,c.error,c.message,void 0);yield{event:u.event,data:c}}}o=!0}catch(u){if(u instanceof Error&&u.name==="AbortError")return;throw u}finally{o||t.abort()}}return new r(a,t)}static fromReadableStream(e,t){let n=!1;async function*s(){let a=new ni,o=pm(e);for await(let u of o)for(let c of a.decode(u))yield c;for(let u of a.flush())yield u}async function*i(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(let o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new r(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],n=this.iterator(),s=i=>({next:()=>{if(i.length===0){let a=n.next();e.push(a),t.push(a)}return i.shift()}});return[new r(()=>s(e),this.controller),new r(()=>s(t),this.controller)]}toReadableStream(){let e=this,t,n=new TextEncoder;return new ld({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{let{value:i,done:a}=await t.next();if(a)return s.close();let o=n.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}},md=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=Zw(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}},ni=class r{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];let n=r.NEWLINE_CHARS.has(t[t.length-1]||""),s=t.split(r.NEWLINE_REGEXP);return n&&s.pop(),s.length===1&&!n?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),n||(this.buffer=[s.pop()||""]),s)}decodeText(e){var t;if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer!="undefined"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new z(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder!="undefined"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return(t=this.textDecoder)!=null||(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new z(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new z("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];let e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};ni.NEWLINE_CHARS=new Set([`
`,"\r","\v","\f","","","","\x85","\u2028","\u2029"]);ni.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;function Zw(r,e){let t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}function pm(r){if(r[Symbol.asyncIterator])return r;let e=r.getReader();return{async next(){try{let t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var mm=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function",Hw=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&gm(r),gm=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",Gw=r=>Hw(r)||mm(r)||hd(r);async function bd(r,e,t={}){var s,i,a;if(r=await r,mm(r)){let o=await r.blob();return e||(e=(s=new URL(r.url).pathname.split(/[\\/]/).pop())!=null?s:"unknown_file"),new Lu([o],e,t)}let n=await Jw(r);if(e||(e=(i=Yw(r))!=null?i:"unknown_file"),!t.type){let o=(a=n[0])==null?void 0:a.type;typeof o=="string"&&(t={...t,type:o})}return new Lu(n,e,t)}async function Jw(r){var t;let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(gm(r))e.push(await r.arrayBuffer());else if(Xw(r))for await(let n of r)e.push(n);else throw new Error(`Unexpected data type: ${typeof r}; constructor: ${(t=r==null?void 0:r.constructor)==null?void 0:t.name}; props: ${Ww(r)}`);return e}function Ww(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}function Yw(r){var e;return gd(r.name)||gd(r.filename)||((e=gd(r.path))==null?void 0:e.split(/[\\/]/).pop())}var gd=r=>{if(typeof r=="string")return r;if(typeof Buffer!="undefined"&&r instanceof Buffer)return String(r)},Xw=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",_d=r=>r&&typeof r=="object"&&r.body&&r[Symbol.toStringTag]==="MultipartBody";var Gt=async r=>{let e=await ym(r.body);return dd(e,r)},ym=async r=>{let e=new cd;return await Promise.all(Object.entries(r||{}).map(([t,n])=>yd(e,t,n))),e};var yd=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(Gw(t)){let n=await bd(t);r.append(e,n)}else if(Array.isArray(t))await Promise.all(t.map(n=>yd(r,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,s])=>yd(r,`${e}[${n}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var ev=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},tv=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Uu;async function vm(r){let{response:e}=r;if(r.options.stream)return si("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):_r.fromSSEResponse(e,r.controller);if(e.status===204)return null;if(r.options.__binaryResponse)return e;let t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){let i=await e.json();return si("response",e.status,e.url,e.headers,i),i}let s=await e.text();return si("response",e.status,e.url,e.headers,s),s}var Ku=class r extends Promise{constructor(e,t=vm){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new r(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},qu=class{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=wd("maxRetries",t),this.timeout=wd("timeout",n),this.httpAgent=s,this.fetch=i!=null?i:ud}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...av(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${lv()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(s=>({method:e,path:t,...s})))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer!="undefined")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder!="undefined")return new TextEncoder().encode(e).length.toString()}return null}buildRequest(e){var p,m,g,y,b,O;let{method:t,path:n,query:s,headers:i={}}=e,a=_d(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,o=this.calculateContentLength(a),u=this.buildURL(n,s);"timeout"in e&&wd("timeout",e.timeout);let c=(p=e.timeout)!=null?p:this.timeout,l=(g=(m=e.httpAgent)!=null?m:this.httpAgent)!=null?g:fd(u),d=c+1e3;typeof((y=l==null?void 0:l.options)==null?void 0:y.timeout)=="number"&&d>((b=l.options.timeout)!=null?b:0)&&(l.options.timeout=d),this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let f=this.buildHeaders({options:e,headers:i,contentLength:o});return{req:{method:t,...a&&{body:a},headers:f,...l&&{agent:l},signal:(O=e.signal)!=null?O:null},url:u,timeout:c}}buildHeaders({options:e,headers:t,contentLength:n}){let s={};n&&(s["content-length"]=n);let i=this.defaultHeaders(e);return wm(s,i),wm(s,t),_d(e.body)&&Zn!=="node"&&delete s["content-type"],this.validateHeaders(s,t),s}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,s){return ye.generate(e,t,n,s)}request(e,t=null){return new Ku(this.makeRequest(e,t))}async makeRequest(e,t){var l,d,f;let n=await e;t==null&&(t=(l=n.maxRetries)!=null?l:this.maxRetries),await this.prepareOptions(n);let{req:s,url:i,timeout:a}=this.buildRequest(n);if(await this.prepareRequest(s,{url:i,options:n}),si("request",i,n,s.headers),(d=n.signal)!=null&&d.aborted)throw new ge;let o=new AbortController,u=await this.fetchWithTimeout(i,s,a,o).catch(Fu);if(u instanceof Error){if((f=n.signal)!=null&&f.aborted)throw new ge;if(t)return this.retryRequest(n,t);throw u.name==="AbortError"?new br:new yr({cause:u})}let c=rv(u.headers);if(!u.ok){if(t&&this.shouldRetry(u)){let b=`retrying, ${t} attempts remaining`;return si(`response (error; ${b})`,u.status,i,c),this.retryRequest(n,t,c)}let h=await u.text().catch(b=>Fu(b).message),p=ov(h),m=p?void 0:h;throw si(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,u.status,i,c,m),this.makeStatusError(u.status,p,m,c)}return{response:u,options:n,controller:o}}requestAPIList(e,t){let n=this.makeRequest(t,null);return new vd(this,n,e)}buildURL(e,t){let n=cv(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return xm(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n!="undefined").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new z(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,s){let{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());let o=setTimeout(()=>s.abort(),n);return this.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...a}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){var o;let s,i=n==null?void 0:n["retry-after-ms"];if(i){let u=parseFloat(i);Number.isNaN(u)||(s=u)}let a=n==null?void 0:n["retry-after"];if(a&&!s){let u=parseFloat(a);Number.isNaN(u)?s=Date.parse(a)-Date.now():s=u*1e3}if(!(s&&0<=s&&s<60*1e3)){let u=(o=e.maxRetries)!=null?o:this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,u)}return await xd(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){let i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Vn}`}},Aa=class{constructor(e,t,n,s){Uu.set(this,void 0),ev(this,Uu,e,"f"),this.options=s,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new z("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){let n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(let[s,i]of n)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await tv(this,Uu,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Uu=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},vd=class extends Ku{constructor(e,t,n){super(t,async s=>new n(e,s.response,await vm(s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},rv=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){let n=t.toString();return e[n.toLowerCase()]||e[n]}}),nv={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryResponse:!0,__streamClass:!0},_e=r=>typeof r=="object"&&r!==null&&!xm(r)&&Object.keys(r).every(e=>Am(nv,e)),sv=()=>{if(typeof Deno!="undefined"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vn,"X-Stainless-OS":_m(Deno.build.os),"X-Stainless-Arch":bm(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":Deno.version};if(typeof EdgeRuntime!="undefined")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vn,"X-Stainless-OS":_m(process.platform),"X-Stainless-Arch":bm(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let r=iv();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function iv(){if(typeof navigator=="undefined"||!navigator)return null;let r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of r){let n=t.exec(navigator.userAgent);if(n){let s=n[1]||0,i=n[2]||0,a=n[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}var bm=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",_m=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown"),zu,av=()=>zu!=null?zu:zu=sv(),ov=r=>{try{return JSON.parse(r)}catch(e){return}},uv=new RegExp("^(?:[a-z]+:)?//","i"),cv=r=>uv.test(r),xd=r=>new Promise(e=>setTimeout(e,r)),wd=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new z(`${r} must be an integer`);if(e<0)throw new z(`${r} must be a positive integer`);return e},Fu=r=>r instanceof Error?r:new Error(r);var Vu=r=>{var e,t,n,s,i,a;if(typeof process!="undefined")return(n=(t=(e=process.env)==null?void 0:e[r])==null?void 0:t.trim())!=null?n:void 0;if(typeof Deno!="undefined")return(a=(i=(s=Deno.env)==null?void 0:s.get)==null?void 0:i.call(s,r))==null?void 0:a.trim()};function xm(r){if(!r)return!0;for(let e in r)return!1;return!0}function Am(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function wm(r,e){for(let t in e){if(!Am(e,t))continue;let n=t.toLowerCase();if(!n)continue;let s=e[t];s===null?delete r[n]:s!==void 0&&(r[n]=s)}}function si(r,...e){typeof process!="undefined"&&process.env.DEBUG==="true"&&console.log(`OpenAI:DEBUG:${r}`,...e)}var lv=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{let e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)}),Om=()=>typeof window!="undefined"&&typeof window.document!="undefined"&&typeof navigator!="undefined";function Ad(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}var qr=class extends Aa{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}nextPageParams(){return null}nextPageInfo(){return null}},we=class extends Aa{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[]}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var n;let e=this.getPaginatedItems();if(!e.length)return null;let t=(n=e[e.length-1])==null?void 0:n.id;return t?{params:{after:t}}:null}};var L=class{constructor(e){this._client=e}};var Hn=class extends L{create(e,t){var n;return this._client.post("/chat/completions",{body:e,...t,stream:(n=e.stream)!=null?n:!1})}};Hn||(Hn={});var Vr=class extends L{constructor(){super(...arguments),this.completions=new Hn(this._client)}};(function(r){r.Completions=Hn})(Vr||(Vr={}));var Gn=class extends L{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}};Gn||(Gn={});var Jn=class extends L{create(e,t){return this._client.post("/audio/transcriptions",Gt({body:e,...t}))}};Jn||(Jn={});var Wn=class extends L{create(e,t){return this._client.post("/audio/translations",Gt({body:e,...t}))}};Wn||(Wn={});var Zr=class extends L{constructor(){super(...arguments),this.transcriptions=new Jn(this._client),this.translations=new Wn(this._client),this.speech=new Gn(this._client)}};(function(r){r.Transcriptions=Jn,r.Translations=Wn,r.Speech=Gn})(Zr||(Zr={}));var Yn=class extends L{create(e,t,n){return this._client.post(`/assistants/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/assistants/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}list(e,t={},n){return _e(t)?this.list(e,{},t):this._client.getAPIList(`/assistants/${e}/files`,Xn,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/assistants/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}},Xn=class extends we{};(function(r){r.AssistantFilesPage=Xn})(Yn||(Yn={}));var Qn=class extends L{constructor(){super(...arguments),this.files=new Yn(this._client)}create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}list(e={},t){return _e(e)?this.list({},e):this._client.getAPIList("/assistants",es,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}},es=class extends we{};(function(r){r.AssistantsPage=es,r.Files=Yn,r.AssistantFilesPage=Xn})(Qn||(Qn={}));function Od(r){return typeof r.parse=="function"}var Hr=r=>(r==null?void 0:r.role)==="assistant",Ed=r=>(r==null?void 0:r.role)==="function",Sd=r=>(r==null?void 0:r.role)==="tool";var Nt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},W=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Me,Zu,Hu,Oa,Ea,Gu,Sa,wr,Ta,Ju,Wu,ii,Td,Yu,Pd,kd,Id,Cd,km,Nd,Pm=10,ai=class{constructor(){Me.add(this),this.controller=new AbortController,Zu.set(this,void 0),Hu.set(this,()=>{}),Oa.set(this,()=>{}),Ea.set(this,void 0),Gu.set(this,()=>{}),Sa.set(this,()=>{}),wr.set(this,{}),this._chatCompletions=[],this.messages=[],Ta.set(this,!1),Ju.set(this,!1),Wu.set(this,!1),ii.set(this,!1),Cd.set(this,e=>{if(Nt(this,Ju,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new ge),e instanceof ge)return Nt(this,Wu,!0,"f"),this._emit("abort",e);if(e instanceof z)return this._emit("error",e);if(e instanceof Error){let t=new z(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new z(String(e)))}),Nt(this,Zu,new Promise((e,t)=>{Nt(this,Hu,e,"f"),Nt(this,Oa,t,"f")}),"f"),Nt(this,Ea,new Promise((e,t)=>{Nt(this,Gu,e,"f"),Nt(this,Sa,t,"f")}),"f"),W(this,Zu,"f").catch(()=>{}),W(this,Ea,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},W(this,Cd,"f"))},0)}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Ed(e)||Sd(e))&&e.content)this._emit("functionCallResult",e.content);else if(Hr(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Hr(e)&&e.tool_calls)for(let n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}_connected(){this.ended||(W(this,Hu,"f").call(this),this._emit("connect"))}get ended(){return W(this,Ta,"f")}get errored(){return W(this,Ju,"f")}get aborted(){return W(this,Wu,"f")}abort(){this.controller.abort()}on(e,t){return(W(this,wr,"f")[e]||(W(this,wr,"f")[e]=[])).push({listener:t}),this}off(e,t){let n=W(this,wr,"f")[e];if(!n)return this;let s=n.findIndex(i=>i.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(W(this,wr,"f")[e]||(W(this,wr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{Nt(this,ii,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){Nt(this,ii,!0,"f"),await W(this,Ea,"f")}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new z("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),W(this,Me,"m",Td).call(this)}async finalMessage(){return await this.done(),W(this,Me,"m",Yu).call(this)}async finalFunctionCall(){return await this.done(),W(this,Me,"m",Pd).call(this)}async finalFunctionCallResult(){return await this.done(),W(this,Me,"m",kd).call(this)}async totalUsage(){return await this.done(),W(this,Me,"m",Id).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emit(e,...t){if(W(this,Ta,"f"))return;e==="end"&&(Nt(this,Ta,!0,"f"),W(this,Gu,"f").call(this));let n=W(this,wr,"f")[e];if(n&&(W(this,wr,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){let s=t[0];!W(this,ii,"f")&&!(n!=null&&n.length)&&Promise.reject(s),W(this,Oa,"f").call(this,s),W(this,Sa,"f").call(this,s),this._emit("end");return}if(e==="error"){let s=t[0];!W(this,ii,"f")&&!(n!=null&&n.length)&&Promise.reject(s),W(this,Oa,"f").call(this,s),W(this,Sa,"f").call(this,s),this._emit("end")}}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=W(this,Me,"m",Yu).call(this);t&&this._emit("finalMessage",t);let n=W(this,Me,"m",Td).call(this);n&&this._emit("finalContent",n);let s=W(this,Me,"m",Pd).call(this);s&&this._emit("finalFunctionCall",s);let i=W(this,Me,"m",kd).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",W(this,Me,"m",Id).call(this))}async _createChatCompletion(e,t,n){let s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),W(this,Me,"m",km).call(this,t);let i=await e.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(i)}async _runChatCompletion(e,t,n){for(let s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){var f;let s="function",{function_call:i="auto",stream:a,...o}=t,u=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:c=Pm}=n||{},l={};for(let h of t.functions)l[h.name||h.function.name]=h;let d=t.functions.map(h=>({name:h.name||h.function.name,parameters:h.parameters,description:h.description}));for(let h of t.messages)this._addMessage(h,!1);for(let h=0;h<c;++h){let m=(f=(await this._createChatCompletion(e,{...o,function_call:i,functions:d,messages:[...this.messages]},n)).choices[0])==null?void 0:f.message;if(!m)throw new z("missing message in ChatCompletion response");if(!m.function_call)return;let{name:g,arguments:y}=m.function_call,b=l[g];if(b){if(u&&u!==g){let _=`Invalid function_call: ${JSON.stringify(g)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,name:g,content:_});continue}}else{let _=`Invalid function_call: ${JSON.stringify(g)}. Available options are: ${d.map(F=>JSON.stringify(F.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:g,content:_});continue}let O;try{O=Od(b)?await b.parse(y):y}catch(_){this._addMessage({role:s,name:g,content:_ instanceof Error?_.message:String(_)});continue}let E=await b.function(O,this),T=W(this,Me,"m",Nd).call(this,E);if(this._addMessage({role:s,name:g,content:T}),u)return}}async _runTools(e,t,n){var f,h;let s="tool",{tool_choice:i="auto",stream:a,...o}=t,u=typeof i!="string"&&((f=i==null?void 0:i.function)==null?void 0:f.name),{maxChatCompletions:c=Pm}=n||{},l={};for(let p of t.tools)p.type==="function"&&(l[p.function.name||p.function.function.name]=p.function);let d="tools"in t?t.tools.map(p=>p.type==="function"?{type:"function",function:{name:p.function.name||p.function.function.name,parameters:p.function.parameters,description:p.function.description}}:p):void 0;for(let p of t.messages)this._addMessage(p,!1);for(let p=0;p<c;++p){let g=(h=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:d,messages:[...this.messages]},n)).choices[0])==null?void 0:h.message;if(!g)throw new z("missing message in ChatCompletion response");if(!g.tool_calls)return;for(let y of g.tool_calls){if(y.type!=="function")continue;let b=y.id,{name:O,arguments:E}=y.function,T=l[O];if(T){if(u&&u!==O){let M=`Invalid tool_call: ${JSON.stringify(O)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,tool_call_id:b,content:M});continue}}else{let M=`Invalid tool_call: ${JSON.stringify(O)}. Available options are: ${d.map(te=>JSON.stringify(te.function.name)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:b,content:M});continue}let _;try{_=Od(T)?await T.parse(E):E}catch(M){let te=M instanceof Error?M.message:String(M);this._addMessage({role:s,tool_call_id:b,content:te});continue}let F=await T.function(_,this),S=W(this,Me,"m",Nd).call(this,F);if(this._addMessage({role:s,tool_call_id:b,content:S}),u)return}}}};Zu=new WeakMap,Hu=new WeakMap,Oa=new WeakMap,Ea=new WeakMap,Gu=new WeakMap,Sa=new WeakMap,wr=new WeakMap,Ta=new WeakMap,Ju=new WeakMap,Wu=new WeakMap,ii=new WeakMap,Cd=new WeakMap,Me=new WeakSet,Td=function(){var e;return(e=W(this,Me,"m",Yu).call(this).content)!=null?e:null},Yu=function(){var t;let e=this.messages.length;for(;e-- >0;){let n=this.messages[e];if(Hr(n))return{...n,content:(t=n.content)!=null?t:null}}throw new z("stream ended without producing a ChatCompletionMessage with role=assistant")},Pd=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){let s=this.messages[n];if(Hr(s)&&(s!=null&&s.function_call))return s.function_call;if(Hr(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},kd=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Ed(t)&&t.content!=null||Sd(t)&&t.content!=null&&this.messages.some(n=>{var s;return n.role==="assistant"&&((s=n.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},Id=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},km=function(e){if(e.n!=null&&e.n>1)throw new z("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Nd=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var Pa=class r extends ai{static runFunctions(e,t,n){let s=new r,i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,n){let s=new r,i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e){super._addMessage(e),Hr(e)&&e.content&&this._emit("content",e.content)}};var Rt=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Rd=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Jt,Gr,jd,$d,Xu,Im,oi=class r extends ai{constructor(){super(...arguments),Jt.add(this),Gr.set(this,void 0)}get currentChatCompletionSnapshot(){return Rt(this,Gr,"f")}static fromReadableStream(e){let t=new r;return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){let s=new r;return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,n){var a;let s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Rt(this,Jt,"m",jd).call(this);let i=await e.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(let o of i)Rt(this,Jt,"m",$d).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new ge;return this._addChatCompletion(Rt(this,Jt,"m",Xu).call(this))}async _fromReadableStream(e,t){var a;let n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),Rt(this,Jt,"m",jd).call(this),this._connected();let s=_r.fromReadableStream(e,this.controller),i;for await(let o of s)i&&i!==o.id&&this._addChatCompletion(Rt(this,Jt,"m",Xu).call(this)),Rt(this,Jt,"m",$d).call(this,o),i=o.id;if((a=s.controller.signal)!=null&&a.aborted)throw new ge;return this._addChatCompletion(Rt(this,Jt,"m",Xu).call(this))}[(Gr=new WeakMap,Jt=new WeakSet,jd=function(){this.ended||Rd(this,Gr,void 0,"f")},$d=function(t){var a,o,u;if(this.ended)return;let n=Rt(this,Jt,"m",Im).call(this,t);this._emit("chunk",t,n);let s=(o=(a=t.choices[0])==null?void 0:a.delta)==null?void 0:o.content,i=(u=n.choices[0])==null?void 0:u.message;s!=null&&(i==null?void 0:i.role)==="assistant"&&(i!=null&&i.content)&&this._emit("content",s,i.content)},Xu=function(){if(this.ended)throw new z("stream has ended, this shouldn't happen");let t=Rt(this,Gr,"f");if(!t)throw new z("request ended without sending any chunks");return Rd(this,Gr,void 0,"f"),gv(t)},Im=function(t){var c,l,d,f;var n,s,i;let a=Rt(this,Gr,"f"),{choices:o,...u}=t;a?Object.assign(a,u):a=Rd(this,Gr,{...u,choices:[]},"f");for(let{delta:h,finish_reason:p,index:m,logprobs:g=null,...y}of t.choices){let b=a.choices[m];if(b||(b=a.choices[m]={finish_reason:p,index:m,message:{},logprobs:g,...y}),g)if(!b.logprobs)b.logprobs=Object.assign({},g);else{let{content:S,...M}=g;Object.assign(b.logprobs,M),S&&((c=(n=b.logprobs).content)!=null||(n.content=[]),b.logprobs.content.push(...S))}if(p&&(b.finish_reason=p),Object.assign(b,y),!h)continue;let{content:O,function_call:E,role:T,tool_calls:_,...F}=h;if(Object.assign(b.message,F),O&&(b.message.content=(b.message.content||"")+O),T&&(b.message.role=T),E&&(b.message.function_call?(E.name&&(b.message.function_call.name=E.name),E.arguments&&((l=(s=b.message.function_call).arguments)!=null||(s.arguments=""),b.message.function_call.arguments+=E.arguments)):b.message.function_call=E),_){b.message.tool_calls||(b.message.tool_calls=[]);for(let{index:S,id:M,type:te,function:ie,...rt}of _){let Ee=(d=(i=b.message.tool_calls)[S])!=null?d:i[S]={};Object.assign(Ee,rt),M&&(Ee.id=M),te&&(Ee.type=te),ie&&((f=Ee.function)!=null||(Ee.function={arguments:""})),ie!=null&&ie.name&&(Ee.function.name=ie.name),ie!=null&&ie.arguments&&(Ee.function.arguments+=ie.arguments)}}}return a},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("chunk",s=>{let i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(let i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(let i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new _r(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function gv(r){let{id:e,choices:t,created:n,model:s,system_fingerprint:i,...a}=r;return{...a,id:e,choices:t.map(({message:o,finish_reason:u,index:c,logprobs:l,...d})=>{if(!u)throw new z(`missing finish_reason for choice ${c}`);let{content:f=null,function_call:h,tool_calls:p,...m}=o,g=o.role;if(!g)throw new z(`missing role for choice ${c}`);if(h){let{arguments:y,name:b}=h;if(y==null)throw new z(`missing function_call.arguments for choice ${c}`);if(!b)throw new z(`missing function_call.name for choice ${c}`);return{...d,message:{content:f,function_call:{arguments:y,name:b},role:g},finish_reason:u,index:c,logprobs:l}}return p?{...d,index:c,finish_reason:u,logprobs:l,message:{...m,role:g,content:f,tool_calls:p.map((y,b)=>{let{function:O,type:E,id:T,..._}=y,{arguments:F,name:S,...M}=O||{};if(T==null)throw new z(`missing choices[${c}].tool_calls[${b}].id
${Qu(r)}`);if(E==null)throw new z(`missing choices[${c}].tool_calls[${b}].type
${Qu(r)}`);if(S==null)throw new z(`missing choices[${c}].tool_calls[${b}].function.name
${Qu(r)}`);if(F==null)throw new z(`missing choices[${c}].tool_calls[${b}].function.arguments
${Qu(r)}`);return{..._,id:T,type:E,function:{...M,name:S,arguments:F}}})}}:{...d,message:{...m,content:f,role:g},finish_reason:u,index:c,logprobs:l}}),created:n,model:s,object:"chat.completion",...i?{system_fingerprint:i}:{}}}function Qu(r){return JSON.stringify(r)}var ka=class r extends oi{static fromReadableStream(e){let t=new r;return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){let s=new r,i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,n){let s=new r,i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}};var Ia=class extends L{runFunctions(e,t){return e.stream?ka.runFunctions(this._client.chat.completions,e,t):Pa.runFunctions(this._client.chat.completions,e,t)}runTools(e,t){return e.stream?ka.runTools(this._client.chat.completions,e,t):Pa.runTools(this._client.chat.completions,e,t)}stream(e,t){return oi.createChatCompletion(this._client.chat.completions,e,t)}};var ts=class extends L{constructor(){super(...arguments),this.completions=new Ia(this._client)}};(function(r){r.Completions=Ia})(ts||(ts={}));var jt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},de=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},ec,tc,Ca,Na,rc,Ra,vr,ja,nc,sc,ui,Md,ic=class{constructor(){this.controller=new AbortController,ec.set(this,void 0),tc.set(this,()=>{}),Ca.set(this,()=>{}),Na.set(this,void 0),rc.set(this,()=>{}),Ra.set(this,()=>{}),vr.set(this,{}),ja.set(this,!1),nc.set(this,!1),sc.set(this,!1),ui.set(this,!1),Md.set(this,e=>{if(jt(this,nc,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new ge),e instanceof ge)return jt(this,sc,!0,"f"),this._emit("abort",e);if(e instanceof z)return this._emit("error",e);if(e instanceof Error){let t=new z(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new z(String(e)))}),jt(this,ec,new Promise((e,t)=>{jt(this,tc,e,"f"),jt(this,Ca,t,"f")}),"f"),jt(this,Na,new Promise((e,t)=>{jt(this,rc,e,"f"),jt(this,Ra,t,"f")}),"f"),de(this,ec,"f").catch(()=>{}),de(this,Na,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emit("end")},de(this,Md,"f"))},0)}_addRun(e){return e}_connected(){this.ended||(de(this,tc,"f").call(this),this._emit("connect"))}get ended(){return de(this,ja,"f")}get errored(){return de(this,nc,"f")}get aborted(){return de(this,sc,"f")}abort(){this.controller.abort()}on(e,t){return(de(this,vr,"f")[e]||(de(this,vr,"f")[e]=[])).push({listener:t}),this}off(e,t){let n=de(this,vr,"f")[e];if(!n)return this;let s=n.findIndex(i=>i.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(de(this,vr,"f")[e]||(de(this,vr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{jt(this,ui,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){jt(this,ui,!0,"f"),await de(this,Na,"f")}_emit(e,...t){if(de(this,ja,"f"))return;e==="end"&&(jt(this,ja,!0,"f"),de(this,rc,"f").call(this));let n=de(this,vr,"f")[e];if(n&&(de(this,vr,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){let s=t[0];!de(this,ui,"f")&&!(n!=null&&n.length)&&Promise.reject(s),de(this,Ca,"f").call(this,s),de(this,Ra,"f").call(this,s),this._emit("end");return}if(e==="error"){let s=t[0];!de(this,ui,"f")&&!(n!=null&&n.length)&&Promise.reject(s),de(this,Ca,"f").call(this,s),de(this,Ra,"f").call(this,s),this._emit("end")}}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,s){return await this._createAssistantStream(t,e,n,s)}async _runToolAssistantStream(e,t,n,s,i){return await this._createToolAssistantStream(n,e,t,s,i)}async _createThreadAssistantStream(e,t,n){let s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let i=await e.createAndRun({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addRun(i)}async _createToolAssistantStream(e,t,n,s,i){let a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let o=await e.submitToolOutputs(t,n,{...s,stream:!1},{...i,signal:this.controller.signal});return this._connected(),this._addRun(o)}async _createAssistantStream(e,t,n,s){let i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a=await e.create(t,{...n,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addRun(a)}};ec=new WeakMap,tc=new WeakMap,Ca=new WeakMap,Na=new WeakMap,rc=new WeakMap,Ra=new WeakMap,vr=new WeakMap,ja=new WeakMap,nc=new WeakMap,sc=new WeakMap,ui=new WeakMap,Md=new WeakMap;var R=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Qe=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},ze,Ld,Wt,ac,$t,ns,ci,rs,dc,et,oc,uc,$a,cc,lc,Cm,Nm,Rm,jm,$m,Mm,Lm,xr=class r extends ic{constructor(){super(...arguments),ze.add(this),Ld.set(this,[]),Wt.set(this,{}),ac.set(this,{}),$t.set(this,void 0),ns.set(this,void 0),ci.set(this,void 0),rs.set(this,void 0),dc.set(this,void 0),et.set(this,void 0),oc.set(this,void 0),uc.set(this,void 0),$a.set(this,void 0)}[(Ld=new WeakMap,Wt=new WeakMap,ac=new WeakMap,$t=new WeakMap,ns=new WeakMap,ci=new WeakMap,rs=new WeakMap,dc=new WeakMap,et=new WeakMap,oc=new WeakMap,uc=new WeakMap,$a=new WeakMap,ze=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("event",s=>{let i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(let i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(let i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new _r(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,s,i){let a=new r;return a._run(()=>a._runToolAssistantStream(e,t,n,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,n,s,i){var c;let a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let o={...s,stream:!0},u=await e.submitToolOutputs(t,n,o,{...i,signal:this.controller.signal});this._connected();for await(let l of u)R(this,ze,"m",cc).call(this,l);if((c=u.controller.signal)!=null&&c.aborted)throw new ge;return this._addRun(R(this,ze,"m",lc).call(this))}static createThreadAssistantStream(e,t,n){let s=new r;return s._run(()=>s._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,n,s){let i=new r;return i._run(()=>i._runAssistantStream(e,t,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return R(this,oc,"f")}currentRun(){return R(this,uc,"f")}currentMessageSnapshot(){return R(this,$t,"f")}currentRunStepSnapshot(){return R(this,$a,"f")}async finalRunSteps(){return await this.done(),Object.values(R(this,Wt,"f"))}async finalMessages(){return await this.done(),Object.values(R(this,ac,"f"))}async finalRun(){if(await this.done(),!R(this,ns,"f"))throw Error("Final run was not received.");return R(this,ns,"f")}async _createThreadAssistantStream(e,t,n){var o;let s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let i={...t,stream:!0},a=await e.createAndRun(i,{...n,signal:this.controller.signal});this._connected();for await(let u of a)R(this,ze,"m",cc).call(this,u);if((o=a.controller.signal)!=null&&o.aborted)throw new ge;return this._addRun(R(this,ze,"m",lc).call(this))}async _createAssistantStream(e,t,n,s){var u;let i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a={...n,stream:!0},o=await e.create(t,a,{...s,signal:this.controller.signal});this._connected();for await(let c of o)R(this,ze,"m",cc).call(this,c);if((u=o.controller.signal)!=null&&u.aborted)throw new ge;return this._addRun(R(this,ze,"m",lc).call(this))}static accumulateDelta(e,t){for(let[n,s]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let i=e[n];if(i==null){e[n]=s;continue}if(n==="index"||n==="type"){e[n]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(Ad(i)&&Ad(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${i}`);e[n]=i}return e}};cc=function(e){if(!this.ended)switch(Qe(this,oc,e,"f"),R(this,ze,"m",Rm).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":R(this,ze,"m",Lm).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":R(this,ze,"m",Nm).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":R(this,ze,"m",Cm).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},lc=function(){if(this.ended)throw new z("stream has ended, this shouldn't happen");if(!R(this,ns,"f"))throw Error("Final run has been been received");return R(this,ns,"f")},Cm=function(e){let[t,n]=R(this,ze,"m",$m).call(this,e,R(this,$t,"f"));Qe(this,$t,t,"f"),R(this,ac,"f")[t.id]=t;for(let s of n){let i=t.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=t.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=R(this,ci,"f")){if(R(this,rs,"f"))switch(R(this,rs,"f").type){case"text":this._emit("textDone",R(this,rs,"f").text,R(this,$t,"f"));break;case"image_file":this._emit("imageFileDone",R(this,rs,"f").image_file,R(this,$t,"f"));break}Qe(this,ci,s.index,"f")}Qe(this,rs,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(R(this,ci,"f")!==void 0){let s=e.data.content[R(this,ci,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,R(this,$t,"f"));break;case"text":this._emit("textDone",s.text,R(this,$t,"f"));break}}R(this,$t,"f")&&this._emit("messageDone",e.data),Qe(this,$t,void 0,"f")}},Nm=function(e){let t=R(this,ze,"m",jm).call(this,e);switch(Qe(this,$a,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(let i of n.step_details.tool_calls)i.index==R(this,dc,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(R(this,et,"f")&&this._emit("toolCallDone",R(this,et,"f")),Qe(this,dc,i.index,"f"),Qe(this,et,t.step_details.tool_calls[i.index],"f"),R(this,et,"f")&&this._emit("toolCallCreated",R(this,et,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Qe(this,$a,void 0,"f"),e.data.step_details.type=="tool_calls"&&R(this,et,"f")&&(this._emit("toolCallDone",R(this,et,"f")),Qe(this,et,void 0,"f")),this._emit("runStepDone",e.data,t);break;case"thread.run.step.in_progress":break}},Rm=function(e){R(this,Ld,"f").push(e),this._emit("event",e)},jm=function(e){switch(e.event){case"thread.run.step.created":return R(this,Wt,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=R(this,Wt,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){let s=xr.accumulateDelta(t,n.delta);R(this,Wt,"f")[e.data.id]=s}return R(this,Wt,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":R(this,Wt,"f")[e.data.id]=e.data;break}if(R(this,Wt,"f")[e.data.id])return R(this,Wt,"f")[e.data.id];throw new Error("No snapshot available")},$m=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(let i of s.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=R(this,ze,"m",Mm).call(this,i,a)}else t.content[i.index]=i,n.push(i);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Mm=function(e,t){return xr.accumulateDelta(t,e)},Lm=function(e){switch(Qe(this,uc,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Qe(this,ns,e.data,"f"),R(this,et,"f")&&(this._emit("toolCallDone",R(this,et,"f")),Qe(this,et,void 0,"f"));break;case"thread.run.cancelling":break}};var ss=class extends L{retrieve(e,t,n,s){return this._client.get(`/threads/${e}/messages/${t}/files/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}list(e,t,n={},s){return _e(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/messages/${t}/files`,is,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}},is=class extends we{};(function(r){r.MessageFilesPage=is})(ss||(ss={}));var as=class extends L{constructor(){super(...arguments),this.files=new ss(this._client)}create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}list(e,t={},n){return _e(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,os,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}},os=class extends we{};(function(r){r.MessagesPage=os,r.Files=ss,r.MessageFilesPage=is})(as||(as={}));var us=class extends L{retrieve(e,t,n,s){return this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}list(e,t,n={},s){return _e(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,cs,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}},cs=class extends we{};(function(r){r.RunStepsPage=cs})(us||(us={}));var ls=class extends L{constructor(){super(...arguments),this.steps=new us(this._client)}create(e,t,n){var s;return this._client.post(`/threads/${e}/runs`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers},stream:(s=t.stream)!=null?s:!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}list(e,t={},n){return _e(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,ds,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}createAndStream(e,t,n){return xr.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,s){var i;return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers},stream:(i=n.stream)!=null?i:!1})}submitToolOutputsStream(e,t,n,s){return xr.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,s)}},ds=class extends we{};(function(r){r.RunsPage=ds,r.Steps=us,r.RunStepsPage=cs})(ls||(ls={}));var fs=class extends L{constructor(){super(...arguments),this.runs=new ls(this._client),this.messages=new as(this._client)}create(e={},t){return _e(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}createAndRun(e,t){var n;return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers},stream:(n=e.stream)!=null?n:!1})}createAndRunStream(e,t){return xr.createThreadAssistantStream(e,this._client.beta.threads,t)}};(function(r){r.Runs=ls,r.RunsPage=ds,r.Messages=as,r.MessagesPage=os})(fs||(fs={}));var Jr=class extends L{constructor(){super(...arguments),this.chat=new ts(this._client),this.assistants=new Qn(this._client),this.threads=new fs(this._client)}};(function(r){r.Chat=ts,r.Assistants=Qn,r.AssistantsPage=es,r.Threads=fs})(Jr||(Jr={}));var Wr=class extends L{create(e,t){var n;return this._client.post("/completions",{body:e,...t,stream:(n=e.stream)!=null?n:!1})}};Wr||(Wr={});var Yr=class extends L{create(e,t){return this._client.post("/embeddings",{body:e,...t})}};Yr||(Yr={});var Xr=class extends L{create(e,t){return this._client.post("/files",Gt({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return _e(e)?this.list({},e):this._client.getAPIList("/files",Qr,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){let s=new Set(["processed","error","deleted"]),i=Date.now(),a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await xd(t),a=await this.retrieve(e),Date.now()-i>n)throw new br({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}},Qr=class extends qr{};(function(r){r.FileObjectsPage=Qr})(Xr||(Xr={}));var hs=class extends L{create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return _e(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",ps,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return _e(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,ms,{query:t,...n})}},ps=class extends we{},ms=class extends we{};(function(r){r.FineTuningJobsPage=ps,r.FineTuningJobEventsPage=ms})(hs||(hs={}));var en=class extends L{constructor(){super(...arguments),this.jobs=new hs(this._client)}};(function(r){r.Jobs=hs,r.FineTuningJobsPage=ps,r.FineTuningJobEventsPage=ms})(en||(en={}));var tn=class extends L{createVariation(e,t){return this._client.post("/images/variations",Gt({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",Gt({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}};tn||(tn={});var rn=class extends L{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",nn,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}},nn=class extends qr{};(function(r){r.ModelsPage=nn})(rn||(rn={}));var sn=class extends L{create(e,t){return this._client.post("/moderations",{body:e,...t})}};sn||(sn={});var Km,fe=class extends qu{constructor({baseURL:e=Vu("OPENAI_BASE_URL"),apiKey:t=Vu("OPENAI_API_KEY"),organization:n=(i=>(i=Vu("OPENAI_ORG_ID"))!=null?i:null)(),...s}={}){var o;if(t===void 0)throw new z("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let a={apiKey:t,organization:n,...s,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&Om())throw new z(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:(o=a.timeout)!=null?o:6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new Wr(this),this.chat=new Vr(this),this.embeddings=new Yr(this),this.files=new Xr(this),this.images=new tn(this),this.audio=new Zr(this),this.moderations=new sn(this),this.models=new rn(this),this.fineTuning=new en(this),this.beta=new Jr(this),this._options=a,this.apiKey=t,this.organization=n}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}};Km=fe;fe.OpenAI=Km;fe.OpenAIError=z;fe.APIError=ye;fe.APIConnectionError=yr;fe.APIConnectionTimeoutError=br;fe.APIUserAbortError=ge;fe.NotFoundError=Xs;fe.ConflictError=Qs;fe.RateLimitError=ti;fe.BadRequestError=Js;fe.AuthenticationError=Ws;fe.InternalServerError=ri;fe.PermissionDeniedError=Ys;fe.UnprocessableEntityError=ei;var{OpenAIError:Zj,APIError:Hj,APIConnectionError:Gj,APIConnectionTimeoutError:qm,APIUserAbortError:Vm,NotFoundError:Jj,ConflictError:Wj,RateLimitError:Yj,BadRequestError:Xj,AuthenticationError:Qj,InternalServerError:e$,PermissionDeniedError:t$,UnprocessableEntityError:r$}=pd;(function(r){r.toFile=bd,r.fileFromPath=Du,r.Page=qr,r.CursorPage=we,r.Completions=Wr,r.Chat=Vr,r.Embeddings=Yr,r.Files=Xr,r.FileObjectsPage=Qr,r.Images=tn,r.Audio=Zr,r.Moderations=sn,r.Models=rn,r.ModelsPage=nn,r.FineTuning=en,r.Beta=Jr})(fe||(fe={}));function Zm(r){return{name:r.name,description:r.description,parameters:qn(r.schema)}}function Dd(r){return{type:"function",function:Zm(r)}}var gs=class extends ce{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){let n=oe(t);return this.func&&await this.func(e,n),this._callWithConfig(s=>Promise.resolve(s),e,n)}async*transform(e,t){let n=oe(t),s,i=!0;for await(let a of this._transformStreamWithConfig(e,o=>o,n))if(yield a,i)if(s===void 0)s=a;else try{s=Zt(s,a)}catch(o){s=void 0,i=!1}this.func&&s!==void 0&&await this.func(s,n)}static assign(e){return new Hs(new Kr({steps:e}))}};var li=class extends ce{parseResultWithPrompt(e,t,n){return this.parseResult(e,n)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(n,s)=>this.parseResult([{text:n}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(n,s)=>this.parseResult([{message:n,text:this._baseMessageToString(n)}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"})}},di=class extends li{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}},ys=class extends Error{constructor(e,t,n,s=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=n,this.sendToLLM=s,s&&(n===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true")}};function Ma(r,e){let t=typeof r;if(t!==typeof e)return!1;if(Array.isArray(r)){if(!Array.isArray(e))return!1;let n=r.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(!Ma(r[s],e[s]))return!1;return!0}if(t==="object"){if(!r||!e)return r===e;let n=Object.keys(r),s=Object.keys(e);if(n.length!==s.length)return!1;for(let a of n)if(!Ma(r[a],e[a]))return!1;return!0}return r===e}var U$=typeof self!="undefined"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");var Ov=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,Ev=[0,31,28,31,30,31,30,31,31,30,31,30,31],Sv=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,Tv=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,Pv=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,kv=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,Iv=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,Cv=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,Nv=/^(?:\/(?:[^~/]|~0|~1)*)*$/,Rv=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,jv=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,$v=/^\d\d\d\d-[0-1]\d-[0-3]\d$/,Mv=/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,Lv=/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,Dv=/^(?:(?:[a-z][a-z0-9+-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,Bv=r=>{if(r[0]==='"')return!1;let[e,t,...n]=r.split("@");return!e||!t||n.length!==0||e.length>64||t.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(t)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:t.split(".").every(s=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(s))},Fv=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,Uv=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,zv=r=>r.length>1&&r.length<80&&(/^P\d+([.,]\d+)?W$/.test(r)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(r)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(r));function Ge(r){return r.test.bind(r)}var Kv={date:Hm,time:Gm.bind(void 0,!1),"date-time":Hv,duration:zv,uri:Wv,"uri-reference":Ge(Pv),"uri-template":Ge(kv),url:Ge(Iv),email:Bv,hostname:Ge(Tv),ipv4:Ge(Fv),ipv6:Ge(Uv),regex:Xv,uuid:Ge(Cv),"json-pointer":Ge(Nv),"json-pointer-uri-fragment":Ge(Rv),"relative-json-pointer":Ge(jv)},qv={...Kv,date:Ge($v),time:Ge(Mv),"date-time":Ge(Lv),"uri-reference":Ge(Dv)};function Vv(r){return r%4===0&&(r%100!==0||r%400===0)}function Hm(r){let e=r.match(Ov);if(!e)return!1;let t=+e[1],n=+e[2],s=+e[3];return n>=1&&n<=12&&s>=1&&s<=(n==2&&Vv(t)?29:Ev[n])}function Gm(r,e){let t=e.match(Sv);if(!t)return!1;let n=+t[1],s=+t[2],i=+t[3],a=!!t[5];return(n<=23&&s<=59&&i<=59||n==23&&s==59&&i==60)&&(!r||a)}var Zv=/t|\s/i;function Hv(r){let e=r.split(Zv);return e.length==2&&Hm(e[0])&&Gm(!0,e[1])}var Gv=/\/|:/,Jv=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function Wv(r){return Gv.test(r)&&Jv.test(r)}var Yv=/[^\\]\\Z/;function Xv(r){if(Yv.test(r))return!1;try{return new RegExp(r),!0}catch(e){return!1}}var fi=class extends di{async*_transform(e){for await(let t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}},La=class extends fi{constructor(e){var t;super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(t=e==null?void 0:e.diff)!=null?t:this.diff}async*_transform(e){let t,n;for await(let s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let i;if(Ah(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new ar({message:s,text:s.content})}else if(bn(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new ar({message:s.toChunk(),text:s.content})}else i=new jr({text:s});n===void 0?n=i:n=n.concat(i);let a=await this.parsePartialResult([n]);a!=null&&!Ma(a,t)&&(this.diff?yield this._diff(t,a):yield a,t=a)}}};var fc=class extends di{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){let t=dr.object(Object.fromEntries(Object.entries(e).map(([n,s])=>[n,dr.string().describe(s)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(qn(this.schema))}
\`\`\`
`}async parse(e){try{let t=e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim();return await this.schema.parseAsync(JSON.parse(t))}catch(t){throw new ys(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}};var hc=class extends La{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?Su(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return Jm(e[0].text)}async parse(e){return Jm(e,JSON.parse)}getFormatInstructions(){return""}};function Jm(r,e=e0){r=r.trim();let t=/```(json)?(.*)```/s.exec(r);return e(t?t[2]:r)}function e0(r){if(typeof r=="undefined")return null;try{return JSON.parse(r)}catch(i){}let e="",t=[],n=!1,s=!1;for(let i of r){if(n)i==='"'&&!s?n=!1:i===`
`&&!s?i="\\n":i==="\\"?s=!s:s=!1;else if(i==='"')n=!0,s=!1;else if(i==="{")t.push("}");else if(i==="[")t.push("]");else if(i==="}"||i==="]")if(t&&t[t.length-1]===i)t.pop();else return null;e+=i}n&&(e+='"');for(let i=t.length-1;i>=0;i-=1)e+=t[i];try{return JSON.parse(e)}catch(i){return null}}var Bd=class extends li{static lc_name(){return"JsonOutputToolsParser"}constructor(e){var t;super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(t=e==null?void 0:e.returnId)!=null?t:this.returnId}async parseResult(e){let t=e[0].message.additional_kwargs.tool_calls;if(!t)throw new Error(`No tools_call in message ${JSON.stringify(e)}`);let n=JSON.parse(JSON.stringify(t)),s=[];for(let i of n)if(i.function!==void 0){let a={type:i.function.name,args:JSON.parse(i.function.arguments)};this.returnId&&(a.id=i.id),Object.defineProperty(a,"name",{get(){return this.type}}),Object.defineProperty(a,"arguments",{get(){return this.args}}),s.push(a)}return s}},Da=class extends li{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){var t;super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"initialParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=(t=e.returnSingle)!=null?t:this.returnSingle,this.initialParser=new Bd(e),this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;let t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new ys(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parseResult(e){let n=(await this.initialParser.parseResult(e)).filter(a=>a.type===this.keyName),s=n;return this.returnId||(s=n.map(a=>a.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(a=>this._validateResult(a)))}};function Fd(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function Q(r,e,t,n,s){r[e]=t,Fd(r,e,n,s)}var Wm={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"string",mapStrategy:"entries",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",emailStrategy:"format:email"},Ym=r=>typeof r=="string"?{...Wm,name:r}:{...Wm,...r};var se;(function(r){r.assertEqual=s=>s;function e(s){}r.assertIs=e;function t(s){throw new Error}r.assertNever=t,r.arrayToEnum=s=>{let i={};for(let a of s)i[a]=a;return i},r.getValidEnumValues=s=>{let i=r.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),a={};for(let o of i)a[o]=s[o];return r.objectValues(a)},r.objectValues=s=>r.objectKeys(s).map(function(i){return s[i]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let i=[];for(let a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},r.find=(s,i)=>{for(let a of s)if(i(a))return a},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function n(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}r.joinValues=n,r.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(se||(se={}));var Xm;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Xm||(Xm={}));var k=se.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),bs=r=>{switch(typeof r){case"undefined":return k.undefined;case"string":return k.string;case"number":return isNaN(r)?k.nan:k.number;case"boolean":return k.boolean;case"function":return k.function;case"bigint":return k.bigint;case"symbol":return k.symbol;case"object":return Array.isArray(r)?k.array:r===null?k.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?k.promise:typeof Map!="undefined"&&r instanceof Map?k.map:typeof Set!="undefined"&&r instanceof Set?k.set:typeof Date!="undefined"&&r instanceof Date?k.date:k.object;default:return k.unknown}},A=se.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);var ct=class extends Error{constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){let t=e||function(i){return i.message},n={_errors:[]},s=i=>{for(let a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)n._errors.push(t(a));else{let o=n,u=0;for(;u<a.path.length;){let c=a.path[u];u===a.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(a))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return s(this),n}toString(){return this.message}get message(){return JSON.stringify(this.issues,se.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},n=[];for(let s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}};ct.create=r=>new ct(r);var mc=(r,e)=>{let t;switch(r.code){case A.invalid_type:r.received===k.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case A.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,se.jsonStringifyReplacer)}`;break;case A.unrecognized_keys:t=`Unrecognized key(s) in object: ${se.joinValues(r.keys,", ")}`;break;case A.invalid_union:t="Invalid input";break;case A.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${se.joinValues(r.options)}`;break;case A.invalid_enum_value:t=`Invalid enum value. Expected ${se.joinValues(r.options)}, received '${r.received}'`;break;case A.invalid_arguments:t="Invalid function arguments";break;case A.invalid_return_type:t="Invalid function return type";break;case A.invalid_date:t="Invalid date";break;case A.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:se.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case A.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case A.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case A.custom:t="Invalid input";break;case A.invalid_intersection_types:t="Intersection results could not be merged";break;case A.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case A.not_finite:t="Number must be finite";break;default:t=e.defaultError,se.assertNever(r)}return{message:t}},t0=mc;function zd(){return t0}var Kd=r=>{let{data:e,path:t,errorMaps:n,issueData:s}=r,i=[...t,...s.path||[]],a={...s,path:i},o="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)o=c(a,{data:e,defaultError:o}).message;return{...s,path:i,message:s.message||o}};function C(r,e){let t=Kd({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,zd(),mc].filter(n=>!!n)});r.common.issues.push(t)}var Ke=class r{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let n=[];for(let s of t){if(s.status==="aborted")return Z;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){let n=[];for(let s of t)n.push({key:await s.key,value:await s.value});return r.mergeObjectSync(e,n)}static mergeObjectSync(e,t){let n={};for(let s of t){let{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return Z;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value!="undefined"||s.alwaysSet)&&(n[i.value]=a.value)}return{status:e.value,value:n}}},Z=Object.freeze({status:"aborted"}),r0=r=>({status:"dirty",value:r}),Je=r=>({status:"valid",value:r}),Qm=r=>r.status==="aborted",eg=r=>r.status==="dirty",gc=r=>r.status==="valid",qd=r=>typeof Promise!="undefined"&&r instanceof Promise,$;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})($||($={}));var lt=class{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},tg=(r,e)=>{if(gc(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new ct(r.common.issues);return this._error=t,this._error}}};function V(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:n,description:s}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,o)=>a.code!=="invalid_type"?{message:o.defaultError}:typeof o.data=="undefined"?{message:n!=null?n:o.defaultError}:{message:t!=null?t:o.defaultError},description:s}}var J=class{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return bs(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:bs(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ke,ctx:{common:e.parent.common,data:e.data,parsedType:bs(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(qd(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;let s={common:{issues:[],async:(n=t==null?void 0:t.async)!==null&&n!==void 0?n:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:bs(e)},i=this._parseSync({data:e,path:s.path,parent:s});return tg(s,i)}async parseAsync(e,t){let n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){let n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:bs(e)},s=this._parse({data:e,path:n.path,parent:n}),i=await(qd(s)?s:Promise.resolve(s));return tg(n,i)}refine(e,t){let n=s=>typeof t=="string"||typeof t=="undefined"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{let a=e(s),o=()=>i.addIssue({code:A.custom,...n(s)});return typeof Promise!="undefined"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new Mt({schema:this,typeName:v.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Yt.create(this,this._def)}nullable(){return un.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return on.create(this,this._def)}promise(){return _s.create(this,this._def)}or(e){return yi.create([this,e],this._def)}and(e){return bi.create(this,e,this._def)}transform(e){return new Mt({...V(this._def),schema:this,typeName:v.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new Ai({...V(this._def),innerType:this,defaultValue:t,typeName:v.ZodDefault})}brand(){return new Jd({typeName:v.ZodBranded,type:this,...V(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new Ga({...V(this._def),innerType:this,catchValue:t,typeName:v.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return yc.create(this,e)}readonly(){return Wa.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},n0=/^c[^\s-]{8,}$/i,s0=/^[a-z][a-z0-9]*$/,i0=/^[0-9A-HJKMNP-TV-Z]{26}$/,a0=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,o0=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,u0="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Ud,c0=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,l0=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,d0=r=>r.precision?r.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${r.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${r.precision}}Z$`):r.precision===0?r.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):r.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function f0(r,e){return!!((e==="v4"||!e)&&c0.test(r)||(e==="v6"||!e)&&l0.test(r))}var pi=class r extends J{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==k.string){let i=this._getOrReturnCtx(e);return C(i,{code:A.invalid_type,expected:k.string,received:i.parsedType}),Z}let n=new Ke,s;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),C(s,{code:A.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),C(s,{code:A.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){let a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(s=this._getOrReturnCtx(e,s),a?C(s,{code:A.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&C(s,{code:A.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")o0.test(e.data)||(s=this._getOrReturnCtx(e,s),C(s,{validation:"email",code:A.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")Ud||(Ud=new RegExp(u0,"u")),Ud.test(e.data)||(s=this._getOrReturnCtx(e,s),C(s,{validation:"emoji",code:A.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")a0.test(e.data)||(s=this._getOrReturnCtx(e,s),C(s,{validation:"uuid",code:A.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")n0.test(e.data)||(s=this._getOrReturnCtx(e,s),C(s,{validation:"cuid",code:A.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")s0.test(e.data)||(s=this._getOrReturnCtx(e,s),C(s,{validation:"cuid2",code:A.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")i0.test(e.data)||(s=this._getOrReturnCtx(e,s),C(s,{validation:"ulid",code:A.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(e.data)}catch(a){s=this._getOrReturnCtx(e,s),C(s,{validation:"url",code:A.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),C(s,{validation:"regex",code:A.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),C(s,{code:A.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),C(s,{code:A.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),C(s,{code:A.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?d0(i).test(e.data)||(s=this._getOrReturnCtx(e,s),C(s,{code:A.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="ip"?f0(e.data,i.version)||(s=this._getOrReturnCtx(e,s),C(s,{validation:"ip",code:A.invalid_string,message:i.message}),n.dirty()):se.assertNever(i);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(s=>e.test(s),{validation:t,code:A.invalid_string,...$.errToObj(n)})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...$.errToObj(e)})}url(e){return this._addCheck({kind:"url",...$.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...$.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...$.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...$.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...$.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...$.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...$.errToObj(e)})}datetime(e){var t;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)=="undefined"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,...$.errToObj(e==null?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...$.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...$.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...$.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...$.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...$.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...$.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...$.errToObj(t)})}nonempty(e){return this.min(1,$.errToObj(e))}trim(){return new r({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};pi.create=r=>{var e;return new pi({checks:[],typeName:v.ZodString,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...V(r)})};function h0(r,e){let t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,i=parseInt(r.toFixed(s).replace(".","")),a=parseInt(e.toFixed(s).replace(".",""));return i%a/Math.pow(10,s)}var Ba=class r extends J{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==k.number){let i=this._getOrReturnCtx(e);return C(i,{code:A.invalid_type,expected:k.number,received:i.parsedType}),Z}let n,s=new Ke;for(let i of this._def.checks)i.kind==="int"?se.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{code:A.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),C(n,{code:A.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),C(n,{code:A.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?h0(e.data,i.value)!==0&&(n=this._getOrReturnCtx(e,n),C(n,{code:A.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{code:A.not_finite,message:i.message}),s.dirty()):se.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,$.toString(t))}gt(e,t){return this.setLimit("min",e,!1,$.toString(t))}lte(e,t){return this.setLimit("max",e,!0,$.toString(t))}lt(e,t){return this.setLimit("max",e,!1,$.toString(t))}setLimit(e,t,n,s){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:$.toString(s)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:$.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:$.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:$.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:$.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:$.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:$.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:$.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:$.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:$.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&se.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}};Ba.create=r=>new Ba({checks:[],typeName:v.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...V(r)});var Fa=class r extends J{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==k.bigint){let i=this._getOrReturnCtx(e);return C(i,{code:A.invalid_type,expected:k.bigint,received:i.parsedType}),Z}let n,s=new Ke;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),C(n,{code:A.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),C(n,{code:A.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),C(n,{code:A.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):se.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,$.toString(t))}gt(e,t){return this.setLimit("min",e,!1,$.toString(t))}lte(e,t){return this.setLimit("max",e,!0,$.toString(t))}lt(e,t){return this.setLimit("max",e,!1,$.toString(t))}setLimit(e,t,n,s){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:$.toString(s)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:$.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:$.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:$.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:$.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:$.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Fa.create=r=>{var e;return new Fa({checks:[],typeName:v.ZodBigInt,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...V(r)})};var Ua=class extends J{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==k.boolean){let n=this._getOrReturnCtx(e);return C(n,{code:A.invalid_type,expected:k.boolean,received:n.parsedType}),Z}return Je(e.data)}};Ua.create=r=>new Ua({typeName:v.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...V(r)});var za=class r extends J{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==k.date){let i=this._getOrReturnCtx(e);return C(i,{code:A.invalid_type,expected:k.date,received:i.parsedType}),Z}if(isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return C(i,{code:A.invalid_date}),Z}let n=new Ke,s;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),C(s,{code:A.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),C(s,{code:A.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):se.assertNever(i);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:$.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:$.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};za.create=r=>new za({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:v.ZodDate,...V(r)});var Ka=class extends J{_parse(e){if(this._getType(e)!==k.symbol){let n=this._getOrReturnCtx(e);return C(n,{code:A.invalid_type,expected:k.symbol,received:n.parsedType}),Z}return Je(e.data)}};Ka.create=r=>new Ka({typeName:v.ZodSymbol,...V(r)});var mi=class extends J{_parse(e){if(this._getType(e)!==k.undefined){let n=this._getOrReturnCtx(e);return C(n,{code:A.invalid_type,expected:k.undefined,received:n.parsedType}),Z}return Je(e.data)}};mi.create=r=>new mi({typeName:v.ZodUndefined,...V(r)});var gi=class extends J{_parse(e){if(this._getType(e)!==k.null){let n=this._getOrReturnCtx(e);return C(n,{code:A.invalid_type,expected:k.null,received:n.parsedType}),Z}return Je(e.data)}};gi.create=r=>new gi({typeName:v.ZodNull,...V(r)});var qa=class extends J{constructor(){super(...arguments),this._any=!0}_parse(e){return Je(e.data)}};qa.create=r=>new qa({typeName:v.ZodAny,...V(r)});var an=class extends J{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Je(e.data)}};an.create=r=>new an({typeName:v.ZodUnknown,...V(r)});var Xt=class extends J{_parse(e){let t=this._getOrReturnCtx(e);return C(t,{code:A.invalid_type,expected:k.never,received:t.parsedType}),Z}};Xt.create=r=>new Xt({typeName:v.ZodNever,...V(r)});var Va=class extends J{_parse(e){if(this._getType(e)!==k.undefined){let n=this._getOrReturnCtx(e);return C(n,{code:A.invalid_type,expected:k.void,received:n.parsedType}),Z}return Je(e.data)}};Va.create=r=>new Va({typeName:v.ZodVoid,...V(r)});var on=class r extends J{_parse(e){let{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==k.array)return C(t,{code:A.invalid_type,expected:k.array,received:t.parsedType}),Z;if(s.exactLength!==null){let a=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(a||o)&&(C(t,{code:a?A.too_big:A.too_small,minimum:o?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(C(t,{code:A.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(C(t,{code:A.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>s.type._parseAsync(new lt(t,a,t.path,o)))).then(a=>Ke.mergeArray(n,a));let i=[...t.data].map((a,o)=>s.type._parseSync(new lt(t,a,t.path,o)));return Ke.mergeArray(n,i)}get element(){return this._def.type}min(e,t){return new r({...this._def,minLength:{value:e,message:$.toString(t)}})}max(e,t){return new r({...this._def,maxLength:{value:e,message:$.toString(t)}})}length(e,t){return new r({...this._def,exactLength:{value:e,message:$.toString(t)}})}nonempty(e){return this.min(1,e)}};on.create=(r,e)=>new on({type:r,minLength:null,maxLength:null,exactLength:null,typeName:v.ZodArray,...V(e)});function hi(r){if(r instanceof tt){let e={};for(let t in r.shape){let n=r.shape[t];e[t]=Yt.create(hi(n))}return new tt({...r._def,shape:()=>e})}else return r instanceof on?new on({...r._def,type:hi(r.element)}):r instanceof Yt?Yt.create(hi(r.unwrap())):r instanceof un?un.create(hi(r.unwrap())):r instanceof Ar?Ar.create(r.items.map(e=>hi(e))):r}var tt=class r extends J{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=se.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==k.object){let c=this._getOrReturnCtx(e);return C(c,{code:A.invalid_type,expected:k.object,received:c.parsedType}),Z}let{status:n,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof Xt&&this._def.unknownKeys==="strip"))for(let c in s.data)a.includes(c)||o.push(c);let u=[];for(let c of a){let l=i[c],d=s.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new lt(s,d,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof Xt){let c=this._def.unknownKeys;if(c==="passthrough")for(let l of o)u.push({key:{status:"valid",value:l},value:{status:"valid",value:s.data[l]}});else if(c==="strict")o.length>0&&(C(s,{code:A.unrecognized_keys,keys:o}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let c=this._def.catchall;for(let l of o){let d=s.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new lt(s,d,s.path,l)),alwaysSet:l in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let c=[];for(let l of u){let d=await l.key;c.push({key:d,value:await l.value,alwaysSet:l.alwaysSet})}return c}).then(c=>Ke.mergeObjectSync(n,c)):Ke.mergeObjectSync(n,u)}get shape(){return this._def.shape()}strict(e){return $.errToObj,new r({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var s,i,a,o;let u=(a=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,t,n).message)!==null&&a!==void 0?a:n.defaultError;return t.code==="unrecognized_keys"?{message:(o=$.errToObj(e).message)!==null&&o!==void 0?o:u}:{message:u}}}:{}})}strip(){return new r({...this._def,unknownKeys:"strip"})}passthrough(){return new r({...this._def,unknownKeys:"passthrough"})}extend(e){return new r({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new r({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:v.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new r({...this._def,catchall:e})}pick(e){let t={};return se.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new r({...this._def,shape:()=>t})}omit(e){let t={};return se.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new r({...this._def,shape:()=>t})}deepPartial(){return hi(this)}partial(e){let t={};return se.objectKeys(this.shape).forEach(n=>{let s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}),new r({...this._def,shape:()=>t})}required(e){let t={};return se.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof Yt;)i=i._def.innerType;t[n]=i}}),new r({...this._def,shape:()=>t})}keyof(){return rg(se.objectKeys(this.shape))}};tt.create=(r,e)=>new tt({shape:()=>r,unknownKeys:"strip",catchall:Xt.create(),typeName:v.ZodObject,...V(e)});tt.strictCreate=(r,e)=>new tt({shape:()=>r,unknownKeys:"strict",catchall:Xt.create(),typeName:v.ZodObject,...V(e)});tt.lazycreate=(r,e)=>new tt({shape:r,unknownKeys:"strip",catchall:Xt.create(),typeName:v.ZodObject,...V(e)});var yi=class extends J{_parse(e){let{ctx:t}=this._processInputParams(e),n=this._def.options;function s(i){for(let o of i)if(o.result.status==="valid")return o.result;for(let o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;let a=i.map(o=>new ct(o.ctx.common.issues));return C(t,{code:A.invalid_union,unionErrors:a}),Z}if(t.common.async)return Promise.all(n.map(async i=>{let a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(s);{let i,a=[];for(let u of n){let c={...t,common:{...t.common,issues:[]},parent:null},l=u._parseSync({data:t.data,path:t.path,parent:c});if(l.status==="valid")return l;l.status==="dirty"&&!i&&(i={result:l,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;let o=a.map(u=>new ct(u));return C(t,{code:A.invalid_union,unionErrors:o}),Z}}get options(){return this._def.options}};yi.create=(r,e)=>new yi({options:r,typeName:v.ZodUnion,...V(e)});var pc=r=>r instanceof _i?pc(r.schema):r instanceof Mt?pc(r.innerType()):r instanceof wi?[r.value]:r instanceof vi?r.options:r instanceof xi?Object.keys(r.enum):r instanceof Ai?pc(r._def.innerType):r instanceof mi?[void 0]:r instanceof gi?[null]:null,Vd=class r extends J{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==k.object)return C(t,{code:A.invalid_type,expected:k.object,received:t.parsedType}),Z;let n=this.discriminator,s=t.data[n],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(C(t,{code:A.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),Z)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){let s=new Map;for(let i of t){let a=pc(i.shape[e]);if(!a)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of a){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,i)}}return new r({typeName:v.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...V(n)})}};function Zd(r,e){let t=bs(r),n=bs(e);if(r===e)return{valid:!0,data:r};if(t===k.object&&n===k.object){let s=se.objectKeys(e),i=se.objectKeys(r).filter(o=>s.indexOf(o)!==-1),a={...r,...e};for(let o of i){let u=Zd(r[o],e[o]);if(!u.valid)return{valid:!1};a[o]=u.data}return{valid:!0,data:a}}else if(t===k.array&&n===k.array){if(r.length!==e.length)return{valid:!1};let s=[];for(let i=0;i<r.length;i++){let a=r[i],o=e[i],u=Zd(a,o);if(!u.valid)return{valid:!1};s.push(u.data)}return{valid:!0,data:s}}else return t===k.date&&n===k.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var bi=class extends J{_parse(e){let{status:t,ctx:n}=this._processInputParams(e),s=(i,a)=>{if(Qm(i)||Qm(a))return Z;let o=Zd(i.value,a.value);return o.valid?((eg(i)||eg(a))&&t.dirty(),{status:t.value,value:o.data}):(C(n,{code:A.invalid_intersection_types}),Z)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};bi.create=(r,e,t)=>new bi({left:r,right:e,typeName:v.ZodIntersection,...V(t)});var Ar=class r extends J{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==k.array)return C(n,{code:A.invalid_type,expected:k.array,received:n.parsedType}),Z;if(n.data.length<this._def.items.length)return C(n,{code:A.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Z;!this._def.rest&&n.data.length>this._def.items.length&&(C(n,{code:A.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...n.data].map((a,o)=>{let u=this._def.items[o]||this._def.rest;return u?u._parse(new lt(n,a,n.path,o)):null}).filter(a=>!!a);return n.common.async?Promise.all(i).then(a=>Ke.mergeArray(t,a)):Ke.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new r({...this._def,rest:e})}};Ar.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Ar({items:r,typeName:v.ZodTuple,rest:null,...V(e)})};var Hd=class r extends J{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==k.object)return C(n,{code:A.invalid_type,expected:k.object,received:n.parsedType}),Z;let s=[],i=this._def.keyType,a=this._def.valueType;for(let o in n.data)s.push({key:i._parse(new lt(n,o,n.path,o)),value:a._parse(new lt(n,n.data[o],n.path,o))});return n.common.async?Ke.mergeObjectAsync(t,s):Ke.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof J?new r({keyType:e,valueType:t,typeName:v.ZodRecord,...V(n)}):new r({keyType:pi.create(),valueType:e,typeName:v.ZodRecord,...V(t)})}},Za=class extends J{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==k.map)return C(n,{code:A.invalid_type,expected:k.map,received:n.parsedType}),Z;let s=this._def.keyType,i=this._def.valueType,a=[...n.data.entries()].map(([o,u],c)=>({key:s._parse(new lt(n,o,n.path,[c,"key"])),value:i._parse(new lt(n,u,n.path,[c,"value"]))}));if(n.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let u of a){let c=await u.key,l=await u.value;if(c.status==="aborted"||l.status==="aborted")return Z;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}})}else{let o=new Map;for(let u of a){let c=u.key,l=u.value;if(c.status==="aborted"||l.status==="aborted")return Z;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}}}};Za.create=(r,e,t)=>new Za({valueType:e,keyType:r,typeName:v.ZodMap,...V(t)});var Ha=class r extends J{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==k.set)return C(n,{code:A.invalid_type,expected:k.set,received:n.parsedType}),Z;let s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(C(n,{code:A.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(C(n,{code:A.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());let i=this._def.valueType;function a(u){let c=new Set;for(let l of u){if(l.status==="aborted")return Z;l.status==="dirty"&&t.dirty(),c.add(l.value)}return{status:t.value,value:c}}let o=[...n.data.values()].map((u,c)=>i._parse(new lt(n,u,n.path,c)));return n.common.async?Promise.all(o).then(u=>a(u)):a(o)}min(e,t){return new r({...this._def,minSize:{value:e,message:$.toString(t)}})}max(e,t){return new r({...this._def,maxSize:{value:e,message:$.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Ha.create=(r,e)=>new Ha({valueType:r,minSize:null,maxSize:null,typeName:v.ZodSet,...V(e)});var Gd=class r extends J{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==k.function)return C(t,{code:A.invalid_type,expected:k.function,received:t.parsedType}),Z;function n(o,u){return Kd({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,zd(),mc].filter(c=>!!c),issueData:{code:A.invalid_arguments,argumentsError:u}})}function s(o,u){return Kd({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,zd(),mc].filter(c=>!!c),issueData:{code:A.invalid_return_type,returnTypeError:u}})}let i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof _s){let o=this;return Je(async function(...u){let c=new ct([]),l=await o._def.args.parseAsync(u,i).catch(h=>{throw c.addIssue(n(u,h)),c}),d=await Reflect.apply(a,this,l);return await o._def.returns._def.type.parseAsync(d,i).catch(h=>{throw c.addIssue(s(d,h)),c})})}else{let o=this;return Je(function(...u){let c=o._def.args.safeParse(u,i);if(!c.success)throw new ct([n(u,c.error)]);let l=Reflect.apply(a,this,c.data),d=o._def.returns.safeParse(l,i);if(!d.success)throw new ct([s(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r({...this._def,args:Ar.create(e).rest(an.create())})}returns(e){return new r({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new r({args:e||Ar.create([]).rest(an.create()),returns:t||an.create(),typeName:v.ZodFunction,...V(n)})}},_i=class extends J{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};_i.create=(r,e)=>new _i({getter:r,typeName:v.ZodLazy,...V(e)});var wi=class extends J{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return C(t,{received:t.data,code:A.invalid_literal,expected:this._def.value}),Z}return{status:"valid",value:e.data}}get value(){return this._def.value}};wi.create=(r,e)=>new wi({value:r,typeName:v.ZodLiteral,...V(e)});function rg(r,e){return new vi({values:r,typeName:v.ZodEnum,...V(e)})}var vi=class r extends J{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),n=this._def.values;return C(t,{expected:se.joinValues(n),received:t.parsedType,code:A.invalid_type}),Z}if(this._def.values.indexOf(e.data)===-1){let t=this._getOrReturnCtx(e),n=this._def.values;return C(t,{received:t.data,code:A.invalid_enum_value,options:n}),Z}return Je(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e){return r.create(e)}exclude(e){return r.create(this.options.filter(t=>!e.includes(t)))}};vi.create=rg;var xi=class extends J{_parse(e){let t=se.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==k.string&&n.parsedType!==k.number){let s=se.objectValues(t);return C(n,{expected:se.joinValues(s),received:n.parsedType,code:A.invalid_type}),Z}if(t.indexOf(e.data)===-1){let s=se.objectValues(t);return C(n,{received:n.data,code:A.invalid_enum_value,options:s}),Z}return Je(e.data)}get enum(){return this._def.values}};xi.create=(r,e)=>new xi({values:r,typeName:v.ZodNativeEnum,...V(e)});var _s=class extends J{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==k.promise&&t.common.async===!1)return C(t,{code:A.invalid_type,expected:k.promise,received:t.parsedType}),Z;let n=t.parsedType===k.promise?t.data:Promise.resolve(t.data);return Je(n.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}};_s.create=(r,e)=>new _s({type:r,typeName:v.ZodPromise,...V(e)});var Mt=class extends J{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===v.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:a=>{C(n,a),a.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){let a=s.transform(n.data,i);return n.common.issues.length?{status:"dirty",value:n.data}:n.common.async?Promise.resolve(a).then(o=>this._def.schema._parseAsync({data:o,path:n.path,parent:n})):this._def.schema._parseSync({data:a,path:n.path,parent:n})}if(s.type==="refinement"){let a=o=>{let u=s.refinement(o,i);if(n.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){let o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?Z:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?Z:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!gc(a))return a;let o=s.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>gc(a)?Promise.resolve(s.transform(a.value,i)).then(o=>({status:t.value,value:o})):a);se.assertNever(s)}};Mt.create=(r,e,t)=>new Mt({schema:r,typeName:v.ZodEffects,effect:e,...V(t)});Mt.createWithPreprocess=(r,e,t)=>new Mt({schema:e,effect:{type:"preprocess",transform:r},typeName:v.ZodEffects,...V(t)});var Yt=class extends J{_parse(e){return this._getType(e)===k.undefined?Je(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Yt.create=(r,e)=>new Yt({innerType:r,typeName:v.ZodOptional,...V(e)});var un=class extends J{_parse(e){return this._getType(e)===k.null?Je(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};un.create=(r,e)=>new un({innerType:r,typeName:v.ZodNullable,...V(e)});var Ai=class extends J{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return t.parsedType===k.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Ai.create=(r,e)=>new Ai({innerType:r,typeName:v.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...V(e)});var Ga=class extends J{_parse(e){let{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return qd(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new ct(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new ct(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Ga.create=(r,e)=>new Ga({innerType:r,typeName:v.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...V(e)});var Ja=class extends J{_parse(e){if(this._getType(e)!==k.nan){let n=this._getOrReturnCtx(e);return C(n,{code:A.invalid_type,expected:k.nan,received:n.parsedType}),Z}return{status:"valid",value:e.data}}};Ja.create=r=>new Ja({typeName:v.ZodNaN,...V(r)});var iL=Symbol("zod_brand"),Jd=class extends J{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}},yc=class r extends J{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?Z:i.status==="dirty"?(t.dirty(),r0(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{let s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?Z:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new r({in:e,out:t,typeName:v.ZodPipeline})}},Wa=class extends J{_parse(e){let t=this._def.innerType._parse(e);return gc(t)&&(t.value=Object.freeze(t.value)),t}};Wa.create=(r,e)=>new Wa({innerType:r,typeName:v.ZodReadonly,...V(e)});var aL={object:tt.lazycreate},v;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(v||(v={}));var oL=pi.create,uL=Ba.create,cL=Ja.create,lL=Fa.create,dL=Ua.create,fL=za.create,hL=Ka.create,pL=mi.create,mL=gi.create,gL=qa.create,yL=an.create,bL=Xt.create,_L=Va.create,wL=on.create,vL=tt.create,xL=tt.strictCreate,AL=yi.create,OL=Vd.create,EL=bi.create,SL=Ar.create,TL=Hd.create,PL=Za.create,kL=Ha.create,IL=Gd.create,CL=_i.create,NL=wi.create,RL=vi.create,jL=xi.create,$L=_s.create,ML=Mt.create,LL=Yt.create,DL=un.create,BL=Mt.createWithPreprocess,FL=yc.create;function ng(){return{}}function sg(r,e){var n,s;let t={type:"array"};return((s=(n=r.type)==null?void 0:n._def)==null?void 0:s.typeName)!==v.ZodAny&&(t.items=B(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&Q(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&Q(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(Q(t,"minItems",r.exactLength.value,r.exactLength.message,e),Q(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function ig(r,e){let t={type:"integer",format:"int64"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Q(t,"minimum",n.value,n.message,e):Q(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Q(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Q(t,"maximum",n.value,n.message,e):Q(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Q(t,"maximum",n.value,n.message,e));break;case"multipleOf":Q(t,"multipleOf",n.value,n.message,e);break}return t}function ag(){return{type:"boolean"}}function og(r,e){return B(r.type._def,e)}var ug=(r,e)=>B(r.innerType._def,e);function cg(r,e){return e.dateStrategy=="integer"?p0(r,e):{type:"string",format:"date-time"}}var p0=(r,e)=>{let t={type:"integer",format:"unix-time"};for(let n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"&&Q(t,"minimum",n.value,n.message,e);break;case"max":e.target==="jsonSchema7"&&Q(t,"maximum",n.value,n.message,e);break}return t};function lg(r,e){return{...B(r.innerType._def,e),default:r.defaultValue()}}function dg(r,e){return e.effectStrategy==="input"?B(r.schema._def,e):{}}function fg(r){return{type:"string",enum:r.values}}var m0=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function hg(r,e){let t=[B(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),B(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,s=[];return t.forEach(i=>{if(m0(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(n=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){let{additionalProperties:o,...u}=i;a=u}else n=void 0;s.push(a)}}),s.length?{allOf:s,...n}:void 0}function pg(r,e){let t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}var Ya={cuid:"^[cC][^\\s-]{8,}$",cuid2:"^[a-z][a-z0-9]*$",ulid:"^[0-9A-HJKMNP-TV-Z]{26}$",email:"^(?!\\.)(?!.*\\.\\.)([a-zA-Z0-9_+-\\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\\-]*\\.)+[a-zA-Z]{2,}$",emoji:"^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",uuid:"^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$",ipv4:"^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$",ipv6:"^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$"};function bc(r,e){let t={type:"string"};function n(s){return e.patternStrategy==="escape"?g0(s):s}if(r.checks)for(let s of r.checks)switch(s.kind){case"min":Q(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e);break;case"max":Q(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":ws(t,"email",s.message,e);break;case"format:idn-email":ws(t,"idn-email",s.message,e);break;case"pattern:zod":Or(t,Ya.email,s.message,e);break}break;case"url":ws(t,"uri",s.message,e);break;case"uuid":ws(t,"uuid",s.message,e);break;case"regex":Or(t,s.regex.source,s.message,e);break;case"cuid":Or(t,Ya.cuid,s.message,e);break;case"cuid2":Or(t,Ya.cuid2,s.message,e);break;case"startsWith":Or(t,"^"+n(s.value),s.message,e);break;case"endsWith":Or(t,n(s.value)+"$",s.message,e);break;case"datetime":ws(t,"date-time",s.message,e);break;case"length":Q(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e),Q(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"includes":{Or(t,n(s.value),s.message,e);break}case"ip":{s.version!=="v6"&&ws(t,"ipv4",s.message,e),s.version!=="v4"&&ws(t,"ipv6",s.message,e);break}case"emoji":Or(t,Ya.emoji,s.message,e);break;case"ulid":{Or(t,Ya.ulid,s.message,e);break}case"toLowerCase":case"toUpperCase":case"trim":break;default:}return t}var g0=r=>Array.from(r).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),ws=(r,e,t,n)=>{var s;r.format||(s=r.anyOf)!=null&&s.some(i=>i.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):Q(r,"format",e,t,n)},Or=(r,e,t,n)=>{var s;r.pattern||(s=r.allOf)!=null&&s.some(i=>i.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:e,...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):Q(r,"pattern",e,t,n)};function _c(r,e){var n,s,i,a,o;if(e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===v.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((u,c)=>{var l;return{...u,[c]:(l=B(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",c]}))!=null?l:{}}},{}),additionalProperties:!1};let t={type:"object",additionalProperties:(s=B(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]}))!=null?s:{}};if(e.target==="openApi3")return t;if(((i=r.keyType)==null?void 0:i._def.typeName)===v.ZodString&&((a=r.keyType._def.checks)!=null&&a.length)){let u=Object.entries(bc(r.keyType._def,e)).reduce((c,[l,d])=>l==="type"?c:{...c,[l]:d},{});return{...t,propertyNames:u}}else if(((o=r.keyType)==null?void 0:o._def.typeName)===v.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};return t}function mg(r,e){if(e.mapStrategy==="record")return _c(r,e);let t=B(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=B(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function gg(r){let e=r.values,n=Object.keys(r.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(n.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function yg(){return{not:{}}}function bg(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var Xa={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function wg(r,e){if(e.target==="openApi3")return _g(r,e);let t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in Xa&&(!n._def.checks||!n._def.checks.length))){let n=t.reduce((s,i)=>{let a=Xa[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=t.reduce((s,i)=>{let a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){let s=n.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(i=>!n.includes(i))],[])};return _g(r,e)}var _g=(r,e)=>{let t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>B(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function vg(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:Xa[r.innerType._def.typeName],nullable:!0}:{type:[Xa[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=B(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}let t=B(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function xg(r,e){let t={type:"number"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"int":t.type="integer",Fd(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Q(t,"minimum",n.value,n.message,e):Q(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Q(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Q(t,"maximum",n.value,n.message,e):Q(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Q(t,"maximum",n.value,n.message,e));break;case"multipleOf":Q(t,"multipleOf",n.value,n.message,e);break}return t}function Ag(r,e){var n;let t={type:"object",...Object.entries(r.shape()).reduce((s,[i,a])=>{if(a===void 0||a._def===void 0)return s;let o=B(a._def,{...e,currentPath:[...e.currentPath,"properties",i],propertyPath:[...e.currentPath,"properties",i]});return o===void 0?s:{properties:{...s.properties,[i]:o},required:a.isOptional()?s.required:[...s.required,i]}},{properties:{},required:[]}),additionalProperties:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":(n=B(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]}))!=null?n:!0};return t.required.length||delete t.required,t}var Og=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return B(r.innerType._def,e);let t=B(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}};var Eg=(r,e)=>{if(e.pipeStrategy==="input")return B(r.in._def,e);if(e.pipeStrategy==="output")return B(r.out._def,e);let t=B(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=B(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function Sg(r,e){return B(r.type._def,e)}function Tg(r,e){let n={type:"array",uniqueItems:!0,items:B(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&Q(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&Q(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function Pg(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>B(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:B(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>B(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function kg(){return{not:{}}}function Ig(){return{}}var Cg=(r,e)=>B(r.innerType._def,e);function B(r,e,t=!1){let n=e.seen.get(r);if(n&&!t){let a=y0(n,e);if(a!==void 0)return a}let s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);let i=_0(r,r.typeName,e);return i&&w0(r,e,i),s.jsonSchema=i,i}var y0=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:b0(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((t,n)=>e.currentPath[n]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},b0=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},_0=(r,e,t)=>{switch(e){case v.ZodString:return bc(r,t);case v.ZodNumber:return xg(r,t);case v.ZodObject:return Ag(r,t);case v.ZodBigInt:return ig(r,t);case v.ZodBoolean:return ag();case v.ZodDate:return cg(r,t);case v.ZodUndefined:return kg();case v.ZodNull:return bg(t);case v.ZodArray:return sg(r,t);case v.ZodUnion:case v.ZodDiscriminatedUnion:return wg(r,t);case v.ZodIntersection:return hg(r,t);case v.ZodTuple:return Pg(r,t);case v.ZodRecord:return _c(r,t);case v.ZodLiteral:return pg(r,t);case v.ZodEnum:return fg(r);case v.ZodNativeEnum:return gg(r);case v.ZodNullable:return vg(r,t);case v.ZodOptional:return Og(r,t);case v.ZodMap:return mg(r,t);case v.ZodSet:return Tg(r,t);case v.ZodLazy:return B(r.getter()._def,t);case v.ZodPromise:return Sg(r,t);case v.ZodNaN:case v.ZodNever:return yg();case v.ZodEffects:return dg(r,t);case v.ZodAny:return ng();case v.ZodUnknown:return Ig();case v.ZodDefault:return lg(r,t);case v.ZodBranded:return og(r,t);case v.ZodReadonly:return Cg(r,t);case v.ZodCatch:return ug(r,t);case v.ZodPipeline:return Eg(r,t);case v.ZodFunction:case v.ZodVoid:case v.ZodSymbol:return;default:return(n=>{})(e)}},w0=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t);var Ng=r=>{let e=Ym(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};var wc=(r,e)=>{var o;let t=Ng(e),n=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((u,[c,l])=>{var d;return{...u,[c]:(d=B(l._def,{...t,currentPath:[...t.basePath,t.definitionPath,c]},!0))!=null?d:{}}},{}):void 0,s=typeof e=="string"?e:e==null?void 0:e.name,i=(o=B(r._def,s===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,s]},!1))!=null?o:{},a=s===void 0?n?{...i,[t.definitionPath]:n}:i:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...n,[s]:i}};return t.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),a};function Qa(r){let{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:n,azureOpenAIBasePath:s,baseURL:i}=r;if(n&&s&&e)return`${s}/${e}`;if(n){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return i}function eo(r){let e;return r.constructor.name===qm.name?(e=new Error(r.message),e.name="TimeoutError"):r.constructor.name===Vm.name?(e=new Error(r.message),e.name="AbortError"):e=r,e}function v0(r){return r.anyOf!==void 0&&Array.isArray(r.anyOf)}function Rg(r){var t;let e=["namespace functions {",""];for(let n of r)n.description&&e.push(`// ${n.description}`),Object.keys((t=n.parameters.properties)!=null?t:{}).length>0?(e.push(`type ${n.name} = (_: {`),e.push(jg(n.parameters,0)),e.push("}) => any;")):e.push(`type ${n.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function jg(r,e){var n,s;let t=[];for(let[i,a]of Object.entries((n=r.properties)!=null?n:{}))a.description&&e<2&&t.push(`// ${a.description}`),(s=r.required)!=null&&s.includes(i)?t.push(`${i}: ${vc(a,e)},`):t.push(`${i}?: ${vc(a,e)},`);return t.map(i=>" ".repeat(e)+i).join(`
`)}function vc(r,e){if(v0(r))return r.anyOf.map(t=>vc(t,e)).join(" | ");switch(r.type){case"string":return r.enum?r.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",jg(r,e+2),"}"].join(`
`);case"array":return r.items?`${vc(r.items,e)}[]`:"any[]";default:return""}}function x0(r){return r.role!=="system"&&r.role!=="assistant"&&r.role!=="user"&&r.role!=="function"&&r.role!=="tool"&&console.warn(`Unknown message role: ${r.role}`),r.role}function Lg(r){let e=r._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Rr.isInstance(r))throw new Error("Invalid generic chat message");return x0(r)}default:throw new Error(`Unknown message type: ${e}`)}}function A0(r){var e;switch(r.role){case"assistant":return new Ne(r.content||"",{function_call:r.function_call,tool_calls:r.tool_calls});default:return new Rr(r.content||"",(e=r.role)!=null?e:"unknown")}}function O0(r,e){var i,a;let t=(i=r.role)!=null?i:e,n=(a=r.content)!=null?a:"",s;return r.function_call?s={function_call:r.function_call}:r.tool_calls?s={tool_calls:r.tool_calls}:s={},t==="user"?new Gi({content:n}):t==="assistant"?new ir({content:n,additional_kwargs:s}):t==="system"?new Ji({content:n}):t==="function"?new Wi({content:n,additional_kwargs:s,name:r.name}):t==="tool"?new Fo({content:n,additional_kwargs:s,tool_call_id:r.tool_call_id}):new Yi({content:n,role:t})}function $g(r){return r.map(e=>({role:Lg(e),content:e.content,name:e.name,function_call:e.additional_kwargs.function_call,tool_calls:e.additional_kwargs.tool_calls,tool_call_id:e.tool_call_id}))}var to=class extends Gs{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){var n,s,i,a,o,u,c,l,d,f,h,p,m,g,y,b,O,E,T,_,F,S,M,te,ie,rt,Ee;if(super(e!=null?e:{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(n=e==null?void 0:e.openAIApiKey)!=null?n:ae("OPENAI_API_KEY"),this.azureOpenAIApiKey=(s=e==null?void 0:e.azureOpenAIApiKey)!=null?s:ae("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=(i=e==null?void 0:e.azureOpenAIApiInstanceName)!=null?i:ae("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=(a=e==null?void 0:e.azureOpenAIApiDeploymentName)!=null?a:ae("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=(o=e==null?void 0:e.azureOpenAIApiVersion)!=null?o:ae("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=(u=e==null?void 0:e.azureOpenAIBasePath)!=null?u:ae("AZURE_OPENAI_BASE_PATH"),this.organization=(l=(c=e==null?void 0:e.configuration)==null?void 0:c.organization)!=null?l:ae("OPENAI_ORGANIZATION"),this.modelName=(d=e==null?void 0:e.modelName)!=null?d:this.modelName,this.modelKwargs=(f=e==null?void 0:e.modelKwargs)!=null?f:{},this.timeout=e==null?void 0:e.timeout,this.temperature=(h=e==null?void 0:e.temperature)!=null?h:this.temperature,this.topP=(p=e==null?void 0:e.topP)!=null?p:this.topP,this.frequencyPenalty=(m=e==null?void 0:e.frequencyPenalty)!=null?m:this.frequencyPenalty,this.presencePenalty=(g=e==null?void 0:e.presencePenalty)!=null?g:this.presencePenalty,this.maxTokens=e==null?void 0:e.maxTokens,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(y=e==null?void 0:e.n)!=null?y:this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=e==null?void 0:e.stop,this.user=e==null?void 0:e.user,this.streaming=(b=e==null?void 0:e.streaming)!=null?b:!1,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.openAIApiKey=(O=this.openAIApiKey)!=null?O:""}this.clientConfig={apiKey:this.openAIApiKey,organization:this.organization,baseURL:(T=t==null?void 0:t.basePath)!=null?T:(E=e==null?void 0:e.configuration)==null?void 0:E.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:(M=(_=t==null?void 0:t.baseOptions)==null?void 0:_.headers)!=null?M:(S=(F=e==null?void 0:e.configuration)==null?void 0:F.baseOptions)==null?void 0:S.headers,defaultQuery:(Ee=(te=t==null?void 0:t.baseOptions)==null?void 0:te.params)!=null?Ee:(rt=(ie=e==null?void 0:e.configuration)==null?void 0:ie.baseOptions)==null?void 0:rt.params,...t,...e==null?void 0:e.configuration}}invocationParams(e){var s;function t(i){return i!==void 0&&i.every(a=>Array.isArray(a.lc_namespace))}return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(s=e==null?void 0:e.stop)!=null?s:this.stop,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:t(e==null?void 0:e.tools)?e==null?void 0:e.tools.map(Dd):e==null?void 0:e.tools,tool_choice:e==null?void 0:e.tool_choice,response_format:e==null?void 0:e.response_format,seed:e==null?void 0:e.seed,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,n){var u,c,l,d,f;let s=$g(e),i={...this.invocationParams(t),messages:s,stream:!0},a,o=await this.completionWithRetry(i,t);for await(let h of o){let p=h==null?void 0:h.choices[0];if(!p)continue;let{delta:m}=p;if(!m)continue;let g=O0(m,a);a=(u=m.role)!=null?u:a;let y={prompt:(c=t.promptIndex)!=null?c:0,completion:(l=p.index)!=null?l:0};if(typeof g.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}let b={...y};p.finish_reason!==void 0&&(b.finish_reason=p.finish_reason),this.logprobs&&(b.logprobs=p.logprobs);let O=new ar({message:g,text:g.content,generationInfo:b});yield O,n==null||n.handleLLMNewToken((d=O.text)!=null?d:"",y,void 0,void 0,void 0,{chunk:O})}if((f=t.signal)!=null&&f.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,n){var o,u,c,l,d,f,h,p,m,g;let s={},i=this.invocationParams(t),a=$g(e);if(i.stream){let y=this._streamResponseChunks(e,t,n),b={};for await(let S of y){S.message.response_metadata={...S.generationInfo,...S.message.response_metadata};let M=(u=(o=S.generationInfo)==null?void 0:o.completion)!=null?u:0;b[M]===void 0?b[M]=S:b[M]=b[M].concat(S)}let O=Object.entries(b).sort(([S],[M])=>parseInt(S,10)-parseInt(M,10)).map(([S,M])=>M),{functions:E,function_call:T}=this.invocationParams(t),_=await this.getEstimatedTokenCountFromPrompt(e,E,T),F=await this.getNumTokensFromGenerations(O);return s.promptTokens=_,s.completionTokens=F,s.totalTokens=_+F,{generations:O,llmOutput:{estimatedTokenUsage:s}}}else{let y=await this.completionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}),{completion_tokens:b,prompt_tokens:O,total_tokens:E}=(c=y==null?void 0:y.usage)!=null?c:{};b&&(s.completionTokens=((l=s.completionTokens)!=null?l:0)+b),O&&(s.promptTokens=((d=s.promptTokens)!=null?d:0)+O),E&&(s.totalTokens=((f=s.totalTokens)!=null?f:0)+E);let T=[];for(let _ of(h=y==null?void 0:y.choices)!=null?h:[]){let S={text:(m=(p=_.message)==null?void 0:p.content)!=null?m:"",message:A0((g=_.message)!=null?g:{role:"assistant"})};S.generationInfo={..._.finish_reason?{finish_reason:_.finish_reason}:{},..._.logprobs?{logprobs:_.logprobs}:{}},T.push(S)}return{generations:T,llmOutput:{tokenUsage:s}}}}async getEstimatedTokenCountFromPrompt(e,t,n){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&n!=="auto"){let i=Rg(t);s+=await this.getNumTokens(i),s+=9}return t&&e.find(i=>i._getType()==="system")&&(s-=4),n==="none"?s+=1:typeof n=="object"&&(s+=await this.getNumTokens(n.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async n=>{var s;return(s=n.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([n.message])).countPerMessage[0]:await this.getNumTokens(n.message.content)}))).reduce((n,s)=>n+s,0)}async getNumTokensFromMessages(e){let t=0,n=0,s=0;this.modelName==="gpt-3.5-turbo-0301"?(n=4,s=-1):(n=3,s=1);let i=await Promise.all(e.map(async a=>{var f,h,p,m,g,y;let o=await this.getNumTokens(a.content),u=await this.getNumTokens(Lg(a)),c=a.name!==void 0?s+await this.getNumTokens(a.name):0,l=o+n+u+c,d=a;if(d._getType()==="function"&&(l-=2),(f=d.additional_kwargs)!=null&&f.function_call&&(l+=3),(h=d==null?void 0:d.additional_kwargs.function_call)!=null&&h.name&&(l+=await this.getNumTokens((p=d.additional_kwargs.function_call)==null?void 0:p.name)),(m=d.additional_kwargs.function_call)!=null&&m.arguments)try{l+=await this.getNumTokens(JSON.stringify(JSON.parse((g=d.additional_kwargs.function_call)==null?void 0:g.arguments)))}catch(b){console.error("Error parsing function arguments",b,JSON.stringify(d.additional_kwargs.function_call)),l+=await this.getNumTokens((y=d.additional_kwargs.function_call)==null?void 0:y.arguments)}return t+=l,l}));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){let n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,n)}catch(s){throw eo(s)}})}_getClientOptions(e){if(!this.client){let n={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},s=Qa(n),i={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new fe(i)}let t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,n)=>{var s,i,a;return n&&n.tokenUsage&&(t.tokenUsage.completionTokens+=(s=n.tokenUsage.completionTokens)!=null?s:0,t.tokenUsage.promptTokens+=(i=n.tokenUsage.promptTokens)!=null?i:0,t.tokenUsage.totalTokens+=(a=n.tokenUsage.totalTokens)!=null?a:0),t},{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){var f;let n,s,i,a;E0(e)?(n=e.schema,s=e.name,i=e.method,a=e.includeRaw):(n=e,s=t==null?void 0:t.name,i=t==null?void 0:t.method,a=t==null?void 0:t.includeRaw);let o,u;if(i==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),Mg(n)?u=fc.fromZodSchema(n):u=new hc;else{let h=s!=null?s:"extract";if(Mg(n)){let p=wc(n);o=this.bind({tools:[{type:"function",function:{name:h,description:p.description,parameters:p}}],tool_choice:{type:"function",function:{name:h}}}),u=new Da({returnSingle:!0,keyName:h,zodSchema:n})}else{let p;typeof n.name=="string"&&typeof n.parameters=="object"&&n.parameters!=null?(p=n,h=n.name):p={name:h,description:(f=n.description)!=null?f:"",parameters:n},o=this.bind({tools:[{type:"function",function:p}],tool_choice:{type:"function",function:{name:h}}}),u=new Da({returnSingle:!0,keyName:h})}}if(!a)return o.pipe(u);let c=gs.assign({parsed:(h,p)=>u.invoke(h.raw,p)}),l=gs.assign({parsed:()=>null}),d=c.withFallbacks({fallbacks:[l]});return Zs.from([{raw:o},d])}};function Mg(r){return typeof(r==null?void 0:r.parse)=="function"}function E0(r){return r!==void 0&&typeof r.schema=="object"}var Wd=class extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}},Yd=class extends va{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e!=null?e:{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1})}async invoke(e,t){return this.call(e,oe(t))}async call(e,t,n){let s;try{s=await this.schema.parseAsync(e)}catch(c){throw new Wd("Received tool input did not match expected schema",JSON.stringify(e))}let i=Ap(t),a=await Oe.configure(i.callbacks,this.callbacks,i.tags||n,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),o=await(a==null?void 0:a.handleToolStart(this.toJSON(),typeof s=="string"?s:JSON.stringify(s),void 0,void 0,void 0,void 0,i.runName)),u;try{u=await this._call(s,o,i)}catch(c){throw await(o==null?void 0:o.handleToolError(c)),c}return await(o==null?void 0:o.handleToolEnd(u)),u}},xc=class extends Yd{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:dr.object({input:dr.string().optional()}).transform(t=>t.input)})}call(e,t){return super.call(typeof e=="string"||!e?{input:e}:e,t)}};var Xd=class extends xc{static lc_name(){return"DallEAPIWrapper"}constructor(e){var i,a,o,u,c,l,d,f;super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A wrapper around OpenAI DALL-E API. Useful for when you need to generate images from a text description. Input should be an image description."}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"dall-e-3"}),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:"vivid"}),Object.defineProperty(this,"quality",{enumerable:!0,configurable:!0,writable:!0,value:"standard"}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:"1024x1024"}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"url"}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=(i=e==null?void 0:e.openAIApiKey)!=null?i:ae("OPENAI_API_KEY"),n=(a=e==null?void 0:e.organization)!=null?a:ae("OPENAI_ORGANIZATION"),s={apiKey:t,organization:n,dangerouslyAllowBrowser:!0};this.client=new fe(s),this.modelName=(o=e==null?void 0:e.modelName)!=null?o:this.modelName,this.style=(u=e==null?void 0:e.style)!=null?u:this.style,this.quality=(c=e==null?void 0:e.quality)!=null?c:this.quality,this.n=(l=e==null?void 0:e.n)!=null?l:this.n,this.size=(d=e==null?void 0:e.size)!=null?d:this.size,this.responseFormat=(f=e==null?void 0:e.responseFormat)!=null?f:this.responseFormat,this.user=e==null?void 0:e.user}async _call(e){let t=await this.client.images.generate({model:this.modelName,prompt:e,n:this.n,size:this.size,response_format:this.responseFormat,style:this.style,quality:this.quality,user:this.user}),n="";return this.responseFormat==="url"?[n]=t.data.map(s=>s.url).filter(s=>s!=="undefined"):[n]=t.data.map(s=>s.b64_json).filter(s=>s!=="undefined"),n}};Object.defineProperty(Xd,"toolName",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"});var vs={},Dg=r=>{vs[r]&&delete vs[r]};var cn=r=>{switch(r.modelId=JSON.stringify(r),!0){case r.modelName.contains("gpt"):vs[r.modelId]||(vs[r.modelId]=new to({openAIApiKey:r.apiKey,modelName:r.modelName,maxRetries:2,timeout:5e3,topP:r.topP,presencePenalty:r.topK,temperature:r.temperature}));break;case r.modelName.contains("gemini"):vs[r.modelId]||(vs[r.modelId]=new Mu({apiKey:r.apiKey,modelName:r.modelName,topK:r.topK,topP:r.topP,temperature:r.temperature,maxRetries:2,safetySettings:[{category:wn.HARM_CATEGORY_DANGEROUS_CONTENT,threshold:vn.BLOCK_NONE},{category:wn.HARM_CATEGORY_HARASSMENT,threshold:vn.BLOCK_NONE},{category:wn.HARM_CATEGORY_HATE_SPEECH,threshold:vn.BLOCK_NONE},{category:wn.HARM_CATEGORY_SEXUALLY_EXPLICIT,threshold:vn.BLOCK_NONE}]}));break}return vs[r.modelId]};var Ac=r=>{let e=[],t;for(let n of r)t&&t._getType()===n._getType()?t.content+=`
"""
`+n.content:(e.push(n),t=n);return e};var Ec="ai-assistant-view",Oc=class extends dt.ItemView{constructor(e,t){super(e),this.plugin=t,this.resetConversation()}resetConversation(){this.messageListEl&&this.messageListEl.empty(),this.conversation=[new Se(this.plugin.settings.systemPrompt),new Ne("How can I help you?")]}async onload(){this.renderView()}renderHeader(e){let t=e.createDiv(ue.header);t.createEl("h2",{text:"Use AI",cls:ue.title});let n=t.createDiv({cls:ue.actions}),s=t.createEl("button",{cls:"clickable-icon"});(0,dt.setIcon)(s,"lucide-plus"),n.appendChild(s),this.registerDomEvent(s,"click",()=>{this.resetConversation(),this.renderMessageList(this.contentEl)});let i=t.createEl("button",{cls:"clickable-icon"});(0,dt.setIcon)(i,"lucide-settings"),n.appendChild(i),t.appendChild(n)}renderSystemMessage(e,t){e.createDiv({cls:[ue.messageItem,ue.systemMessage]}).createDiv({cls:ue.messageText,text:t.content})}renderHumanMessage(e,t){let n=e.createDiv({cls:[ue.messageItem,ue.humanMessage]});(0,dt.setIcon)(n.createDiv({cls:ue.avatar}),"lucide-user"),n.createDiv({cls:ue.messageText,text:t.content})}renderAiMessage(e,t){let n=e.createDiv({cls:[ue.messageItem,ue.aiMessage]});(0,dt.setIcon)(n.createDiv({cls:ue.avatar}),"lucide-sparkles");let s=n.createDiv({cls:ue.messageText,text:t.content});return{messageEl:n,messageTextEl:s}}renderMessageItem(e,t){switch(t._getType()){case"human":this.renderHumanMessage(e,t);break;case"ai":this.renderAiMessage(e,t);break;case"system":this.renderSystemMessage(e,t);break}this.contentEl.scrollTop=this.contentEl.scrollHeight}renderMessageList(e){this.messageListEl||(this.messageListEl=e.createDiv({cls:ue.messageList})),this.conversation.forEach(t=>{this.renderMessageItem(this.messageListEl,t)})}async generateAiMessage(){if(this.plugin.settings.models.length===0){new dt.Notice("No models found");return}let e=this.plugin.settings.models[0],t=cn(e),n=Ac(this.conversation),{messageTextEl:s}=this.renderAiMessage(this.messageListEl,new Ne("Loading..."));try{let i=await t.stream(n,{}),a="";for await(let o of i)a+=o.content,s.innerHTML=a,this.contentEl.scrollTop=this.contentEl.scrollHeight;this.conversation.push(new Ne(a))}catch(i){s.innerHTML="Error"}}async addHumanMessage(e){e=await this.resolveMessageVariables(e);let t=new Se(e);this.conversation.push(t),this.renderMessageItem(this.messageListEl,t)}async resolveMessageVariables(e){var t;if(e.includes("[[page]]")){let n=(t=this.app.workspace.getActiveFile())==null?void 0:t.path;if(!n)return e;let s=this.app.vault.getFileByPath(n);if(!s)return e;let i=n?await this.app.vault.read(s):"";i&&(e=e.replace("[[page]]",i))}if(e.includes("[[selection]]")){let n=this.app.workspace.getActiveViewOfType(dt.MarkdownView);if(!n)return e;let s=n.editor.getSelection();s&&(e=e.replace("[[selection]]",s))}return e}renderUserInputs(e){let t=e.createDiv({cls:ue.inputContainer}),n=t.createEl("div",{cls:ue.textInput});n.setAttribute("contenteditable","true"),n.setAttribute("placeholder","Type a message..."),this.registerDomEvent(n,"keydown",async u=>{let c=u.shiftKey;if(u.key==="Enter"&&!u.shiftKey&&n.innerText.trim().length>0){u.preventDefault(),n.removeAttribute("contenteditable");let l=n.innerText.trim();n.innerHTML="loading...",await this.addHumanMessage(l),await this.generateAiMessage(),n.setAttribute("contenteditable","true"),n.innerHTML=""}}),this.registerDomEvent(n,"focus",()=>{t.addClass(ue.focus)}),this.registerDomEvent(n,"blur",()=>{t.removeClass(ue.focus)});let s=t.createDiv({cls:ue.controls}),a=s.createDiv({cls:ue.attachments}).createEl("button",{cls:[ue.attachButton,"clickable-icon","side-dock-ribbon-action"]});a.innerText="[[page]]",this.registerDomEvent(a,"click",()=>{n.innerHTML+="[[page]]"});let o=s.createEl("button",{cls:[ue.sendButton,"clickable-icon","side-dock-ribbon-action"]});(0,dt.setIcon)(o,"lucide-send"),this.registerDomEvent(o,"click",async()=>{let u=n.innerText.trim();u&&(await this.addHumanMessage(u),await this.generateAiMessage(),n.innerHTML="")})}renderView(){this.contentEl.empty(),this.contentEl.addClass(ue.container),this.renderHeader(this.contentEl),this.renderMessageList(this.contentEl),this.renderUserInputs(this.contentEl)}onunload(){super.onunload()}onPaneMenu(e,t){super.onPaneMenu(e,t),e.addItem(n=>{n.setTitle("Help..."),n.setIcon("globe"),n.onClick(()=>{open("https://twitter.com/duocdev")})})}getViewType(){return Ec}getDisplayText(){return"AI Assistant"}getIcon(){return"lucide-sparkles"}};var Bg=require("obsidian"),Oi=r=>{let e=r.workspace.getActiveViewOfType(Bg.ItemView);return(e==null?void 0:e.getViewType())==="canvas"?e.canvas:null};function Sc(r,e){let t=Object.keys(e).map(n=>S0(r,n,e[n]));return t.length===1?t[0]:function(){t.forEach(n=>n())}}function S0(r,e,t){let n=r[e],s=r.hasOwnProperty(e),i=s?n:function(){return Object.getPrototypeOf(r)[e].apply(this,arguments)},a=t(i);return n&&Object.setPrototypeOf(a,n),Object.setPrototypeOf(o,a),r[e]=o,u;function o(...c){return a===i&&r[e]===o&&u(),a.apply(this,c)}function u(){r[e]===o&&(s?r[e]=i:delete r[e]),a!==i&&(a=i,Object.setPrototypeOf(o,n||Function))}}var Fg={label:"_label_nz18q_1"};var Qd=!1,ef=!1,tf=!1,T0=(r,e)=>e.menu?(r.register(Sc(e.menu.constructor.prototype,{render:t=>function(...n){let s=t.call(this,...n);if(this.menuEl.children.length===0||this.canvas.selection.size!==1)return s;let i=this.canvas.selection.values().next().value;return Object.prototype.hasOwnProperty.call(i,"path")||Object.prototype.hasOwnProperty.call(i,"bgPath")||r.events.trigger("canvas:node-menu",this,this.canvas,i),s}})),!0):!1,P0=(r,e)=>{let t=Object.getPrototypeOf(e);return r.register(Sc(t,{addNode(n){return function(...s){return n.call(this,...s)}},addEdge:n=>function(...s){var i,a;return s[0].color=(a=(i=s[0].from)==null?void 0:i.node)==null?void 0:a.color,n.call(this,...s)},showCreationMenu:n=>function(...s){let i=s[0],a=s[1];return r.events.trigger("canvas:creation-menu",i,e,a),n.call(this,...s)}})),!0},k0=(r,e)=>{let t=e.nodes;if(t.size===0)return!1;let n=Object.getPrototypeOf(t.values().next().value);return r.register(Sc(n,{render:s=>function(...i){var l,d,f;let a=s.call(this,...i),o=this;if(this.nodeEl.getAttribute("data-patched")!==null)return a;this.nodeEl.setAttribute("data-patched","true");let u=(f=(l=o.getData())==null?void 0:l.model)!=null?f:(d=o.getData())==null?void 0:d.role;if(!u)return a;let c=document.createElement("div");return c.textContent=u,c.classList.add(Fg.label),this.nodeEl.appendChild(c),a},showMenu:s=>function(...i){let a=i[0],o=this;return a.addSeparator(),a.addItem(u=>{u.setTitle("Split list to notes"),u.setIcon("lucide-list"),u.onClick(()=>{r.events.trigger("canvas:split-node",e,o)})}),s.call(this,...i)}})),!0},rf=r=>{console.log("patching all");let e=Oi(r.app);return e?(ef||(ef=T0(r,e)),Qd||(Qd=P0(r,e)),tf||(tf=k0(r,e)),tf&&Qd&&ef):!1};var Kg=require("obsidian");var ro=r=>{let e=[];for(let t=0;t<r;t++)e.push((16*Math.random()|0).toString(16));return e.join("")};var Ug=async(r,e,t,n,s)=>{if(!r)return;let i=r.getData();i&&(r.importData({edges:[...i.edges,{...s,id:e,fromNode:t.node.id,fromSide:t.side,toNode:n.node.id,toSide:n.side}],nodes:i.nodes}),await r.requestFrame())};var zg=async(r,e)=>{if(!r)return;let t=r.getData();t&&(r.importData({edges:[...t.edges,...e],nodes:t.nodes}),await r.requestFrame())};var Tc=50,Ei=80;function N0(r,e,t,n){var l,d,f,h,p,m;let s=e.x+e.width+Ei,i=e.y+e.height+Ei,a=r.getEdgesForNode(e).filter(g=>g.from.node.id==e.id&&g.from.side==t).map(g=>g.to.node),o=a.reduce((g,y)=>{switch(t){case"left":case"right":return y.y>g.y?y:g;case"top":case"bottom":return y.x>g.x?y:g}},a[0]),u=(d=(l=n==null?void 0:n.size)==null?void 0:l.width)!=null?d:500,c=(h=(f=n==null?void 0:n.size)==null?void 0:f.height)!=null?h:250;switch(t){case"left":s=o?o.x+o.width-u:e.x-u-Ei,i=o?o.y+o.height+Tc:e.y+e.height/2-c/2;break;case"right":s=(p=o==null?void 0:o.x)!=null?p:e.x+e.width+Ei,i=o?o.y+o.height+Tc:e.y+e.height/2-c/2;break;case"top":s=o?o.x+o.width+Tc:e.x+e.width/2-u/2,i=o?o.y+o.height-c:e.y-c-Ei;break;case"bottom":s=o?o.x+o.width+Tc:e.x+e.width/2-u/2,i=(m=o==null?void 0:o.y)!=null?m:e.y+e.height+Ei;break}return{x:s,y:i,width:u,height:c}}var Si=async(r,e,t,n,s)=>{var h,p,m,g;let i=r.getEdgesForNode(e).filter(y=>y.to.node.id===e.id),a="bottom",o="top";if(i.length>0){let y=i[0];y.to.side==="left"?(a="right",o="left"):y.to.side==="right"?(a="left",o="right"):y.to.side==="top"?(a="bottom",o="top"):y.to.side==="bottom"&&(a="top",o="bottom")}let{x:u,y:c,width:l,height:d}=N0(r,e,a,t),f=r.createTextNode({pos:{x:u,y:c},size:{height:(p=(h=t==null?void 0:t.size)==null?void 0:h.height)!=null?p:d,width:(g=(m=t==null?void 0:t.size)==null?void 0:m.width)!=null?g:l},text:t==null?void 0:t.text,focus:!1});return n&&f.setData(n),r.deselectAll(),r.addNode(f),await Ug(r,ro(16),{side:a,node:e},{side:o,node:f},s),f};var qg=async(r,e)=>{let t=Oi(r);if(!t){new Kg.Notice("No active canvas");return}let s=t.selection.values().next().value;t.deselectAll();let i=await Si(t,s,{size:{height:50,width:250}},{role:"user"});e&&await i.setText(e),await t.requestSave(),await t.requestFrame(),setTimeout(()=>{i.startEditing()},100)};var nf=require("obsidian");var R0=(r,e,t)=>{if(e.modelName.contains("gpt"))return r.unshift(new yn(t));if(e.modelName.contains("gemini"))return r.unshift(new Se(t))},j0=async(r,e,t)=>{let n=t.getData();return Object.prototype.hasOwnProperty.call(n,"role")&&n.role==="ai"?t:t.text===""?(t.setData({...t.getData(),role:"ai"}),t):Si(r,t,{},{role:"ai"},{})},$0=async(r,e,t,n)=>{let s=cn(r);if(!s){new nf.Notice("Model not found");return}try{let i=await s.stream(e,{}),a="";for await(let o of i)a+=o.content,await t.setText(a);t.setData({...t.getData(),status:"generated"})}catch(i){await t.setText("Error: "+i.message)}finally{t.setData({...t.getData(),status:"generated"})}},M0="#2d9bd2",Vg=async(r,e,t,n,s)=>{var u;let i=await j0(n,t,s);await i.setText("Generating..."),i.setData({...i.getData(),status:"generating",model:t.modelName}),i.color=(u=t.color)!=null?u:M0,R0(e,t,r);let a=s.getData().role==="ai"&&e[e.length-1].content===s.text;e[e.length-1]._getType()==="ai"&&t.modelName.contains("gemini")&&(e[e.length-1]=new Se(e[e.length-1]),a=!1);let o=Ac(a?e.slice(0,-1):e);try{await $0(t,o,i,n)}catch(c){new nf.Notice("Failed to generate content"),await i.setText("Error: "+c.message),i.setData({...i.getData(),status:"error"})}finally{await n.requestSave(),await n.requestFrame()}};var Zg=async(r,e,t="right")=>{let n=r.getLeavesOfType(e);if(n.length>0){r.revealLeaf(n[0]);return}let s=await L0(r,e,t);s&&r.revealLeaf(s)},L0=async(r,e,t="right")=>{let n=null;switch(t){case"left":n=r.getLeftLeaf(!1);break;case"center":n=r.getLeaf(!1);break;case"right":default:n=r.getRightLeaf(!1);break}return await(n==null?void 0:n.setViewState({type:e,active:!0})),n};function D0(r){let t=r.canvas.getEdgesForNode(r).filter(n=>n.to.node.id===r.id).map(n=>n.from.node);return t.sort((n,s)=>s.x-n.x),t}async function Hg(r,e,t=D0){let n=new Set,s=[{node:r,depth:0}];for(;s.length>0;){let{node:i,depth:a}=s.shift();if(n.has(i.id))continue;if(!await e(i,a))break;n.add(i.id);let u=t(i);for(let c of u)n.has(c.id)||s.push({node:c,depth:a+1})}}var MU=pt(require("electron")),Cc=require("obsidian");function B0(r,e,t,n){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{c(n.next(l))}catch(d){a(d)}}function u(l){try{c(n.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):s(l.value).then(o,u)}c((n=n.apply(r,e||[])).next())})}var F0=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i,Gg="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36,gzip(gfe)",U0=/<text start="([^"]*)" dur="([^"]*)">([^<]*)<\/text>/g,ln=class extends Error{constructor(e){super(`[YoutubeTranscript] \u{1F6A8} ${e}`)}},sf=class extends ln{constructor(){super("YouTube is receiving too many requests from this IP and now requires solving a captcha to continue")}},af=class extends ln{constructor(e){super(`The video is no longer available (${e})`)}},Pc=class extends ln{constructor(e){super(`Transcript is disabled on this video (${e})`)}},kc=class extends ln{constructor(e){super(`No transcripts are available for this video (${e})`)}},of=class extends ln{constructor(e,t,n){super(`No transcripts are available in ${e} this video (${n}). Available languages: ${t.join(", ")}`)}},Ic=class{static fetchTranscript(e,t){var n;return B0(this,void 0,void 0,function*(){let s=this.retrieveVideoId(e),a=yield(yield fetch(`https://www.youtube.com/watch?v=${s}`,{headers:Object.assign(Object.assign({},(t==null?void 0:t.lang)&&{"Accept-Language":t.lang}),{"User-Agent":Gg})})).text(),o=a.split('"captions":');if(o.length<=1)throw a.includes('class="g-recaptcha"')?new sf:a.includes('"playabilityStatus":')?new Pc(e):new af(e);let u=(n=(()=>{try{return JSON.parse(o[1].split(',"videoDetails')[0].replace(`
`,""))}catch(h){return}})())===null||n===void 0?void 0:n.playerCaptionsTracklistRenderer;if(!u)throw new Pc(e);if(!("captionTracks"in u))throw new kc(e);if(t!=null&&t.lang&&!u.captionTracks.some(h=>h.languageCode===(t==null?void 0:t.lang)))throw new of(t==null?void 0:t.lang,u.captionTracks.map(h=>h.languageCode),e);let c=(t!=null&&t.lang?u.captionTracks.find(h=>h.languageCode===(t==null?void 0:t.lang)):u.captionTracks[0]).baseUrl,l=yield fetch(c,{headers:Object.assign(Object.assign({},(t==null?void 0:t.lang)&&{"Accept-Language":t.lang}),{"User-Agent":Gg})});if(!l.ok)throw new kc(e);return[...(yield l.text()).matchAll(U0)].map(h=>{var p;return{text:h[3],duration:parseFloat(h[2]),offset:parseFloat(h[1]),lang:(p=t==null?void 0:t.lang)!==null&&p!==void 0?p:u.captionTracks[0].languageCode}})})}static retrieveVideoId(e){if(e.length===11)return e;let t=e.match(F0);if(t&&t.length)return t[1];throw new ln("Impossible to retrieve Youtube video ID.")}};async function z0(r,e,t){var s;let n=await r.vault.read(e);if(t){let i=r.metadataCache.getFileCache(e);if(i){let a=(0,Cc.resolveSubpath)(i,t);if(!a)return console.warn("Failed to get subpath",{file:e,subpath:t}),n;if(a.start||a.end){let o=n.slice(a.start.offset,(s=a.end)==null?void 0:s.offset);return o||(console.warn("Failed to get subpath",{file:e,subpath:t}),n)}}}return n}async function K0(r){return await r.executeJavaScript("document.body.innerText")}var q0="https://get-youtube-transcript.fly.dev/transcripts/:id/?format=plain&chunk-size=3000&include-time=true";async function V0(r){var s;let e=(s=r.match(/(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([^&]+)/))==null?void 0:s[1];if(!e)throw new Error("Failed to get youtube id");let t=q0.replace(":id",e);return(await Ic.fetchTranscript(e)).reduce((i,a)=>i+a.text+`
`,"")}async function Nc(r){let e=r.app,t=r.getData();switch(t.type){case"text":return t.text;case"file":{let n=e.vault.getAbstractFileByPath(t.file);if(n instanceof Cc.TFile){let s=await e.vault.read(n);return r.subpath?await z0(e,n,t.subpath):`## ${n.basename}
${s}`}throw new Error("Failed to get file content")}case"link":{let n;if(t.url.includes("youtube.com"))n=await V0(t.url);else{let i=r.nodeEl.querySelector("webview");i&&(n=await K0(i))}return n!=null?n:t.url}}}var Jg=async r=>{let e={modelSetting:{},messages:[]};return await Hg(r,async(n,s)=>{let i=n.getData(),a=await Nc(n);if(a===void 0||(a==null?void 0:a.length)===0)return!0;switch(i.role){case"ai":e.messages.push(new Ne(a));break;case"system":e.messages.push(new yn(a));break;case"tool":break;case"model":let o=e.modelSetting.modelName!==void 0||e.modelSetting.modelId!==void 0;a.startsWith("```useModel")&&!o&&(a=a.replace("```useModel","").replace("```",""),e.modelSetting=mn(a),console.log(e.modelSetting));break;default:e.messages.push(new Se(a));break}return!0}),e.messages.reverse(),e};function Wg(r){var t;let e=mn(r);return Z0((t=e.modelName)!=null?t:e.modelId)}function Z0(r){let e=document.createElement("div"),t=document.createElement("h1");return t.textContent=r,t.style.margin="0",t.style.padding="0",e.appendChild(t),e}function Yg(r){let e=mn(r);return H0(e.name)}function H0(r){let e=document.createElement("div"),t=document.createElement("h1");return t.textContent=r,t.style.margin="0",t.style.padding="0",e.appendChild(t),e}var Xg=r=>{let e=r.split("-")[0],t=Math.random().toString(36).substring(2,15);return`${e}-${t}`};var uf=require("obsidian");var Qg=async(r,e)=>{var a;let t=await Nc(e);if(!t){new uf.Notice("No content found in the selected node");return}let n=t.split(`
`).filter(o=>o.trim()!=="");if(n.length===0){new uf.Notice("No list items found in the selected node");return}let s=r.getEdgesForNode(e).filter(o=>o.to.node.id===e.id),i=[];for(let o of n){let u=await Si(r,e,{text:o});for(let c of s)i.push({label:(a=c.label)!=null?a:"",id:ro(16),fromNode:c.from.node.id,fromSide:c.from.side,toNode:u.id,toSide:c.to.side})}i.length>0&&await zg(r,i),r.removeNode(e)};var xs=require("obsidian");var ft=require("obsidian");var ey=["#94D1BE","#EBD2B4","#DAC4F7","#32936F","#32936F","#F08A4B","#F2A541","#06BCC1"],ty=()=>ey[Math.floor(Math.random()*ey.length)];var Er={advancedField:"_advancedField_1mnnh_1",show:"_show_1mnnh_4",autoFlow:"_autoFlow_1mnnh_7"};var no=class extends ft.Modal{constructor(e,t){super(e),this.model={...t}}onOpen(){let{contentEl:e}=this;new ft.Setting(e).setName("Model ID").setDesc("This id is used to mention the model in the canvas, chat").addText(s=>{var i;return s.onChange(async a=>{this.model.modelId=a}).setValue((i=this.model.modelId)!=null?i:"")}),new ft.Setting(e).setName("Model name").setDesc("This name is used to call API").addDropdown(s=>s.onChange(async i=>{this.model.modelName=i}).addOptions({"gpt-4-0125-preview":"gpt-4-0125-preview","gpt-4-turbo-preview":"gpt-4-turbo-preview","gpt-4o":"gpt-4o","gemini-1.0-pro-001":"gemini-1.0-pro-001","gemini-1.5-pro-latest":"gemini-1.5-pro-latest","gemini-1.5-flash":"gemini-1.5-flash"}).setValue(this.model.modelName)),new ft.Setting(e).setName("API Key").addText(s=>s.setValue(this.model.apiKey).onChange(async i=>{this.model.apiKey=i})),new ft.Setting(e).setName("Advanced settings").setDesc("Only change if you know what you are doing").addToggle(s=>{s.setValue(!1).onChange(i=>{let a=e.getElementsByClassName(Er.advancedField);for(let o=0;o<a.length;o++)a[o].classList.toggle(Er.show,i)})}),new ft.Setting(e).setName("Color").setClass(Er.advancedField).setDesc("The color will be used to display the AI's response").addColorPicker(s=>{var i;return s.setValue((i=this.model.color)!=null?i:ty()).onChange(async a=>{this.model.color=a})}),new ft.Setting(e).setName("Temperature").setClass(Er.advancedField).addText(s=>{var i;return s.setValue(`${(i=this.model.temperature)!=null?i:""}`).onChange(async a=>{this.model.temperature=parseFloat(a)})}),new ft.Setting(e).setName("TopP").setClass(Er.advancedField).addText(s=>{var i;return s.setValue(`${(i=this.model.topP)!=null?i:""}`).onChange(async a=>{this.model.topP=parseFloat(a)})}),new ft.Setting(e).setName("TopK").setClass(Er.advancedField).addText(s=>{var i;return s.setValue(`${(i=this.model.topK)!=null?i:""}`).onChange(async a=>{this.model.topK=parseFloat(a)})});let t=new ft.Setting(e).setClass("hidden"),n=e.createDiv("modal-button-container");n.createEl("button",{text:"Test connection",cls:"mod-cta"}).addEventListener("click",async()=>{t.settingEl.classList.remove("hidden"),t.setName("Send a test question...");let s=cn(this.model),i="Very short explain about LLMs temperature parameter, 1 sentence.";try{let a=await s.invoke(i);t.setName("Success").setDesc(`Question: ${i}

AI Response: ${a.content}`)}catch(a){t.setName("Error").setDesc(`Error: ${a.message}`)}}),n.createEl("button",{text:"Save",cls:"mod-cta"}).addEventListener("click",async()=>{this.onSaveCb&&this.onSaveCb.call(this,this.model),this.close()})}onSave(e){return this.onSaveCb=e,this}};var cf=class extends xs.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new xs.Setting(e).setName("Models").setDesc("Currently, we support OpenAI GPT, Google Gemini").setHeading().addButton(t=>{t.setButtonText("Add model").onClick(()=>{new no(this.app,{modelName:"",modelId:"",apiKey:""}).setTitle("Add model").onSave(async n=>{this.plugin.settings.models.push(n),await this.plugin.saveSettings(),this.display()}).open()})}),this.plugin.settings.models.forEach((t,n)=>{let s=new xs.Setting(e);n>0&&s.addExtraButton(i=>{i.setIcon("arrow-up").onClick(async()=>{let a=this.plugin.settings.models[n-1];this.plugin.settings.models[n-1]=this.plugin.settings.models[n],this.plugin.settings.models[n]=a,await this.plugin.saveSettings(),this.display()}).setTooltip("Set as default")}),s.addExtraButton(i=>{i.setIcon("trash").setTooltip("Remove").onClick(async()=>{this.plugin.settings.models.splice(n,1),await this.plugin.saveSettings(),this.display()})}).setName(`${t.modelId}${n===0?" (default)":""}`).addExtraButton(i=>{i.setIcon("edit").onClick(()=>{new no(this.app,t).setTitle("Edit model").onSave(async a=>{this.plugin.settings.models[n]=a,this.plugin.events.trigger("model-update",a),await this.plugin.saveSettings(),this.display()}).open()})})}),new xs.Setting(e).setName("Default system prompt").setDesc("The system prompt sent with each request to the API.").setClass(Er.autoFlow).addTextArea(t=>{t.inputEl.rows=5,t.setValue(this.plugin.settings.systemPrompt),t.onChange(async n=>{this.plugin.settings.systemPrompt=n,await this.plugin.saveSettings()})}),new xs.Setting(e).setName("Follow me on Twitter").setDesc("@duocdev").addButton(t=>{t.setCta(),t.setButtonText("Document").onClick(()=>{window.open("https://useai.aiocean.io/")})}).addButton(t=>{t.setCta(),t.setButtonText("Follow for update").onClick(()=>{window.open("https://twitter.com/duocdev")})}).addButton(t=>{t.setCta(),t.setButtonText("Bug report").onClick(()=>{window.open("https://aiocean.atlassian.net/servicedesk/customer/portal/5")})}).addButton(t=>{t.buttonEl.outerHTML="<a href='https://paypal.me/duocnguyen' target='_blank'><img style='border:0px;height:35px;' src='https://cdn.ko-fi.com/cdn/kofi3.png?v=3' /></a>"})}},ry=cf;var lf=`
You are a critical-thinking assistant bot.
Consider the intent of my questions before responding.
Do not restate my information unless I ask for it.
Do not include caveats or disclaimers.
Use step-by-step reasoning. Be brief.`,ny={models:[],systemPrompt:lf,debug:!1};var Rc=class extends ht.Plugin{constructor(e,t,n){super(e,t),this.events=new Bo}async onload(){await this.loadSettings(),await this.migrateSettings(),this.addSettingTab(new ry(this.app,this)),this.registerCommands(),this.patchObsidian(),this.registerEvents(),this.registerView(Ec,e=>new Oc(e,this)),this.addRibbonIcon("lucide-sparkles","AI Assistant",async()=>{await Zg(this.app.workspace,Ec)}),this.registerMarkdownCodeBlockProcessor("useTool",(e,t,n)=>{let s=Yg(e);t.appendChild(s)}),this.registerMarkdownCodeBlockProcessor("useModel",(e,t,n)=>{let s=Wg(e);t.appendChild(s)})}appendAiButton(e,t,n,s){let i=createEl("button","clickable-icon gpt-menu-item"),a=(t==null?void 0:t.role)==="ai"?"Regenerate":"Ask question with AI",o=(t==null?void 0:t.role)==="ai"?"refresh-ccw":"lucide-sparkles";(0,ht.setTooltip)(i,a,{placement:"top"}),(0,ht.setIcon)(i,o),i.addEventListener("click",async()=>{this.events.trigger("canvas:node-menu:ask-question",n,s)}),e.menuEl.appendChild(i)}appendUserButton(e){let t=createEl("button","clickable-icon gpt-menu-item");(0,ht.setTooltip)(t,"add user node",{placement:"top"}),(0,ht.setIcon)(t,"message-square"),t.addEventListener("click",async()=>{await qg(this.app)}),e.menuEl.appendChild(t)}isMenuPatched(e){return e.menuEl.querySelector(".gpt-menu-item")!==null}isNodeGenerating(e){return(e==null?void 0:e.status)==="generating"}registerEvents(){this.registerEvent(this.events.on("canvas:node-menu",(e,t,n)=>{let s=n.getData();this.isMenuPatched(e)||this.isNodeGenerating(s)||(this.appendAiButton(e,s,t,n),this.appendUserButton(e))})),this.registerEvent(this.events.on("canvas:node-menu:ask-question",async(e,t)=>{let{messages:n,modelSetting:s}=await Jg(t);if(n.length===0){new ht.Notice("No messages found");return}if(this.settings.models.length>0){let i=s.modelId;if(i===void 0){let o=e.getEdgesForNode(t).filter(u=>u.to.node.id===t.id).first();i=(o==null?void 0:o.label)||void 0}i===void 0&&(i=this.settings.models[0].modelId);let a;a=this.settings.models.find(o=>o.modelId===i),s=Object.assign(s,a)}if(s.modelName===void 0||s.apiKey===void 0){new ht.Notice("Model name or API Key is missing");return}await Vg(this.settings.systemPrompt,n,s,e,t)})),this.registerEvent(this.events.on("model-update",async e=>{Dg(e.modelName)})),this.registerEvent(this.events.on("canvas:split-node",async(e,t)=>{await Qg(e,t)})),this.registerEvent(this.events.on("canvas:creation-menu",async(e,t,n)=>{e.addSeparator(),e.addItem(s=>{s.setTitle("Add prompt").setIcon("lucide-list").onClick(()=>{ih(this.app,i=>{t.createTextNode({pos:n,size:{height:150,width:300},text:i.prompt,focus:!1}).setData({role:"user"})})})}),e.addItem(s=>{s.setTitle("Add tool").setIcon("lucide-list").onClick(()=>{oh(this.app,i=>{t.createTextNode({pos:n,size:{height:50,width:200},text:i.config,focus:!1}).setData({role:"tool"})})})}),e.addItem(s=>{s.setTitle("Add model").setIcon("lucide-list").onClick(i=>{nh(this.app,this.settings.models,a=>{console.log(n),t.createTextNode({pos:n,size:{height:50,width:300},text:"```useModel\n"+ll(a)+"\n```",focus:!1}).setData({role:"model"})})})})}))}patchObsidian(){this.app.workspace.onLayoutReady(()=>{if(rf(this))return;let e=this.app.workspace.on("layout-change",()=>{rf(this)&&this.app.workspace.offref(e)});this.registerEvent(e)})}async migrateSettings(){let e=!1;this.settings.models===void 0&&(this.settings.models=[],e=!0),this.settings.systemPrompt===void 0&&(this.settings.systemPrompt=lf,e=!0);for(let t of this.settings.models)t.modelId===void 0&&(t.modelId=Xg(t.modelName),e=!0);e&&await this.saveSettings()}async loadSettings(){this.settings=Object.assign({},ny,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}registerCommands(){[{id:"split-list-to-note",name:"Split list to notes",icon:"lucide-list",checkCallback:t=>{let n=Oi(this.app);if(!n)return!1;let s=n.selection;if(s.size!==1)return!1;let i=s.values().next().value;return t||this.events.trigger("canvas:split-node",n,i),!0}},{id:"continue-writing",name:"Continue writing",editorCallback:async(t,n)=>{let s=this.settings.models[0],i=cn(s),a=t.getValue();console.log(t);try{let o=await i.stream(a,{});for await(let u of o)t.replaceRange(u.content,t.getCursor()),t.refresh()}catch(o){new ht.Notice("Error generating content")}}}].forEach(t=>this.addCommand(t))}};
/*! Bundled license information:

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@langchain/core/dist/utils/js-sha1/hash.js:
  (*
   * [js-sha1]{@link https://github.com/emn178/js-sha1}
   *
   * @version 0.6.0
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2014-2017
   * @license MIT
   *)

@langchain/core/dist/utils/fast-json-patch/src/helpers.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017-2022 Joachim Wester
   * MIT licensed
   *)

@langchain/core/dist/utils/fast-json-patch/src/duplex.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2013-2021 Joachim Wester
   * MIT license
   *)

youtube-transcript/dist/youtube-transcript.esm.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)
*/
