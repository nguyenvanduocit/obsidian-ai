var Gg=Object.create;var Ei=Object.defineProperty;var Jg=Object.getOwnPropertyDescriptor;var Wg=Object.getOwnPropertyNames;var Yg=Object.getPrototypeOf,Xg=Object.prototype.hasOwnProperty;var Qg=(r,e,t)=>e in r?Ei(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var qe=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),kc=(r,e)=>{for(var t in e)Ei(r,t,{get:e[t],enumerable:!0})},rf=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Wg(e))!Xg.call(r,s)&&s!==t&&Ei(r,s,{get:()=>e[s],enumerable:!(n=Jg(e,s))||n.enumerable});return r};var ht=(r,e,t)=>(t=r!=null?Gg(Yg(r)):{},rf(e||!r||!r.__esModule?Ei(t,"default",{value:r,enumerable:!0}):t,r)),ey=r=>rf(Ei({},"__esModule",{value:!0}),r);var Er=(r,e,t)=>(Qg(r,typeof e!="symbol"?e+"":e,t),t);var ff=qe((Y0,df)=>{"use strict";df.exports=function(r,e){if(typeof r!="string")throw new TypeError("Expected a string");return e=typeof e=="undefined"?"_":e,r.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}});var _f=qe((X0,jc)=>{"use strict";var sy=/[\p{Lu}]/u,iy=/[\p{Ll}]/u,hf=/^[\p{Lu}](?![\p{Lu}])/gu,gf=/([\p{Alpha}\p{N}_]|$)/u,yf=/[_.\- ]+/,ay=new RegExp("^"+yf.source),pf=new RegExp(yf.source+gf.source,"gu"),mf=new RegExp("\\d+"+gf.source,"gu"),oy=(r,e,t)=>{let n=!1,s=!1,i=!1;for(let a=0;a<r.length;a++){let o=r[a];n&&sy.test(o)?(r=r.slice(0,a)+"-"+r.slice(a),n=!1,i=s,s=!0,a++):s&&i&&iy.test(o)?(r=r.slice(0,a-1)+"-"+r.slice(a-1),i=s,s=!1,n=!0):(n=e(o)===o&&t(o)!==o,i=s,s=t(o)===o&&e(o)!==o)}return r},uy=(r,e)=>(hf.lastIndex=0,r.replace(hf,t=>e(t))),cy=(r,e)=>(pf.lastIndex=0,mf.lastIndex=0,r.replace(pf,(t,n)=>e(n)).replace(mf,t=>e(t))),bf=(r,e)=>{if(!(typeof r=="string"||Array.isArray(r)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(r)?r=r.map(i=>i.trim()).filter(i=>i.length).join("-"):r=r.trim(),r.length===0)return"";let t=e.locale===!1?i=>i.toLowerCase():i=>i.toLocaleLowerCase(e.locale),n=e.locale===!1?i=>i.toUpperCase():i=>i.toLocaleUpperCase(e.locale);return r.length===1?e.pascalCase?n(r):t(r):(r!==t(r)&&(r=oy(r,t,n)),r=r.replace(ay,""),e.preserveConsecutiveUppercase?r=uy(r,t):r=t(r),e.pascalCase&&(r=n(r.charAt(0))+r.slice(1)),cy(r,n))};jc.exports=bf;jc.exports.default=bf});var Df=qe((vx,Mf)=>{function nt(r,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(r)),this._timeouts=r,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}Mf.exports=nt;nt.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};nt.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};nt.prototype.retry=function(r){if(this._timeout&&clearTimeout(this._timeout),!r)return!1;var e=new Date().getTime();if(r&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(r),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(r);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t),this._options.unref&&this._timer.unref(),!0};nt.prototype.attempt=function(r,e){this._fn=r,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};nt.prototype.try=function(r){console.log("Using RetryOperation.try() is deprecated"),this.attempt(r)};nt.prototype.start=function(r){console.log("Using RetryOperation.start() is deprecated"),this.attempt(r)};nt.prototype.start=nt.prototype.try;nt.prototype.errors=function(){return this._errors};nt.prototype.attempts=function(){return this._attempts};nt.prototype.mainError=function(){if(this._errors.length===0)return null;for(var r={},e=null,t=0,n=0;n<this._errors.length;n++){var s=this._errors[n],i=s.message,a=(r[i]||0)+1;r[i]=a,a>=t&&(e=s,t=a)}return e}});var Bf=qe(_n=>{var My=Df();_n.operation=function(r){var e=_n.timeouts(r);return new My(e,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})};_n.timeouts=function(r){if(r instanceof Array)return[].concat(r);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var t in r)e[t]=r[t];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],s=0;s<e.retries;s++)n.push(this.createTimeout(s,e));return r&&r.forever&&!n.length&&n.push(this.createTimeout(s,e)),n.sort(function(i,a){return i-a}),n};_n.createTimeout=function(r,e){var t=e.randomize?Math.random()+1:1,n=Math.round(t*Math.max(e.minTimeout,1)*Math.pow(e.factor,r));return n=Math.min(n,e.maxTimeout),n};_n.wrap=function(r,e,t){if(e instanceof Array&&(t=e,e=null),!t){t=[];for(var n in r)typeof r[n]=="function"&&t.push(n)}for(var s=0;s<t.length;s++){var i=t[s],a=r[i];r[i]=function(u){var c=_n.operation(e),l=Array.prototype.slice.call(arguments,1),d=l.pop();l.push(function(f){c.retry(f)||(f&&(arguments[0]=c.mainError()),d.apply(this,arguments))}),c.attempt(function(){u.apply(r,l)})}.bind(r,a),r[i].options=e}}});var Uf=qe((Ax,Ff)=>{Ff.exports=Bf()});var yo=qe((Ox,go)=>{"use strict";var Dy=Uf(),By=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],mo=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},Fy=(r,e,t)=>{let n=t.retries-(e-1);return r.attemptNumber=e,r.retriesLeft=n,r},Uy=r=>By.includes(r),zf=(r,e)=>new Promise((t,n)=>{e={onFailedAttempt:()=>{},retries:10,...e};let s=Dy.operation(e);s.attempt(async i=>{try{t(await r(i))}catch(a){if(!(a instanceof Error)){n(new TypeError(`Non-error was thrown: "${a}". You should only throw errors.`));return}if(a instanceof mo)s.stop(),n(a.originalError);else if(a instanceof TypeError&&!Uy(a.message))s.stop(),n(a);else{Fy(a,i,e);try{await e.onFailedAttempt(a)}catch(o){n(o);return}s.retry(a)||n(s.mainError())}}})});go.exports=zf;go.exports.default=zf;go.exports.AbortError=mo});var qf=qe((Ex,Kc)=>{"use strict";var zy=Object.prototype.hasOwnProperty,Me="~";function ji(){}Object.create&&(ji.prototype=Object.create(null),new ji().__proto__||(Me=!1));function Ky(r,e,t){this.fn=r,this.context=e,this.once=t||!1}function Kf(r,e,t,n,s){if(typeof t!="function")throw new TypeError("The listener must be a function");var i=new Ky(t,n||r,s),a=Me?Me+e:e;return r._events[a]?r._events[a].fn?r._events[a]=[r._events[a],i]:r._events[a].push(i):(r._events[a]=i,r._eventsCount++),r}function bo(r,e){--r._eventsCount===0?r._events=new ji:delete r._events[e]}function Ce(){this._events=new ji,this._eventsCount=0}Ce.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)zy.call(t,n)&&e.push(Me?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};Ce.prototype.listeners=function(e){var t=Me?Me+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,i=n.length,a=new Array(i);s<i;s++)a[s]=n[s].fn;return a};Ce.prototype.listenerCount=function(e){var t=Me?Me+e:e,n=this._events[t];return n?n.fn?1:n.length:0};Ce.prototype.emit=function(e,t,n,s,i,a){var o=Me?Me+e:e;if(!this._events[o])return!1;var u=this._events[o],c=arguments.length,l,d;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,s),!0;case 5:return u.fn.call(u.context,t,n,s,i),!0;case 6:return u.fn.call(u.context,t,n,s,i,a),!0}for(d=1,l=new Array(c-1);d<c;d++)l[d-1]=arguments[d];u.fn.apply(u.context,l)}else{var f=u.length,h;for(d=0;d<f;d++)switch(u[d].once&&this.removeListener(e,u[d].fn,void 0,!0),c){case 1:u[d].fn.call(u[d].context);break;case 2:u[d].fn.call(u[d].context,t);break;case 3:u[d].fn.call(u[d].context,t,n);break;case 4:u[d].fn.call(u[d].context,t,n,s);break;default:if(!l)for(h=1,l=new Array(c-1);h<c;h++)l[h-1]=arguments[h];u[d].fn.apply(u[d].context,l)}}return!0};Ce.prototype.on=function(e,t,n){return Kf(this,e,t,n,!1)};Ce.prototype.once=function(e,t,n){return Kf(this,e,t,n,!0)};Ce.prototype.removeListener=function(e,t,n,s){var i=Me?Me+e:e;if(!this._events[i])return this;if(!t)return bo(this,i),this;var a=this._events[i];if(a.fn)a.fn===t&&(!s||a.once)&&(!n||a.context===n)&&bo(this,i);else{for(var o=0,u=[],c=a.length;o<c;o++)(a[o].fn!==t||s&&!a[o].once||n&&a[o].context!==n)&&u.push(a[o]);u.length?this._events[i]=u.length===1?u[0]:u:bo(this,i)}return this};Ce.prototype.removeAllListeners=function(e){var t;return e?(t=Me?Me+e:e,this._events[t]&&bo(this,t)):(this._events=new ji,this._eventsCount=0),this};Ce.prototype.off=Ce.prototype.removeListener;Ce.prototype.addListener=Ce.prototype.on;Ce.prefixed=Me;Ce.EventEmitter=Ce;typeof Kc!="undefined"&&(Kc.exports=Ce)});var Zf=qe((Sx,Vf)=>{"use strict";Vf.exports=(r,e)=>(e=e||(()=>{}),r.then(t=>new Promise(n=>{n(e())}).then(()=>t),t=>new Promise(n=>{n(e())}).then(()=>{throw t})))});var Gf=qe((Tx,wo)=>{"use strict";var qy=Zf(),_o=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},Hf=(r,e,t)=>new Promise((n,s)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){n(r);return}let i=setTimeout(()=>{if(typeof t=="function"){try{n(t())}catch(u){s(u)}return}let a=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new _o(a);typeof r.cancel=="function"&&r.cancel(),s(o)},e);qy(r.then(n,s),()=>{clearTimeout(i)})});wo.exports=Hf;wo.exports.default=Hf;wo.exports.TimeoutError=_o});var Jf=qe(qc=>{"use strict";Object.defineProperty(qc,"__esModule",{value:!0});function Vy(r,e,t){let n=0,s=r.length;for(;s>0;){let i=s/2|0,a=n+i;t(r[a],e)<=0?(n=++a,s-=i+1):s=i}return n}qc.default=Vy});var Wf=qe(Zc=>{"use strict";Object.defineProperty(Zc,"__esModule",{value:!0});var Zy=Jf(),Vc=class{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);let n={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(n);return}let s=Zy.default(this._queue,n,(i,a)=>a.priority-i.priority);this._queue.splice(s,0,n)}dequeue(){let e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}};Zc.default=Vc});var xo=qe(Gc=>{"use strict";Object.defineProperty(Gc,"__esModule",{value:!0});var Hy=qf(),Yf=Gf(),Gy=Wf(),vo=()=>{},Jy=new Yf.TimeoutError,Hc=class extends Hy{constructor(e){var t,n,s,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=vo,this._resolveIdle=vo,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:Gy.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(i=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=vo,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=vo,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(this._intervalId===void 0){let t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((n,s)=>{let i=async()=>{this._pendingCount++,this._intervalCount++;try{let a=this._timeout===void 0&&t.timeout===void 0?e():Yf.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&s(Jy)});n(await a)}catch(a){s(a)}this._next()};this._queue.enqueue(i,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}};Gc.default=Hc});var th=qe(Oo=>{"use strict";Oo.byteLength=Qy;Oo.toByteArray=tb;Oo.fromByteArray=sb;var Mt=[],st=[],Xy=typeof Uint8Array!="undefined"?Uint8Array:Array,Jc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(wn=0,Qf=Jc.length;wn<Qf;++wn)Mt[wn]=Jc[wn],st[Jc.charCodeAt(wn)]=wn;var wn,Qf;st[45]=62;st[95]=63;function eh(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function Qy(r){var e=eh(r),t=e[0],n=e[1];return(t+n)*3/4-n}function eb(r,e,t){return(e+t)*3/4-t}function tb(r){var e,t=eh(r),n=t[0],s=t[1],i=new Xy(eb(r,n,s)),a=0,o=s>0?n-4:n,u;for(u=0;u<o;u+=4)e=st[r.charCodeAt(u)]<<18|st[r.charCodeAt(u+1)]<<12|st[r.charCodeAt(u+2)]<<6|st[r.charCodeAt(u+3)],i[a++]=e>>16&255,i[a++]=e>>8&255,i[a++]=e&255;return s===2&&(e=st[r.charCodeAt(u)]<<2|st[r.charCodeAt(u+1)]>>4,i[a++]=e&255),s===1&&(e=st[r.charCodeAt(u)]<<10|st[r.charCodeAt(u+1)]<<4|st[r.charCodeAt(u+2)]>>2,i[a++]=e>>8&255,i[a++]=e&255),i}function rb(r){return Mt[r>>18&63]+Mt[r>>12&63]+Mt[r>>6&63]+Mt[r&63]}function nb(r,e,t){for(var n,s=[],i=e;i<t;i+=3)n=(r[i]<<16&16711680)+(r[i+1]<<8&65280)+(r[i+2]&255),s.push(rb(n));return s.join("")}function sb(r){for(var e,t=r.length,n=t%3,s=[],i=16383,a=0,o=t-n;a<o;a+=i)s.push(nb(r,a,a+i>o?o:a+i));return n===1?(e=r[t-1],s.push(Mt[e>>2]+Mt[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],s.push(Mt[e>>10]+Mt[e>>4&63]+Mt[e<<2&63]+"=")),s.join("")}});var _h=qe((nA,bh)=>{"use strict";var gh=(r=0)=>e=>`\x1B[${38+r};5;${e}m`,yh=(r=0)=>(e,t,n)=>`\x1B[${38+r};2;${e};${t};${n}m`;function m_(){let r=new Map,e={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};e.color.gray=e.color.blackBright,e.bgColor.bgGray=e.bgColor.bgBlackBright,e.color.grey=e.color.blackBright,e.bgColor.bgGrey=e.bgColor.bgBlackBright;for(let[t,n]of Object.entries(e)){for(let[s,i]of Object.entries(n))e[s]={open:`\x1B[${i[0]}m`,close:`\x1B[${i[1]}m`},n[s]=e[s],r.set(i[0],i[1]);Object.defineProperty(e,t,{value:n,enumerable:!1})}return Object.defineProperty(e,"codes",{value:r,enumerable:!1}),e.color.close="\x1B[39m",e.bgColor.close="\x1B[49m",e.color.ansi256=gh(),e.color.ansi16m=yh(),e.bgColor.ansi256=gh(10),e.bgColor.ansi16m=yh(10),Object.defineProperties(e,{rgbToAnsi256:{value:(t,n,s)=>t===n&&n===s?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(n/255*5)+Math.round(s/255*5),enumerable:!1},hexToRgb:{value:t=>{let n=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(t.toString(16));if(!n)return[0,0,0];let{colorString:s}=n.groups;s.length===3&&(s=s.split("").map(a=>a+a).join(""));let i=Number.parseInt(s,16);return[i>>16&255,i>>8&255,i&255]},enumerable:!1},hexToAnsi256:{value:t=>e.rgbToAnsi256(...e.hexToRgb(t)),enumerable:!1}}),e}Object.defineProperty(bh,"exports",{enumerable:!0,get:m_})});var L0={};kc(L0,{default:()=>Ic});module.exports=ey(L0);var Lt=require("obsidian");var nf=require("obsidian"),ty=[{name:"gpt-4o"},{name:"gemini"}],Cc=class extends nf.SuggestModal{getSuggestions(e){return ty.filter(t=>t.name.toLowerCase().includes(e.toLowerCase()))}renderSuggestion(e,t){t.createEl("div",{text:e.name})}setChooseSuggestionCallback(e){this.onChooseSuggestion=e}onChooseSuggestion(e,t){this.onChooseSuggestion&&this.onChooseSuggestion.call(this,e)}},to,sf=(r,e)=>{to||(to=new Cc(r)),to.setChooseSuggestionCallback(e),to.open()};var af=require("obsidian"),ry=[{title:"Keyword report",prompt:"Create a keyword report and SEO content plan from 1 keyword."},{title:"TL;DR",prompt:"Condense selected text, article, email into a TLDR for quick understanding and time-saving."},{title:"Grammarly",prompt:"Correct spelling and text grammar."},{title:"FAQ & answers writer",prompt:"Generate FAQ list with answers from the given product or service description."},{title:"Key takeaways",prompt:"Summarize the key takeaways from the given content."},{title:"SILO structure",prompt:"Build a comprehensive SILO framework for a website using the provided keyword. Arrange the sections and categories hierarchically, with the Home page at the top and the more specific pages at the bottom. Utilize your expertise in crafting an effective structure for linking and SEO to reach top positions in Google."},{title:"Effective Keyword Research",prompt:"Calling All Business Owners & Freelancers: Tired of aimlessly targeting keywords? Let us streamline your SEO efforts with an advanced keyword strategy, starting with a single. Benefit from keyword clusters, search intent analysis, and engaging meta descriptions. Wave goodbye to unproductive SEO and welcome a targeted, results-driven strategy. Boost your online presence with our expert keyword strategy and SEO content prompt!"},{title:"Generate keywords",prompt:"Distill some keywords from the given text."}],Nc=class extends af.SuggestModal{getSuggestions(e){return ry.filter(t=>t.title.toLowerCase().includes(e.toLowerCase())||t.prompt.toLowerCase().includes(e.toLowerCase()))}renderSuggestion(e,t){t.createEl("div",{text:e.title}),t.createEl("small",{text:e.prompt.slice(0,100)+"..."})}setChooseSuggestionCallback(e){this.onChooseSuggestion=e}onChooseSuggestion(e,t){this.onChooseSuggestion&&this.onChooseSuggestion.call(this,e)}},ro,of=(r,e)=>{ro||(ro=new Nc(r)),ro.setChooseSuggestionCallback(e),ro.open()};var uf=require("obsidian"),ny=[{name:"Wiki search",config:"```useTool\nname: 'wikiSearch'\n```"},{name:"Vector Search",config:"```useTool\nname: 'vectorSearch'\n```"},{name:"Google Search",config:"```useTool\nname: 'googleSearch'\n```"}],Rc=class extends uf.SuggestModal{getSuggestions(e){return ny.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())||t.config.toLowerCase().includes(e.toLowerCase()))}renderSuggestion(e,t){t.createEl("div",{text:e.name})}setChooseSuggestionCallback(e){this.onChooseSuggestion=e}onChooseSuggestion(e,t){this.onChooseSuggestion&&this.onChooseSuggestion.call(this,e)}},no,cf=(r,e)=>{no||(no=new Rc(r)),no.setChooseSuggestionCallback(e),no.open()};var lf=require("obsidian"),so=class extends lf.Events{constructor(){super()}on(e,t){return super.on(e,t)}trigger(e,...t){return super.trigger(e,...t)}};var ut=require("obsidian");var ue={container:"_container_jyj1d_1",header:"_header_jyj1d_7",title:"_title_jyj1d_18",actions:"_actions_jyj1d_21",inputContainer:"_inputContainer_jyj1d_32",textInput:"_textInput_jyj1d_43",focus:"_focus_jyj1d_60",controls:"_controls_jyj1d_63",attachments:"_attachments_jyj1d_77",messageItem:"_messageItem_jyj1d_82",systemMessage:"_systemMessage_jyj1d_93",humanMessage:"_humanMessage_jyj1d_98",aiMessage:"_aiMessage_jyj1d_101"};var wf=ht(ff(),1),ly=ht(_f(),1);function vf(r,e){return(e==null?void 0:e[r])||(0,wf.default)(r)}function xf(r,e,t){let n={};for(let s in r)Object.hasOwn(r,s)&&(n[e(s,t)]=r[s]);return n}function Af(r){return Array.isArray(r)?[...r]:{...r}}function dy(r,e){let t=Af(r);for(let[n,s]of Object.entries(e)){let[i,...a]=n.split(".").reverse(),o=t;for(let u of a.reverse()){if(o[u]===void 0)break;o[u]=Af(o[u]),o=o[u]}o[i]!==void 0&&(o[i]={lc:1,type:"secret",id:[s]})}return t}function $c(r){let e=Object.getPrototypeOf(r);return typeof r.lc_name=="function"&&(typeof e.lc_name!="function"||r.lc_name()!==e.lc_name())?r.lc_name():r.name}var pt=class r{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,$c(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof r||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},n=Object.keys(this.lc_kwargs).reduce((s,i)=>(s[i]=i in this?this[i]:this.lc_kwargs[i],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(n,Reflect.get(s,"lc_attributes",this));return Object.keys(t).forEach(s=>{let i=this,a=n,[o,...u]=s.split(".").reverse();for(let c of u.reverse()){if(!(c in i)||i[c]===void 0)return;(!(c in a)||a[c]===void 0)&&(typeof i[c]=="object"&&i[c]!=null?a[c]={}:Array.isArray(i[c])&&(a[c]=[])),i=i[c],a=a[c]}o in i&&i[o]!==void 0&&(a[o]=a[o]||i[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:xf(Object.keys(t).length?dy(n,t):n,vf,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function vs(r,e){return typeof r=="string"?typeof e=="string"?r+e:[{type:"text",text:r},...e]:Array.isArray(e)?[...r,...e]:[...r,{type:"text",text:e}]}var ln=class extends pt{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}toChunk(){let e=this._getType();if(e==="human")return new Si({...this});if(e==="ai")return new Qt({...this});if(e==="system")return new Ti({...this});if(e==="function")return new Pi({...this});if(Tr.isInstance(this))return new Ii({...this});throw new Error("Unknown message type.")}};function Of(r){return Array.isArray(r)&&r.every(e=>typeof e.index=="number")}function We(r,e){var n,s;let t={...r};for(let[i,a]of Object.entries(e))if(t[i]==null)t[i]=a;else{if(a==null)continue;if(typeof t[i]!=typeof a||Array.isArray(t[i])!==Array.isArray(a))throw new Error(`field[${i}] already exists in the message chunk, but with a different type.`);if(typeof t[i]=="string")t[i]=t[i]+a;else if(!Array.isArray(t[i])&&typeof t[i]=="object")t[i]=We(t[i],a);else if(i==="tool_calls"&&Of(t[i])&&Of(a))for(let o of a)((n=t[i])==null?void 0:n[o.index])!==void 0?t[i]=(s=t[i])==null?void 0:s.map((u,c)=>{var l,d,f;return c!==o.index?u:{...u,...o,function:{name:(l=o.function.name)!=null?l:u.function.name,arguments:((d=u.function.arguments)!=null?d:"")+((f=o.function.arguments)!=null?f:"")}}}):t[i][o.index]=o;else if(Array.isArray(t[i]))t[i]=t[i].concat(a);else{if(t[i]===a)continue;console.warn(`field[${i}] already exists in this message chunk and value has unsupported type.`)}}return t}var Sr=class extends ln{},Se=class extends ln{static lc_name(){return"HumanMessage"}_getType(){return"human"}},Si=class r extends Sr{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new r({content:vs(this.content,e.content),additional_kwargs:We(this.additional_kwargs,e.additional_kwargs),response_metadata:We(this.response_metadata,e.response_metadata)})}},ke=class extends ln{static lc_name(){return"AIMessage"}_getType(){return"ai"}},Qt=class r extends Sr{static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){return new r({content:vs(this.content,e.content),additional_kwargs:We(this.additional_kwargs,e.additional_kwargs),response_metadata:We(this.response_metadata,e.response_metadata)})}},dn=class extends ln{static lc_name(){return"SystemMessage"}_getType(){return"system"}},Ti=class r extends Sr{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new r({content:vs(this.content,e.content),additional_kwargs:We(this.additional_kwargs,e.additional_kwargs),response_metadata:We(this.response_metadata,e.response_metadata)})}};var Pi=class r extends Sr{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){var t;return new r({content:vs(this.content,e.content),additional_kwargs:We(this.additional_kwargs,e.additional_kwargs),response_metadata:We(this.response_metadata,e.response_metadata),name:(t=this.name)!=null?t:""})}};var io=class r extends Sr{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new r({content:vs(this.content,e.content),additional_kwargs:We(this.additional_kwargs,e.additional_kwargs),response_metadata:We(this.response_metadata,e.response_metadata),tool_call_id:this.tool_call_id})}},Tr=class r extends ln{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return r}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}};function fn(r){return typeof(r==null?void 0:r._getType)=="function"}function Ef(r){return fn(r)&&typeof r.concat=="function"}function hn(r){if(typeof r=="string")return new Se(r);if(fn(r))return r;let[e,t]=r;if(e==="human"||e==="user")return new Se({content:t});if(e==="ai"||e==="assistant")return new ke({content:t});if(e==="system")return new dn({content:t});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}var Ii=class r extends Sr{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new r({content:vs(this.content,e.content),additional_kwargs:We(this.additional_kwargs,e.additional_kwargs),response_metadata:We(this.response_metadata,e.response_metadata),role:this.role})}};function xs(r,e="Human",t="AI"){let n=[];for(let s of r){let i;if(s._getType()==="human")i=e;else if(s._getType()==="ai")i=t;else if(s._getType()==="system")i="System";else if(s._getType()==="function")i="Function";else if(s._getType()==="tool")i="Tool";else if(s._getType()==="generic")i=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);let a=s.name?`${s.name}, `:"";n.push(`${i}: ${a}${s.content}`)}return n.join(`
`)}var pn;(function(r){r.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",r.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",r.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",r.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",r.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(pn||(pn={}));var mn;(function(r){r.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",r.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",r.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",r.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",r.BLOCK_NONE="BLOCK_NONE"})(mn||(mn={}));var Sf;(function(r){r.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",r.NEGLIGIBLE="NEGLIGIBLE",r.LOW="LOW",r.MEDIUM="MEDIUM",r.HIGH="HIGH"})(Sf||(Sf={}));var Tf;(function(r){r.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",r.SAFETY="SAFETY",r.OTHER="OTHER"})(Tf||(Tf={}));var ao;(function(r){r.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",r.STOP="STOP",r.MAX_TOKENS="MAX_TOKENS",r.SAFETY="SAFETY",r.RECITATION="RECITATION",r.OTHER="OTHER"})(ao||(ao={}));var Pf;(function(r){r.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",r.RETRIEVAL_QUERY="RETRIEVAL_QUERY",r.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",r.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",r.CLASSIFICATION="CLASSIFICATION",r.CLUSTERING="CLUSTERING"})(Pf||(Pf={}));var gn=class extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}},oo=class extends gn{constructor(e,t){super(e),this.response=t}};var fy="https://generativelanguage.googleapis.com",hy="v1",py="0.1.3",my="genai-js",yn;(function(r){r.GENERATE_CONTENT="generateContent",r.STREAM_GENERATE_CONTENT="streamGenerateContent",r.COUNT_TOKENS="countTokens",r.EMBED_CONTENT="embedContent",r.BATCH_EMBED_CONTENTS="batchEmbedContents"})(yn||(yn={}));var bn=class{constructor(e,t,n,s){this.model=e,this.task=t,this.apiKey=n,this.stream=s}toString(){let e=`${fy}/${hy}/models/${this.model}:${this.task}`;return this.stream&&(e+="?alt=sse"),e}};function gy(){return`${my}/${py}`}async function Ri(r,e){let t;try{if(t=await fetch(r.toString(),{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-client":gy(),"x-goog-api-key":r.apiKey},body:e}),!t.ok){let n="";try{let s=await t.json();n=s.error.message,s.error.details&&(n+=` ${JSON.stringify(s.error.details)}`)}catch(s){}throw new Error(`[${t.status} ${t.statusText}] ${n}`)}}catch(n){let s=new gn(`Error fetching from ${r.toString()}: ${n.message}`);throw s.stack=n.stack,s}return t}function Bc(r){return r.text=()=>{if(r.candidates&&r.candidates.length>0){if(r.candidates.length>1&&console.warn(`This response had ${r.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),Cf(r.candidates[0]))throw new oo(`${uo(r)}`,r);return yy(r)}else if(r.promptFeedback)throw new oo(`Text not available. ${uo(r)}`,r);return""},r}function yy(r){var e,t,n,s;return!((s=(n=(t=(e=r.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0?void 0:t.parts)===null||n===void 0?void 0:n[0])===null||s===void 0)&&s.text?r.candidates[0].content.parts[0].text:""}var by=[ao.RECITATION,ao.SAFETY];function Cf(r){return!!r.finishReason&&by.includes(r.finishReason)}function uo(r){var e,t,n;let s="";if((!r.candidates||r.candidates.length===0)&&r.promptFeedback)s+="Response was blocked",!((e=r.promptFeedback)===null||e===void 0)&&e.blockReason&&(s+=` due to ${r.promptFeedback.blockReason}`),!((t=r.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(s+=`: ${r.promptFeedback.blockReasonMessage}`);else if(!((n=r.candidates)===null||n===void 0)&&n[0]){let i=r.candidates[0];Cf(i)&&(s+=`Candidate was blocked due to ${i.finishReason}`,i.finishMessage&&(s+=`: ${i.finishMessage}`))}return s}function Ci(r){return this instanceof Ci?(this.v=r,this):new Ci(r)}function _y(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),s,i=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(f){n[f]&&(s[f]=function(h){return new Promise(function(m,p){i.push([f,h,m,p])>1||o(f,h)})})}function o(f,h){try{u(n[f](h))}catch(m){d(i[0][3],m)}}function u(f){f.value instanceof Ci?Promise.resolve(f.value.v).then(c,l):d(i[0][2],f)}function c(f){o("next",f)}function l(f){o("throw",f)}function d(f,h){f(h),i.shift(),i.length&&o(i[0][0],i[0][1])}}var If=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function wy(r){let e=r.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=Ay(e),[n,s]=t.tee();return{stream:xy(n),response:vy(s)}}async function vy(r){let e=[],t=r.getReader();for(;;){let{done:n,value:s}=await t.read();if(n)return Bc(Oy(e));e.push(s)}}function xy(r){return _y(this,arguments,function*(){let t=r.getReader();for(;;){let{value:n,done:s}=yield Ci(t.read());if(s)break;yield yield Ci(Bc(n))}})}function Ay(r){let e=r.getReader();return new ReadableStream({start(n){let s="";return i();function i(){return e.read().then(({value:a,done:o})=>{if(o){if(s.trim()){n.error(new gn("Failed to parse stream"));return}n.close();return}s+=a;let u=s.match(If),c;for(;u;){try{c=JSON.parse(u[1])}catch(l){n.error(new gn(`Error parsing JSON response: "${u[1]}"`));return}n.enqueue(c),s=s.substring(u[0].length),u=s.match(If)}return i()})}}})}function Oy(r){let e=r[r.length-1],t={promptFeedback:e==null?void 0:e.promptFeedback};for(let n of r)if(n.candidates)for(let s of n.candidates){let i=s.index;if(t.candidates||(t.candidates=[]),t.candidates[i]||(t.candidates[i]={index:s.index}),t.candidates[i].citationMetadata=s.citationMetadata,t.candidates[i].finishReason=s.finishReason,t.candidates[i].finishMessage=s.finishMessage,t.candidates[i].safetyRatings=s.safetyRatings,s.content&&s.content.parts){t.candidates[i].content||(t.candidates[i].content={role:s.content.role||"user",parts:[{text:""}]});for(let a of s.content.parts)a.text&&(t.candidates[i].content.parts[0].text+=a.text)}}return t}async function Nf(r,e,t){let n=new bn(e,yn.STREAM_GENERATE_CONTENT,r,!0),s=await Ri(n,JSON.stringify(t));return wy(s)}async function Rf(r,e,t){let n=new bn(e,yn.GENERATE_CONTENT,r,!1),i=await(await Ri(n,JSON.stringify(t))).json();return{response:Bc(i)}}function ki(r,e){let t=[];if(typeof r=="string")t=[{text:r}];else for(let n of r)typeof n=="string"?t.push({text:n}):t.push(n);return{role:e,parts:t}}function Lc(r){return r.contents?r:{contents:[ki(r,"user")]}}function Ey(r){return typeof r=="string"||Array.isArray(r)?{content:ki(r,"user")}:r}var kf="SILENT_ERROR",Mc=class{constructor(e,t,n){this.model=t,this.params=n,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,n!=null&&n.history&&(this._history=n.history.map(s=>{if(!s.role)throw new Error("Missing role for history item: "+JSON.stringify(s));return ki(s.parts,s.role)}))}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e){var t,n;await this._sendPromise;let s=ki(e,"user"),i={safetySettings:(t=this.params)===null||t===void 0?void 0:t.safetySettings,generationConfig:(n=this.params)===null||n===void 0?void 0:n.generationConfig,contents:[...this._history,s]},a;return this._sendPromise=this._sendPromise.then(()=>Rf(this._apiKey,this.model,i)).then(o=>{var u;if(o.response.candidates&&o.response.candidates.length>0){this._history.push(s);let c=Object.assign({parts:[],role:"model"},(u=o.response.candidates)===null||u===void 0?void 0:u[0].content);this._history.push(c)}else{let c=uo(o.response);c&&console.warn(`sendMessage() was unsuccessful. ${c}. Inspect response object for details.`)}a=o}),await this._sendPromise,a}async sendMessageStream(e){var t,n;await this._sendPromise;let s=ki(e,"user"),i={safetySettings:(t=this.params)===null||t===void 0?void 0:t.safetySettings,generationConfig:(n=this.params)===null||n===void 0?void 0:n.generationConfig,contents:[...this._history,s]},a=Nf(this._apiKey,this.model,i);return this._sendPromise=this._sendPromise.then(()=>a).catch(o=>{throw new Error(kf)}).then(o=>o.response).then(o=>{if(o.candidates&&o.candidates.length>0){this._history.push(s);let u=Object.assign({},o.candidates[0].content);u.role||(u.role="model"),this._history.push(u)}else{let u=uo(o);u&&console.warn(`sendMessageStream() was unsuccessful. ${u}. Inspect response object for details.`)}}).catch(o=>{o.message!==kf&&console.error(o)}),a}};async function Sy(r,e,t){let n=new bn(e,yn.COUNT_TOKENS,r,!1);return(await Ri(n,JSON.stringify(Object.assign(Object.assign({},t),{model:e})))).json()}async function Ty(r,e,t){let n=new bn(e,yn.EMBED_CONTENT,r,!1);return(await Ri(n,JSON.stringify(t))).json()}async function Py(r,e,t){let n=new bn(e,yn.BATCH_EMBED_CONTENTS,r,!1),s=t.requests.map(a=>Object.assign(Object.assign({},a),{model:`models/${e}`}));return(await Ri(n,JSON.stringify({requests:s}))).json()}var Dc=class{constructor(e,t){var n;this.apiKey=e,t.model.startsWith("models/")?this.model=(n=t.model.split("models/"))===null||n===void 0?void 0:n[1]:this.model=t.model,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[]}async generateContent(e){let t=Lc(e);return Rf(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings},t))}async generateContentStream(e){let t=Lc(e);return Nf(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings},t))}startChat(e){return new Mc(this.apiKey,this.model,e)}async countTokens(e){let t=Lc(e);return Sy(this.apiKey,this.model,t)}async embedContent(e){let t=Ey(e);return Ty(this.apiKey,this.model,t)}async batchEmbedContents(e){return Py(this.apiKey,this.model,e)}};var Ni=class{constructor(e){this.apiKey=e}getGenerativeModel(e){if(!e.model)throw new gn("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Dc(this.apiKey,e)}};var Iy=()=>typeof window!="undefined"&&typeof window.document!="undefined",ky=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Cy=()=>typeof window!="undefined"&&window.name==="nodejs"||typeof navigator!="undefined"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),jf=()=>typeof Deno!="undefined",Ny=()=>typeof process!="undefined"&&typeof process.versions!="undefined"&&typeof process.versions.node!="undefined"&&!jf(),Ry=()=>{let r;return Iy()?r="browser":Ny()?r="node":ky()?r="webworker":Cy()?r="jsdom":jf()?r="deno":r="other",r},Fc;async function $f(){return Fc===void 0&&(Fc={library:"langchain-js",runtime:Ry()}),Fc}function ae(r){var e;try{return typeof process!="undefined"?(e=process.env)==null?void 0:e[r]:void 0}catch(t){return}}var co="__run",Pr=class r{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new r({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}},er=class r extends Pr{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new r({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}};var jy=typeof window=="object"?window:{},H="0123456789abcdef".split(""),$y=[-2147483648,8388608,32768,128],mt=[24,16,8,0];var xe=[];function gt(r){r?(xe[0]=xe[16]=xe[1]=xe[2]=xe[3]=xe[4]=xe[5]=xe[6]=xe[7]=xe[8]=xe[9]=xe[10]=xe[11]=xe[12]=xe[13]=xe[14]=xe[15]=0,this.blocks=xe):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}gt.prototype.update=function(r){if(!this.finalized){var e=typeof r!="string";e&&r.constructor===jy.ArrayBuffer&&(r=new Uint8Array(r));for(var t,n=0,s,i=r.length||0,a=this.blocks;n<i;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),e)for(s=this.start;n<i&&s<64;++n)a[s>>2]|=r[n]<<mt[s++&3];else for(s=this.start;n<i&&s<64;++n)t=r.charCodeAt(n),t<128?a[s>>2]|=t<<mt[s++&3]:t<2048?(a[s>>2]|=(192|t>>6)<<mt[s++&3],a[s>>2]|=(128|t&63)<<mt[s++&3]):t<55296||t>=57344?(a[s>>2]|=(224|t>>12)<<mt[s++&3],a[s>>2]|=(128|t>>6&63)<<mt[s++&3],a[s>>2]|=(128|t&63)<<mt[s++&3]):(t=65536+((t&1023)<<10|r.charCodeAt(++n)&1023),a[s>>2]|=(240|t>>18)<<mt[s++&3],a[s>>2]|=(128|t>>12&63)<<mt[s++&3],a[s>>2]|=(128|t>>6&63)<<mt[s++&3],a[s>>2]|=(128|t&63)<<mt[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=a[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};gt.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var r=this.blocks,e=this.lastByteIndex;r[16]=this.block,r[e>>2]|=$y[e&3],this.block=r[16],e>=56&&(this.hashed||this.hash(),r[0]=this.block,r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0),r[14]=this.hBytes<<3|this.bytes>>>29,r[15]=this.bytes<<3,this.hash()}};gt.prototype.hash=function(){var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4,i,a,o,u=this.blocks;for(a=16;a<80;++a)o=u[a-3]^u[a-8]^u[a-14]^u[a-16],u[a]=o<<1|o>>>31;for(a=0;a<20;a+=5)i=e&t|~e&n,o=r<<5|r>>>27,s=o+i+s+1518500249+u[a]<<0,e=e<<30|e>>>2,i=r&e|~r&t,o=s<<5|s>>>27,n=o+i+n+1518500249+u[a+1]<<0,r=r<<30|r>>>2,i=s&r|~s&e,o=n<<5|n>>>27,t=o+i+t+1518500249+u[a+2]<<0,s=s<<30|s>>>2,i=n&s|~n&r,o=t<<5|t>>>27,e=o+i+e+1518500249+u[a+3]<<0,n=n<<30|n>>>2,i=t&n|~t&s,o=e<<5|e>>>27,r=o+i+r+1518500249+u[a+4]<<0,t=t<<30|t>>>2;for(;a<40;a+=5)i=e^t^n,o=r<<5|r>>>27,s=o+i+s+1859775393+u[a]<<0,e=e<<30|e>>>2,i=r^e^t,o=s<<5|s>>>27,n=o+i+n+1859775393+u[a+1]<<0,r=r<<30|r>>>2,i=s^r^e,o=n<<5|n>>>27,t=o+i+t+1859775393+u[a+2]<<0,s=s<<30|s>>>2,i=n^s^r,o=t<<5|t>>>27,e=o+i+e+1859775393+u[a+3]<<0,n=n<<30|n>>>2,i=t^n^s,o=e<<5|e>>>27,r=o+i+r+1859775393+u[a+4]<<0,t=t<<30|t>>>2;for(;a<60;a+=5)i=e&t|e&n|t&n,o=r<<5|r>>>27,s=o+i+s-1894007588+u[a]<<0,e=e<<30|e>>>2,i=r&e|r&t|e&t,o=s<<5|s>>>27,n=o+i+n-1894007588+u[a+1]<<0,r=r<<30|r>>>2,i=s&r|s&e|r&e,o=n<<5|n>>>27,t=o+i+t-1894007588+u[a+2]<<0,s=s<<30|s>>>2,i=n&s|n&r|s&r,o=t<<5|t>>>27,e=o+i+e-1894007588+u[a+3]<<0,n=n<<30|n>>>2,i=t&n|t&s|n&s,o=e<<5|e>>>27,r=o+i+r-1894007588+u[a+4]<<0,t=t<<30|t>>>2;for(;a<80;a+=5)i=e^t^n,o=r<<5|r>>>27,s=o+i+s-899497514+u[a]<<0,e=e<<30|e>>>2,i=r^e^t,o=s<<5|s>>>27,n=o+i+n-899497514+u[a+1]<<0,r=r<<30|r>>>2,i=s^r^e,o=n<<5|n>>>27,t=o+i+t-899497514+u[a+2]<<0,s=s<<30|s>>>2,i=n^s^r,o=t<<5|t>>>27,e=o+i+e-899497514+u[a+3]<<0,n=n<<30|n>>>2,i=t^n^s,o=e<<5|e>>>27,r=o+i+r-899497514+u[a+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+r<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+n<<0,this.h4=this.h4+s<<0};gt.prototype.hex=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return H[r>>28&15]+H[r>>24&15]+H[r>>20&15]+H[r>>16&15]+H[r>>12&15]+H[r>>8&15]+H[r>>4&15]+H[r&15]+H[e>>28&15]+H[e>>24&15]+H[e>>20&15]+H[e>>16&15]+H[e>>12&15]+H[e>>8&15]+H[e>>4&15]+H[e&15]+H[t>>28&15]+H[t>>24&15]+H[t>>20&15]+H[t>>16&15]+H[t>>12&15]+H[t>>8&15]+H[t>>4&15]+H[t&15]+H[n>>28&15]+H[n>>24&15]+H[n>>20&15]+H[n>>16&15]+H[n>>12&15]+H[n>>8&15]+H[n>>4&15]+H[n&15]+H[s>>28&15]+H[s>>24&15]+H[s>>20&15]+H[s>>16&15]+H[s>>12&15]+H[s>>8&15]+H[s>>4&15]+H[s&15]};gt.prototype.toString=gt.prototype.hex;gt.prototype.digest=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return[r>>24&255,r>>16&255,r>>8&255,r&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,n>>24&255,n>>16&255,n>>8&255,n&255,s>>24&255,s>>16&255,s>>8&255,s&255]};gt.prototype.array=gt.prototype.digest;gt.prototype.arrayBuffer=function(){this.finalize();var r=new ArrayBuffer(20),e=new DataView(r);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),r};var Uc=r=>new gt(!0).update(r).hex();var Lf=(...r)=>Uc(r.join("_"));var zc=class{},Ly=new Map,lo=class r extends zc{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e!=null?e:new Map}lookup(e,t){var n;return Promise.resolve((n=this.cache.get(Lf(e,t)))!=null?n:null)}async update(e,t,n){this.cache.set(Lf(e,t),n)}static global(){return new r(Ly)}};var fo=class extends pt{},ho=class extends fo{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new Se(this.value)]}},po=class extends fo{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return xs(this.messages)}toChatMessages(){return this.messages}};var Xf=ht(yo(),1),Ao=ht(xo(),1),Wy=[400,401,402,403,404,405,406,407,409],Yy=r=>{var t,n,s;if(r.message.startsWith("Cancel")||r.message.startsWith("AbortError")||r.name==="AbortError"||(r==null?void 0:r.code)==="ECONNABORTED")throw r;let e=(n=(t=r==null?void 0:r.response)==null?void 0:t.status)!=null?n:r==null?void 0:r.status;if(e&&Wy.includes(+e))throw r;if(((s=r==null?void 0:r.error)==null?void 0:s.code)==="insufficient_quota"){let i=new Error(r==null?void 0:r.message);throw i.name="InsufficientQuotaError",i}},tr=class{constructor(e){var n,s,i;Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=(n=e.maxConcurrency)!=null?n:1/0,this.maxRetries=(s=e.maxRetries)!=null?s:6,this.onFailedAttempt=(i=e.onFailedAttempt)!=null?i:Yy;let t="default"in Ao.default?Ao.default.default:Ao.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>(0,Xf.default)(()=>e(...t).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};var rh=ht(th(),1);var ib=Object.defineProperty,ab=(r,e,t)=>e in r?ib(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ob=(r,e,t)=>(ab(r,typeof e!="symbol"?e+"":e,t),t);function ub(r,e){let t=Array.from({length:r.length},(n,s)=>({start:s,end:s+1}));for(;t.length>1;){let n=null;for(let s=0;s<t.length-1;s++){let i=r.slice(t[s].start,t[s+1].end),a=e.get(i.join(","));a!=null&&(n==null||a<n[0])&&(n=[a,s])}if(n!=null){let s=n[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function cb(r,e){return r.length===1?[e.get(r.join(","))]:ub(r,e).map(t=>e.get(r.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function lb(r){return r.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var Wc=class{constructor(r,e){Er(this,"specialTokens");Er(this,"inverseSpecialTokens");Er(this,"patStr");Er(this,"textEncoder",new TextEncoder);Er(this,"textDecoder",new TextDecoder("utf-8"));Er(this,"rankMap",new Map);Er(this,"textMap",new Map);this.patStr=r.pat_str;let t=r.bpe_ranks.split(`
`).filter(Boolean).reduce((n,s)=>{let[i,a,...o]=s.split(" "),u=Number.parseInt(a,10);return o.forEach((c,l)=>n[c]=u+l),n},{});for(let[n,s]of Object.entries(t)){let i=rh.default.toByteArray(n);this.rankMap.set(i.join(","),s),this.textMap.set(s,i)}this.specialTokens={...r.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[s,i])=>(n[i]=this.textEncoder.encode(s),n),{})}encode(r,e=[],t="all"){var c;let n=new RegExp(this.patStr,"ug"),s=Wc.specialTokenRegex(Object.keys(this.specialTokens)),i=[],a=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(l=>!a.has(l)):t);if(o.size>0){let l=Wc.specialTokenRegex([...o]),d=r.match(l);if(d!=null)throw new Error(`The text contains a special token that is not allowed: ${d[0]}`)}let u=0;for(;;){let l=null,d=u;for(;s.lastIndex=d,l=s.exec(r),!(l==null||a.has(l[0]));)d=l.index+1;let f=(c=l==null?void 0:l.index)!=null?c:r.length;for(let m of r.substring(u,f).matchAll(n)){let p=this.textEncoder.encode(m[0]),g=this.rankMap.get(p.join(","));if(g!=null){i.push(g);continue}i.push(...cb(p,this.rankMap))}if(l==null)break;let h=this.specialTokens[l[0]];i.push(h),u=l.index+l[0].length}return i}decode(r){var i;let e=[],t=0;for(let a=0;a<r.length;++a){let o=r[a],u=(i=this.textMap.get(o))!=null?i:this.inverseSpecialTokens[o];u!=null&&(e.push(u),t+=u.length)}let n=new Uint8Array(t),s=0;for(let a of e)n.set(a,s),s+=a.length;return this.textDecoder.decode(n)}},Eo=Wc;ob(Eo,"specialTokenRegex",r=>new RegExp(r.map(e=>lb(e)).join("|"),"g"));function Yc(r){switch(r){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":return"cl100k_base";default:throw new Error("Unknown model")}}var So={},db=new tr({});async function fb(r){return r in So||(So[r]=db.fetch(`https://tiktoken.pages.dev/js/${r}.json`).then(e=>e.json()).then(e=>new Eo(e)).catch(e=>{throw delete So[r],e})),await So[r]}async function nh(r){return fb(Yc(r))}var re;(function(r){r.assertEqual=s=>s;function e(s){}r.assertIs=e;function t(s){throw new Error}r.assertNever=t,r.arrayToEnum=s=>{let i={};for(let a of s)i[a]=a;return i},r.getValidEnumValues=s=>{let i=r.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),a={};for(let o of i)a[o]=s[o];return r.objectValues(a)},r.objectValues=s=>r.objectKeys(s).map(function(i){return s[i]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let i=[];for(let a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},r.find=(s,i)=>{for(let a of s)if(i(a))return a},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function n(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}r.joinValues=n,r.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(re||(re={}));var Qc;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Qc||(Qc={}));var P=re.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ir=r=>{switch(typeof r){case"undefined":return P.undefined;case"string":return P.string;case"number":return isNaN(r)?P.nan:P.number;case"boolean":return P.boolean;case"function":return P.function;case"bigint":return P.bigint;case"symbol":return P.symbol;case"object":return Array.isArray(r)?P.array:r===null?P.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?P.promise:typeof Map!="undefined"&&r instanceof Map?P.map:typeof Set!="undefined"&&r instanceof Set?P.set:typeof Date!="undefined"&&r instanceof Date?P.date:P.object;default:return P.unknown}},x=re.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),hb=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),Ye=class extends Error{constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){let t=e||function(i){return i.message},n={_errors:[]},s=i=>{for(let a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)n._errors.push(t(a));else{let o=n,u=0;for(;u<a.path.length;){let c=a.path[u];u===a.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(a))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return s(this),n}toString(){return this.message}get message(){return JSON.stringify(this.issues,re.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},n=[];for(let s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}};Ye.create=r=>new Ye(r);var $i=(r,e)=>{let t;switch(r.code){case x.invalid_type:r.received===P.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case x.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,re.jsonStringifyReplacer)}`;break;case x.unrecognized_keys:t=`Unrecognized key(s) in object: ${re.joinValues(r.keys,", ")}`;break;case x.invalid_union:t="Invalid input";break;case x.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${re.joinValues(r.options)}`;break;case x.invalid_enum_value:t=`Invalid enum value. Expected ${re.joinValues(r.options)}, received '${r.received}'`;break;case x.invalid_arguments:t="Invalid function arguments";break;case x.invalid_return_type:t="Invalid function return type";break;case x.invalid_date:t="Invalid date";break;case x.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:re.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case x.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case x.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case x.custom:t="Invalid input";break;case x.invalid_intersection_types:t="Intersection results could not be merged";break;case x.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case x.not_finite:t="Number must be finite";break;default:t=e.defaultError,re.assertNever(r)}return{message:t}},ah=$i;function pb(r){ah=r}function Po(){return ah}var Io=r=>{let{data:e,path:t,errorMaps:n,issueData:s}=r,i=[...t,...s.path||[]],a={...s,path:i},o="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)o=c(a,{data:e,defaultError:o}).message;return{...s,path:i,message:s.message||o}},mb=[];function k(r,e){let t=Io({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Po(),$i].filter(n=>!!n)});r.common.issues.push(t)}var Ne=class r{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let n=[];for(let s of t){if(s.status==="aborted")return U;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){let n=[];for(let s of t)n.push({key:await s.key,value:await s.value});return r.mergeObjectSync(e,n)}static mergeObjectSync(e,t){let n={};for(let s of t){let{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return U;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value!="undefined"||s.alwaysSet)&&(n[i.value]=a.value)}return{status:e.value,value:n}}},U=Object.freeze({status:"aborted"}),oh=r=>({status:"dirty",value:r}),De=r=>({status:"valid",value:r}),el=r=>r.status==="aborted",tl=r=>r.status==="dirty",Li=r=>r.status==="valid",ko=r=>typeof Promise!="undefined"&&r instanceof Promise,j;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(j||(j={}));var it=class{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},sh=(r,e)=>{if(Li(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new Ye(r.common.issues);return this._error=t,this._error}}};function K(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:n,description:s}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,o)=>a.code!=="invalid_type"?{message:o.defaultError}:typeof o.data=="undefined"?{message:n!=null?n:o.defaultError}:{message:t!=null?t:o.defaultError},description:s}}var q=class{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return Ir(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Ir(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ne,ctx:{common:e.parent.common,data:e.data,parsedType:Ir(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(ko(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;let s={common:{issues:[],async:(n=t==null?void 0:t.async)!==null&&n!==void 0?n:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ir(e)},i=this._parseSync({data:e,path:s.path,parent:s});return sh(s,i)}async parseAsync(e,t){let n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){let n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ir(e)},s=this._parse({data:e,path:n.path,parent:n}),i=await(ko(s)?s:Promise.resolve(s));return sh(n,i)}refine(e,t){let n=s=>typeof t=="string"||typeof t=="undefined"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{let a=e(s),o=()=>i.addIssue({code:x.custom,...n(s)});return typeof Promise!="undefined"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new Xe({schema:this,typeName:w.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return yt.create(this,this._def)}nullable(){return sr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return nr.create(this,this._def)}promise(){return Nr.create(this,this._def)}or(e){return Tn.create([this,e],this._def)}and(e){return Pn.create(this,e,this._def)}transform(e){return new Xe({...K(this._def),schema:this,typeName:w.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new Rn({...K(this._def),innerType:this,defaultValue:t,typeName:w.ZodDefault})}brand(){return new jo({typeName:w.ZodBranded,type:this,...K(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new Ps({...K(this._def),innerType:this,catchValue:t,typeName:w.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Mi.create(this,e)}readonly(){return ks.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},gb=/^c[^\s-]{8,}$/i,yb=/^[a-z][a-z0-9]*$/,bb=/^[0-9A-HJKMNP-TV-Z]{26}$/,_b=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,wb=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,vb="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Xc,xb=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,Ab=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Ob=r=>r.precision?r.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${r.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${r.precision}}Z$`):r.precision===0?r.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):r.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function Eb(r,e){return!!((e==="v4"||!e)&&xb.test(r)||(e==="v6"||!e)&&Ab.test(r))}var kr=class r extends q{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==P.string){let i=this._getOrReturnCtx(e);return k(i,{code:x.invalid_type,expected:P.string,received:i.parsedType}),U}let n=new Ne,s;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),k(s,{code:x.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),k(s,{code:x.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){let a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(s=this._getOrReturnCtx(e,s),a?k(s,{code:x.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&k(s,{code:x.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")wb.test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"email",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")Xc||(Xc=new RegExp(vb,"u")),Xc.test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"emoji",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")_b.test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"uuid",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")gb.test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"cuid",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")yb.test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"cuid2",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")bb.test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"ulid",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(e.data)}catch(a){s=this._getOrReturnCtx(e,s),k(s,{validation:"url",code:x.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"regex",code:x.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),k(s,{code:x.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),k(s,{code:x.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),k(s,{code:x.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?Ob(i).test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{code:x.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="ip"?Eb(e.data,i.version)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"ip",code:x.invalid_string,message:i.message}),n.dirty()):re.assertNever(i);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(s=>e.test(s),{validation:t,code:x.invalid_string,...j.errToObj(n)})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...j.errToObj(e)})}url(e){return this._addCheck({kind:"url",...j.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...j.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...j.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...j.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...j.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...j.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...j.errToObj(e)})}datetime(e){var t;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)=="undefined"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,...j.errToObj(e==null?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...j.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...j.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...j.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...j.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...j.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...j.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...j.errToObj(t)})}nonempty(e){return this.min(1,j.errToObj(e))}trim(){return new r({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};kr.create=r=>{var e;return new kr({checks:[],typeName:w.ZodString,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...K(r)})};function Sb(r,e){let t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,i=parseInt(r.toFixed(s).replace(".","")),a=parseInt(e.toFixed(s).replace(".",""));return i%a/Math.pow(10,s)}var vn=class r extends q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==P.number){let i=this._getOrReturnCtx(e);return k(i,{code:x.invalid_type,expected:P.number,received:i.parsedType}),U}let n,s=new Ne;for(let i of this._def.checks)i.kind==="int"?re.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),k(n,{code:x.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),k(n,{code:x.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),k(n,{code:x.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?Sb(e.data,i.value)!==0&&(n=this._getOrReturnCtx(e,n),k(n,{code:x.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),k(n,{code:x.not_finite,message:i.message}),s.dirty()):re.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,j.toString(t))}gt(e,t){return this.setLimit("min",e,!1,j.toString(t))}lte(e,t){return this.setLimit("max",e,!0,j.toString(t))}lt(e,t){return this.setLimit("max",e,!1,j.toString(t))}setLimit(e,t,n,s){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:j.toString(s)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:j.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:j.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:j.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:j.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:j.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:j.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:j.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:j.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:j.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&re.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}};vn.create=r=>new vn({checks:[],typeName:w.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...K(r)});var xn=class r extends q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==P.bigint){let i=this._getOrReturnCtx(e);return k(i,{code:x.invalid_type,expected:P.bigint,received:i.parsedType}),U}let n,s=new Ne;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),k(n,{code:x.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),k(n,{code:x.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),k(n,{code:x.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):re.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,j.toString(t))}gt(e,t){return this.setLimit("min",e,!1,j.toString(t))}lte(e,t){return this.setLimit("max",e,!0,j.toString(t))}lt(e,t){return this.setLimit("max",e,!1,j.toString(t))}setLimit(e,t,n,s){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:j.toString(s)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:j.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:j.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:j.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:j.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:j.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};xn.create=r=>{var e;return new xn({checks:[],typeName:w.ZodBigInt,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...K(r)})};var An=class extends q{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==P.boolean){let n=this._getOrReturnCtx(e);return k(n,{code:x.invalid_type,expected:P.boolean,received:n.parsedType}),U}return De(e.data)}};An.create=r=>new An({typeName:w.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...K(r)});var On=class r extends q{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==P.date){let i=this._getOrReturnCtx(e);return k(i,{code:x.invalid_type,expected:P.date,received:i.parsedType}),U}if(isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return k(i,{code:x.invalid_date}),U}let n=new Ne,s;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),k(s,{code:x.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),k(s,{code:x.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):re.assertNever(i);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:j.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:j.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};On.create=r=>new On({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:w.ZodDate,...K(r)});var Os=class extends q{_parse(e){if(this._getType(e)!==P.symbol){let n=this._getOrReturnCtx(e);return k(n,{code:x.invalid_type,expected:P.symbol,received:n.parsedType}),U}return De(e.data)}};Os.create=r=>new Os({typeName:w.ZodSymbol,...K(r)});var En=class extends q{_parse(e){if(this._getType(e)!==P.undefined){let n=this._getOrReturnCtx(e);return k(n,{code:x.invalid_type,expected:P.undefined,received:n.parsedType}),U}return De(e.data)}};En.create=r=>new En({typeName:w.ZodUndefined,...K(r)});var Sn=class extends q{_parse(e){if(this._getType(e)!==P.null){let n=this._getOrReturnCtx(e);return k(n,{code:x.invalid_type,expected:P.null,received:n.parsedType}),U}return De(e.data)}};Sn.create=r=>new Sn({typeName:w.ZodNull,...K(r)});var Cr=class extends q{constructor(){super(...arguments),this._any=!0}_parse(e){return De(e.data)}};Cr.create=r=>new Cr({typeName:w.ZodAny,...K(r)});var rr=class extends q{constructor(){super(...arguments),this._unknown=!0}_parse(e){return De(e.data)}};rr.create=r=>new rr({typeName:w.ZodUnknown,...K(r)});var bt=class extends q{_parse(e){let t=this._getOrReturnCtx(e);return k(t,{code:x.invalid_type,expected:P.never,received:t.parsedType}),U}};bt.create=r=>new bt({typeName:w.ZodNever,...K(r)});var Es=class extends q{_parse(e){if(this._getType(e)!==P.undefined){let n=this._getOrReturnCtx(e);return k(n,{code:x.invalid_type,expected:P.void,received:n.parsedType}),U}return De(e.data)}};Es.create=r=>new Es({typeName:w.ZodVoid,...K(r)});var nr=class r extends q{_parse(e){let{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==P.array)return k(t,{code:x.invalid_type,expected:P.array,received:t.parsedType}),U;if(s.exactLength!==null){let a=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(a||o)&&(k(t,{code:a?x.too_big:x.too_small,minimum:o?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(k(t,{code:x.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(k(t,{code:x.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>s.type._parseAsync(new it(t,a,t.path,o)))).then(a=>Ne.mergeArray(n,a));let i=[...t.data].map((a,o)=>s.type._parseSync(new it(t,a,t.path,o)));return Ne.mergeArray(n,i)}get element(){return this._def.type}min(e,t){return new r({...this._def,minLength:{value:e,message:j.toString(t)}})}max(e,t){return new r({...this._def,maxLength:{value:e,message:j.toString(t)}})}length(e,t){return new r({...this._def,exactLength:{value:e,message:j.toString(t)}})}nonempty(e){return this.min(1,e)}};nr.create=(r,e)=>new nr({type:r,minLength:null,maxLength:null,exactLength:null,typeName:w.ZodArray,...K(e)});function As(r){if(r instanceof Ve){let e={};for(let t in r.shape){let n=r.shape[t];e[t]=yt.create(As(n))}return new Ve({...r._def,shape:()=>e})}else return r instanceof nr?new nr({...r._def,type:As(r.element)}):r instanceof yt?yt.create(As(r.unwrap())):r instanceof sr?sr.create(As(r.unwrap())):r instanceof Dt?Dt.create(r.items.map(e=>As(e))):r}var Ve=class r extends q{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=re.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==P.object){let c=this._getOrReturnCtx(e);return k(c,{code:x.invalid_type,expected:P.object,received:c.parsedType}),U}let{status:n,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof bt&&this._def.unknownKeys==="strip"))for(let c in s.data)a.includes(c)||o.push(c);let u=[];for(let c of a){let l=i[c],d=s.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new it(s,d,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof bt){let c=this._def.unknownKeys;if(c==="passthrough")for(let l of o)u.push({key:{status:"valid",value:l},value:{status:"valid",value:s.data[l]}});else if(c==="strict")o.length>0&&(k(s,{code:x.unrecognized_keys,keys:o}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let c=this._def.catchall;for(let l of o){let d=s.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new it(s,d,s.path,l)),alwaysSet:l in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let c=[];for(let l of u){let d=await l.key;c.push({key:d,value:await l.value,alwaysSet:l.alwaysSet})}return c}).then(c=>Ne.mergeObjectSync(n,c)):Ne.mergeObjectSync(n,u)}get shape(){return this._def.shape()}strict(e){return j.errToObj,new r({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var s,i,a,o;let u=(a=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,t,n).message)!==null&&a!==void 0?a:n.defaultError;return t.code==="unrecognized_keys"?{message:(o=j.errToObj(e).message)!==null&&o!==void 0?o:u}:{message:u}}}:{}})}strip(){return new r({...this._def,unknownKeys:"strip"})}passthrough(){return new r({...this._def,unknownKeys:"passthrough"})}extend(e){return new r({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new r({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:w.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new r({...this._def,catchall:e})}pick(e){let t={};return re.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new r({...this._def,shape:()=>t})}omit(e){let t={};return re.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new r({...this._def,shape:()=>t})}deepPartial(){return As(this)}partial(e){let t={};return re.objectKeys(this.shape).forEach(n=>{let s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}),new r({...this._def,shape:()=>t})}required(e){let t={};return re.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof yt;)i=i._def.innerType;t[n]=i}}),new r({...this._def,shape:()=>t})}keyof(){return uh(re.objectKeys(this.shape))}};Ve.create=(r,e)=>new Ve({shape:()=>r,unknownKeys:"strip",catchall:bt.create(),typeName:w.ZodObject,...K(e)});Ve.strictCreate=(r,e)=>new Ve({shape:()=>r,unknownKeys:"strict",catchall:bt.create(),typeName:w.ZodObject,...K(e)});Ve.lazycreate=(r,e)=>new Ve({shape:r,unknownKeys:"strip",catchall:bt.create(),typeName:w.ZodObject,...K(e)});var Tn=class extends q{_parse(e){let{ctx:t}=this._processInputParams(e),n=this._def.options;function s(i){for(let o of i)if(o.result.status==="valid")return o.result;for(let o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;let a=i.map(o=>new Ye(o.ctx.common.issues));return k(t,{code:x.invalid_union,unionErrors:a}),U}if(t.common.async)return Promise.all(n.map(async i=>{let a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(s);{let i,a=[];for(let u of n){let c={...t,common:{...t.common,issues:[]},parent:null},l=u._parseSync({data:t.data,path:t.path,parent:c});if(l.status==="valid")return l;l.status==="dirty"&&!i&&(i={result:l,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;let o=a.map(u=>new Ye(u));return k(t,{code:x.invalid_union,unionErrors:o}),U}}get options(){return this._def.options}};Tn.create=(r,e)=>new Tn({options:r,typeName:w.ZodUnion,...K(e)});var To=r=>r instanceof In?To(r.schema):r instanceof Xe?To(r.innerType()):r instanceof kn?[r.value]:r instanceof Cn?r.options:r instanceof Nn?Object.keys(r.enum):r instanceof Rn?To(r._def.innerType):r instanceof En?[void 0]:r instanceof Sn?[null]:null,Co=class r extends q{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==P.object)return k(t,{code:x.invalid_type,expected:P.object,received:t.parsedType}),U;let n=this.discriminator,s=t.data[n],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(k(t,{code:x.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),U)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){let s=new Map;for(let i of t){let a=To(i.shape[e]);if(!a)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of a){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,i)}}return new r({typeName:w.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...K(n)})}};function rl(r,e){let t=Ir(r),n=Ir(e);if(r===e)return{valid:!0,data:r};if(t===P.object&&n===P.object){let s=re.objectKeys(e),i=re.objectKeys(r).filter(o=>s.indexOf(o)!==-1),a={...r,...e};for(let o of i){let u=rl(r[o],e[o]);if(!u.valid)return{valid:!1};a[o]=u.data}return{valid:!0,data:a}}else if(t===P.array&&n===P.array){if(r.length!==e.length)return{valid:!1};let s=[];for(let i=0;i<r.length;i++){let a=r[i],o=e[i],u=rl(a,o);if(!u.valid)return{valid:!1};s.push(u.data)}return{valid:!0,data:s}}else return t===P.date&&n===P.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var Pn=class extends q{_parse(e){let{status:t,ctx:n}=this._processInputParams(e),s=(i,a)=>{if(el(i)||el(a))return U;let o=rl(i.value,a.value);return o.valid?((tl(i)||tl(a))&&t.dirty(),{status:t.value,value:o.data}):(k(n,{code:x.invalid_intersection_types}),U)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};Pn.create=(r,e,t)=>new Pn({left:r,right:e,typeName:w.ZodIntersection,...K(t)});var Dt=class r extends q{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==P.array)return k(n,{code:x.invalid_type,expected:P.array,received:n.parsedType}),U;if(n.data.length<this._def.items.length)return k(n,{code:x.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),U;!this._def.rest&&n.data.length>this._def.items.length&&(k(n,{code:x.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...n.data].map((a,o)=>{let u=this._def.items[o]||this._def.rest;return u?u._parse(new it(n,a,n.path,o)):null}).filter(a=>!!a);return n.common.async?Promise.all(i).then(a=>Ne.mergeArray(t,a)):Ne.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new r({...this._def,rest:e})}};Dt.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Dt({items:r,typeName:w.ZodTuple,rest:null,...K(e)})};var No=class r extends q{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==P.object)return k(n,{code:x.invalid_type,expected:P.object,received:n.parsedType}),U;let s=[],i=this._def.keyType,a=this._def.valueType;for(let o in n.data)s.push({key:i._parse(new it(n,o,n.path,o)),value:a._parse(new it(n,n.data[o],n.path,o))});return n.common.async?Ne.mergeObjectAsync(t,s):Ne.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof q?new r({keyType:e,valueType:t,typeName:w.ZodRecord,...K(n)}):new r({keyType:kr.create(),valueType:e,typeName:w.ZodRecord,...K(t)})}},Ss=class extends q{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==P.map)return k(n,{code:x.invalid_type,expected:P.map,received:n.parsedType}),U;let s=this._def.keyType,i=this._def.valueType,a=[...n.data.entries()].map(([o,u],c)=>({key:s._parse(new it(n,o,n.path,[c,"key"])),value:i._parse(new it(n,u,n.path,[c,"value"]))}));if(n.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let u of a){let c=await u.key,l=await u.value;if(c.status==="aborted"||l.status==="aborted")return U;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}})}else{let o=new Map;for(let u of a){let c=u.key,l=u.value;if(c.status==="aborted"||l.status==="aborted")return U;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}}}};Ss.create=(r,e,t)=>new Ss({valueType:e,keyType:r,typeName:w.ZodMap,...K(t)});var Ts=class r extends q{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==P.set)return k(n,{code:x.invalid_type,expected:P.set,received:n.parsedType}),U;let s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(k(n,{code:x.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(k(n,{code:x.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());let i=this._def.valueType;function a(u){let c=new Set;for(let l of u){if(l.status==="aborted")return U;l.status==="dirty"&&t.dirty(),c.add(l.value)}return{status:t.value,value:c}}let o=[...n.data.values()].map((u,c)=>i._parse(new it(n,u,n.path,c)));return n.common.async?Promise.all(o).then(u=>a(u)):a(o)}min(e,t){return new r({...this._def,minSize:{value:e,message:j.toString(t)}})}max(e,t){return new r({...this._def,maxSize:{value:e,message:j.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Ts.create=(r,e)=>new Ts({valueType:r,minSize:null,maxSize:null,typeName:w.ZodSet,...K(e)});var Ro=class r extends q{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==P.function)return k(t,{code:x.invalid_type,expected:P.function,received:t.parsedType}),U;function n(o,u){return Io({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Po(),$i].filter(c=>!!c),issueData:{code:x.invalid_arguments,argumentsError:u}})}function s(o,u){return Io({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Po(),$i].filter(c=>!!c),issueData:{code:x.invalid_return_type,returnTypeError:u}})}let i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof Nr){let o=this;return De(async function(...u){let c=new Ye([]),l=await o._def.args.parseAsync(u,i).catch(h=>{throw c.addIssue(n(u,h)),c}),d=await Reflect.apply(a,this,l);return await o._def.returns._def.type.parseAsync(d,i).catch(h=>{throw c.addIssue(s(d,h)),c})})}else{let o=this;return De(function(...u){let c=o._def.args.safeParse(u,i);if(!c.success)throw new Ye([n(u,c.error)]);let l=Reflect.apply(a,this,c.data),d=o._def.returns.safeParse(l,i);if(!d.success)throw new Ye([s(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r({...this._def,args:Dt.create(e).rest(rr.create())})}returns(e){return new r({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new r({args:e||Dt.create([]).rest(rr.create()),returns:t||rr.create(),typeName:w.ZodFunction,...K(n)})}},In=class extends q{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};In.create=(r,e)=>new In({getter:r,typeName:w.ZodLazy,...K(e)});var kn=class extends q{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return k(t,{received:t.data,code:x.invalid_literal,expected:this._def.value}),U}return{status:"valid",value:e.data}}get value(){return this._def.value}};kn.create=(r,e)=>new kn({value:r,typeName:w.ZodLiteral,...K(e)});function uh(r,e){return new Cn({values:r,typeName:w.ZodEnum,...K(e)})}var Cn=class r extends q{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),n=this._def.values;return k(t,{expected:re.joinValues(n),received:t.parsedType,code:x.invalid_type}),U}if(this._def.values.indexOf(e.data)===-1){let t=this._getOrReturnCtx(e),n=this._def.values;return k(t,{received:t.data,code:x.invalid_enum_value,options:n}),U}return De(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e){return r.create(e)}exclude(e){return r.create(this.options.filter(t=>!e.includes(t)))}};Cn.create=uh;var Nn=class extends q{_parse(e){let t=re.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==P.string&&n.parsedType!==P.number){let s=re.objectValues(t);return k(n,{expected:re.joinValues(s),received:n.parsedType,code:x.invalid_type}),U}if(t.indexOf(e.data)===-1){let s=re.objectValues(t);return k(n,{received:n.data,code:x.invalid_enum_value,options:s}),U}return De(e.data)}get enum(){return this._def.values}};Nn.create=(r,e)=>new Nn({values:r,typeName:w.ZodNativeEnum,...K(e)});var Nr=class extends q{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==P.promise&&t.common.async===!1)return k(t,{code:x.invalid_type,expected:P.promise,received:t.parsedType}),U;let n=t.parsedType===P.promise?t.data:Promise.resolve(t.data);return De(n.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}};Nr.create=(r,e)=>new Nr({type:r,typeName:w.ZodPromise,...K(e)});var Xe=class extends q{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===w.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:a=>{k(n,a),a.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){let a=s.transform(n.data,i);return n.common.issues.length?{status:"dirty",value:n.data}:n.common.async?Promise.resolve(a).then(o=>this._def.schema._parseAsync({data:o,path:n.path,parent:n})):this._def.schema._parseSync({data:a,path:n.path,parent:n})}if(s.type==="refinement"){let a=o=>{let u=s.refinement(o,i);if(n.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){let o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?U:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?U:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Li(a))return a;let o=s.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>Li(a)?Promise.resolve(s.transform(a.value,i)).then(o=>({status:t.value,value:o})):a);re.assertNever(s)}};Xe.create=(r,e,t)=>new Xe({schema:r,typeName:w.ZodEffects,effect:e,...K(t)});Xe.createWithPreprocess=(r,e,t)=>new Xe({schema:e,effect:{type:"preprocess",transform:r},typeName:w.ZodEffects,...K(t)});var yt=class extends q{_parse(e){return this._getType(e)===P.undefined?De(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};yt.create=(r,e)=>new yt({innerType:r,typeName:w.ZodOptional,...K(e)});var sr=class extends q{_parse(e){return this._getType(e)===P.null?De(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};sr.create=(r,e)=>new sr({innerType:r,typeName:w.ZodNullable,...K(e)});var Rn=class extends q{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return t.parsedType===P.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Rn.create=(r,e)=>new Rn({innerType:r,typeName:w.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...K(e)});var Ps=class extends q{_parse(e){let{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return ko(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Ye(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Ye(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Ps.create=(r,e)=>new Ps({innerType:r,typeName:w.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...K(e)});var Is=class extends q{_parse(e){if(this._getType(e)!==P.nan){let n=this._getOrReturnCtx(e);return k(n,{code:x.invalid_type,expected:P.nan,received:n.parsedType}),U}return{status:"valid",value:e.data}}};Is.create=r=>new Is({typeName:w.ZodNaN,...K(r)});var Tb=Symbol("zod_brand"),jo=class extends q{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}},Mi=class r extends q{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?U:i.status==="dirty"?(t.dirty(),oh(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{let s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?U:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new r({in:e,out:t,typeName:w.ZodPipeline})}},ks=class extends q{_parse(e){let t=this._def.innerType._parse(e);return Li(t)&&(t.value=Object.freeze(t.value)),t}};ks.create=(r,e)=>new ks({innerType:r,typeName:w.ZodReadonly,...K(e)});var ch=(r,e={},t)=>r?Cr.create().superRefine((n,s)=>{var i,a;if(!r(n)){let o=typeof e=="function"?e(n):typeof e=="string"?{message:e}:e,u=(a=(i=o.fatal)!==null&&i!==void 0?i:t)!==null&&a!==void 0?a:!0,c=typeof o=="string"?{message:o}:o;s.addIssue({code:"custom",...c,fatal:u})}}):Cr.create(),Pb={object:Ve.lazycreate},w;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(w||(w={}));var Ib=(r,e={message:`Input not instance of ${r.name}`})=>ch(t=>t instanceof r,e),lh=kr.create,dh=vn.create,kb=Is.create,Cb=xn.create,fh=An.create,Nb=On.create,Rb=Os.create,jb=En.create,$b=Sn.create,Lb=Cr.create,Mb=rr.create,Db=bt.create,Bb=Es.create,Fb=nr.create,Ub=Ve.create,zb=Ve.strictCreate,Kb=Tn.create,qb=Co.create,Vb=Pn.create,Zb=Dt.create,Hb=No.create,Gb=Ss.create,Jb=Ts.create,Wb=Ro.create,Yb=In.create,Xb=kn.create,Qb=Cn.create,e_=Nn.create,t_=Nr.create,ih=Xe.create,r_=yt.create,n_=sr.create,s_=Xe.createWithPreprocess,i_=Mi.create,a_=()=>lh().optional(),o_=()=>dh().optional(),u_=()=>fh().optional(),c_={string:r=>kr.create({...r,coerce:!0}),number:r=>vn.create({...r,coerce:!0}),boolean:r=>An.create({...r,coerce:!0}),bigint:r=>xn.create({...r,coerce:!0}),date:r=>On.create({...r,coerce:!0})},l_=U,ir=Object.freeze({__proto__:null,defaultErrorMap:$i,setErrorMap:pb,getErrorMap:Po,makeIssue:Io,EMPTY_PATH:mb,addIssueToContext:k,ParseStatus:Ne,INVALID:U,DIRTY:oh,OK:De,isAborted:el,isDirty:tl,isValid:Li,isAsync:ko,get util(){return re},get objectUtil(){return Qc},ZodParsedType:P,getParsedType:Ir,ZodType:q,ZodString:kr,ZodNumber:vn,ZodBigInt:xn,ZodBoolean:An,ZodDate:On,ZodSymbol:Os,ZodUndefined:En,ZodNull:Sn,ZodAny:Cr,ZodUnknown:rr,ZodNever:bt,ZodVoid:Es,ZodArray:nr,ZodObject:Ve,ZodUnion:Tn,ZodDiscriminatedUnion:Co,ZodIntersection:Pn,ZodTuple:Dt,ZodRecord:No,ZodMap:Ss,ZodSet:Ts,ZodFunction:Ro,ZodLazy:In,ZodLiteral:kn,ZodEnum:Cn,ZodNativeEnum:Nn,ZodPromise:Nr,ZodEffects:Xe,ZodTransformer:Xe,ZodOptional:yt,ZodNullable:sr,ZodDefault:Rn,ZodCatch:Ps,ZodNaN:Is,BRAND:Tb,ZodBranded:jo,ZodPipeline:Mi,ZodReadonly:ks,custom:ch,Schema:q,ZodSchema:q,late:Pb,get ZodFirstPartyTypeKind(){return w},coerce:c_,any:Lb,array:Fb,bigint:Cb,boolean:fh,date:Nb,discriminatedUnion:qb,effect:ih,enum:Qb,function:Wb,instanceof:Ib,intersection:Vb,lazy:Yb,literal:Xb,map:Gb,nan:kb,nativeEnum:e_,never:Db,null:$b,nullable:n_,number:dh,object:Ub,oboolean:u_,onumber:o_,optional:r_,ostring:a_,pipeline:i_,preprocess:s_,promise:t_,record:Hb,set:Jb,strictObject:zb,string:lh,symbol:Rb,transformer:ih,tuple:Zb,undefined:jb,union:Kb,unknown:Mb,void:Bb,NEVER:l_,ZodIssueCode:x,quotelessJson:hb,ZodError:Ye});var Sl=ht(yo(),1);var $o,d_=new Uint8Array(16);function nl(){if(!$o&&($o=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!$o))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return $o(d_)}var hh=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function f_(r){return typeof r=="string"&&hh.test(r)}var Di=f_;var Te=[];for(let r=0;r<256;++r)Te.push((r+256).toString(16).slice(1));function ph(r,e=0){return Te[r[e+0]]+Te[r[e+1]]+Te[r[e+2]]+Te[r[e+3]]+"-"+Te[r[e+4]]+Te[r[e+5]]+"-"+Te[r[e+6]]+Te[r[e+7]]+"-"+Te[r[e+8]]+Te[r[e+9]]+"-"+Te[r[e+10]]+Te[r[e+11]]+Te[r[e+12]]+Te[r[e+13]]+Te[r[e+14]]+Te[r[e+15]]}var h_=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),sl={randomUUID:h_};function p_(r,e,t){if(sl.randomUUID&&!e&&!r)return sl.randomUUID();r=r||{};let n=r.random||(r.rng||nl)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=n[s];return e}return ph(n)}var Be=p_;var il=class{},jn=class r extends il{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,$c(this.constructor)]}constructor(e){var t,n,s,i,a;super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:ae("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=(t=e.ignoreLLM)!=null?t:this.ignoreLLM,this.ignoreChain=(n=e.ignoreChain)!=null?n:this.ignoreChain,this.ignoreAgent=(s=e.ignoreAgent)!=null?s:this.ignoreAgent,this.ignoreRetriever=(i=e.ignoreRetriever)!=null?i:this.ignoreRetriever,this.awaitHandlers=(a=e._awaitHandler)!=null?a:this.awaitHandlers)}copy(){return new this.constructor(this)}toJSON(){return pt.prototype.toJSON.call(this)}toJSONNotImplemented(){return pt.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends r{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Be()}),Object.assign(this,e)}}return new t}};var ol=ht(_h(),1);function al(r,e){return r&&!Array.isArray(r)&&typeof r=="object"?r:{[e]:r}}function g_(r){return r.replace(/[-:.]/g,"")}function y_(r,e){return g_(`${new Date(r).toISOString().slice(0,-1)}000Z`)+e}var _t=class extends jn{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}async _startTrace(e){var s;let t=y_(e.start_time,e.id),n={...e};if(n.parent_run_id!==void 0){let i=this.runMap.get(n.parent_run_id);i&&(this._addChildRun(i,n),i.child_execution_order=Math.max(i.child_execution_order,n.child_execution_order),n.trace_id=i.trace_id,i.dotted_order!==void 0&&(n.dotted_order=[i.dotted_order,t].join(".")))}else n.trace_id=n.id,n.dotted_order=t;this.runMap.set(n.id,n),await((s=this.onRunCreate)==null?void 0:s.call(this,n))}async _endTrace(e){var n;let t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((n=this.onRunUpdate)==null?void 0:n.call(this,e))}_getExecutionOrder(e){let t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,n,s,i,a,o,u){var h;let c=this._getExecutionOrder(s),l=Date.now(),d=o?{...i,metadata:o}:i,f={id:n,name:u!=null?u:e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d!=null?d:{},tags:a||[]};return await this._startTrace(f),await((h=this.onLLMStart)==null?void 0:h.call(this,f)),f}async handleChatModelStart(e,t,n,s,i,a,o,u){var h;let c=this._getExecutionOrder(s),l=Date.now(),d=o?{...i,metadata:o}:i,f={id:n,name:u!=null?u:e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d!=null?d:{},tags:a||[]};return await this._startTrace(f),await((h=this.onLLMStart)==null?void 0:h.call(this,f)),f}async handleLLMEnd(e,t){var s;let n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="llm")throw new Error("No LLM run to end.");return n.end_time=Date.now(),n.outputs=e,n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onLLMEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleLLMError(e,t){var s;let n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="llm")throw new Error("No LLM run to end.");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onLLMError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleChainStart(e,t,n,s,i,a,o,u){var f;let c=this._getExecutionOrder(s),l=Date.now(),d={id:n,name:u!=null?u:e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:o!=null?o:"chain",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return await this._startTrace(d),await((f=this.onChainStart)==null?void 0:f.call(this,d)),d}async handleChainEnd(e,t,n,s,i){var o;let a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=al(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=al(i.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleChainError(e,t,n,s,i){var o;let a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=al(i.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleToolStart(e,t,n,s,i,a,o){var d;let u=this._getExecutionOrder(s),c=Date.now(),l={id:n,name:o!=null?o:e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:u,child_execution_order:u,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return await this._startTrace(l),await((d=this.onToolStart)==null?void 0:d.call(this,l)),l}async handleToolEnd(e,t){var s;let n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onToolEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleToolError(e,t){var s;let n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onToolError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleAgentAction(e,t){var i;let n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="chain")return;let s=n;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentAction)==null?void 0:i.call(this,n))}async handleAgentEnd(e,t){var s;let n=this.runMap.get(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,n)))}async handleRetrieverStart(e,t,n,s,i,a,o){var d;let u=this._getExecutionOrder(s),c=Date.now(),l={id:n,name:o!=null?o:e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:u,child_execution_order:u,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return await this._startTrace(l),await((d=this.onRetrieverStart)==null?void 0:d.call(this,l)),l}async handleRetrieverEnd(e,t){var s;let n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await((s=this.onRetrieverEnd)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleRetrieverError(e,t){var s;let n=this.runMap.get(t);if(!n||(n==null?void 0:n.run_type)!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await((s=this.onRetrieverError)==null?void 0:s.call(this,n)),await this._endTrace(n),n}async handleText(e,t){var s;let n=this.runMap.get(t);!n||(n==null?void 0:n.run_type)!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,n)))}async handleLLMNewToken(e,t,n,s,i,a){var u;let o=this.runMap.get(n);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:a==null?void 0:a.chunk}}),await((u=this.onLLMNewToken)==null?void 0:u.call(this,o,e,{chunk:a==null?void 0:a.chunk})),o}};function Fe(r,e){return`${r.open}${e}${r.close}`}function wt(r,e){try{return JSON.stringify(r,null,2)}catch(t){return e}}function Rr(r){if(!r.end_time)return"";let e=r.end_time-r.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}var{color:Ze}=ol.default,Bi=class extends _t{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],n=e;for(;n.parent_run_id;){let s=this.runMap.get(n.parent_run_id);if(s)t.push(s),n=s;else break}return t}getBreadcrumbs(e){let n=[...this.getParents(e).reverse(),e].map((s,i,a)=>{let o=`${s.execution_order}:${s.run_type}:${s.name}`;return i===a.length-1?Fe(ol.default.bold,o):o}).join(" > ");return Fe(Ze.grey,n)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${Fe(Ze.green,"[chain/start]")} [${t}] Entering Chain run with input: ${wt(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Fe(Ze.cyan,"[chain/end]")} [${t}] [${Rr(e)}] Exiting Chain run with output: ${wt(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${Fe(Ze.red,"[chain/error]")} [${t}] [${Rr(e)}] Chain run errored with error: ${wt(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${Fe(Ze.green,"[llm/start]")} [${t}] Entering LLM run with input: ${wt(n,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Fe(Ze.cyan,"[llm/end]")} [${t}] [${Rr(e)}] Exiting LLM run with output: ${wt(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${Fe(Ze.red,"[llm/error]")} [${t}] [${Rr(e)}] LLM run errored with error: ${wt(e.error,"[error]")}`)}onToolStart(e){var n;let t=this.getBreadcrumbs(e);console.log(`${Fe(Ze.green,"[tool/start]")} [${t}] Entering Tool run with input: "${(n=e.inputs.input)==null?void 0:n.trim()}"`)}onToolEnd(e){var n,s;let t=this.getBreadcrumbs(e);console.log(`${Fe(Ze.cyan,"[tool/end]")} [${t}] [${Rr(e)}] Exiting Tool run with output: "${(s=(n=e.outputs)==null?void 0:n.output)==null?void 0:s.trim()}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${Fe(Ze.red,"[tool/error]")} [${t}] [${Rr(e)}] Tool run errored with error: ${wt(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${Fe(Ze.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${wt(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Fe(Ze.cyan,"[retriever/end]")} [${t}] [${Rr(e)}] Exiting Retriever run with output: ${wt(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${Fe(Ze.red,"[retriever/error]")} [${t}] [${Rr(e)}] Retriever run errored with error: ${wt(e.error,"[error]")}`)}onAgentAction(e){let t=e,n=this.getBreadcrumbs(e);console.log(`${Fe(Ze.blue,"[agent/action]")} [${n}] Agent selected action: ${wt(t.actions[t.actions.length-1],"[action]")}`)}};var wh=ht(yo(),1),Lo=ht(xo(),1),b_=[400,401,403,404,405,406,407,408],__=[409],Fi=class{constructor(e){var n,s;Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=(n=e.maxConcurrency)!=null?n:1/0,this.maxRetries=(s=e.maxRetries)!=null?s:6;let t="default"in Lo.default?Lo.default.default:Lo.default;this.queue=new t({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){let n=this.onFailedResponseHook;return this.queue.add(()=>(0,wh.default)(()=>e(...t).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.message.startsWith("AbortError")||(s==null?void 0:s.code)==="ECONNABORTED")throw s;let i=s==null?void 0:s.response,a=i==null?void 0:i.status;if(a){if(b_.includes(+a))throw s;if(__.includes(+a))return;n&&await n(i)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};function ul(r){return typeof(r==null?void 0:r._getType)=="function"}function cl(r){let e={type:r._getType(),data:{content:r.content}};return r!=null&&r.additional_kwargs&&Object.keys(r.additional_kwargs).length>0&&(e.data.additional_kwargs={...r.additional_kwargs}),e}var ar,w_=()=>typeof window!="undefined"&&typeof window.document!="undefined",v_=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",x_=()=>typeof window!="undefined"&&window.name==="nodejs"||typeof navigator!="undefined"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),vh=()=>typeof Deno!="undefined",A_=()=>typeof process!="undefined"&&typeof process.versions!="undefined"&&typeof process.versions.node!="undefined"&&!vh(),O_=()=>ar||(w_()?ar="browser":A_()?ar="node":v_()?ar="webworker":x_()?ar="jsdom":vh()?ar="deno":ar="other",ar),ll;async function fl(){if(ll===void 0){let r=O_(),e=S_();ll={library:"langsmith",runtime:r,sdk:"langsmith-js",sdk_version:Mo,...e}}return ll}function xh(){let r=E_()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(let[n,s]of Object.entries(r))n.startsWith("LANGCHAIN_")&&typeof s=="string"&&!t.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[n]=s);return e}function E_(){try{return typeof process!="undefined"&&process.env?Object.entries(process.env).reduce((r,[e,t])=>(r[e]=String(t),r),{}):void 0}catch(r){return}}function or(r){var e;try{return typeof process!="undefined"?(e=process.env)==null?void 0:e[r]:void 0}catch(t){return}}var dl;function S_(){if(dl!==void 0)return dl;let r=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(let t of r){let n=or(t);n!==void 0&&(e[t]=n)}return dl=e,e}async function Ah(r){let e=await fl(),t=xh();return r.map(n=>{var a,o;let s=(a=n.extra)!=null?a:{},i=s.metadata;return n.extra={...s,runtime:{...e,...s==null?void 0:s.runtime},metadata:{...t,...t.revision_id||n.revision_id?{revision_id:(o=n.revision_id)!=null?o:t.revision_id}:{},...i}},n})}var T_=()=>{let r=or("LANGCHAIN_TRACING_SAMPLING_RATE");if(r===void 0)return;let e=parseFloat(r);if(e<0||e>1)throw new Error(`LANGCHAIN_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},P_=r=>{let t=r.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"},jr=async(r,e)=>{let t=await r.text();if(!r.ok)throw new Error(`Failed to ${e}: ${r.status} ${r.statusText} ${t}`)};async function I_(r){let e=[];for await(let t of r)e.push(t);return e}function hl(r){if(r!==void 0)return r.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}function le(r){if(!Di(r))throw new Error(`Invalid UUID: ${r}`)}var k_=async r=>{var e;if((r==null?void 0:r.status)===429){let t=parseInt((e=r.headers.get("retry-after"))!=null?e:"30",10)*1e3;if(t>0)return await new Promise(n=>setTimeout(n,t)),!0}return!1},pl=class{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]})}get size(){return this.items.length}push(e){return new Promise(t=>{this.items.push([e,t])})}pop(e){if(e<1)throw new Error("Number of items to pop off may not be less than 1.");let t=[];for(;t.length<e&&this.items.length;){let n=this.items.shift();if(n)t.push(n);else break}return[t.map(n=>n[0]),()=>t.forEach(n=>n[1]())]}},C_=20971520,Cs=class r{constructor(e={}){var n,s,i,a,o,u,c,l,d,f,h;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sampledPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new pl}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=r.getDefaultClientConfig();this.tracingSampleRate=T_(),this.apiUrl=(s=hl((n=e.apiUrl)!=null?n:t.apiUrl))!=null?s:"",this.apiKey=hl((i=e.apiKey)!=null?i:t.apiKey),this.webUrl=hl((a=e.webUrl)!=null?a:t.webUrl),this.timeout_ms=(o=e.timeout_ms)!=null?o:12e3,this.caller=new Fi((u=e.callerOptions)!=null?u:{}),this.batchIngestCaller=new Fi({...(c=e.callerOptions)!=null?c:{},onFailedResponseHook:k_}),this.hideInputs=(l=e.hideInputs)!=null?l:t.hideInputs,this.hideOutputs=(d=e.hideOutputs)!=null?d:t.hideOutputs,this.autoBatchTracing=(f=e.autoBatchTracing)!=null?f:this.autoBatchTracing,this.pendingAutoBatchedRunLimit=(h=e.pendingAutoBatchedRunLimit)!=null?h:this.pendingAutoBatchedRunLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){var i;let e=or("LANGCHAIN_API_KEY"),t=(i=or("LANGCHAIN_ENDPOINT"))!=null?i:"https://api.smith.langchain.com",n=or("LANGCHAIN_HIDE_INPUTS")==="true",s=or("LANGCHAIN_HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:P_(this.apiUrl)?(this.webUrl="http://localhost","http://localhost"):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com","https://dev.smith.langchain.com"):(this.webUrl="https://smith.langchain.com","https://smith.langchain.com")}get headers(){let e={"User-Agent":`langsmith-js/${Mo}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){let t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){var a;let n=(a=t==null?void 0:t.toString())!=null?a:"",s=`${this.apiUrl}${e}?${n}`,i=await this.caller.call(fetch,s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok)throw new Error(`Failed to fetch ${e}: ${i.status} ${i.statusText}`);return i}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams){let n=Number(t.get("offset"))||0,s=Number(t.get("limit"))||100;for(;;){t.set("offset",String(n)),t.set("limit",String(s));let i=`${this.apiUrl}${e}?${t}`,a=await this.caller.call(fetch,i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!a.ok)throw new Error(`Failed to fetch ${e}: ${a.status} ${a.statusText}`);let o=await a.json();if(o.length===0||(yield o,o.length<s))break;n+=o.length}}async*_getCursorPaginatedList(e,t=null,n="POST",s="runs"){let i=t?{...t}:{};for(;;){let o=await(await this.caller.call(fetch,`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(i)})).json();if(!o||!o[s])break;yield o[s];let u=o.cursors;if(!u||!u.next)break;i.cursor=u.next}}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){let n=[];for(let s of e)this.sampledPostUuids.has(s.id)&&(n.push(s),this.sampledPostUuids.delete(s.id));return n}else{let n=[];for(let s of e)Math.random()<this.tracingSampleRate&&(n.push(s),this.sampledPostUuids.add(s.id));return n}}async drainAutoBatchQueue(){for(;this.autoBatchQueue.size>=0;){let[e,t]=this.autoBatchQueue.pop(this.pendingAutoBatchedRunLimit);if(!e.length){t();return}try{await this.batchIngestRuns({runCreates:e.filter(n=>n.action==="create").map(n=>n.item),runUpdates:e.filter(n=>n.action==="update").map(n=>n.item)})}finally{t()}}}async processRunOperation(e,t){let n=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0;let s=this.autoBatchQueue.push(e);return(t||this.autoBatchQueue.size>this.pendingAutoBatchedRunLimit)&&await this.drainAutoBatchQueue(),this.autoBatchQueue.size>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)},n?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),s}async _getServerInfo(){let e=await fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!e.ok)throw await e.text(),new Error("Failed to retrieve server info.");return e.json()}async batchEndpointIsSupported(){try{this.serverInfo=await this._getServerInfo()}catch(e){return!1}return!0}async createRun(e){var o;if(!this._filterForSampling([e]).length)return;let t={...this.headers,"Content-Type":"application/json"},n=e.project_name;delete e.project_name;let s=this.prepareRunCreateOrUpdateInputs({session_name:n,...e,start_time:(o=e.start_time)!=null?o:Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){this.processRunOperation({action:"create",item:s}).catch(console.error);return}let i=await Ah([s]),a=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(i[0]),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await jr(a,"create run")}async batchIngestRuns({runCreates:e,runUpdates:t}){var c,l,d,f,h;if(e===void 0&&t===void 0)return;let n=(c=e==null?void 0:e.map(m=>this.prepareRunCreateOrUpdateInputs(m)))!=null?c:[],s=(l=t==null?void 0:t.map(m=>this.prepareRunCreateOrUpdateInputs(m)))!=null?l:[];if(n.length>0&&s.length>0){let m=n.reduce((g,y)=>(y.id&&(g[y.id]=y),g),{}),p=[];for(let g of s)g.id!==void 0&&m[g.id]?m[g.id]={...m[g.id],...g}:p.push(g);n=Object.values(m),s=p}let i={post:this._filterForSampling(n),patch:this._filterForSampling(s,!0)};if(!i.post.length&&!i.patch.length)return;if(n=await Ah(n),this.batchEndpointSupported===void 0&&(this.batchEndpointSupported=await this.batchEndpointIsSupported()),!this.batchEndpointSupported){this.autoBatchTracing=!1;for(let m of i.post)await this.createRun(m);for(let m of i.patch)m.id!==void 0&&await this.updateRun(m.id,m);return}let a=(h=(f=(d=this.serverInfo)==null?void 0:d.batch_ingest_config)==null?void 0:f.size_limit_bytes)!=null?h:C_,o={post:[],patch:[]},u=0;for(let m of["post","patch"]){let p=m,g=i[p].reverse(),y=g.pop();for(;y!==void 0;){let b=JSON.stringify(y);u>0&&u+b.length>a&&(await this._postBatchIngestRuns(JSON.stringify(o)),u=0,o.post=[],o.patch=[]),u+=b.length,o[p].push(y),y=g.pop()}}(o.post.length>0||o.patch.length>0)&&await this._postBatchIngestRuns(JSON.stringify(o))}async _postBatchIngestRuns(e){let t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},n=await this.batchIngestCaller.call(fetch,`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await jr(n,"batch create run")}async updateRun(e,t){le(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));let n={...t,id:e};if(!this._filterForSampling([n],!0).length)return;if(this.autoBatchTracing&&n.trace_id!==void 0&&n.dotted_order!==void 0){if(t.end_time!==void 0&&n.parent_run_id===void 0){await this.processRunOperation({action:"update",item:n},!0);return}else this.processRunOperation({action:"update",item:n}).catch(console.error);return}let s={...this.headers,"Content-Type":"application/json"},i=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await jr(i,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){le(e);let n=await this._get(`/runs/${e}`);return t&&n.child_run_ids&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:t,projectOpts:n}){if(t!==void 0){let s;t.session_id?s=t.session_id:n!=null&&n.projectName?s=(await this.readProject({projectName:n==null?void 0:n.projectName})).id:n!=null&&n.projectId?s=n==null?void 0:n.projectId:s=(await this.readProject({projectName:or("LANGCHAIN_PROJECT")||"default"})).id;let i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){let s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await I_(this.listRuns({id:e.child_run_ids})),n={},s={};t.sort((i,a)=>{var o,u;return((o=i==null?void 0:i.dotted_order)!=null?o:"").localeCompare((u=a==null?void 0:a.dotted_order)!=null?u:"")});for(let i of t){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);i.parent_run_id in n||(n[i.parent_run_id]=[]),n[i.parent_run_id].push(i),s[i.id]=i}e.child_runs=n[e.id]||[];for(let i in n)i!==e.id&&(s[i].child_runs=n[i]);return e}async*listRuns(e){let{projectId:t,projectName:n,parentRunId:s,traceId:i,referenceExampleId:a,startTime:o,executionOrder:u,runType:c,error:l,id:d,query:f,filter:h,traceFilter:m,treeFilter:p,limit:g}=e,y=[];if(t&&(y=Array.isArray(t)?t:[t]),n){let O=Array.isArray(n)?n:[n],E=await Promise.all(O.map(T=>this.readProject({projectName:T}).then(_=>_.id)));y.push(...E)}let b={session:y.length?y:null,run_type:c,reference_example:a,query:f,filter:h,trace_filter:m,tree_filter:p,execution_order:u,parent_run:s,start_time:o?o.toISOString():null,error:l,id:d,limit:g,trace:i};for await(let O of this._getCursorPaginatedList("/runs/query",b))yield*O}async shareRun(e,{shareId:t}={}){let n={run_id:e,share_token:t||Be()};le(e);let i=await(await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(i===null||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){le(e);let t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await jr(t,"unshare run")}async readRunSharedLink(e){le(e);let n=await(await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let n=new URLSearchParams({share_token:e});if(t!==void 0)for(let a of t)n.append("id",a);return le(e),await(await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),le(e);let s=await(await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);let n={dataset_id:e};le(e);let i=await(await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){le(e);let t=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await jr(t,"unshare dataset")}async readSharedDataset(e){return le(e),await(await this.caller.call(fetch,`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createProject({projectName:e,description:t=null,metadata:n=null,upsert:s=!1,projectExtra:i=null,referenceDatasetId:a=null}){let o=s?"?upsert=true":"",u=`${this.apiUrl}/sessions${o}`,c=i||{};n&&(c.metadata=n);let l={name:e,extra:c,description:t};a!==null&&(l.reference_dataset_id=a);let d=await this.caller.call(fetch,u,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),f=await d.json();if(!d.ok)throw new Error(`Failed to create session ${e}: ${d.status} ${d.statusText}`);return f}async updateProject(e,{name:t=null,description:n=null,metadata:s=null,projectExtra:i=null,endTime:a=null}){let o=`${this.apiUrl}/sessions/${e}`,u=i;s&&(u={...u||{},metadata:s});let c={name:t,extra:u,description:n,end_time:a?new Date(a).toISOString():null},l=await this.caller.call(fetch,o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),d=await l.json();if(!l.ok)throw new Error(`Failed to update project ${e}: ${l.status} ${l.statusText}`);return d}async hasProject({projectId:e,projectName:t}){let n="/sessions",s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)le(e),n+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");let i=await this.caller.call(fetch,`${this.apiUrl}${n}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{let a=await i.json();return i.ok?Array.isArray(a)?a.length>0:!0:!1}catch(a){return!1}}async readProject({projectId:e,projectName:t,includeStats:n}){let s="/sessions",i=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)le(e),s+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide projectName or projectId");n!==void 0&&i.append("include_stats",n.toString());let a=await this._get(s,i),o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=a[0]}else o=a;return o}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:n,referenceDatasetId:s,referenceDatasetName:i,referenceFree:a}={}){let o=new URLSearchParams;if(e!==void 0)for(let u of e)o.append("id",u);if(t!==void 0&&o.append("name",t),n!==void 0&&o.append("name_contains",n),s!==void 0)o.append("reference_dataset",s);else if(i!==void 0){let u=await this.readDataset({datasetName:i});o.append("reference_dataset",u.id)}a!==void 0&&o.append("reference_free",a.toString());for await(let u of this._getPaginated("/sessions",o))yield*u}async deleteProject({projectId:e,projectName:t}){let n;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:t})).id:n=e,le(n);let s=await this.caller.call(fetch,`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await jr(s,`delete session ${n} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:n,outputKeys:s,description:i,dataType:a,name:o}){let u=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,t),n.forEach(f=>{c.append("input_keys",f)}),s.forEach(f=>{c.append("output_keys",f)}),i&&c.append("description",i),a&&c.append("data_type",a),o&&c.append("name",o);let l=await this.caller.call(fetch,u,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!l.ok){let f=await l.json();throw f.detail&&f.detail.includes("already exists")?new Error(`Dataset ${t} already exists`):new Error(`Failed to upload CSV: ${l.status} ${l.statusText}`)}return await l.json()}async createDataset(e,{description:t,dataType:n}={}){let s={name:e,description:t};n&&(s.data_type=n);let i=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok){let o=await i.json();throw o.detail&&o.detail.includes("already exists")?new Error(`Dataset ${e} already exists`):new Error(`Failed to create dataset ${i.status} ${i.statusText}`)}return await i.json()}async readDataset({datasetId:e,datasetName:t}){let n="/datasets",s=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)le(e),n+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");let i=await this._get(n,s),a;if(Array.isArray(i)){if(i.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=i[0]}else a=i;return a}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:n,toVersion:s}){let i=e;if(i===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(await this.readDataset({datasetName:t})).id);let a=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${i}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){let n="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:n,datasetName:s,datasetNameContains:i}={}){let a="/datasets",o=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(n!==void 0)for(let u of n)o.append("id",u);s!==void 0&&o.append("name",s),i!==void 0&&o.append("name_contains",i);for await(let u of this._getPaginated(a,o))yield*u}async deleteDataset({datasetId:e,datasetName:t}){let n="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)le(s),n+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");let i=await this.caller.call(fetch,this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok)throw new Error(`Failed to delete ${n}: ${i.status} ${i.statusText}`);await i.json()}async createExample(e,t,{datasetId:n,datasetName:s,createdAt:i,exampleId:a}){let o=n;if(o===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(o!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");o===void 0&&(o=(await this.readDataset({datasetName:s})).id);let u=i||new Date,c={dataset_id:o,inputs:e,outputs:t,created_at:u==null?void 0:u.toISOString(),id:a},l=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!l.ok)throw new Error(`Failed to create example: ${l.status} ${l.statusText}`);return await l.json()}async createExamples(e){let{inputs:t,outputs:n,sourceRunIds:s,exampleIds:i,datasetId:a,datasetName:o}=e,u=a;if(u===void 0&&o===void 0)throw new Error("Must provide either datasetName or datasetId");if(u!==void 0&&o!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");u===void 0&&(u=(await this.readDataset({datasetName:o})).id);let c=t.map((f,h)=>({dataset_id:u,inputs:f,outputs:n?n[h]:void 0,id:i?i[h]:void 0,source_run_id:s?s[h]:void 0})),l=await this.caller.call(fetch,`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!l.ok)throw new Error(`Failed to create examples: ${l.status} ${l.statusText}`);return await l.json()}async createLLMExample(e,t,n){return this.createExample({input:e},{output:t},n)}async createChatExample(e,t,n){let s=e.map(a=>ul(a)?cl(a):a),i=ul(t)?cl(t):t;return this.createExample({input:s},{output:i},n)}async readExample(e){le(e);let t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:n,asOf:s,inlineS3Urls:i}={}){let a;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)a=e;else if(t!==void 0)a=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");let o=new URLSearchParams({dataset:a}),u=s?typeof s=="string"?s:s==null?void 0:s.toISOString():void 0;u&&o.append("as_of",u);let c=i!=null?i:!0;if(o.append("inline_s3_urls",c.toString()),n!==void 0)for(let l of n)o.append("id",l);for await(let l of this._getPaginated("/examples",o))yield*l}async deleteExample(e){le(e);let t=`/examples/${e}`,n=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw new Error(`Failed to delete ${t}: ${n.status} ${n.statusText}`);await n.json()}async updateExample(e,t){le(e);let n=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw new Error(`Failed to update example ${e}: ${n.status} ${n.statusText}`);return await n.json()}async evaluateRun(e,t,{sourceInfo:n,loadChildRuns:s,referenceExample:i}={loadChildRuns:!1}){var l;let a;if(typeof e=="string")a=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)a=e;else throw new Error(`Invalid run type: ${typeof e}`);a.reference_example_id!==null&&a.reference_example_id!==void 0&&(i=await this.readExample(a.reference_example_id));let o=await t.evaluateRun(a,i),u=n!=null?n:{};o.evaluatorInfo&&(u={...u,...o.evaluatorInfo});let c=(l=o.targetRunId)!=null?l:a.id;return await this.createFeedback(c,o.key,{score:o==null?void 0:o.score,value:o==null?void 0:o.value,comment:o==null?void 0:o.comment,correction:o==null?void 0:o.correction,sourceInfo:u,feedbackSourceType:"model",sourceRunId:o==null?void 0:o.sourceRunId})}async createFeedback(e,t,{score:n,value:s,correction:i,comment:a,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:c,feedbackId:l,feedbackConfig:d}){var g;let f={type:u!=null?u:"api",metadata:o!=null?o:{}};c!==void 0&&(f==null?void 0:f.metadata)!==void 0&&!f.metadata.__run&&(f.metadata.__run={run_id:c}),(f==null?void 0:f.metadata)!==void 0&&((g=f.metadata.__run)==null?void 0:g.run_id)!==void 0&&le(f.metadata.__run.run_id);let h={id:l!=null?l:Be(),run_id:e,key:t,score:n,value:s,correction:i,comment:a,feedback_source:f,feedbackConfig:d},m=`${this.apiUrl}/feedback`,p=await this.caller.call(fetch,m,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(h),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await jr(p,"create feedback"),h}async updateFeedback(e,{score:t,value:n,correction:s,comment:i}){let a={};t!=null&&(a.score=t),n!=null&&(a.value=n),s!=null&&(a.correction=s),i!=null&&(a.comment=i),le(e);let o=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await jr(o,"update feedback")}async readFeedback(e){le(e);let t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){le(e);let t=`/feedback/${e}`,n=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw new Error(`Failed to delete ${t}: ${n.status} ${n.statusText}`);await n.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){let s=new URLSearchParams;if(e&&s.append("run",e.join(",")),t)for(let i of t)s.append("key",i);if(n)for(let i of n)s.append("source",i);for await(let i of this._getPaginated("/feedback",s))yield*i}async createPresignedFeedbackToken(e,t,{expiration:n,feedbackConfig:s}={}){let i={run_id:e,feedback_key:t,feedback_config:s};return n?typeof n=="string"?i.expires_at=n:(n!=null&&n.hours||n!=null&&n.minutes||n!=null&&n.days)&&(i.expires_in=n):i.expires_in={hours:3},await(await this.caller.call(fetch,`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){le(e);let t=new URLSearchParams({run_id:e});for await(let n of this._getPaginated("/feedback/tokens",t))yield*n}};var Mo="0.1.14";var Ui=class extends _t{constructor(e={}){var i;super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{exampleId:t,projectName:n,client:s}=e;this.projectName=(i=n!=null?n:ae("LANGCHAIN_PROJECT"))!=null?i:ae("LANGCHAIN_SESSION"),this.exampleId=t,this.client=s!=null?s:new Cs({})}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await $f()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){let t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){let t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}};async function Oh(){return new Ui}var Do=ht(xo(),1),ml;function N_(){let r="default"in Do.default?Do.default.default:Do.default;return new r({autoStart:!0,concurrency:1})}async function Ae(r,e){e===!0?await r():(typeof ml=="undefined"&&(ml=N_()),ml.add(r))}ae("LANGCHAIN_TRACING_V2")==="true"&&ae("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"&&["[WARN]: You have enabled LangSmith tracing without backgrounding callbacks.","[WARN]: If you are not using a serverless environment where you must wait for tracing calls to finish,",'[WARN]: we suggest setting "process.env.LANGCHAIN_CALLBACKS_BACKGROUND=true" to avoid additional latency.'].join(`
`);function Eh(r){return r?Array.isArray(r)||"name"in r?{callbacks:r}:r:{}}var gl=class{setHandler(e){return this.setHandlers([e])}},Ns=class{constructor(e,t,n,s,i,a,o,u){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:u})}async handleText(e){await Promise.all(this.handlers.map(t=>Ae(async()=>{var n;try{await((n=t.handleText)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleText: ${s}`)}},t.awaitHandlers)))}},yl=class extends Ns{getChild(e){let t=new Oe(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>Ae(async()=>{var n;if(!t.ignoreRetriever)try{await((n=t.handleRetrieverEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>Ae(async()=>{var n;if(!t.ignoreRetriever)try{await((n=t.handleRetrieverError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${s}`)}},t.awaitHandlers)))}},Bo=class extends Ns{async handleLLMNewToken(e,t,n,s,i,a){await Promise.all(this.handlers.map(o=>Ae(async()=>{var u;if(!o.ignoreLLM)try{await((u=o.handleLLMNewToken)==null?void 0:u.call(o,e,t!=null?t:{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a))}catch(c){console.error(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${c}`)}},o.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>Ae(async()=>{var n;if(!t.ignoreLLM)try{await((n=t.handleLLMError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${s}`)}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>Ae(async()=>{var n;if(!t.ignoreLLM)try{await((n=t.handleLLMEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${s}`)}},t.awaitHandlers)))}},bl=class extends Ns{getChild(e){let t=new Oe(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,n,s,i){await Promise.all(this.handlers.map(a=>Ae(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainError)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(u){console.error(`Error in handler ${a.constructor.name}, handleChainError: ${u}`)}},a.awaitHandlers)))}async handleChainEnd(e,t,n,s,i){await Promise.all(this.handlers.map(a=>Ae(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainEnd)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(u){console.error(`Error in handler ${a.constructor.name}, handleChainEnd: ${u}`)}},a.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>Ae(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentAction)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${s}`)}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>Ae(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleAgentEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${s}`)}},t.awaitHandlers)))}},_l=class extends Ns{getChild(e){let t=new Oe(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>Ae(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolError)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${s}`)}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>Ae(async()=>{var n;if(!t.ignoreAgent)try{await((n=t.handleToolEnd)==null?void 0:n.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${s}`)}},t.awaitHandlers)))}},Oe=class r extends gl{constructor(e,t){var n,s,i,a,o,u;super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(n=t==null?void 0:t.handlers)!=null?n:this.handlers,this.inheritableHandlers=(s=t==null?void 0:t.inheritableHandlers)!=null?s:this.inheritableHandlers,this.tags=(i=t==null?void 0:t.tags)!=null?i:this.tags,this.inheritableTags=(a=t==null?void 0:t.inheritableTags)!=null?a:this.inheritableTags,this.metadata=(o=t==null?void 0:t.metadata)!=null?o:this.metadata,this.inheritableMetadata=(u=t==null?void 0:t.inheritableMetadata)!=null?u:this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,n=void 0,s=void 0,i=void 0,a=void 0,o=void 0,u=void 0){return Promise.all(t.map(async c=>{let l=Be();return await Promise.all(this.handlers.map(d=>Ae(async()=>{var f;if(!d.ignoreLLM)try{await((f=d.handleLLMStart)==null?void 0:f.call(d,e,[c],l,this._parentRunId,i,this.tags,this.metadata,u))}catch(h){console.error(`Error in handler ${d.constructor.name}, handleLLMStart: ${h}`)}},d.awaitHandlers))),new Bo(l,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,n=void 0,s=void 0,i=void 0,a=void 0,o=void 0,u=void 0){return Promise.all(t.map(async c=>{let l=Be();return await Promise.all(this.handlers.map(d=>Ae(async()=>{var f,h;if(!d.ignoreLLM)try{if(d.handleChatModelStart)await((f=d.handleChatModelStart)==null?void 0:f.call(d,e,[c],l,this._parentRunId,i,this.tags,this.metadata,u));else if(d.handleLLMStart){let m=xs(c);await((h=d.handleLLMStart)==null?void 0:h.call(d,e,[m],l,this._parentRunId,i,this.tags,this.metadata,u))}}catch(m){console.error(`Error in handler ${d.constructor.name}, handleLLMStart: ${m}`)}},d.awaitHandlers))),new Bo(l,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,n=Be(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>Ae(async()=>{var c;if(!u.ignoreChain)try{await((c=u.handleChainStart)==null?void 0:c.call(u,e,t,n,this._parentRunId,this.tags,this.metadata,s,o))}catch(l){console.error(`Error in handler ${u.constructor.name}, handleChainStart: ${l}`)}},u.awaitHandlers))),new bl(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,n=Be(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>Ae(async()=>{var c;if(!u.ignoreAgent)try{await((c=u.handleToolStart)==null?void 0:c.call(u,e,t,n,this._parentRunId,this.tags,this.metadata,o))}catch(l){console.error(`Error in handler ${u.constructor.name}, handleToolStart: ${l}`)}},u.awaitHandlers))),new _l(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,n=Be(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>Ae(async()=>{var c;if(!u.ignoreRetriever)try{await((c=u.handleRetrieverStart)==null?void 0:c.call(u,e,t,n,this._parentRunId,this.tags,this.metadata,o))}catch(l){console.error(`Error in handler ${u.constructor.name}, handleRetrieverStart: ${l}`)}},u.awaitHandlers))),new yl(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(let n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let n=new r(this._parentRunId);for(let s of this.handlers){let i=this.inheritableHandlers.includes(s);n.addHandler(s,i)}for(let s of this.tags){let i=this.inheritableTags.includes(s);n.addTags([s],i)}for(let s of Object.keys(this.metadata)){let i=Object.keys(this.inheritableMetadata).includes(s);n.addMetadata({[s]:this.metadata[s]},i)}for(let s of e)n.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===s.name)||n.addHandler(s,t);return n}static fromHandlers(e){class t extends jn{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Be()}),Object.assign(this,e)}}let n=new this;return n.addHandler(new t),n}static async configure(e,t,n,s,i,a,o){var f,h;let u;(e||t)&&(Array.isArray(e)||!e?(u=new r,u.setHandlers((f=e==null?void 0:e.map(zi))!=null?f:[],!0)):u=e,u=u.copy(Array.isArray(t)?t.map(zi):t==null?void 0:t.handlers,!1));let c=ae("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),l=ae("LANGCHAIN_TRACING_V2")==="true",d=l||((h=ae("LANGCHAIN_TRACING"))!=null?h:!1);if(c||d){if(u||(u=new r),c&&!u.handlers.some(m=>m.name===Bi.prototype.name)){let m=new Bi;u.addHandler(m,!0)}d&&!u.handlers.some(m=>m.name==="langchain_tracer")&&l&&u.addHandler(await Oh(),!0)}return(n||s)&&u&&(u.addTags(n!=null?n:[]),u.addTags(s!=null?s:[],!1)),(i||a)&&u&&(u.addMetadata(i!=null?i:{}),u.addMetadata(a!=null?a:{},!1)),u}};function zi(r){return"name"in r?r:jn.fromMethods(r)}var wl={};kc(wl,{JsonPatchError:()=>he,_areEquals:()=>qi,applyOperation:()=>Ln,applyPatch:()=>$r,applyReducer:()=>L_,deepClone:()=>j_,getValueByPointer:()=>qo,validate:()=>Th,validator:()=>Vo});var R_=Object.prototype.hasOwnProperty;function Uo(r,e){return R_.call(r,e)}function zo(r){if(Array.isArray(r)){let t=new Array(r.length);for(let n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(r);let e=[];for(let t in r)Uo(r,t)&&e.push(t);return e}function Re(r){switch(typeof r){case"object":return JSON.parse(JSON.stringify(r));case"undefined":return null;default:return r}}function Ko(r){let e=0,t=r.length,n;for(;e<t;){if(n=r.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function Bt(r){return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}function Ki(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}function Fo(r){if(r===void 0)return!0;if(r){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(Fo(r[t]))return!0}else if(typeof r=="object"){let t=zo(r),n=t.length;for(var e=0;e<n;e++)if(Fo(r[t[e]]))return!0}}return!1}function Sh(r,e){let t=[r];for(let n in e){let s=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof s!="undefined"&&t.push(`${n}: ${s}`)}return t.join(`
`)}var $n=class extends Error{constructor(e,t,n,s,i){super(Sh(e,{name:t,index:n,operation:s,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=Sh(e,{name:t,index:n,operation:s,tree:i})}};var he=$n,j_=Re,Rs={add:function(r,e,t){return r[e]=this.value,{newDocument:t}},remove:function(r,e,t){var n=r[e];return delete r[e],{newDocument:t,removed:n}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:function(r,e,t){let n=qo(t,this.path);n&&(n=Re(n));let s=Ln(t,{op:"remove",path:this.from}).removed;return Ln(t,{op:"add",path:this.path,value:s}),{newDocument:t,removed:n}},copy:function(r,e,t){let n=qo(t,this.from);return Ln(t,{op:"add",path:this.path,value:Re(n)}),{newDocument:t}},test:function(r,e,t){return{newDocument:t,test:qi(r[e],this.value)}},_get:function(r,e,t){return this.value=r[e],{newDocument:t}}},$_={add:function(r,e,t){return Ko(e)?r.splice(e,0,this.value):r[e]=this.value,{newDocument:t,index:e}},remove:function(r,e,t){var n=r.splice(e,1);return{newDocument:t,removed:n[0]}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:Rs.move,copy:Rs.copy,test:Rs.test,_get:Rs._get};function qo(r,e){if(e=="")return r;var t={op:"_get",path:e};return Ln(r,t),t.value}function Ln(r,e,t=!1,n=!0,s=!0,i=0){if(t&&(typeof t=="function"?t(e,0,r,e.path):Vo(e,0)),e.path===""){let a={newDocument:r};if(e.op==="add")return a.newDocument=e.value,a;if(e.op==="replace")return a.newDocument=e.value,a.removed=r,a;if(e.op==="move"||e.op==="copy")return a.newDocument=qo(r,e.from),e.op==="move"&&(a.removed=r),a;if(e.op==="test"){if(a.test=qi(r,e.value),a.test===!1)throw new he("Test operation failed","TEST_OPERATION_FAILED",i,e,r);return a.newDocument=r,a}else{if(e.op==="remove")return a.removed=r,a.newDocument=null,a;if(e.op==="_get")return e.value=r,a;if(t)throw new he("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,e,r);return a}}else{n||(r=Re(r));let o=(e.path||"").split("/"),u=r,c=1,l=o.length,d,f,h;for(typeof t=="function"?h=t:h=Vo;;){if(f=o[c],f&&f.indexOf("~")!=-1&&(f=Ki(f)),s&&(f=="__proto__"||f=="prototype"&&c>0&&o[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(u[f]===void 0?d=o.slice(0,c).join("/"):c==l-1&&(d=e.path),d!==void 0&&h(e,0,r,d)),c++,Array.isArray(u)){if(f==="-")f=u.length;else{if(t&&!Ko(f))throw new he("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,e,r);Ko(f)&&(f=~~f)}if(c>=l){if(t&&e.op==="add"&&f>u.length)throw new he("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,e,r);let m=$_[e.op].call(e,u,f,r);if(m.test===!1)throw new he("Test operation failed","TEST_OPERATION_FAILED",i,e,r);return m}}else if(c>=l){let m=Rs[e.op].call(e,u,f,r);if(m.test===!1)throw new he("Test operation failed","TEST_OPERATION_FAILED",i,e,r);return m}if(u=u[f],t&&c<l&&(!u||typeof u!="object"))throw new he("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,e,r)}}}function $r(r,e,t,n=!0,s=!0){if(t&&!Array.isArray(e))throw new he("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(r=Re(r));let i=new Array(e.length);for(let a=0,o=e.length;a<o;a++)i[a]=Ln(r,e[a],t,!0,s,a),r=i[a].newDocument;return i.newDocument=r,i}function L_(r,e,t){let n=Ln(r,e);if(n.test===!1)throw new he("Test operation failed","TEST_OPERATION_FAILED",t,e,r);return n.newDocument}function Vo(r,e,t,n){if(typeof r!="object"||r===null||Array.isArray(r))throw new he("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,r,t);if(Rs[r.op]){if(typeof r.path!="string")throw new he("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,r,t);if(r.path.indexOf("/")!==0&&r.path.length>0)throw new he('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,r,t);if((r.op==="move"||r.op==="copy")&&typeof r.from!="string")throw new he("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&r.value===void 0)throw new he("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&Fo(r.value))throw new he("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,r,t);if(t){if(r.op=="add"){var s=r.path.split("/").length,i=n.split("/").length;if(s!==i+1&&s!==i)throw new he("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,r,t)}else if(r.op==="replace"||r.op==="remove"||r.op==="_get"){if(r.path!==n)throw new he("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,r,t)}else if(r.op==="move"||r.op==="copy"){var a={op:"_get",path:r.from,value:void 0},o=Th([a],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new he("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,r,t)}}}else throw new he("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,r,t)}function Th(r,e,t){try{if(!Array.isArray(r))throw new he("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)$r(Re(e),Re(r),t||!0);else{t=t||Vo;for(var n=0;n<r.length;n++)t(r[n],n,e,void 0)}}catch(s){if(s instanceof he)return s;throw s}}function qi(r,e){if(r===e)return!0;if(r&&e&&typeof r=="object"&&typeof e=="object"){var t=Array.isArray(r),n=Array.isArray(e),s,i,a;if(t&&n){if(i=r.length,i!=e.length)return!1;for(s=i;s--!==0;)if(!qi(r[s],e[s]))return!1;return!0}if(t!=n)return!1;var o=Object.keys(r);if(i=o.length,i!==Object.keys(e).length)return!1;for(s=i;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=i;s--!==0;)if(a=o[s],!qi(r[a],e[a]))return!1;return!0}return r!==r&&e!==e}function Ph(r,e,t,n,s){if(e!==r){typeof e.toJSON=="function"&&(e=e.toJSON());for(var i=zo(e),a=zo(r),o=!1,u=!1,c=a.length-1;c>=0;c--){var l=a[c],d=r[l];if(Uo(e,l)&&!(e[l]===void 0&&d!==void 0&&Array.isArray(e)===!1)){var f=e[l];typeof d=="object"&&d!=null&&typeof f=="object"&&f!=null&&Array.isArray(d)===Array.isArray(f)?Ph(d,f,t,n+"/"+Bt(l),s):d!==f&&(o=!0,s&&t.push({op:"test",path:n+"/"+Bt(l),value:Re(d)}),t.push({op:"replace",path:n+"/"+Bt(l),value:Re(f)}))}else Array.isArray(r)===Array.isArray(e)?(s&&t.push({op:"test",path:n+"/"+Bt(l),value:Re(d)}),t.push({op:"remove",path:n+"/"+Bt(l)}),u=!0):(s&&t.push({op:"test",path:n,value:r}),t.push({op:"replace",path:n,value:e}),o=!0)}if(!(!u&&i.length==a.length))for(var c=0;c<i.length;c++){var l=i[c];!Uo(r,l)&&e[l]!==void 0&&t.push({op:"add",path:n+"/"+Bt(l),value:Re(e[l])})}}}function Zo(r,e,t=!1){var n=[];return Ph(r,e,n,"",t),n}var eO={...wl,JsonPatchError:$n,deepClone:Re,escapePathComponent:Bt,unescapePathComponent:Ki};var Ft=class r extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){let t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}static fromReadableStream(e){let t=e.getReader();return new r({start(n){return s();function s(){return t.read().then(({done:i,value:a})=>{if(i){n.close();return}return n.enqueue(a),s()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new r({async pull(t){let{value:n,done:s}=await e.next();s&&t.close(),t.enqueue(n)},async cancel(t){await e.return(t)}})}};function vl(r,e=2){let t=Array.from({length:e},()=>[]);return t.map(async function*(s){for(;;)if(s.length===0){let i=await r.next();for(let a of t)a.push(i)}else{if(s[0].done)return;yield s.shift().value}})}function Ut(r,e){if(Array.isArray(r)&&Array.isArray(e))return r.concat(e);if(typeof r=="string"&&typeof e=="string")return r+e;if(typeof r=="number"&&typeof e=="number")return r+e;if("concat"in r&&typeof r.concat=="function")return r.concat(e);if(typeof r=="object"&&typeof e=="object"){let t={...r};for(let[n,s]of Object.entries(e))n in t&&!Array.isArray(t[n])?t[n]=Ut(t[n],s):t[n]=s;return t}else throw new Error(`Cannot concat ${typeof r} and ${typeof e}`)}var ur=class{constructor(e,t){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e,this.setup=new Promise((n,s)=>{this.firstResult=e.next(),t?this.firstResult.then(t).then(n,s):this.firstResult.then(i=>n(void 0),s)})}async next(...e){return this.firstResultUsed?this.generator.next(...e):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}};async function Ih(r,e,t,...n){let s=new ur(e,t),i=await s.setup;return{output:r(s,i,...n),setup:i}}var vt=class{constructor(e){var t;Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=(t=e.ops)!=null?t:[]}concat(e){let t=this.ops.concat(e.ops),n=$r({},t);return new Vi({ops:t,state:n[n.length-1].newDocument})}},Vi=class r extends vt{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),n=$r(this.state,e.ops);return new r({ops:t,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){let t=$r({},e.ops);return new r({ops:e.ops,state:t[t.length-1].newDocument})}};async function kh(r,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:t}=r;if(["retriever","llm","prompt"].includes(r.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function Ch(r,e){let{outputs:t}=r;return e==="original"||["retriever","llm","prompt"].includes(r.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function M_(r){return r!==void 0&&r.message!==void 0}var Zi=class extends _t{constructor(e){var t,n;super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=(t=e==null?void 0:e.autoClose)!=null?t:!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(n=e==null?void 0:e._schemaFormat)!=null?n:this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Ft.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){var s;if(e.id===this.rootId)return!1;let t=(s=e.tags)!=null?s:[],n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||t.find(i=>{var a;return(a=this.includeTags)==null?void 0:a.includes(i)})!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&t.every(i=>{var a;return!((a=this.excludeTags)!=null&&a.includes(i))})),n}async*tapOutputIterable(e,t){for await(let n of t){if(e!==this.rootId){let s=this.keyMapByRunId[e];s&&await this.writer.write(new vt({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){var s,i,a;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new vt({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;let n={id:e.id,name:e.name,type:e.run_type,tags:(s=e.tags)!=null?s:[],metadata:(a=(i=e.extra)==null?void 0:i.metadata)!=null?a:{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await kh(e,this._schemaFormat)),await this.writer.write(new vt({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{let t=this.keyMapByRunId[e.id];if(t===void 0)return;let n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:await kh(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:await Ch(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let s=new vt({ops:n});await this.writer.write(s)}finally{if(e.id===this.rootId){let t=new vt({ops:[{op:"replace",path:"/final_output",value:await Ch(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,n){let s=this.keyMapByRunId[e.id];if(s===void 0)return;let i=e.inputs.messages!==void 0,a;i?M_(n==null?void 0:n.chunk)?a=n==null?void 0:n.chunk:a=new Qt(t):a=t;let o=new vt({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${s}/streamed_output/-`,value:a}]});await this.writer.write(o)}};var xl=class{getStore(){}run(e,t){t()}},Al=class{constructor(){Object.defineProperty(this,"asyncLocalStorage",{enumerable:!0,configurable:!0,writable:!0,value:new xl}),Object.defineProperty(this,"hasBeenInitialized",{enumerable:!0,configurable:!0,writable:!0,value:!1})}getInstance(){return this.asyncLocalStorage}initializeGlobalInstance(e){this.hasBeenInitialized||(this.hasBeenInitialized=!0,this.asyncLocalStorage=e)}},Hi=new Al;var Ho=25;async function zt(r){return Oe.configure(r==null?void 0:r.callbacks,void 0,r==null?void 0:r.tags,void 0,r==null?void 0:r.metadata)}function Ol(...r){var t,n,s;let e={};for(let i of r.filter(a=>!!a))for(let a of Object.keys(i))if(a==="metadata")e[a]={...e[a],...i[a]};else if(a==="tags"){let o=(t=e[a])!=null?t:[];e[a]=[...new Set(o.concat((n=i[a])!=null?n:[]))]}else if(a==="configurable")e[a]={...e[a],...i[a]};else if(a==="callbacks"){let o=e.callbacks,u=i.callbacks;if(Array.isArray(u))if(!o)e.callbacks=u;else if(Array.isArray(o))e.callbacks=o.concat(u);else{let c=o.copy();for(let l of u)c.addHandler(zi(l),!0);e.callbacks=c}else if(u)if(!o)e.callbacks=u;else if(Array.isArray(o)){let c=u.copy();for(let l of o)c.addHandler(zi(l),!0);e.callbacks=c}else e.callbacks=new Oe(u._parentRunId,{handlers:o.handlers.concat(u.handlers),inheritableHandlers:o.inheritableHandlers.concat(u.inheritableHandlers),tags:Array.from(new Set(o.tags.concat(u.tags))),inheritableTags:Array.from(new Set(o.inheritableTags.concat(u.inheritableTags))),metadata:{...o.metadata,...u.metadata}})}else{let o=a;e[o]=(s=i[o])!=null?s:e[o]}return e}var D_=new Set(["string","number","boolean"]);function oe(r){var n;let e=r!=null?r:Hi.getInstance().getStore(),t={tags:[],metadata:{},callbacks:void 0,recursionLimit:25};if(e&&(t={...t,...e}),e!=null&&e.configurable)for(let s of Object.keys(e.configurable))D_.has(typeof e.configurable[s])&&!((n=t.metadata)!=null&&n[s])&&(t.metadata||(t.metadata={}),t.metadata[s]=e.configurable[s]);return t}function Pe(r={},{callbacks:e,maxConcurrency:t,recursionLimit:n,runName:s,configurable:i}={}){let a=oe(r);return e!==void 0&&(delete a.runName,a.callbacks=e),n!==void 0&&(a.recursionLimit=n),t!==void 0&&(a.maxConcurrency=t),s!==void 0&&(a.runName=s),i!==void 0&&(a.configurable={...a.configurable,...i}),a}var Gi=class extends _t{constructor({config:e,onStart:t,onEnd:n,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&(this.argOnStart.length===1?await this.argOnStart(e):this.argOnStart.length===2&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(this.argOnError.length===1?await this.argOnError(e):this.argOnError.length===2&&await this.argOnError(e,this.config)):this.argOnEnd&&(this.argOnEnd.length===1?await this.argOnEnd(e):this.argOnEnd.length===2&&await this.argOnEnd(e,this.config)))}};function Jo(r){return r?r.lc_runnable:!1}var Go=class{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){var i;let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0,s=(i=e.tags)!=null?i:[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(t)),this.includeTags!==void 0&&(n=n||s.some(a=>{var o;return(o=this.includeTags)==null?void 0:o.includes(a)})),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(n=n&&s.every(a=>{var o;return!((o=this.excludeTags)!=null&&o.includes(a))})),n}};function El(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function X(r,e,t,n,s){r[e]=t,El(r,e,n,s)}var Nh={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"string",mapStrategy:"entries",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",emailStrategy:"format:email"},Rh=r=>typeof r=="string"?{...Nh,name:r}:{...Nh,...r};function jh(){return{}}function $h(r,e){var n,s;let t={type:"array"};return((s=(n=r.type)==null?void 0:n._def)==null?void 0:s.typeName)!==w.ZodAny&&(t.items=D(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&X(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&X(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(X(t,"minItems",r.exactLength.value,r.exactLength.message,e),X(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function Lh(r,e){let t={type:"integer",format:"int64"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?X(t,"minimum",n.value,n.message,e):X(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),X(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?X(t,"maximum",n.value,n.message,e):X(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),X(t,"maximum",n.value,n.message,e));break;case"multipleOf":X(t,"multipleOf",n.value,n.message,e);break}return t}function Mh(){return{type:"boolean"}}function Dh(r,e){return D(r.type._def,e)}var Bh=(r,e)=>D(r.innerType._def,e);function Fh(r,e){return e.dateStrategy=="integer"?B_(r,e):{type:"string",format:"date-time"}}var B_=(r,e)=>{let t={type:"integer",format:"unix-time"};for(let n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"&&X(t,"minimum",n.value,n.message,e);break;case"max":e.target==="jsonSchema7"&&X(t,"maximum",n.value,n.message,e);break}return t};function Uh(r,e){return{...D(r.innerType._def,e),default:r.defaultValue()}}function zh(r,e){return e.effectStrategy==="input"?D(r.schema._def,e):{}}function Kh(r){return{type:"string",enum:r.values}}var F_=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function qh(r,e){let t=[D(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),D(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,s=[];return t.forEach(i=>{if(F_(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(n=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){let{additionalProperties:o,...u}=i;a=u}else n=void 0;s.push(a)}}),s.length?{allOf:s,...n}:void 0}function Vh(r,e){let t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}var Ji={cuid:"^[cC][^\\s-]{8,}$",cuid2:"^[a-z][a-z0-9]*$",ulid:"^[0-9A-HJKMNP-TV-Z]{26}$",email:"^(?!\\.)(?!.*\\.\\.)([a-zA-Z0-9_+-\\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\\-]*\\.)+[a-zA-Z]{2,}$",emoji:"^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",uuid:"^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$",ipv4:"^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$",ipv6:"^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$"};function Wo(r,e){let t={type:"string"};function n(s){return e.patternStrategy==="escape"?U_(s):s}if(r.checks)for(let s of r.checks)switch(s.kind){case"min":X(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e);break;case"max":X(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Mn(t,"email",s.message,e);break;case"format:idn-email":Mn(t,"idn-email",s.message,e);break;case"pattern:zod":cr(t,Ji.email,s.message,e);break}break;case"url":Mn(t,"uri",s.message,e);break;case"uuid":Mn(t,"uuid",s.message,e);break;case"regex":cr(t,s.regex.source,s.message,e);break;case"cuid":cr(t,Ji.cuid,s.message,e);break;case"cuid2":cr(t,Ji.cuid2,s.message,e);break;case"startsWith":cr(t,"^"+n(s.value),s.message,e);break;case"endsWith":cr(t,n(s.value)+"$",s.message,e);break;case"datetime":Mn(t,"date-time",s.message,e);break;case"length":X(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e),X(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"includes":{cr(t,n(s.value),s.message,e);break}case"ip":{s.version!=="v6"&&Mn(t,"ipv4",s.message,e),s.version!=="v4"&&Mn(t,"ipv6",s.message,e);break}case"emoji":cr(t,Ji.emoji,s.message,e);break;case"ulid":{cr(t,Ji.ulid,s.message,e);break}case"toLowerCase":case"toUpperCase":case"trim":break;default:}return t}var U_=r=>Array.from(r).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Mn=(r,e,t,n)=>{var s;r.format||(s=r.anyOf)!=null&&s.some(i=>i.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):X(r,"format",e,t,n)},cr=(r,e,t,n)=>{var s;r.pattern||(s=r.allOf)!=null&&s.some(i=>i.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:e,...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):X(r,"pattern",e,t,n)};function Yo(r,e){var n,s,i,a,o;if(e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===w.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((u,c)=>{var l;return{...u,[c]:(l=D(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",c]}))!=null?l:{}}},{}),additionalProperties:!1};let t={type:"object",additionalProperties:(s=D(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]}))!=null?s:{}};if(e.target==="openApi3")return t;if(((i=r.keyType)==null?void 0:i._def.typeName)===w.ZodString&&((a=r.keyType._def.checks)!=null&&a.length)){let u=Object.entries(Wo(r.keyType._def,e)).reduce((c,[l,d])=>l==="type"?c:{...c,[l]:d},{});return{...t,propertyNames:u}}else if(((o=r.keyType)==null?void 0:o._def.typeName)===w.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};return t}function Zh(r,e){if(e.mapStrategy==="record")return Yo(r,e);let t=D(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=D(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function Hh(r){let e=r.values,n=Object.keys(r.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(n.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function Gh(){return{not:{}}}function Jh(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var Wi={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Yh(r,e){if(e.target==="openApi3")return Wh(r,e);let t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in Wi&&(!n._def.checks||!n._def.checks.length))){let n=t.reduce((s,i)=>{let a=Wi[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=t.reduce((s,i)=>{let a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){let s=n.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(i=>!n.includes(i))],[])};return Wh(r,e)}var Wh=(r,e)=>{let t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>D(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function Xh(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:Wi[r.innerType._def.typeName],nullable:!0}:{type:[Wi[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=D(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}let t=D(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function Qh(r,e){let t={type:"number"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"int":t.type="integer",El(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?X(t,"minimum",n.value,n.message,e):X(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),X(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?X(t,"maximum",n.value,n.message,e):X(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),X(t,"maximum",n.value,n.message,e));break;case"multipleOf":X(t,"multipleOf",n.value,n.message,e);break}return t}function ep(r,e){var n;let t={type:"object",...Object.entries(r.shape()).reduce((s,[i,a])=>{if(a===void 0||a._def===void 0)return s;let o=D(a._def,{...e,currentPath:[...e.currentPath,"properties",i],propertyPath:[...e.currentPath,"properties",i]});return o===void 0?s:{properties:{...s.properties,[i]:o},required:a.isOptional()?s.required:[...s.required,i]}},{properties:{},required:[]}),additionalProperties:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":(n=D(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]}))!=null?n:!0};return t.required.length||delete t.required,t}var tp=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return D(r.innerType._def,e);let t=D(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}};var rp=(r,e)=>{if(e.pipeStrategy==="input")return D(r.in._def,e);if(e.pipeStrategy==="output")return D(r.out._def,e);let t=D(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=D(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function np(r,e){return D(r.type._def,e)}function sp(r,e){let n={type:"array",uniqueItems:!0,items:D(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&X(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&X(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function ip(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>D(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:D(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>D(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function ap(){return{not:{}}}function op(){return{}}var up=(r,e)=>D(r.innerType._def,e);function D(r,e,t=!1){let n=e.seen.get(r);if(n&&!t){let a=z_(n,e);if(a!==void 0)return a}let s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);let i=q_(r,r.typeName,e);return i&&V_(r,e,i),s.jsonSchema=i,i}var z_=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:K_(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((t,n)=>e.currentPath[n]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},K_=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},q_=(r,e,t)=>{switch(e){case w.ZodString:return Wo(r,t);case w.ZodNumber:return Qh(r,t);case w.ZodObject:return ep(r,t);case w.ZodBigInt:return Lh(r,t);case w.ZodBoolean:return Mh();case w.ZodDate:return Fh(r,t);case w.ZodUndefined:return ap();case w.ZodNull:return Jh(t);case w.ZodArray:return $h(r,t);case w.ZodUnion:case w.ZodDiscriminatedUnion:return Yh(r,t);case w.ZodIntersection:return qh(r,t);case w.ZodTuple:return ip(r,t);case w.ZodRecord:return Yo(r,t);case w.ZodLiteral:return Vh(r,t);case w.ZodEnum:return Kh(r);case w.ZodNativeEnum:return Hh(r);case w.ZodNullable:return Xh(r,t);case w.ZodOptional:return tp(r,t);case w.ZodMap:return Zh(r,t);case w.ZodSet:return sp(r,t);case w.ZodLazy:return D(r.getter()._def,t);case w.ZodPromise:return np(r,t);case w.ZodNaN:case w.ZodNever:return Gh();case w.ZodEffects:return zh(r,t);case w.ZodAny:return jh();case w.ZodUnknown:return op();case w.ZodDefault:return Uh(r,t);case w.ZodBranded:return Dh(r,t);case w.ZodReadonly:return up(r,t);case w.ZodCatch:return Bh(r,t);case w.ZodPipeline:return rp(r,t);case w.ZodFunction:case w.ZodVoid:case w.ZodSymbol:return;default:return(n=>{})(e)}},V_=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t);var cp=r=>{let e=Rh(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};var Dn=(r,e)=>{var o;let t=cp(e),n=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((u,[c,l])=>{var d;return{...u,[c]:(d=D(l._def,{...t,currentPath:[...t.basePath,t.definitionPath,c]},!0))!=null?d:{}}},{}):void 0,s=typeof e=="string"?e:e==null?void 0:e.name,i=(o=D(r._def,s===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,s]},!1))!=null?o:{},a=s===void 0?n?{...i,[t.definitionPath]:n}:i:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...n,[s]:i}};return t.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),a};function Z_(r){return Jo(r.data)?{type:"runnable",data:{id:r.data.lc_id,name:r.data.getName()}}:{type:"schema",data:{...Dn(r.data.schema),title:r.data.name}}}var Yi=class{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){let e={};return Object.values(this.nodes).forEach((t,n)=>{e[t.id]=Di(t.id)?n:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...Z_(t)})),edges:this.edges.map(t=>t.data?{source:e[t.source],target:e[t.target],data:t.data}:{source:e[t.source],target:e[t.target]})}}addNode(e,t){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);let n=t||Be(),s={id:n,data:e};return this.nodes[n]=s,s}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,n){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);let s={source:e.id,target:t.id,data:n};return this.edges.push(s),s}firstNode(){let e=new Set(this.edges.map(n=>n.target)),t=[];return Object.values(this.nodes).forEach(n=>{e.has(n.id)||t.push(n)}),t[0]}lastNode(){let e=new Set(this.edges.map(n=>n.source)),t=[];return Object.values(this.nodes).forEach(n=>{e.has(n.id)||t.push(n)}),t[0]}extend(e){Object.entries(e.nodes).forEach(([t,n])=>{this.nodes[t]=n}),this.edges=[...this.edges,...e.edges]}trimFirstNode(){let e=this.firstNode();if(e){let t=this.edges.filter(n=>n.source===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}trimLastNode(){let e=this.lastNode();if(e){let t=this.edges.filter(n=>n.target===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}};function Ie(r,e){return r&&!Array.isArray(r)&&!(r instanceof Date)&&typeof r=="object"?r:{[e]:r}}var ce=class extends pt{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){var n,s;let t=(s=(n=this.name)!=null?n:this.constructor.lc_name())!=null?s:this.constructor.name;return e?`${t}${e}`:t}bind(e){return new Lr({bound:this,kwargs:e,config:{}})}map(){return new Xo({bound:this})}withRetry(e){return new Qo({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new Lr({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new eu({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)){if(e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);return e.map(oe)}return Array.from({length:t},()=>oe(e))}async batch(e,t,n){var u,c;let s=this._getOptionsList(t!=null?t:{},e.length),i=(c=(u=s[0])==null?void 0:u.maxConcurrency)!=null?c:n==null?void 0:n.maxConcurrency,a=new tr({maxConcurrency:i,onFailedAttempt:l=>{throw l}}),o=e.map((l,d)=>a.call(async()=>{try{return await this.invoke(l,s[d])}catch(f){if(n!=null&&n.returnExceptions)return f;throw f}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){let n=new ur(this._streamIterator(e,oe(t)));return await n.setup,Ft.fromAsyncGenerator(n)}_separateRunnableConfigFromCallOptions(e={}){let t=oe({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency}),n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,[t,n]}async _callWithConfig(e,t,n){var u;let s=oe(n),i=await zt(s),a=await(i==null?void 0:i.handleChainStart(this.toJSON(),Ie(t,"input"),void 0,s==null?void 0:s.runType,void 0,void 0,(u=s==null?void 0:s.runName)!=null?u:this.getName())),o;try{o=await e.call(this,t,s,a)}catch(c){throw await(a==null?void 0:a.handleChainError(c)),c}return await(a==null?void 0:a.handleChainEnd(Ie(o,"output"))),o}async _batchWithConfig(e,t,n,s){let i=this._getOptionsList(n!=null?n:{},t.length),a=await Promise.all(i.map(zt)),o=await Promise.all(a.map((c,l)=>{var d;return c==null?void 0:c.handleChainStart(this.toJSON(),Ie(t[l],"input"),void 0,i[l].runType,void 0,void 0,(d=i[l].runName)!=null?d:this.getName())})),u;try{u=await e.call(this,t,i,o,s)}catch(c){throw await Promise.all(o.map(l=>l==null?void 0:l.handleChainError(c))),c}return await Promise.all(o.map(c=>c==null?void 0:c.handleChainEnd(Ie(u,"output")))),u}async*_transformStreamWithConfig(e,t,n){let s,i=!0,a,o=!0,u=oe(n),c=await zt(u);async function*l(){for await(let f of e){if(i)if(s===void 0)s=f;else try{s=Ut(s,f)}catch(h){s=void 0,i=!1}yield f}}let d;try{let f=await Ih(t.bind(this),l(),async()=>{var g;return c==null?void 0:c.handleChainStart(this.toJSON(),{input:""},void 0,u==null?void 0:u.runType,void 0,void 0,(g=u==null?void 0:u.runName)!=null?g:this.getName())},u);d=f.setup;let h=g=>g.name==="log_stream_tracer",m=d==null?void 0:d.handlers.find(h),p=f.output;m!==void 0&&d!==void 0&&(p=await m.tapOutputIterable(d.runId,f.output));for await(let g of p)if(yield g,o)if(a===void 0)a=g;else try{a=Ut(a,g)}catch(y){a=void 0,o=!1}}catch(f){throw await(d==null?void 0:d.handleChainError(f,void 0,void 0,void 0,{inputs:Ie(s,"input")})),f}await(d==null?void 0:d.handleChainEnd(a!=null?a:{},void 0,void 0,void 0,{inputs:Ie(s,"input")}))}getGraph(e){let t=new Yi,n=t.addNode({name:`${this.getName()}Input`,schema:ir.any()}),s=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:ir.any()});return t.addEdge(n,s),t.addEdge(s,i),t}pipe(e){return new js({first:this,last:lr(e)})}pick(e){return this.pipe(new tu(e))}assign(e){return this.pipe(new $s(new Mr({steps:e})))}async*transform(e,t){let n;for await(let s of e)n===void 0?n=s:n=Ut(n,s);yield*this._streamIterator(n,oe(t))}async*streamLog(e,t,n){let s=new Zi({...n,autoClose:!1,_schemaFormat:"original"}),i=oe(t);yield*this._streamLog(e,s,i)}async*_streamLog(e,t,n){let{callbacks:s}=n;if(s===void 0)n.callbacks=[t];else if(Array.isArray(s))n.callbacks=s.concat([t]);else{let u=s.copy();u.inheritableHandlers.push(t),n.callbacks=u}let i=this.stream(e,n);async function a(){try{let u=await i;for await(let c of u){let l=new vt({ops:[{op:"add",path:"/streamed_output/-",value:c}]});await t.writer.write(l)}}finally{await t.writer.close()}}let o=a();try{for await(let u of t)yield u}finally{await o}}async*streamEvents(e,t,n){var m,p,g;if(t.version!=="v1")throw new Error('Only version "v1" of the events schema is currently supported.');let s,i=!1,a=oe(t),o=(m=a.tags)!=null?m:[],u=(p=a.metadata)!=null?p:{},c=(g=a.runName)!=null?g:this.getName(),l=new Zi({...n,autoClose:!1,_schemaFormat:"streaming_events"}),d=new Go({...n}),f=this._streamLog(e,l,a);for await(let y of f){if(s?s=s.concat(y):s=Vi.fromRunLogPatch(y),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;let T={...s.state},_={run_id:T.id,event:`on_${T.type}_start`,name:c,tags:o,metadata:u,data:{input:e}};d.includeEvent(_,T.type)&&(yield _)}let b=y.ops.filter(T=>T.path.startsWith("/logs/")).map(T=>T.path.split("/")[2]),O=[...new Set(b)];for(let T of O){let _,F={},S=s.state.logs[T];if(S.end_time===void 0?S.streamed_output.length>0?_="stream":_="start":_="end",_==="start")S.inputs!==void 0&&(F.input=S.inputs);else if(_==="end")S.inputs!==void 0&&(F.input=S.inputs),F.output=S.final_output;else if(_==="stream"){let L=S.streamed_output.length;if(L!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${L} instead. Encountered in: "${S.name}"`);F={chunk:S.streamed_output[0]},S.streamed_output=[]}yield{event:`on_${S.type}_${_}`,name:S.name,run_id:S.id,tags:S.tags,metadata:S.metadata,data:F}}let{state:E}=s;if(E.streamed_output.length>0){let T=E.streamed_output.length;if(T!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${T} instead. Encountered in: "${E.name}"`);let _={chunk:E.streamed_output[0]};E.streamed_output=[];let F={event:`on_${E.type}_stream`,run_id:E.id,tags:o,metadata:u,name:c,data:_};d.includeEvent(F,E.type)&&(yield F)}}let h=s==null?void 0:s.state;if(h!==void 0){let y={event:`on_${h.type}_end`,name:c,run_id:h.id,tags:o,metadata:u,data:{output:h.final_output}};d.includeEvent(y,h.type)&&(yield y)}}static isRunnable(e){return Jo(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new Lr({bound:this,config:{},configFactories:[s=>({callbacks:[new Gi({config:s,onStart:e,onEnd:t,onError:n})]})]})}},Lr=class r extends ce{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){let t=Ol(this.config,...e);return Ol(t,...this.configFactories?await Promise.all(this.configFactories.map(async n=>await n(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(oe(t),this.kwargs))}async batch(e,t,n){let s=Array.isArray(t)?await Promise.all(t.map(async i=>this._mergeConfig(oe(i),this.kwargs))):await this._mergeConfig(oe(t),this.kwargs);return this.bound.batch(e,s,n)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(oe(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(oe(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(oe(t),this.kwargs))}async*streamEvents(e,t,n){yield*this.bound.streamEvents(e,{...await this._mergeConfig(oe(t),this.kwargs),version:t.version},n)}static isRunnableBinding(e){return e.bound&&ce.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:n}){return new r({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new Gi({config:s,onStart:e,onEnd:t,onError:n})]})]})}},Xo=class r extends ce{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new r({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,n){return this.bound.batch(e,Pe(t,{callbacks:n==null?void 0:n.getChild()}))}withListeners({onStart:e,onEnd:t,onError:n}){return new r({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:n})})}},Qo=class extends Lr{static lc_name(){return"RunnableRetry"}constructor(e){var t,n;super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=(t=e.maxAttemptNumber)!=null?t:this.maxAttemptNumber,this.onFailedAttempt=(n=e.onFailedAttempt)!=null?n:this.onFailedAttempt}_patchConfigForRetry(e,t,n){let s=e>1?`retry:attempt:${e}`:void 0;return Pe(t,{callbacks:n==null?void 0:n.getChild(s)})}async _invoke(e,t,n){return(0,Sl.default)(s=>super.invoke(e,this._patchConfigForRetry(s,t,n)),{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,n,s){let i={};try{await(0,Sl.default)(async a=>{let o=e.map((f,h)=>h).filter(f=>i[f.toString()]===void 0||i[f.toString()]instanceof Error),u=o.map(f=>e[f]),c=o.map(f=>this._patchConfigForRetry(a,t==null?void 0:t[f],n==null?void 0:n[f])),l=await super.batch(u,c,{...s,returnExceptions:!0}),d;for(let f=0;f<l.length;f+=1){let h=l[f],m=o[f];h instanceof Error&&d===void 0&&(d=h),i[m.toString()]=h}if(d)throw d;return l},{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if((s==null?void 0:s.returnExceptions)!==!0)throw a}return Object.keys(i).sort((a,o)=>parseInt(a,10)-parseInt(o,10)).map(a=>i[parseInt(a,10)])}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}},js=class r extends ce{static lc_name(){return"RunnableSequence"}constructor(e){var t;super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=(t=e.middle)!=null?t:this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){let n=oe(t),s=await zt(n),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),Ie(e,"input"),void 0,void 0,void 0,void 0,n==null?void 0:n.runName)),a=e,o;try{let u=[this.first,...this.middle];for(let c=0;c<u.length;c+=1)a=await u[c].invoke(a,Pe(n,{callbacks:i==null?void 0:i.getChild(`seq:step:${c+1}`)}));o=await this.last.invoke(a,Pe(n,{callbacks:i==null?void 0:i.getChild(`seq:step:${this.steps.length}`)}))}catch(u){throw await(i==null?void 0:i.handleChainError(u)),u}return await(i==null?void 0:i.handleChainEnd(Ie(o,"output"))),o}async batch(e,t,n){let s=this._getOptionsList(t!=null?t:{},e.length),i=await Promise.all(s.map(zt)),a=await Promise.all(i.map((u,c)=>u==null?void 0:u.handleChainStart(this.toJSON(),Ie(e[c],"input"),void 0,void 0,void 0,void 0,s[c].runName))),o=e;try{for(let u=0;u<this.steps.length;u+=1)o=await this.steps[u].batch(o,a.map((l,d)=>{let f=l==null?void 0:l.getChild(`seq:step:${u+1}`);return Pe(s[d],{callbacks:f})}),n)}catch(u){throw await Promise.all(a.map(c=>c==null?void 0:c.handleChainError(u))),u}return await Promise.all(a.map(u=>u==null?void 0:u.handleChainEnd(Ie(o,"output")))),o}async*_streamIterator(e,t){let n=await zt(t),s=await(n==null?void 0:n.handleChainStart(this.toJSON(),Ie(e,"input"),void 0,void 0,void 0,void 0,t==null?void 0:t.runName)),i=[this.first,...this.middle,this.last],a=!0,o;async function*u(){yield e}try{let c=i[0].transform(u(),Pe(t,{callbacks:s==null?void 0:s.getChild("seq:step:1")}));for(let l=1;l<i.length;l+=1)c=await i[l].transform(c,Pe(t,{callbacks:s==null?void 0:s.getChild(`seq:step:${l+1}`)}));for await(let l of c)if(yield l,a)if(o===void 0)o=l;else try{o=Ut(o,l)}catch(d){o=void 0,a=!1}}catch(c){throw await(s==null?void 0:s.handleChainError(c)),c}await(s==null?void 0:s.handleChainEnd(Ie(o,"output")))}getGraph(e){let t=new Yi,n=null;return this.steps.forEach((s,i)=>{let a=s.getGraph(e);i!==0&&a.trimFirstNode(),i!==this.steps.length-1&&a.trimLastNode(),t.extend(a);let o=a.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);n&&t.addEdge(n,o),n=a.lastNode()}),t}pipe(e){var t;return r.isRunnableSequence(e)?new r({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:(t=this.name)!=null?t:e.name}):new r({first:this.first,middle:[...this.middle,this.last],last:lr(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&ce.isRunnable(e)}static from([e,...t],n){return new r({first:lr(e),middle:t.slice(0,-1).map(lr),last:lr(t[t.length-1]),name:n})}},Mr=class r extends ce{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(let[t,n]of Object.entries(e.steps))this.steps[t]=lr(n)}static from(e){return new r({steps:e})}async invoke(e,t){let n=oe(t),s=await zt(n),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),{input:e},void 0,void 0,void 0,void 0,n==null?void 0:n.runName)),a={};try{await Promise.all(Object.entries(this.steps).map(async([o,u])=>{a[o]=await u.invoke(e,Pe(n,{callbacks:i==null?void 0:i.getChild(`map:key:${o}`)}))}))}catch(o){throw await(i==null?void 0:i.handleChainError(o)),o}return await(i==null?void 0:i.handleChainEnd(a)),a}async*_transform(e,t,n){let s={...this.steps},i=vl(e,Object.keys(s).length),a=new Map(Object.entries(s).map(([o,u],c)=>{let l=u.transform(i[c],Pe(n,{callbacks:t==null?void 0:t.getChild(`map:key:${o}`)}));return[o,l.next().then(d=>({key:o,gen:l,result:d}))]}));for(;a.size;){let{key:o,result:u,gen:c}=await Promise.race(a.values());a.delete(o),u.done||(yield{[o]:u.value},a.set(o,c.next().then(l=>({key:o,gen:c,result:l}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}let s=new ur(this.transform(n(),t));return await s.setup,Ft.fromAsyncGenerator(s)}},Xi=class r extends ce{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}static from(e){return new r({func:e})}async _invoke(e,t,n){return new Promise((s,i)=>{var o;let a=Pe(t,{callbacks:n==null?void 0:n.getChild(),recursionLimit:((o=t==null?void 0:t.recursionLimit)!=null?o:Ho)-1});Hi.getInstance().run(a,async()=>{var u;try{let c=await this.func(e,{...a,config:a});if(c&&ce.isRunnable(c)){if((t==null?void 0:t.recursionLimit)===0)throw new Error("Recursion limit reached.");c=await c.invoke(e,{...a,recursionLimit:((u=a.recursionLimit)!=null?u:Ho)-1})}s(c)}catch(c){i(c)}})})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async*_transform(e,t,n){var a;let s;for await(let o of e)if(s===void 0)s=o;else try{s=Ut(s,o)}catch(u){s=o}let i=await new Promise((o,u)=>{Hi.getInstance().run(n,async()=>{try{let c=await this.func(s,{...n,config:n});o(c)}catch(c){u(c)}})});if(i&&ce.isRunnable(i)){if((n==null?void 0:n.recursionLimit)===0)throw new Error("Recursion limit reached.");let o=await i.stream(s,Pe(n,{callbacks:t==null?void 0:t.getChild(),recursionLimit:((a=n==null?void 0:n.recursionLimit)!=null?a:Ho)-1}));for await(let u of o)yield u}else yield i}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}let s=new ur(this.transform(n(),t));return await s.setup,Ft.fromAsyncGenerator(s)}};var eu=class extends ce{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(let e of this.fallbacks)yield e}async invoke(e,t){let n=await Oe.configure(t==null?void 0:t.callbacks,void 0,t==null?void 0:t.tags,void 0,t==null?void 0:t.metadata),s=await(n==null?void 0:n.handleChainStart(this.toJSON(),Ie(e,"input"),void 0,void 0,void 0,void 0,t==null?void 0:t.runName)),i;for(let a of this.runnables())try{let o=await a.invoke(e,Pe(t,{callbacks:s==null?void 0:s.getChild()}));return await(s==null?void 0:s.handleChainEnd(Ie(o,"output"))),o}catch(o){i===void 0&&(i=o)}throw i===void 0?new Error("No error stored at end of fallback."):(await(s==null?void 0:s.handleChainError(i)),i)}async batch(e,t,n){if(n!=null&&n.returnExceptions)throw new Error("Not implemented.");let s=this._getOptionsList(t!=null?t:{},e.length),i=await Promise.all(s.map(u=>Oe.configure(u==null?void 0:u.callbacks,void 0,u==null?void 0:u.tags,void 0,u==null?void 0:u.metadata))),a=await Promise.all(i.map((u,c)=>u==null?void 0:u.handleChainStart(this.toJSON(),Ie(e[c],"input"),void 0,void 0,void 0,void 0,s[c].runName))),o;for(let u of this.runnables())try{let c=await u.batch(e,a.map((l,d)=>Pe(s[d],{callbacks:l==null?void 0:l.getChild()})),n);return await Promise.all(a.map((l,d)=>l==null?void 0:l.handleChainEnd(Ie(c[d],"output")))),c}catch(c){o===void 0&&(o=c)}throw o?(await Promise.all(a.map(u=>u==null?void 0:u.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}};function lr(r){if(typeof r=="function")return new Xi({func:r});if(ce.isRunnable(r))return r;if(!Array.isArray(r)&&typeof r=="object"){let e={};for(let[t,n]of Object.entries(r))e[t]=lr(n);return new Mr({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}var $s=class extends ce{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Mr&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){let n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){let s=this.mapper.getStepsKeys(),[i,a]=vl(e),o=this.mapper.transform(a,Pe(n,{callbacks:t==null?void 0:t.getChild()})),u=o.next();for await(let c of i){if(typeof c!="object"||Array.isArray(c))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof c}`);let l=Object.fromEntries(Object.entries(c).filter(([d])=>!s.includes(d)));Object.keys(l).length>0&&(yield l)}yield(await u).value;for await(let c of o)yield c}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}let s=new ur(this.transform(n(),t));return await s.setup,Ft.fromAsyncGenerator(s)}},tu=class extends ce{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{let t=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(let t of e){let n=await this._pick(t);n!==void 0&&(yield n)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}let s=new ur(this.transform(n(),t));return await s.setup,Ft.fromAsyncGenerator(s)}};var H_=r=>r.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":r.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":r.startsWith("gpt-4-32k")?"gpt-4-32k":r.startsWith("gpt-4-")?"gpt-4":r;var G_=()=>!1,Qi=class extends ce{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){var t,n,s;super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=(t=e.verbose)!=null?t:G_(),this.callbacks=e.callbacks,this.tags=(n=e.tags)!=null?n:[],this.metadata=(s=e.metadata)!=null?s:{}}},ea=class extends Qi{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...n}){super({callbacks:e!=null?e:t,...n}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof n.cache=="object"?this.cache=n.cache:n.cache?this.cache=lo.global():this.cache=void 0,this.caller=new tr(n!=null?n:{})}async getNumTokens(e){if(typeof e!="string")return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await nh("modelName"in this?H_(this.modelName):"gpt2")}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}return t}static _convertInputToPromptValue(e){return typeof e=="string"?new ho(e):Array.isArray(e)?new po(e.map(hn)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall(e){let t={...this._identifyingParams(),...e,_type:this._llmType(),_model:this._modelType()};return Object.entries(t).filter(([i,a])=>a!==void 0).map(([i,a])=>`${i}:${JSON.stringify(a)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}};var Ls=class r extends ea{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){let[t,n]=super._separateRunnableConfigFromCallOptions(e);return n!=null&&n.timeout&&!n.signal&&(n.signal=AbortSignal.timeout(n.timeout)),[t,n]}async invoke(e,t){let n=r._convertInputToPromptValue(e);return(await this.generatePrompt([n],t,t==null?void 0:t.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,n){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===r.prototype._streamResponseChunks)yield this.invoke(e,t);else{let s=r._convertInputToPromptValue(e).toChatMessages(),[i,a]=this._separateRunnableConfigFromCallOptions(t),o=await Oe.configure(i.callbacks,this.callbacks,i.tags,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),u={options:a,invocation_params:this==null?void 0:this.invocationParams(a),batch_size:1},c=await(o==null?void 0:o.handleChatModelStart(this.toJSON(),[s],void 0,void 0,u,void 0,void 0,i.runName)),l;try{for await(let d of this._streamResponseChunks(s,a,c==null?void 0:c[0]))d.message.response_metadata={...d.generationInfo,...d.message.response_metadata},yield d.message,l?l=l.concat(d):l=d}catch(d){throw await Promise.all((c!=null?c:[]).map(f=>f==null?void 0:f.handleLLMError(d))),d}await Promise.all((c!=null?c:[]).map(d=>d==null?void 0:d.handleLLMEnd({generations:[[l]]})))}}async _generateUncached(e,t,n){var f;let s=e.map(h=>h.map(hn)),i=await Oe.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),a={options:t,invocation_params:this==null?void 0:this.invocationParams(t),batch_size:1},o=await(i==null?void 0:i.handleChatModelStart(this.toJSON(),s,void 0,void 0,a,void 0,void 0,n.runName)),u=await Promise.allSettled(s.map((h,m)=>this._generate(h,{...t,promptIndex:m},o==null?void 0:o[m]))),c=[],l=[];await Promise.all(u.map(async(h,m)=>{var p,g;if(h.status==="fulfilled"){let y=h.value;for(let b of y.generations)b.message.response_metadata={...b.generationInfo,...b.message.response_metadata};return y.generations.length===1&&(y.generations[0].message.response_metadata={...y.llmOutput,...y.generations[0].message.response_metadata}),c[m]=y.generations,l[m]=y.llmOutput,(p=o==null?void 0:o[m])==null?void 0:p.handleLLMEnd({generations:[y.generations],llmOutput:y.llmOutput})}else return await((g=o==null?void 0:o[m])==null?void 0:g.handleLLMError(h.reason)),Promise.reject(h.reason)}));let d={generations:c,llmOutput:l.length?(f=this._combineLLMOutput)==null?void 0:f.call(this,...l):void 0};return Object.defineProperty(d,co,{value:o?{runIds:o==null?void 0:o.map(h=>h.runId)}:void 0,configurable:!0}),d}async _generateCached({messages:e,cache:t,llmStringKey:n,parsedOptions:s,handledOptions:i}){let a=e.map(p=>p.map(hn)),o=await Oe.configure(i.callbacks,this.callbacks,i.tags,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),u={options:s,invocation_params:this==null?void 0:this.invocationParams(s),batch_size:1,cached:!0},c=await(o==null?void 0:o.handleChatModelStart(this.toJSON(),a,void 0,void 0,u,void 0,void 0,i.runName)),l=[],f=(await Promise.allSettled(a.map(async(p,g)=>{let y=r._convertInputToPromptValue(p).toString(),b=await t.lookup(y,n);return b==null&&l.push(g),b}))).map((p,g)=>({result:p,runManager:c==null?void 0:c[g]})).filter(({result:p})=>p.status==="fulfilled"&&p.value!=null||p.status==="rejected"),h=[];await Promise.all(f.map(async({result:p,runManager:g},y)=>{if(p.status==="fulfilled"){let b=p.value;return h[y]=b,b.length&&await(g==null?void 0:g.handleLLMNewToken(b[0].text)),g==null?void 0:g.handleLLMEnd({generations:[b]})}else return await(g==null?void 0:g.handleLLMError(p.reason)),Promise.reject(p.reason)}));let m={generations:h,missingPromptIndices:l};return Object.defineProperty(m,co,{value:c?{runIds:c==null?void 0:c.map(p=>p.runId)}:void 0,configurable:!0}),m}async generate(e,t,n){var h,m;let s;Array.isArray(t)?s={stop:t}:s=t;let i=e.map(p=>p.map(hn)),[a,o]=this._separateRunnableConfigFromCallOptions(s);if(a.callbacks=(h=a.callbacks)!=null?h:n,!this.cache)return this._generateUncached(i,o,a);let{cache:u}=this,c=this._getSerializedCacheKeyParametersForCall(o),{generations:l,missingPromptIndices:d}=await this._generateCached({messages:i,cache:u,llmStringKey:c,parsedOptions:o,handledOptions:a}),f={};if(d.length>0){let p=await this._generateUncached(d.map(g=>i[g]),o,a);await Promise.all(p.generations.map(async(g,y)=>{let b=d[y];l[b]=g;let O=r._convertInputToPromptValue(i[b]).toString();return u.update(O,c,g)})),f=(m=p.llmOutput)!=null?m:{}}return{generations:l,llmOutput:f}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,n){let s=e.map(i=>i.toChatMessages());return this.generate(s,t,n)}async call(e,t,n){return(await this.generate([e.map(hn)],t,n)).generations[0][0].message}async callPrompt(e,t,n){let s=e.toChatMessages();return this.call(s,t,n)}async predictMessages(e,t,n){return this.call(e,t,n)}async predict(e,t,n){let s=new Se(e),i=await this.call([s],t,n);if(typeof i.content!="string")throw new Error("Cannot use predict when output is not a string.");return i.content}};function J_(r){var t;let e=r._getType();return Tr.isInstance(r)?r.role:(t=r.name)!=null?t:e}function W_(r){switch(r){case"ai":case"model":return"model";case"system":case"human":return"user";default:throw new Error(`Unknown / unsupported author: ${r}`)}}function Y_(r,e){return typeof r=="string"?[{text:r}]:r.map(t=>{if(t.type==="text")return{text:t.text};if(t.type==="image_url"){if(!e)throw new Error("This model does not support images");if(typeof t.image_url!="string")throw new Error("Please provide image as base64 encoded data URL");let[n,s]=t.image_url.split(",");if(!n.startsWith("data:"))throw new Error("Please provide image as base64 encoded data URL");let[i,a]=n.replace(/^data:/,"").split(";");if(a!=="base64")throw new Error("Please provide image as base64 encoded data URL");return{inlineData:{data:s,mimeType:i}}}throw new Error(`Unknown content type ${t.type}`)})}function Tl(r,e){return r.reduce((t,n,s)=>{if(!fn(n))throw new Error("Unsupported message input");let i=J_(n);if(i==="system"&&s!==0)throw new Error("System message should be the first one");let a=W_(i),o=t.content[t.content.length];if(!t.mergeWithPreviousContent&&o&&o.role===a)throw new Error("Google Generative AI requires alternate messages between authors");let u=Y_(n.content,e);if(t.mergeWithPreviousContent){let l=t.content[t.content.length-1];if(!l)throw new Error("There was a problem parsing your system message. Please try a prompt without one.");return l.parts.push(...u),{mergeWithPreviousContent:!1,content:t.content}}let c={role:a,parts:u};return{mergeWithPreviousContent:i==="system",content:[...t.content,c]}},{content:[],mergeWithPreviousContent:!1}).content}function lp(r){var a,o;if(!r.candidates||r.candidates.length===0||!r.candidates[0])return{generations:[],llmOutput:{filters:r.promptFeedback}};let[e]=r.candidates,{content:t,...n}=e,s=(o=(a=t==null?void 0:t.parts[0])==null?void 0:a.text)!=null?o:"";return{generations:[{text:s,message:new ke({content:s,name:t?t.role:void 0,additional_kwargs:n}),generationInfo:n}]}}function dp(r){var i,a;if(!r.candidates||r.candidates.length===0)return null;let[e]=r.candidates,{content:t,...n}=e,s=(a=(i=t==null?void 0:t.parts[0])==null?void 0:i.text)!=null?a:"";return new er({text:s,message:new Qt({content:s,name:t?t.role:void 0,additional_kwargs:{}}),generationInfo:n})}var ru=class extends Ls{static lc_name(){return"googlegenerativeai"}get lc_secrets(){return{apiKey:"GOOGLE_API_KEY"}}get _isMultimodalModel(){return this.modelName.includes("vision")}constructor(e){var t,n,s,i,a,o,u,c,l,d;if(super(e!=null?e:{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gemini-pro"}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxOutputTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"safetySettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.modelName=(n=(t=e==null?void 0:e.modelName)==null?void 0:t.replace(/^models\//,""))!=null?n:this.modelName,this.maxOutputTokens=(s=e==null?void 0:e.maxOutputTokens)!=null?s:this.maxOutputTokens,this.maxOutputTokens&&this.maxOutputTokens<0)throw new Error("`maxOutputTokens` must be a positive integer");if(this.temperature=(i=e==null?void 0:e.temperature)!=null?i:this.temperature,this.temperature&&(this.temperature<0||this.temperature>1))throw new Error("`temperature` must be in the range of [0.0,1.0]");if(this.topP=(a=e==null?void 0:e.topP)!=null?a:this.topP,this.topP&&this.topP<0)throw new Error("`topP` must be a positive integer");if(this.topP&&this.topP>1)throw new Error("`topP` must be below 1.");if(this.topK=(o=e==null?void 0:e.topK)!=null?o:this.topK,this.topK&&this.topK<0)throw new Error("`topK` must be a positive integer");if(this.stopSequences=(u=e==null?void 0:e.stopSequences)!=null?u:this.stopSequences,this.apiKey=(c=e==null?void 0:e.apiKey)!=null?c:ae("GOOGLE_API_KEY"),!this.apiKey)throw new Error("Please set an API key for Google GenerativeAI in the environment variable GOOGLE_API_KEY or in the `apiKey` field of the ChatGoogleGenerativeAI constructor");if(this.safetySettings=(l=e==null?void 0:e.safetySettings)!=null?l:this.safetySettings,this.safetySettings&&this.safetySettings.length>0&&new Set(this.safetySettings.map(h=>h.category)).size!==this.safetySettings.length)throw new Error("The categories in `safetySettings` array must be unique");this.streaming=(d=e==null?void 0:e.streaming)!=null?d:this.streaming,this.client=new Ni(this.apiKey).getGenerativeModel({model:this.modelName,safetySettings:this.safetySettings,generationConfig:{candidateCount:1,stopSequences:this.stopSequences,maxOutputTokens:this.maxOutputTokens,temperature:this.temperature,topP:this.topP,topK:this.topK}})}_combineLLMOutput(){return[]}_llmType(){return"googlegenerativeai"}async _generate(e,t,n){var o,u,c;let s=Tl(e,this._isMultimodalModel);if(this.streaming){let l={},d=this._streamResponseChunks(e,t,n),f={};for await(let m of d){let p=(u=(o=m.generationInfo)==null?void 0:o.completion)!=null?u:0;f[p]===void 0?f[p]=m:f[p]=f[p].concat(m)}return{generations:Object.entries(f).sort(([m],[p])=>parseInt(m,10)-parseInt(p,10)).map(([m,p])=>p),llmOutput:{estimatedTokenUsage:l}}}let i=await this.caller.callWithOptions({signal:t==null?void 0:t.signal},async()=>{var d;let l;try{l=await this.client.generateContent({contents:s})}catch(f){throw(d=f.message)!=null&&d.includes("400 Bad Request")&&(f.status=400),f}return l}),a=lp(i.response);return await(n==null?void 0:n.handleLLMNewToken((c=a.generations[0].text)!=null?c:"")),a}async*_streamResponseChunks(e,t,n){var a;let s=Tl(e,this._isMultimodalModel),i=await this.caller.callWithOptions({signal:t==null?void 0:t.signal},async()=>{let{stream:o}=await this.client.generateContentStream({contents:s});return o});for await(let o of i){let u=dp(o);u&&(yield u,await(n==null?void 0:n.handleLLMNewToken((a=u.text)!=null?a:"")))}}};var Bn="4.29.2";var hp=!1,Fn,Pl,Q_,ew,tw,Il,rw,nu,kl,Cl,Nl,su,Rl;function pp(r,e={auto:!1}){if(hp)throw new Error(`you must \`import 'openai/shims/${r.kind}'\` before importing anything else from openai`);if(Fn)throw new Error(`can't \`import 'openai/shims/${r.kind}'\` after \`import 'openai/shims/${Fn}'\``);hp=e.auto,Fn=r.kind,Pl=r.fetch,Q_=r.Request,ew=r.Response,tw=r.Headers,Il=r.FormData,rw=r.Blob,nu=r.File,kl=r.ReadableStream,Cl=r.getMultipartRequestOptions,Nl=r.getDefaultAgent,su=r.fileFromPath,Rl=r.isFsReadStream}var iu=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function mp({manuallyImported:r}={}){let e=r?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n",t,n,s,i;try{t=fetch,n=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:s,Headers:i,FormData:typeof FormData!="undefined"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob!="undefined"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File!="undefined"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream!="undefined"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new iu(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}Fn||pp(mp(),{auto:!0});var jl={};kc(jl,{APIConnectionError:()=>dr,APIConnectionTimeoutError:()=>fr,APIError:()=>ye,APIUserAbortError:()=>me,AuthenticationError:()=>Ds,BadRequestError:()=>Ms,ConflictError:()=>Us,InternalServerError:()=>qs,NotFoundError:()=>Fs,OpenAIError:()=>z,PermissionDeniedError:()=>Bs,RateLimitError:()=>Ks,UnprocessableEntityError:()=>zs});var z=class extends Error{},ye=class r extends z{constructor(e,t,n,s){super(`${r.makeMessage(e,t,n)}`),this.status=e,this.headers=s;let i=t;this.error=i,this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,n){let s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e)return new dr({cause:au(t)});let i=t==null?void 0:t.error;return e===400?new Ms(e,i,n,s):e===401?new Ds(e,i,n,s):e===403?new Bs(e,i,n,s):e===404?new Fs(e,i,n,s):e===409?new Us(e,i,n,s):e===422?new zs(e,i,n,s):e===429?new Ks(e,i,n,s):e>=500?new qs(e,i,n,s):new r(e,i,n,s)}},me=class extends ye{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}},dr=class extends ye{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}},fr=class extends dr{constructor({message:e}={}){super({message:e!=null?e:"Request timed out."})}},Ms=class extends ye{constructor(){super(...arguments),this.status=400}},Ds=class extends ye{constructor(){super(...arguments),this.status=401}},Bs=class extends ye{constructor(){super(...arguments),this.status=403}},Fs=class extends ye{constructor(){super(...arguments),this.status=404}},Us=class extends ye{constructor(){super(...arguments),this.status=409}},zs=class extends ye{constructor(){super(...arguments),this.status=422}},Ks=class extends ye{constructor(){super(...arguments),this.status=429}},qs=class extends ye{};var hr=class r{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1,s=new $l;async function*i(){if(!e.body)throw t.abort(),new z("Attempted to iterate over a response with no body");let o=new Vs,u=gp(e.body);for await(let c of u)for(let l of o.decode(c)){let d=s.decode(l);d&&(yield d)}for(let c of o.flush()){let l=s.decode(c);l&&(yield l)}}async function*a(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let o=!1;try{for await(let u of i())if(!o){if(u.data.startsWith("[DONE]")){o=!0;continue}if(u.event===null){let c;try{c=JSON.parse(u.data)}catch(l){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),l}if(c&&c.error)throw new ye(void 0,c.error,void 0,void 0);yield c}else{let c;try{c=JSON.parse(u.data)}catch(l){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),l}if(u.event=="error")throw new ye(void 0,c.error,c.message,void 0);yield{event:u.event,data:c}}}o=!0}catch(u){if(u instanceof Error&&u.name==="AbortError")return;throw u}finally{o||t.abort()}}return new r(a,t)}static fromReadableStream(e,t){let n=!1;async function*s(){let a=new Vs,o=gp(e);for await(let u of o)for(let c of a.decode(u))yield c;for(let u of a.flush())yield u}async function*i(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(let o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new r(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],n=this.iterator(),s=i=>({next:()=>{if(i.length===0){let a=n.next();e.push(a),t.push(a)}return i.shift()}});return[new r(()=>s(e),this.controller),new r(()=>s(t),this.controller)]}toReadableStream(){let e=this,t,n=new TextEncoder;return new kl({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{let{value:i,done:a}=await t.next();if(a)return s.close();let o=n.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}},$l=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=sw(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}},Vs=class r{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];let n=r.NEWLINE_CHARS.has(t[t.length-1]||""),s=t.split(r.NEWLINE_REGEXP);return n&&s.pop(),s.length===1&&!n?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),n||(this.buffer=[s.pop()||""]),s)}decodeText(e){var t;if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer!="undefined"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new z(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder!="undefined"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return(t=this.textDecoder)!=null||(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new z(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new z("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];let e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};Vs.NEWLINE_CHARS=new Set([`
`,"\r","\v","\f","","","","\x85","\u2028","\u2029"]);Vs.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;function sw(r,e){let t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}function gp(r){if(r[Symbol.asyncIterator])return r;let e=r.getReader();return{async next(){try{let t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var yp=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function",iw=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&bp(r),bp=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",aw=r=>iw(r)||yp(r)||Rl(r);async function Dl(r,e,t={}){var s,i,a;if(r=await r,yp(r)){let o=await r.blob();return e||(e=(s=new URL(r.url).pathname.split(/[\\/]/).pop())!=null?s:"unknown_file"),new nu([o],e,t)}let n=await ow(r);if(e||(e=(i=cw(r))!=null?i:"unknown_file"),!t.type){let o=(a=n[0])==null?void 0:a.type;typeof o=="string"&&(t={...t,type:o})}return new nu(n,e,t)}async function ow(r){var t;let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(bp(r))e.push(await r.arrayBuffer());else if(lw(r))for await(let n of r)e.push(n);else throw new Error(`Unexpected data type: ${typeof r}; constructor: ${(t=r==null?void 0:r.constructor)==null?void 0:t.name}; props: ${uw(r)}`);return e}function uw(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}function cw(r){var e;return Ll(r.name)||Ll(r.filename)||((e=Ll(r.path))==null?void 0:e.split(/[\\/]/).pop())}var Ll=r=>{if(typeof r=="string")return r;if(typeof Buffer!="undefined"&&r instanceof Buffer)return String(r)},lw=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",Bl=r=>r&&typeof r=="object"&&r.body&&r[Symbol.toStringTag]==="MultipartBody";var Kt=async r=>{let e=await _p(r.body);return Cl(e,r)},_p=async r=>{let e=new Il;return await Promise.all(Object.entries(r||{}).map(([t,n])=>Ml(e,t,n))),e};var Ml=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(aw(t)){let n=await Dl(t);r.append(e,n)}else if(Array.isArray(t))await Promise.all(t.map(n=>Ml(r,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,s])=>Ml(r,`${e}[${n}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var fw=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},hw=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},ou;async function Ap(r){let{response:e}=r;if(r.options.stream)return Zs("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):hr.fromSSEResponse(e,r.controller);if(e.status===204)return null;if(r.options.__binaryResponse)return e;let t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){let i=await e.json();return Zs("response",e.status,e.url,e.headers,i),i}let s=await e.text();return Zs("response",e.status,e.url,e.headers,s),s}var cu=class r extends Promise{constructor(e,t=Ap){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new r(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},lu=class{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Fl("maxRetries",t),this.timeout=Fl("timeout",n),this.httpAgent=s,this.fetch=i!=null?i:Pl}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...bw(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${xw()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(s=>({method:e,path:t,...s})))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer!="undefined")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder!="undefined")return new TextEncoder().encode(e).length.toString()}return null}buildRequest(e){var m,p,g,y,b,O;let{method:t,path:n,query:s,headers:i={}}=e,a=Bl(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,o=this.calculateContentLength(a),u=this.buildURL(n,s);"timeout"in e&&Fl("timeout",e.timeout);let c=(m=e.timeout)!=null?m:this.timeout,l=(g=(p=e.httpAgent)!=null?p:this.httpAgent)!=null?g:Nl(u),d=c+1e3;typeof((y=l==null?void 0:l.options)==null?void 0:y.timeout)=="number"&&d>((b=l.options.timeout)!=null?b:0)&&(l.options.timeout=d),this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let f=this.buildHeaders({options:e,headers:i,contentLength:o});return{req:{method:t,...a&&{body:a},headers:f,...l&&{agent:l},signal:(O=e.signal)!=null?O:null},url:u,timeout:c}}buildHeaders({options:e,headers:t,contentLength:n}){let s={};n&&(s["content-length"]=n);let i=this.defaultHeaders(e);return xp(s,i),xp(s,t),Bl(e.body)&&Fn!=="node"&&delete s["content-type"],this.validateHeaders(s,t),s}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,s){return ye.generate(e,t,n,s)}request(e,t=null){return new cu(this.makeRequest(e,t))}async makeRequest(e,t){var l,d,f;let n=await e;t==null&&(t=(l=n.maxRetries)!=null?l:this.maxRetries),await this.prepareOptions(n);let{req:s,url:i,timeout:a}=this.buildRequest(n);if(await this.prepareRequest(s,{url:i,options:n}),Zs("request",i,n,s.headers),(d=n.signal)!=null&&d.aborted)throw new me;let o=new AbortController,u=await this.fetchWithTimeout(i,s,a,o).catch(au);if(u instanceof Error){if((f=n.signal)!=null&&f.aborted)throw new me;if(t)return this.retryRequest(n,t);throw u.name==="AbortError"?new fr:new dr({cause:u})}let c=pw(u.headers);if(!u.ok){if(t&&this.shouldRetry(u)){let b=`retrying, ${t} attempts remaining`;return Zs(`response (error; ${b})`,u.status,i,c),this.retryRequest(n,t,c)}let h=await u.text().catch(b=>au(b).message),m=_w(h),p=m?void 0:h;throw Zs(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,u.status,i,c,p),this.makeStatusError(u.status,m,p,c)}return{response:u,options:n,controller:o}}requestAPIList(e,t){let n=this.makeRequest(t,null);return new Ul(this,n,e)}buildURL(e,t){let n=vw(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return Op(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n!="undefined").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new z(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,s){let{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());let o=setTimeout(()=>s.abort(),n);return this.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...a}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){var o;let s,i=n==null?void 0:n["retry-after-ms"];if(i){let u=parseFloat(i);Number.isNaN(u)||(s=u)}let a=n==null?void 0:n["retry-after"];if(a&&!s){let u=parseFloat(a);Number.isNaN(u)?s=Date.parse(a)-Date.now():s=u*1e3}if(!(s&&0<=s&&s<60*1e3)){let u=(o=e.maxRetries)!=null?o:this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,u)}return await zl(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){let i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Bn}`}},ta=class{constructor(e,t,n,s){ou.set(this,void 0),fw(this,ou,e,"f"),this.options=s,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new z("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){let n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(let[s,i]of n)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await hw(this,ou,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(ou=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},Ul=class extends cu{constructor(e,t,n){super(t,async s=>new n(e,s.response,await Ap(s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},pw=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){let n=t.toString();return e[n.toLowerCase()]||e[n]}}),mw={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryResponse:!0,__streamClass:!0},be=r=>typeof r=="object"&&r!==null&&!Op(r)&&Object.keys(r).every(e=>Ep(mw,e)),gw=()=>{if(typeof Deno!="undefined"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Bn,"X-Stainless-OS":vp(Deno.build.os),"X-Stainless-Arch":wp(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":Deno.version};if(typeof EdgeRuntime!="undefined")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Bn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Bn,"X-Stainless-OS":vp(process.platform),"X-Stainless-Arch":wp(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let r=yw();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Bn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Bn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function yw(){if(typeof navigator=="undefined"||!navigator)return null;let r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of r){let n=t.exec(navigator.userAgent);if(n){let s=n[1]||0,i=n[2]||0,a=n[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}var wp=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",vp=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown"),uu,bw=()=>uu!=null?uu:uu=gw(),_w=r=>{try{return JSON.parse(r)}catch(e){return}},ww=new RegExp("^(?:[a-z]+:)?//","i"),vw=r=>ww.test(r),zl=r=>new Promise(e=>setTimeout(e,r)),Fl=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new z(`${r} must be an integer`);if(e<0)throw new z(`${r} must be a positive integer`);return e},au=r=>r instanceof Error?r:new Error(r);var du=r=>{var e,t,n,s,i,a;if(typeof process!="undefined")return(n=(t=(e=process.env)==null?void 0:e[r])==null?void 0:t.trim())!=null?n:void 0;if(typeof Deno!="undefined")return(a=(i=(s=Deno.env)==null?void 0:s.get)==null?void 0:i.call(s,r))==null?void 0:a.trim()};function Op(r){if(!r)return!0;for(let e in r)return!1;return!0}function Ep(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function xp(r,e){for(let t in e){if(!Ep(e,t))continue;let n=t.toLowerCase();if(!n)continue;let s=e[t];s===null?delete r[n]:s!==void 0&&(r[n]=s)}}function Zs(r,...e){typeof process!="undefined"&&process.env.DEBUG==="true"&&console.log(`OpenAI:DEBUG:${r}`,...e)}var xw=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{let e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)}),Sp=()=>typeof window!="undefined"&&typeof window.document!="undefined"&&typeof navigator!="undefined";function Kl(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}var Dr=class extends ta{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}nextPageParams(){return null}nextPageInfo(){return null}},_e=class extends ta{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[]}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var n;let e=this.getPaginatedItems();if(!e.length)return null;let t=(n=e[e.length-1])==null?void 0:n.id;return t?{params:{after:t}}:null}};var M=class{constructor(e){this._client=e}};var Un=class extends M{create(e,t){var n;return this._client.post("/chat/completions",{body:e,...t,stream:(n=e.stream)!=null?n:!1})}};Un||(Un={});var Br=class extends M{constructor(){super(...arguments),this.completions=new Un(this._client)}};(function(r){r.Completions=Un})(Br||(Br={}));var zn=class extends M{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}};zn||(zn={});var Kn=class extends M{create(e,t){return this._client.post("/audio/transcriptions",Kt({body:e,...t}))}};Kn||(Kn={});var qn=class extends M{create(e,t){return this._client.post("/audio/translations",Kt({body:e,...t}))}};qn||(qn={});var Fr=class extends M{constructor(){super(...arguments),this.transcriptions=new Kn(this._client),this.translations=new qn(this._client),this.speech=new zn(this._client)}};(function(r){r.Transcriptions=Kn,r.Translations=qn,r.Speech=zn})(Fr||(Fr={}));var Vn=class extends M{create(e,t,n){return this._client.post(`/assistants/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/assistants/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}list(e,t={},n){return be(t)?this.list(e,{},t):this._client.getAPIList(`/assistants/${e}/files`,Zn,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/assistants/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}},Zn=class extends _e{};(function(r){r.AssistantFilesPage=Zn})(Vn||(Vn={}));var Hn=class extends M{constructor(){super(...arguments),this.files=new Vn(this._client)}create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}list(e={},t){return be(e)?this.list({},e):this._client.getAPIList("/assistants",Gn,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}},Gn=class extends _e{};(function(r){r.AssistantsPage=Gn,r.Files=Vn,r.AssistantFilesPage=Zn})(Hn||(Hn={}));function ql(r){return typeof r.parse=="function"}var Ur=r=>(r==null?void 0:r.role)==="assistant",Vl=r=>(r==null?void 0:r.role)==="function",Zl=r=>(r==null?void 0:r.role)==="tool";var xt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},W=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},je,fu,hu,ra,na,pu,sa,pr,ia,mu,gu,Hs,Hl,yu,Gl,Jl,Wl,Yl,Cp,Xl,kp=10,Gs=class{constructor(){je.add(this),this.controller=new AbortController,fu.set(this,void 0),hu.set(this,()=>{}),ra.set(this,()=>{}),na.set(this,void 0),pu.set(this,()=>{}),sa.set(this,()=>{}),pr.set(this,{}),this._chatCompletions=[],this.messages=[],ia.set(this,!1),mu.set(this,!1),gu.set(this,!1),Hs.set(this,!1),Yl.set(this,e=>{if(xt(this,mu,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new me),e instanceof me)return xt(this,gu,!0,"f"),this._emit("abort",e);if(e instanceof z)return this._emit("error",e);if(e instanceof Error){let t=new z(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new z(String(e)))}),xt(this,fu,new Promise((e,t)=>{xt(this,hu,e,"f"),xt(this,ra,t,"f")}),"f"),xt(this,na,new Promise((e,t)=>{xt(this,pu,e,"f"),xt(this,sa,t,"f")}),"f"),W(this,fu,"f").catch(()=>{}),W(this,na,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},W(this,Yl,"f"))},0)}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Vl(e)||Zl(e))&&e.content)this._emit("functionCallResult",e.content);else if(Ur(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Ur(e)&&e.tool_calls)for(let n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}_connected(){this.ended||(W(this,hu,"f").call(this),this._emit("connect"))}get ended(){return W(this,ia,"f")}get errored(){return W(this,mu,"f")}get aborted(){return W(this,gu,"f")}abort(){this.controller.abort()}on(e,t){return(W(this,pr,"f")[e]||(W(this,pr,"f")[e]=[])).push({listener:t}),this}off(e,t){let n=W(this,pr,"f")[e];if(!n)return this;let s=n.findIndex(i=>i.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(W(this,pr,"f")[e]||(W(this,pr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{xt(this,Hs,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){xt(this,Hs,!0,"f"),await W(this,na,"f")}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new z("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),W(this,je,"m",Hl).call(this)}async finalMessage(){return await this.done(),W(this,je,"m",yu).call(this)}async finalFunctionCall(){return await this.done(),W(this,je,"m",Gl).call(this)}async finalFunctionCallResult(){return await this.done(),W(this,je,"m",Jl).call(this)}async totalUsage(){return await this.done(),W(this,je,"m",Wl).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emit(e,...t){if(W(this,ia,"f"))return;e==="end"&&(xt(this,ia,!0,"f"),W(this,pu,"f").call(this));let n=W(this,pr,"f")[e];if(n&&(W(this,pr,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){let s=t[0];!W(this,Hs,"f")&&!(n!=null&&n.length)&&Promise.reject(s),W(this,ra,"f").call(this,s),W(this,sa,"f").call(this,s),this._emit("end");return}if(e==="error"){let s=t[0];!W(this,Hs,"f")&&!(n!=null&&n.length)&&Promise.reject(s),W(this,ra,"f").call(this,s),W(this,sa,"f").call(this,s),this._emit("end")}}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=W(this,je,"m",yu).call(this);t&&this._emit("finalMessage",t);let n=W(this,je,"m",Hl).call(this);n&&this._emit("finalContent",n);let s=W(this,je,"m",Gl).call(this);s&&this._emit("finalFunctionCall",s);let i=W(this,je,"m",Jl).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",W(this,je,"m",Wl).call(this))}async _createChatCompletion(e,t,n){let s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),W(this,je,"m",Cp).call(this,t);let i=await e.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(i)}async _runChatCompletion(e,t,n){for(let s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){var f;let s="function",{function_call:i="auto",stream:a,...o}=t,u=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:c=kp}=n||{},l={};for(let h of t.functions)l[h.name||h.function.name]=h;let d=t.functions.map(h=>({name:h.name||h.function.name,parameters:h.parameters,description:h.description}));for(let h of t.messages)this._addMessage(h,!1);for(let h=0;h<c;++h){let p=(f=(await this._createChatCompletion(e,{...o,function_call:i,functions:d,messages:[...this.messages]},n)).choices[0])==null?void 0:f.message;if(!p)throw new z("missing message in ChatCompletion response");if(!p.function_call)return;let{name:g,arguments:y}=p.function_call,b=l[g];if(b){if(u&&u!==g){let _=`Invalid function_call: ${JSON.stringify(g)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,name:g,content:_});continue}}else{let _=`Invalid function_call: ${JSON.stringify(g)}. Available options are: ${d.map(F=>JSON.stringify(F.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:g,content:_});continue}let O;try{O=ql(b)?await b.parse(y):y}catch(_){this._addMessage({role:s,name:g,content:_ instanceof Error?_.message:String(_)});continue}let E=await b.function(O,this),T=W(this,je,"m",Xl).call(this,E);if(this._addMessage({role:s,name:g,content:T}),u)return}}async _runTools(e,t,n){var f,h;let s="tool",{tool_choice:i="auto",stream:a,...o}=t,u=typeof i!="string"&&((f=i==null?void 0:i.function)==null?void 0:f.name),{maxChatCompletions:c=kp}=n||{},l={};for(let m of t.tools)m.type==="function"&&(l[m.function.name||m.function.function.name]=m.function);let d="tools"in t?t.tools.map(m=>m.type==="function"?{type:"function",function:{name:m.function.name||m.function.function.name,parameters:m.function.parameters,description:m.function.description}}:m):void 0;for(let m of t.messages)this._addMessage(m,!1);for(let m=0;m<c;++m){let g=(h=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:d,messages:[...this.messages]},n)).choices[0])==null?void 0:h.message;if(!g)throw new z("missing message in ChatCompletion response");if(!g.tool_calls)return;for(let y of g.tool_calls){if(y.type!=="function")continue;let b=y.id,{name:O,arguments:E}=y.function,T=l[O];if(T){if(u&&u!==O){let L=`Invalid tool_call: ${JSON.stringify(O)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,tool_call_id:b,content:L});continue}}else{let L=`Invalid tool_call: ${JSON.stringify(O)}. Available options are: ${d.map(te=>JSON.stringify(te.function.name)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:b,content:L});continue}let _;try{_=ql(T)?await T.parse(E):E}catch(L){let te=L instanceof Error?L.message:String(L);this._addMessage({role:s,tool_call_id:b,content:te});continue}let F=await T.function(_,this),S=W(this,je,"m",Xl).call(this,F);if(this._addMessage({role:s,tool_call_id:b,content:S}),u)return}}}};fu=new WeakMap,hu=new WeakMap,ra=new WeakMap,na=new WeakMap,pu=new WeakMap,sa=new WeakMap,pr=new WeakMap,ia=new WeakMap,mu=new WeakMap,gu=new WeakMap,Hs=new WeakMap,Yl=new WeakMap,je=new WeakSet,Hl=function(){var e;return(e=W(this,je,"m",yu).call(this).content)!=null?e:null},yu=function(){var t;let e=this.messages.length;for(;e-- >0;){let n=this.messages[e];if(Ur(n))return{...n,content:(t=n.content)!=null?t:null}}throw new z("stream ended without producing a ChatCompletionMessage with role=assistant")},Gl=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){let s=this.messages[n];if(Ur(s)&&(s!=null&&s.function_call))return s.function_call;if(Ur(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},Jl=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Vl(t)&&t.content!=null||Zl(t)&&t.content!=null&&this.messages.some(n=>{var s;return n.role==="assistant"&&((s=n.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},Wl=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Cp=function(e){if(e.n!=null&&e.n>1)throw new z("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Xl=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var aa=class r extends Gs{static runFunctions(e,t,n){let s=new r,i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,n){let s=new r,i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e){super._addMessage(e),Ur(e)&&e.content&&this._emit("content",e.content)}};var At=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Ql=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},qt,zr,ed,td,bu,Np,Js=class r extends Gs{constructor(){super(...arguments),qt.add(this),zr.set(this,void 0)}get currentChatCompletionSnapshot(){return At(this,zr,"f")}static fromReadableStream(e){let t=new r;return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){let s=new r;return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,n){var a;let s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),At(this,qt,"m",ed).call(this);let i=await e.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(let o of i)At(this,qt,"m",td).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new me;return this._addChatCompletion(At(this,qt,"m",bu).call(this))}async _fromReadableStream(e,t){var a;let n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),At(this,qt,"m",ed).call(this),this._connected();let s=hr.fromReadableStream(e,this.controller),i;for await(let o of s)i&&i!==o.id&&this._addChatCompletion(At(this,qt,"m",bu).call(this)),At(this,qt,"m",td).call(this,o),i=o.id;if((a=s.controller.signal)!=null&&a.aborted)throw new me;return this._addChatCompletion(At(this,qt,"m",bu).call(this))}[(zr=new WeakMap,qt=new WeakSet,ed=function(){this.ended||Ql(this,zr,void 0,"f")},td=function(t){var a,o,u;if(this.ended)return;let n=At(this,qt,"m",Np).call(this,t);this._emit("chunk",t,n);let s=(o=(a=t.choices[0])==null?void 0:a.delta)==null?void 0:o.content,i=(u=n.choices[0])==null?void 0:u.message;s!=null&&(i==null?void 0:i.role)==="assistant"&&(i!=null&&i.content)&&this._emit("content",s,i.content)},bu=function(){if(this.ended)throw new z("stream has ended, this shouldn't happen");let t=At(this,zr,"f");if(!t)throw new z("request ended without sending any chunks");return Ql(this,zr,void 0,"f"),Pw(t)},Np=function(t){var c,l,d,f;var n,s,i;let a=At(this,zr,"f"),{choices:o,...u}=t;a?Object.assign(a,u):a=Ql(this,zr,{...u,choices:[]},"f");for(let{delta:h,finish_reason:m,index:p,logprobs:g=null,...y}of t.choices){let b=a.choices[p];if(b||(b=a.choices[p]={finish_reason:m,index:p,message:{},logprobs:g,...y}),g)if(!b.logprobs)b.logprobs=Object.assign({},g);else{let{content:S,...L}=g;Object.assign(b.logprobs,L),S&&((c=(n=b.logprobs).content)!=null||(n.content=[]),b.logprobs.content.push(...S))}if(m&&(b.finish_reason=m),Object.assign(b,y),!h)continue;let{content:O,function_call:E,role:T,tool_calls:_,...F}=h;if(Object.assign(b.message,F),O&&(b.message.content=(b.message.content||"")+O),T&&(b.message.role=T),E&&(b.message.function_call?(E.name&&(b.message.function_call.name=E.name),E.arguments&&((l=(s=b.message.function_call).arguments)!=null||(s.arguments=""),b.message.function_call.arguments+=E.arguments)):b.message.function_call=E),_){b.message.tool_calls||(b.message.tool_calls=[]);for(let{index:S,id:L,type:te,function:ie,...rt}of _){let Ee=(d=(i=b.message.tool_calls)[S])!=null?d:i[S]={};Object.assign(Ee,rt),L&&(Ee.id=L),te&&(Ee.type=te),ie&&((f=Ee.function)!=null||(Ee.function={arguments:""})),ie!=null&&ie.name&&(Ee.function.name=ie.name),ie!=null&&ie.arguments&&(Ee.function.arguments+=ie.arguments)}}}return a},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("chunk",s=>{let i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(let i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(let i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new hr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function Pw(r){let{id:e,choices:t,created:n,model:s,system_fingerprint:i,...a}=r;return{...a,id:e,choices:t.map(({message:o,finish_reason:u,index:c,logprobs:l,...d})=>{if(!u)throw new z(`missing finish_reason for choice ${c}`);let{content:f=null,function_call:h,tool_calls:m,...p}=o,g=o.role;if(!g)throw new z(`missing role for choice ${c}`);if(h){let{arguments:y,name:b}=h;if(y==null)throw new z(`missing function_call.arguments for choice ${c}`);if(!b)throw new z(`missing function_call.name for choice ${c}`);return{...d,message:{content:f,function_call:{arguments:y,name:b},role:g},finish_reason:u,index:c,logprobs:l}}return m?{...d,index:c,finish_reason:u,logprobs:l,message:{...p,role:g,content:f,tool_calls:m.map((y,b)=>{let{function:O,type:E,id:T,..._}=y,{arguments:F,name:S,...L}=O||{};if(T==null)throw new z(`missing choices[${c}].tool_calls[${b}].id
${_u(r)}`);if(E==null)throw new z(`missing choices[${c}].tool_calls[${b}].type
${_u(r)}`);if(S==null)throw new z(`missing choices[${c}].tool_calls[${b}].function.name
${_u(r)}`);if(F==null)throw new z(`missing choices[${c}].tool_calls[${b}].function.arguments
${_u(r)}`);return{..._,id:T,type:E,function:{...L,name:S,arguments:F}}})}}:{...d,message:{...p,content:f,role:g},finish_reason:u,index:c,logprobs:l}}),created:n,model:s,object:"chat.completion",...i?{system_fingerprint:i}:{}}}function _u(r){return JSON.stringify(r)}var oa=class r extends Js{static fromReadableStream(e){let t=new r;return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){let s=new r,i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,n){let s=new r,i={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}};var ua=class extends M{runFunctions(e,t){return e.stream?oa.runFunctions(this._client.chat.completions,e,t):aa.runFunctions(this._client.chat.completions,e,t)}runTools(e,t){return e.stream?oa.runTools(this._client.chat.completions,e,t):aa.runTools(this._client.chat.completions,e,t)}stream(e,t){return Js.createChatCompletion(this._client.chat.completions,e,t)}};var Jn=class extends M{constructor(){super(...arguments),this.completions=new ua(this._client)}};(function(r){r.Completions=ua})(Jn||(Jn={}));var Ot=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},de=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},wu,vu,ca,la,xu,da,mr,fa,Au,Ou,Ws,rd,Eu=class{constructor(){this.controller=new AbortController,wu.set(this,void 0),vu.set(this,()=>{}),ca.set(this,()=>{}),la.set(this,void 0),xu.set(this,()=>{}),da.set(this,()=>{}),mr.set(this,{}),fa.set(this,!1),Au.set(this,!1),Ou.set(this,!1),Ws.set(this,!1),rd.set(this,e=>{if(Ot(this,Au,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new me),e instanceof me)return Ot(this,Ou,!0,"f"),this._emit("abort",e);if(e instanceof z)return this._emit("error",e);if(e instanceof Error){let t=new z(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new z(String(e)))}),Ot(this,wu,new Promise((e,t)=>{Ot(this,vu,e,"f"),Ot(this,ca,t,"f")}),"f"),Ot(this,la,new Promise((e,t)=>{Ot(this,xu,e,"f"),Ot(this,da,t,"f")}),"f"),de(this,wu,"f").catch(()=>{}),de(this,la,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emit("end")},de(this,rd,"f"))},0)}_addRun(e){return e}_connected(){this.ended||(de(this,vu,"f").call(this),this._emit("connect"))}get ended(){return de(this,fa,"f")}get errored(){return de(this,Au,"f")}get aborted(){return de(this,Ou,"f")}abort(){this.controller.abort()}on(e,t){return(de(this,mr,"f")[e]||(de(this,mr,"f")[e]=[])).push({listener:t}),this}off(e,t){let n=de(this,mr,"f")[e];if(!n)return this;let s=n.findIndex(i=>i.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(de(this,mr,"f")[e]||(de(this,mr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{Ot(this,Ws,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){Ot(this,Ws,!0,"f"),await de(this,la,"f")}_emit(e,...t){if(de(this,fa,"f"))return;e==="end"&&(Ot(this,fa,!0,"f"),de(this,xu,"f").call(this));let n=de(this,mr,"f")[e];if(n&&(de(this,mr,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){let s=t[0];!de(this,Ws,"f")&&!(n!=null&&n.length)&&Promise.reject(s),de(this,ca,"f").call(this,s),de(this,da,"f").call(this,s),this._emit("end");return}if(e==="error"){let s=t[0];!de(this,Ws,"f")&&!(n!=null&&n.length)&&Promise.reject(s),de(this,ca,"f").call(this,s),de(this,da,"f").call(this,s),this._emit("end")}}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,s){return await this._createAssistantStream(t,e,n,s)}async _runToolAssistantStream(e,t,n,s,i){return await this._createToolAssistantStream(n,e,t,s,i)}async _createThreadAssistantStream(e,t,n){let s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let i=await e.createAndRun({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addRun(i)}async _createToolAssistantStream(e,t,n,s,i){let a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let o=await e.submitToolOutputs(t,n,{...s,stream:!1},{...i,signal:this.controller.signal});return this._connected(),this._addRun(o)}async _createAssistantStream(e,t,n,s){let i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a=await e.create(t,{...n,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addRun(a)}};wu=new WeakMap,vu=new WeakMap,ca=new WeakMap,la=new WeakMap,xu=new WeakMap,da=new WeakMap,mr=new WeakMap,fa=new WeakMap,Au=new WeakMap,Ou=new WeakMap,Ws=new WeakMap,rd=new WeakMap;var R=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Qe=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},Ue,nd,Vt,Su,Et,Yn,Ys,Wn,Cu,et,Tu,Pu,ha,Iu,ku,Rp,jp,$p,Lp,Mp,Dp,Bp,gr=class r extends Eu{constructor(){super(...arguments),Ue.add(this),nd.set(this,[]),Vt.set(this,{}),Su.set(this,{}),Et.set(this,void 0),Yn.set(this,void 0),Ys.set(this,void 0),Wn.set(this,void 0),Cu.set(this,void 0),et.set(this,void 0),Tu.set(this,void 0),Pu.set(this,void 0),ha.set(this,void 0)}[(nd=new WeakMap,Vt=new WeakMap,Su=new WeakMap,Et=new WeakMap,Yn=new WeakMap,Ys=new WeakMap,Wn=new WeakMap,Cu=new WeakMap,et=new WeakMap,Tu=new WeakMap,Pu=new WeakMap,ha=new WeakMap,Ue=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("event",s=>{let i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(let i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(let i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new hr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,s,i){let a=new r;return a._run(()=>a._runToolAssistantStream(e,t,n,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,n,s,i){var c;let a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let o={...s,stream:!0},u=await e.submitToolOutputs(t,n,o,{...i,signal:this.controller.signal});this._connected();for await(let l of u)R(this,Ue,"m",Iu).call(this,l);if((c=u.controller.signal)!=null&&c.aborted)throw new me;return this._addRun(R(this,Ue,"m",ku).call(this))}static createThreadAssistantStream(e,t,n){let s=new r;return s._run(()=>s._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,n,s){let i=new r;return i._run(()=>i._runAssistantStream(e,t,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return R(this,Tu,"f")}currentRun(){return R(this,Pu,"f")}currentMessageSnapshot(){return R(this,Et,"f")}currentRunStepSnapshot(){return R(this,ha,"f")}async finalRunSteps(){return await this.done(),Object.values(R(this,Vt,"f"))}async finalMessages(){return await this.done(),Object.values(R(this,Su,"f"))}async finalRun(){if(await this.done(),!R(this,Yn,"f"))throw Error("Final run was not received.");return R(this,Yn,"f")}async _createThreadAssistantStream(e,t,n){var o;let s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let i={...t,stream:!0},a=await e.createAndRun(i,{...n,signal:this.controller.signal});this._connected();for await(let u of a)R(this,Ue,"m",Iu).call(this,u);if((o=a.controller.signal)!=null&&o.aborted)throw new me;return this._addRun(R(this,Ue,"m",ku).call(this))}async _createAssistantStream(e,t,n,s){var u;let i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a={...n,stream:!0},o=await e.create(t,a,{...s,signal:this.controller.signal});this._connected();for await(let c of o)R(this,Ue,"m",Iu).call(this,c);if((u=o.controller.signal)!=null&&u.aborted)throw new me;return this._addRun(R(this,Ue,"m",ku).call(this))}static accumulateDelta(e,t){for(let[n,s]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let i=e[n];if(i==null){e[n]=s;continue}if(n==="index"||n==="type"){e[n]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(Kl(i)&&Kl(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${i}`);e[n]=i}return e}};Iu=function(e){if(!this.ended)switch(Qe(this,Tu,e,"f"),R(this,Ue,"m",$p).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":R(this,Ue,"m",Bp).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":R(this,Ue,"m",jp).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":R(this,Ue,"m",Rp).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},ku=function(){if(this.ended)throw new z("stream has ended, this shouldn't happen");if(!R(this,Yn,"f"))throw Error("Final run has been been received");return R(this,Yn,"f")},Rp=function(e){let[t,n]=R(this,Ue,"m",Mp).call(this,e,R(this,Et,"f"));Qe(this,Et,t,"f"),R(this,Su,"f")[t.id]=t;for(let s of n){let i=t.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=t.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=R(this,Ys,"f")){if(R(this,Wn,"f"))switch(R(this,Wn,"f").type){case"text":this._emit("textDone",R(this,Wn,"f").text,R(this,Et,"f"));break;case"image_file":this._emit("imageFileDone",R(this,Wn,"f").image_file,R(this,Et,"f"));break}Qe(this,Ys,s.index,"f")}Qe(this,Wn,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(R(this,Ys,"f")!==void 0){let s=e.data.content[R(this,Ys,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,R(this,Et,"f"));break;case"text":this._emit("textDone",s.text,R(this,Et,"f"));break}}R(this,Et,"f")&&this._emit("messageDone",e.data),Qe(this,Et,void 0,"f")}},jp=function(e){let t=R(this,Ue,"m",Lp).call(this,e);switch(Qe(this,ha,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(let i of n.step_details.tool_calls)i.index==R(this,Cu,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(R(this,et,"f")&&this._emit("toolCallDone",R(this,et,"f")),Qe(this,Cu,i.index,"f"),Qe(this,et,t.step_details.tool_calls[i.index],"f"),R(this,et,"f")&&this._emit("toolCallCreated",R(this,et,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Qe(this,ha,void 0,"f"),e.data.step_details.type=="tool_calls"&&R(this,et,"f")&&(this._emit("toolCallDone",R(this,et,"f")),Qe(this,et,void 0,"f")),this._emit("runStepDone",e.data,t);break;case"thread.run.step.in_progress":break}},$p=function(e){R(this,nd,"f").push(e),this._emit("event",e)},Lp=function(e){switch(e.event){case"thread.run.step.created":return R(this,Vt,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=R(this,Vt,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){let s=gr.accumulateDelta(t,n.delta);R(this,Vt,"f")[e.data.id]=s}return R(this,Vt,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":R(this,Vt,"f")[e.data.id]=e.data;break}if(R(this,Vt,"f")[e.data.id])return R(this,Vt,"f")[e.data.id];throw new Error("No snapshot available")},Mp=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(let i of s.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=R(this,Ue,"m",Dp).call(this,i,a)}else t.content[i.index]=i,n.push(i);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Dp=function(e,t){return gr.accumulateDelta(t,e)},Bp=function(e){switch(Qe(this,Pu,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Qe(this,Yn,e.data,"f"),R(this,et,"f")&&(this._emit("toolCallDone",R(this,et,"f")),Qe(this,et,void 0,"f"));break;case"thread.run.cancelling":break}};var Xn=class extends M{retrieve(e,t,n,s){return this._client.get(`/threads/${e}/messages/${t}/files/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}list(e,t,n={},s){return be(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/messages/${t}/files`,Qn,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}},Qn=class extends _e{};(function(r){r.MessageFilesPage=Qn})(Xn||(Xn={}));var es=class extends M{constructor(){super(...arguments),this.files=new Xn(this._client)}create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}list(e,t={},n){return be(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,ts,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}},ts=class extends _e{};(function(r){r.MessagesPage=ts,r.Files=Xn,r.MessageFilesPage=Qn})(es||(es={}));var rs=class extends M{retrieve(e,t,n,s){return this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}list(e,t,n={},s){return be(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,ns,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}},ns=class extends _e{};(function(r){r.RunStepsPage=ns})(rs||(rs={}));var ss=class extends M{constructor(){super(...arguments),this.steps=new rs(this._client)}create(e,t,n){var s;return this._client.post(`/threads/${e}/runs`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers},stream:(s=t.stream)!=null?s:!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}list(e,t={},n){return be(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,is,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}createAndStream(e,t,n){return gr.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,s){var i;return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers},stream:(i=n.stream)!=null?i:!1})}submitToolOutputsStream(e,t,n,s){return gr.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,s)}},is=class extends _e{};(function(r){r.RunsPage=is,r.Steps=rs,r.RunStepsPage=ns})(ss||(ss={}));var as=class extends M{constructor(){super(...arguments),this.runs=new ss(this._client),this.messages=new es(this._client)}create(e={},t){return be(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v1",...n==null?void 0:n.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}createAndRun(e,t){var n;return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers},stream:(n=e.stream)!=null?n:!1})}createAndRunStream(e,t){return gr.createThreadAssistantStream(e,this._client.beta.threads,t)}};(function(r){r.Runs=ss,r.RunsPage=is,r.Messages=es,r.MessagesPage=ts})(as||(as={}));var Kr=class extends M{constructor(){super(...arguments),this.chat=new Jn(this._client),this.assistants=new Hn(this._client),this.threads=new as(this._client)}};(function(r){r.Chat=Jn,r.Assistants=Hn,r.AssistantsPage=Gn,r.Threads=as})(Kr||(Kr={}));var qr=class extends M{create(e,t){var n;return this._client.post("/completions",{body:e,...t,stream:(n=e.stream)!=null?n:!1})}};qr||(qr={});var Vr=class extends M{create(e,t){return this._client.post("/embeddings",{body:e,...t})}};Vr||(Vr={});var Zr=class extends M{create(e,t){return this._client.post("/files",Kt({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return be(e)?this.list({},e):this._client.getAPIList("/files",Hr,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){let s=new Set(["processed","error","deleted"]),i=Date.now(),a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await zl(t),a=await this.retrieve(e),Date.now()-i>n)throw new fr({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}},Hr=class extends Dr{};(function(r){r.FileObjectsPage=Hr})(Zr||(Zr={}));var os=class extends M{create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return be(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",us,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return be(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,cs,{query:t,...n})}},us=class extends _e{},cs=class extends _e{};(function(r){r.FineTuningJobsPage=us,r.FineTuningJobEventsPage=cs})(os||(os={}));var Gr=class extends M{constructor(){super(...arguments),this.jobs=new os(this._client)}};(function(r){r.Jobs=os,r.FineTuningJobsPage=us,r.FineTuningJobEventsPage=cs})(Gr||(Gr={}));var Jr=class extends M{createVariation(e,t){return this._client.post("/images/variations",Kt({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",Kt({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}};Jr||(Jr={});var Wr=class extends M{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Yr,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}},Yr=class extends Dr{};(function(r){r.ModelsPage=Yr})(Wr||(Wr={}));var Xr=class extends M{create(e,t){return this._client.post("/moderations",{body:e,...t})}};Xr||(Xr={});var Vp,fe=class extends lu{constructor({baseURL:e=du("OPENAI_BASE_URL"),apiKey:t=du("OPENAI_API_KEY"),organization:n=(i=>(i=du("OPENAI_ORG_ID"))!=null?i:null)(),...s}={}){var o;if(t===void 0)throw new z("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let a={apiKey:t,organization:n,...s,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&Sp())throw new z(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:(o=a.timeout)!=null?o:6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new qr(this),this.chat=new Br(this),this.embeddings=new Vr(this),this.files=new Zr(this),this.images=new Jr(this),this.audio=new Fr(this),this.moderations=new Xr(this),this.models=new Wr(this),this.fineTuning=new Gr(this),this.beta=new Kr(this),this._options=a,this.apiKey=t,this.organization=n}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}};Vp=fe;fe.OpenAI=Vp;fe.OpenAIError=z;fe.APIError=ye;fe.APIConnectionError=dr;fe.APIConnectionTimeoutError=fr;fe.APIUserAbortError=me;fe.NotFoundError=Fs;fe.ConflictError=Us;fe.RateLimitError=Ks;fe.BadRequestError=Ms;fe.AuthenticationError=Ds;fe.InternalServerError=qs;fe.PermissionDeniedError=Bs;fe.UnprocessableEntityError=zs;var{OpenAIError:ok,APIError:uk,APIConnectionError:ck,APIConnectionTimeoutError:Zp,APIUserAbortError:Hp,NotFoundError:lk,ConflictError:dk,RateLimitError:fk,BadRequestError:hk,AuthenticationError:pk,InternalServerError:mk,PermissionDeniedError:gk,UnprocessableEntityError:yk}=jl;(function(r){r.toFile=Dl,r.fileFromPath=su,r.Page=Dr,r.CursorPage=_e,r.Completions=qr,r.Chat=Br,r.Embeddings=Vr,r.Files=Zr,r.FileObjectsPage=Hr,r.Images=Jr,r.Audio=Fr,r.Moderations=Xr,r.Models=Wr,r.ModelsPage=Yr,r.FineTuning=Gr,r.Beta=Kr})(fe||(fe={}));function Gp(r){return{name:r.name,description:r.description,parameters:Dn(r.schema)}}function sd(r){return{type:"function",function:Gp(r)}}var ls=class extends ce{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){let n=oe(t);return this.func&&await this.func(e,n),this._callWithConfig(s=>Promise.resolve(s),e,n)}async*transform(e,t){let n=oe(t),s,i=!0;for await(let a of this._transformStreamWithConfig(e,o=>o,n))if(yield a,i)if(s===void 0)s=a;else try{s=Ut(s,a)}catch(o){s=void 0,i=!1}this.func&&s!==void 0&&await this.func(s,n)}static assign(e){return new $s(new Mr({steps:e}))}};var Xs=class extends ce{parseResultWithPrompt(e,t,n){return this.parseResult(e,n)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(n,s)=>this.parseResult([{text:n}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(n,s)=>this.parseResult([{message:n,text:this._baseMessageToString(n)}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"})}},Qs=class extends Xs{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}},ds=class extends Error{constructor(e,t,n,s=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=n,this.sendToLLM=s,s&&(n===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true")}};function pa(r,e){let t=typeof r;if(t!==typeof e)return!1;if(Array.isArray(r)){if(!Array.isArray(e))return!1;let n=r.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(!pa(r[s],e[s]))return!1;return!0}if(t==="object"){if(!r||!e)return r===e;let n=Object.keys(r),s=Object.keys(e);if(n.length!==s.length)return!1;for(let a of n)if(!pa(r[a],e[a]))return!1;return!0}return r===e}var rC=typeof self!="undefined"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");var Lw=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,Mw=[0,31,28,31,30,31,30,31,31,30,31,30,31],Dw=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,Bw=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,Fw=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,Uw=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,zw=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,Kw=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,qw=/^(?:\/(?:[^~/]|~0|~1)*)*$/,Vw=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,Zw=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,Hw=/^\d\d\d\d-[0-1]\d-[0-3]\d$/,Gw=/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,Jw=/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,Ww=/^(?:(?:[a-z][a-z0-9+-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,Yw=r=>{if(r[0]==='"')return!1;let[e,t,...n]=r.split("@");return!e||!t||n.length!==0||e.length>64||t.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(t)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:t.split(".").every(s=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(s))},Xw=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,Qw=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,ev=r=>r.length>1&&r.length<80&&(/^P\d+([.,]\d+)?W$/.test(r)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(r)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(r));function He(r){return r.test.bind(r)}var tv={date:Jp,time:Wp.bind(void 0,!1),"date-time":iv,duration:ev,uri:uv,"uri-reference":He(Fw),"uri-template":He(Uw),url:He(zw),email:Yw,hostname:He(Bw),ipv4:He(Xw),ipv6:He(Qw),regex:lv,uuid:He(Kw),"json-pointer":He(qw),"json-pointer-uri-fragment":He(Vw),"relative-json-pointer":He(Zw)},rv={...tv,date:He(Hw),time:He(Gw),"date-time":He(Jw),"uri-reference":He(Ww)};function nv(r){return r%4===0&&(r%100!==0||r%400===0)}function Jp(r){let e=r.match(Lw);if(!e)return!1;let t=+e[1],n=+e[2],s=+e[3];return n>=1&&n<=12&&s>=1&&s<=(n==2&&nv(t)?29:Mw[n])}function Wp(r,e){let t=e.match(Dw);if(!t)return!1;let n=+t[1],s=+t[2],i=+t[3],a=!!t[5];return(n<=23&&s<=59&&i<=59||n==23&&s==59&&i==60)&&(!r||a)}var sv=/t|\s/i;function iv(r){let e=r.split(sv);return e.length==2&&Jp(e[0])&&Wp(!0,e[1])}var av=/\/|:/,ov=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function uv(r){return av.test(r)&&ov.test(r)}var cv=/[^\\]\\Z/;function lv(r){if(cv.test(r))return!1;try{return new RegExp(r),!0}catch(e){return!1}}var ei=class extends Qs{async*_transform(e){for await(let t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}},ma=class extends ei{constructor(e){var t;super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(t=e==null?void 0:e.diff)!=null?t:this.diff}async*_transform(e){let t,n;for await(let s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let i;if(Ef(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new er({message:s,text:s.content})}else if(fn(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new er({message:s.toChunk(),text:s.content})}else i=new Pr({text:s});n===void 0?n=i:n=n.concat(i);let a=await this.parsePartialResult([n]);a!=null&&!pa(a,t)&&(this.diff?yield this._diff(t,a):yield a,t=a)}}};var Nu=class extends Qs{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){let t=ir.object(Object.fromEntries(Object.entries(e).map(([n,s])=>[n,ir.string().describe(s)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(Dn(this.schema))}
\`\`\`
`}async parse(e){try{let t=e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim();return await this.schema.parseAsync(JSON.parse(t))}catch(t){throw new ds(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}};var Ru=class extends ma{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?Zo(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return Yp(e[0].text)}async parse(e){return Yp(e,JSON.parse)}getFormatInstructions(){return""}};function Yp(r,e=fv){r=r.trim();let t=/```(json)?(.*)```/s.exec(r);return e(t?t[2]:r)}function fv(r){if(typeof r=="undefined")return null;try{return JSON.parse(r)}catch(i){}let e="",t=[],n=!1,s=!1;for(let i of r){if(n)i==='"'&&!s?n=!1:i===`
`&&!s?i="\\n":i==="\\"?s=!s:s=!1;else if(i==='"')n=!0,s=!1;else if(i==="{")t.push("}");else if(i==="[")t.push("]");else if(i==="}"||i==="]")if(t&&t[t.length-1]===i)t.pop();else return null;e+=i}n&&(e+='"');for(let i=t.length-1;i>=0;i-=1)e+=t[i];try{return JSON.parse(e)}catch(i){return null}}var id=class extends Xs{static lc_name(){return"JsonOutputToolsParser"}constructor(e){var t;super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(t=e==null?void 0:e.returnId)!=null?t:this.returnId}async parseResult(e){let t=e[0].message.additional_kwargs.tool_calls;if(!t)throw new Error(`No tools_call in message ${JSON.stringify(e)}`);let n=JSON.parse(JSON.stringify(t)),s=[];for(let i of n)if(i.function!==void 0){let a={type:i.function.name,args:JSON.parse(i.function.arguments)};this.returnId&&(a.id=i.id),Object.defineProperty(a,"name",{get(){return this.type}}),Object.defineProperty(a,"arguments",{get(){return this.args}}),s.push(a)}return s}},ga=class extends Xs{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){var t;super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"initialParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=(t=e.returnSingle)!=null?t:this.returnSingle,this.initialParser=new id(e),this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;let t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new ds(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parseResult(e){let n=(await this.initialParser.parseResult(e)).filter(a=>a.type===this.keyName),s=n;return this.returnId||(s=n.map(a=>a.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(a=>this._validateResult(a)))}};function ad(r,e,t,n){n!=null&&n.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function Q(r,e,t,n,s){r[e]=t,ad(r,e,n,s)}var Xp={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"string",mapStrategy:"entries",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",emailStrategy:"format:email"},Qp=r=>typeof r=="string"?{...Xp,name:r}:{...Xp,...r};var ne;(function(r){r.assertEqual=s=>s;function e(s){}r.assertIs=e;function t(s){throw new Error}r.assertNever=t,r.arrayToEnum=s=>{let i={};for(let a of s)i[a]=a;return i},r.getValidEnumValues=s=>{let i=r.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),a={};for(let o of i)a[o]=s[o];return r.objectValues(a)},r.objectValues=s=>r.objectKeys(s).map(function(i){return s[i]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let i=[];for(let a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},r.find=(s,i)=>{for(let a of s)if(i(a))return a},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function n(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}r.joinValues=n,r.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(ne||(ne={}));var em;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(em||(em={}));var I=ne.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),fs=r=>{switch(typeof r){case"undefined":return I.undefined;case"string":return I.string;case"number":return isNaN(r)?I.nan:I.number;case"boolean":return I.boolean;case"function":return I.function;case"bigint":return I.bigint;case"symbol":return I.symbol;case"object":return Array.isArray(r)?I.array:r===null?I.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?I.promise:typeof Map!="undefined"&&r instanceof Map?I.map:typeof Set!="undefined"&&r instanceof Set?I.set:typeof Date!="undefined"&&r instanceof Date?I.date:I.object;default:return I.unknown}},A=ne.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);var at=class extends Error{constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){let t=e||function(i){return i.message},n={_errors:[]},s=i=>{for(let a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)n._errors.push(t(a));else{let o=n,u=0;for(;u<a.path.length;){let c=a.path[u];u===a.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(a))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return s(this),n}toString(){return this.message}get message(){return JSON.stringify(this.issues,ne.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},n=[];for(let s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}};at.create=r=>new at(r);var $u=(r,e)=>{let t;switch(r.code){case A.invalid_type:r.received===I.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case A.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,ne.jsonStringifyReplacer)}`;break;case A.unrecognized_keys:t=`Unrecognized key(s) in object: ${ne.joinValues(r.keys,", ")}`;break;case A.invalid_union:t="Invalid input";break;case A.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${ne.joinValues(r.options)}`;break;case A.invalid_enum_value:t=`Invalid enum value. Expected ${ne.joinValues(r.options)}, received '${r.received}'`;break;case A.invalid_arguments:t="Invalid function arguments";break;case A.invalid_return_type:t="Invalid function return type";break;case A.invalid_date:t="Invalid date";break;case A.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:ne.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case A.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case A.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case A.custom:t="Invalid input";break;case A.invalid_intersection_types:t="Intersection results could not be merged";break;case A.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case A.not_finite:t="Number must be finite";break;default:t=e.defaultError,ne.assertNever(r)}return{message:t}},hv=$u;function ud(){return hv}var cd=r=>{let{data:e,path:t,errorMaps:n,issueData:s}=r,i=[...t,...s.path||[]],a={...s,path:i},o="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)o=c(a,{data:e,defaultError:o}).message;return{...s,path:i,message:s.message||o}};function C(r,e){let t=cd({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,ud(),$u].filter(n=>!!n)});r.common.issues.push(t)}var ze=class r{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let n=[];for(let s of t){if(s.status==="aborted")return Z;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){let n=[];for(let s of t)n.push({key:await s.key,value:await s.value});return r.mergeObjectSync(e,n)}static mergeObjectSync(e,t){let n={};for(let s of t){let{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return Z;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value!="undefined"||s.alwaysSet)&&(n[i.value]=a.value)}return{status:e.value,value:n}}},Z=Object.freeze({status:"aborted"}),pv=r=>({status:"dirty",value:r}),Ge=r=>({status:"valid",value:r}),tm=r=>r.status==="aborted",rm=r=>r.status==="dirty",Lu=r=>r.status==="valid",ld=r=>typeof Promise!="undefined"&&r instanceof Promise,$;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})($||($={}));var ot=class{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},nm=(r,e)=>{if(Lu(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new at(r.common.issues);return this._error=t,this._error}}};function V(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:n,description:s}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,o)=>a.code!=="invalid_type"?{message:o.defaultError}:typeof o.data=="undefined"?{message:n!=null?n:o.defaultError}:{message:t!=null?t:o.defaultError},description:s}}var G=class{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return fs(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:fs(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ze,ctx:{common:e.parent.common,data:e.data,parsedType:fs(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(ld(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;let s={common:{issues:[],async:(n=t==null?void 0:t.async)!==null&&n!==void 0?n:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:fs(e)},i=this._parseSync({data:e,path:s.path,parent:s});return nm(s,i)}async parseAsync(e,t){let n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){let n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:fs(e)},s=this._parse({data:e,path:n.path,parent:n}),i=await(ld(s)?s:Promise.resolve(s));return nm(n,i)}refine(e,t){let n=s=>typeof t=="string"||typeof t=="undefined"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{let a=e(s),o=()=>i.addIssue({code:A.custom,...n(s)});return typeof Promise!="undefined"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new St({schema:this,typeName:v.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Zt.create(this,this._def)}nullable(){return tn.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return en.create(this,this._def)}promise(){return hs.create(this,this._def)}or(e){return ii.create([this,e],this._def)}and(e){return ai.create(this,e,this._def)}transform(e){return new St({...V(this._def),schema:this,typeName:v.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new di({...V(this._def),innerType:this,defaultValue:t,typeName:v.ZodDefault})}brand(){return new md({typeName:v.ZodBranded,type:this,...V(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new Sa({...V(this._def),innerType:this,catchValue:t,typeName:v.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Mu.create(this,e)}readonly(){return Pa.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},mv=/^c[^\s-]{8,}$/i,gv=/^[a-z][a-z0-9]*$/,yv=/^[0-9A-HJKMNP-TV-Z]{26}$/,bv=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,_v=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,wv="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",od,vv=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,xv=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Av=r=>r.precision?r.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${r.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${r.precision}}Z$`):r.precision===0?r.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):r.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function Ov(r,e){return!!((e==="v4"||!e)&&vv.test(r)||(e==="v6"||!e)&&xv.test(r))}var ri=class r extends G{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==I.string){let i=this._getOrReturnCtx(e);return C(i,{code:A.invalid_type,expected:I.string,received:i.parsedType}),Z}let n=new ze,s;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),C(s,{code:A.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),C(s,{code:A.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){let a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(s=this._getOrReturnCtx(e,s),a?C(s,{code:A.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&C(s,{code:A.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")_v.test(e.data)||(s=this._getOrReturnCtx(e,s),C(s,{validation:"email",code:A.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")od||(od=new RegExp(wv,"u")),od.test(e.data)||(s=this._getOrReturnCtx(e,s),C(s,{validation:"emoji",code:A.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")bv.test(e.data)||(s=this._getOrReturnCtx(e,s),C(s,{validation:"uuid",code:A.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")mv.test(e.data)||(s=this._getOrReturnCtx(e,s),C(s,{validation:"cuid",code:A.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")gv.test(e.data)||(s=this._getOrReturnCtx(e,s),C(s,{validation:"cuid2",code:A.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")yv.test(e.data)||(s=this._getOrReturnCtx(e,s),C(s,{validation:"ulid",code:A.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(e.data)}catch(a){s=this._getOrReturnCtx(e,s),C(s,{validation:"url",code:A.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),C(s,{validation:"regex",code:A.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),C(s,{code:A.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),C(s,{code:A.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),C(s,{code:A.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?Av(i).test(e.data)||(s=this._getOrReturnCtx(e,s),C(s,{code:A.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="ip"?Ov(e.data,i.version)||(s=this._getOrReturnCtx(e,s),C(s,{validation:"ip",code:A.invalid_string,message:i.message}),n.dirty()):ne.assertNever(i);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(s=>e.test(s),{validation:t,code:A.invalid_string,...$.errToObj(n)})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...$.errToObj(e)})}url(e){return this._addCheck({kind:"url",...$.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...$.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...$.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...$.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...$.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...$.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...$.errToObj(e)})}datetime(e){var t;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)=="undefined"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,...$.errToObj(e==null?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...$.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...$.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...$.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...$.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...$.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...$.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...$.errToObj(t)})}nonempty(e){return this.min(1,$.errToObj(e))}trim(){return new r({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};ri.create=r=>{var e;return new ri({checks:[],typeName:v.ZodString,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...V(r)})};function Ev(r,e){let t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,i=parseInt(r.toFixed(s).replace(".","")),a=parseInt(e.toFixed(s).replace(".",""));return i%a/Math.pow(10,s)}var ya=class r extends G{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==I.number){let i=this._getOrReturnCtx(e);return C(i,{code:A.invalid_type,expected:I.number,received:i.parsedType}),Z}let n,s=new ze;for(let i of this._def.checks)i.kind==="int"?ne.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{code:A.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),C(n,{code:A.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),C(n,{code:A.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?Ev(e.data,i.value)!==0&&(n=this._getOrReturnCtx(e,n),C(n,{code:A.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),C(n,{code:A.not_finite,message:i.message}),s.dirty()):ne.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,$.toString(t))}gt(e,t){return this.setLimit("min",e,!1,$.toString(t))}lte(e,t){return this.setLimit("max",e,!0,$.toString(t))}lt(e,t){return this.setLimit("max",e,!1,$.toString(t))}setLimit(e,t,n,s){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:$.toString(s)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:$.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:$.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:$.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:$.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:$.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:$.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:$.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:$.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:$.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ne.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}};ya.create=r=>new ya({checks:[],typeName:v.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...V(r)});var ba=class r extends G{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==I.bigint){let i=this._getOrReturnCtx(e);return C(i,{code:A.invalid_type,expected:I.bigint,received:i.parsedType}),Z}let n,s=new ze;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),C(n,{code:A.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),C(n,{code:A.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),C(n,{code:A.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):ne.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,$.toString(t))}gt(e,t){return this.setLimit("min",e,!1,$.toString(t))}lte(e,t){return this.setLimit("max",e,!0,$.toString(t))}lt(e,t){return this.setLimit("max",e,!1,$.toString(t))}setLimit(e,t,n,s){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:$.toString(s)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:$.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:$.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:$.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:$.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:$.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};ba.create=r=>{var e;return new ba({checks:[],typeName:v.ZodBigInt,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...V(r)})};var _a=class extends G{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==I.boolean){let n=this._getOrReturnCtx(e);return C(n,{code:A.invalid_type,expected:I.boolean,received:n.parsedType}),Z}return Ge(e.data)}};_a.create=r=>new _a({typeName:v.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...V(r)});var wa=class r extends G{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==I.date){let i=this._getOrReturnCtx(e);return C(i,{code:A.invalid_type,expected:I.date,received:i.parsedType}),Z}if(isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return C(i,{code:A.invalid_date}),Z}let n=new ze,s;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),C(s,{code:A.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),C(s,{code:A.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):ne.assertNever(i);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:$.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:$.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};wa.create=r=>new wa({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:v.ZodDate,...V(r)});var va=class extends G{_parse(e){if(this._getType(e)!==I.symbol){let n=this._getOrReturnCtx(e);return C(n,{code:A.invalid_type,expected:I.symbol,received:n.parsedType}),Z}return Ge(e.data)}};va.create=r=>new va({typeName:v.ZodSymbol,...V(r)});var ni=class extends G{_parse(e){if(this._getType(e)!==I.undefined){let n=this._getOrReturnCtx(e);return C(n,{code:A.invalid_type,expected:I.undefined,received:n.parsedType}),Z}return Ge(e.data)}};ni.create=r=>new ni({typeName:v.ZodUndefined,...V(r)});var si=class extends G{_parse(e){if(this._getType(e)!==I.null){let n=this._getOrReturnCtx(e);return C(n,{code:A.invalid_type,expected:I.null,received:n.parsedType}),Z}return Ge(e.data)}};si.create=r=>new si({typeName:v.ZodNull,...V(r)});var xa=class extends G{constructor(){super(...arguments),this._any=!0}_parse(e){return Ge(e.data)}};xa.create=r=>new xa({typeName:v.ZodAny,...V(r)});var Qr=class extends G{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ge(e.data)}};Qr.create=r=>new Qr({typeName:v.ZodUnknown,...V(r)});var Ht=class extends G{_parse(e){let t=this._getOrReturnCtx(e);return C(t,{code:A.invalid_type,expected:I.never,received:t.parsedType}),Z}};Ht.create=r=>new Ht({typeName:v.ZodNever,...V(r)});var Aa=class extends G{_parse(e){if(this._getType(e)!==I.undefined){let n=this._getOrReturnCtx(e);return C(n,{code:A.invalid_type,expected:I.void,received:n.parsedType}),Z}return Ge(e.data)}};Aa.create=r=>new Aa({typeName:v.ZodVoid,...V(r)});var en=class r extends G{_parse(e){let{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==I.array)return C(t,{code:A.invalid_type,expected:I.array,received:t.parsedType}),Z;if(s.exactLength!==null){let a=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(a||o)&&(C(t,{code:a?A.too_big:A.too_small,minimum:o?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(C(t,{code:A.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(C(t,{code:A.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>s.type._parseAsync(new ot(t,a,t.path,o)))).then(a=>ze.mergeArray(n,a));let i=[...t.data].map((a,o)=>s.type._parseSync(new ot(t,a,t.path,o)));return ze.mergeArray(n,i)}get element(){return this._def.type}min(e,t){return new r({...this._def,minLength:{value:e,message:$.toString(t)}})}max(e,t){return new r({...this._def,maxLength:{value:e,message:$.toString(t)}})}length(e,t){return new r({...this._def,exactLength:{value:e,message:$.toString(t)}})}nonempty(e){return this.min(1,e)}};en.create=(r,e)=>new en({type:r,minLength:null,maxLength:null,exactLength:null,typeName:v.ZodArray,...V(e)});function ti(r){if(r instanceof tt){let e={};for(let t in r.shape){let n=r.shape[t];e[t]=Zt.create(ti(n))}return new tt({...r._def,shape:()=>e})}else return r instanceof en?new en({...r._def,type:ti(r.element)}):r instanceof Zt?Zt.create(ti(r.unwrap())):r instanceof tn?tn.create(ti(r.unwrap())):r instanceof yr?yr.create(r.items.map(e=>ti(e))):r}var tt=class r extends G{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=ne.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==I.object){let c=this._getOrReturnCtx(e);return C(c,{code:A.invalid_type,expected:I.object,received:c.parsedType}),Z}let{status:n,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof Ht&&this._def.unknownKeys==="strip"))for(let c in s.data)a.includes(c)||o.push(c);let u=[];for(let c of a){let l=i[c],d=s.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new ot(s,d,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof Ht){let c=this._def.unknownKeys;if(c==="passthrough")for(let l of o)u.push({key:{status:"valid",value:l},value:{status:"valid",value:s.data[l]}});else if(c==="strict")o.length>0&&(C(s,{code:A.unrecognized_keys,keys:o}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let c=this._def.catchall;for(let l of o){let d=s.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new ot(s,d,s.path,l)),alwaysSet:l in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let c=[];for(let l of u){let d=await l.key;c.push({key:d,value:await l.value,alwaysSet:l.alwaysSet})}return c}).then(c=>ze.mergeObjectSync(n,c)):ze.mergeObjectSync(n,u)}get shape(){return this._def.shape()}strict(e){return $.errToObj,new r({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var s,i,a,o;let u=(a=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,t,n).message)!==null&&a!==void 0?a:n.defaultError;return t.code==="unrecognized_keys"?{message:(o=$.errToObj(e).message)!==null&&o!==void 0?o:u}:{message:u}}}:{}})}strip(){return new r({...this._def,unknownKeys:"strip"})}passthrough(){return new r({...this._def,unknownKeys:"passthrough"})}extend(e){return new r({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new r({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:v.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new r({...this._def,catchall:e})}pick(e){let t={};return ne.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new r({...this._def,shape:()=>t})}omit(e){let t={};return ne.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new r({...this._def,shape:()=>t})}deepPartial(){return ti(this)}partial(e){let t={};return ne.objectKeys(this.shape).forEach(n=>{let s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}),new r({...this._def,shape:()=>t})}required(e){let t={};return ne.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof Zt;)i=i._def.innerType;t[n]=i}}),new r({...this._def,shape:()=>t})}keyof(){return sm(ne.objectKeys(this.shape))}};tt.create=(r,e)=>new tt({shape:()=>r,unknownKeys:"strip",catchall:Ht.create(),typeName:v.ZodObject,...V(e)});tt.strictCreate=(r,e)=>new tt({shape:()=>r,unknownKeys:"strict",catchall:Ht.create(),typeName:v.ZodObject,...V(e)});tt.lazycreate=(r,e)=>new tt({shape:r,unknownKeys:"strip",catchall:Ht.create(),typeName:v.ZodObject,...V(e)});var ii=class extends G{_parse(e){let{ctx:t}=this._processInputParams(e),n=this._def.options;function s(i){for(let o of i)if(o.result.status==="valid")return o.result;for(let o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;let a=i.map(o=>new at(o.ctx.common.issues));return C(t,{code:A.invalid_union,unionErrors:a}),Z}if(t.common.async)return Promise.all(n.map(async i=>{let a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(s);{let i,a=[];for(let u of n){let c={...t,common:{...t.common,issues:[]},parent:null},l=u._parseSync({data:t.data,path:t.path,parent:c});if(l.status==="valid")return l;l.status==="dirty"&&!i&&(i={result:l,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;let o=a.map(u=>new at(u));return C(t,{code:A.invalid_union,unionErrors:o}),Z}}get options(){return this._def.options}};ii.create=(r,e)=>new ii({options:r,typeName:v.ZodUnion,...V(e)});var ju=r=>r instanceof oi?ju(r.schema):r instanceof St?ju(r.innerType()):r instanceof ui?[r.value]:r instanceof ci?r.options:r instanceof li?Object.keys(r.enum):r instanceof di?ju(r._def.innerType):r instanceof ni?[void 0]:r instanceof si?[null]:null,dd=class r extends G{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==I.object)return C(t,{code:A.invalid_type,expected:I.object,received:t.parsedType}),Z;let n=this.discriminator,s=t.data[n],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(C(t,{code:A.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),Z)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){let s=new Map;for(let i of t){let a=ju(i.shape[e]);if(!a)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of a){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,i)}}return new r({typeName:v.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...V(n)})}};function fd(r,e){let t=fs(r),n=fs(e);if(r===e)return{valid:!0,data:r};if(t===I.object&&n===I.object){let s=ne.objectKeys(e),i=ne.objectKeys(r).filter(o=>s.indexOf(o)!==-1),a={...r,...e};for(let o of i){let u=fd(r[o],e[o]);if(!u.valid)return{valid:!1};a[o]=u.data}return{valid:!0,data:a}}else if(t===I.array&&n===I.array){if(r.length!==e.length)return{valid:!1};let s=[];for(let i=0;i<r.length;i++){let a=r[i],o=e[i],u=fd(a,o);if(!u.valid)return{valid:!1};s.push(u.data)}return{valid:!0,data:s}}else return t===I.date&&n===I.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var ai=class extends G{_parse(e){let{status:t,ctx:n}=this._processInputParams(e),s=(i,a)=>{if(tm(i)||tm(a))return Z;let o=fd(i.value,a.value);return o.valid?((rm(i)||rm(a))&&t.dirty(),{status:t.value,value:o.data}):(C(n,{code:A.invalid_intersection_types}),Z)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};ai.create=(r,e,t)=>new ai({left:r,right:e,typeName:v.ZodIntersection,...V(t)});var yr=class r extends G{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==I.array)return C(n,{code:A.invalid_type,expected:I.array,received:n.parsedType}),Z;if(n.data.length<this._def.items.length)return C(n,{code:A.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Z;!this._def.rest&&n.data.length>this._def.items.length&&(C(n,{code:A.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...n.data].map((a,o)=>{let u=this._def.items[o]||this._def.rest;return u?u._parse(new ot(n,a,n.path,o)):null}).filter(a=>!!a);return n.common.async?Promise.all(i).then(a=>ze.mergeArray(t,a)):ze.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new r({...this._def,rest:e})}};yr.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new yr({items:r,typeName:v.ZodTuple,rest:null,...V(e)})};var hd=class r extends G{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==I.object)return C(n,{code:A.invalid_type,expected:I.object,received:n.parsedType}),Z;let s=[],i=this._def.keyType,a=this._def.valueType;for(let o in n.data)s.push({key:i._parse(new ot(n,o,n.path,o)),value:a._parse(new ot(n,n.data[o],n.path,o))});return n.common.async?ze.mergeObjectAsync(t,s):ze.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof G?new r({keyType:e,valueType:t,typeName:v.ZodRecord,...V(n)}):new r({keyType:ri.create(),valueType:e,typeName:v.ZodRecord,...V(t)})}},Oa=class extends G{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==I.map)return C(n,{code:A.invalid_type,expected:I.map,received:n.parsedType}),Z;let s=this._def.keyType,i=this._def.valueType,a=[...n.data.entries()].map(([o,u],c)=>({key:s._parse(new ot(n,o,n.path,[c,"key"])),value:i._parse(new ot(n,u,n.path,[c,"value"]))}));if(n.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let u of a){let c=await u.key,l=await u.value;if(c.status==="aborted"||l.status==="aborted")return Z;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}})}else{let o=new Map;for(let u of a){let c=u.key,l=u.value;if(c.status==="aborted"||l.status==="aborted")return Z;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}}}};Oa.create=(r,e,t)=>new Oa({valueType:e,keyType:r,typeName:v.ZodMap,...V(t)});var Ea=class r extends G{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==I.set)return C(n,{code:A.invalid_type,expected:I.set,received:n.parsedType}),Z;let s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(C(n,{code:A.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(C(n,{code:A.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());let i=this._def.valueType;function a(u){let c=new Set;for(let l of u){if(l.status==="aborted")return Z;l.status==="dirty"&&t.dirty(),c.add(l.value)}return{status:t.value,value:c}}let o=[...n.data.values()].map((u,c)=>i._parse(new ot(n,u,n.path,c)));return n.common.async?Promise.all(o).then(u=>a(u)):a(o)}min(e,t){return new r({...this._def,minSize:{value:e,message:$.toString(t)}})}max(e,t){return new r({...this._def,maxSize:{value:e,message:$.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Ea.create=(r,e)=>new Ea({valueType:r,minSize:null,maxSize:null,typeName:v.ZodSet,...V(e)});var pd=class r extends G{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==I.function)return C(t,{code:A.invalid_type,expected:I.function,received:t.parsedType}),Z;function n(o,u){return cd({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,ud(),$u].filter(c=>!!c),issueData:{code:A.invalid_arguments,argumentsError:u}})}function s(o,u){return cd({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,ud(),$u].filter(c=>!!c),issueData:{code:A.invalid_return_type,returnTypeError:u}})}let i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof hs){let o=this;return Ge(async function(...u){let c=new at([]),l=await o._def.args.parseAsync(u,i).catch(h=>{throw c.addIssue(n(u,h)),c}),d=await Reflect.apply(a,this,l);return await o._def.returns._def.type.parseAsync(d,i).catch(h=>{throw c.addIssue(s(d,h)),c})})}else{let o=this;return Ge(function(...u){let c=o._def.args.safeParse(u,i);if(!c.success)throw new at([n(u,c.error)]);let l=Reflect.apply(a,this,c.data),d=o._def.returns.safeParse(l,i);if(!d.success)throw new at([s(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r({...this._def,args:yr.create(e).rest(Qr.create())})}returns(e){return new r({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new r({args:e||yr.create([]).rest(Qr.create()),returns:t||Qr.create(),typeName:v.ZodFunction,...V(n)})}},oi=class extends G{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};oi.create=(r,e)=>new oi({getter:r,typeName:v.ZodLazy,...V(e)});var ui=class extends G{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return C(t,{received:t.data,code:A.invalid_literal,expected:this._def.value}),Z}return{status:"valid",value:e.data}}get value(){return this._def.value}};ui.create=(r,e)=>new ui({value:r,typeName:v.ZodLiteral,...V(e)});function sm(r,e){return new ci({values:r,typeName:v.ZodEnum,...V(e)})}var ci=class r extends G{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),n=this._def.values;return C(t,{expected:ne.joinValues(n),received:t.parsedType,code:A.invalid_type}),Z}if(this._def.values.indexOf(e.data)===-1){let t=this._getOrReturnCtx(e),n=this._def.values;return C(t,{received:t.data,code:A.invalid_enum_value,options:n}),Z}return Ge(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e){return r.create(e)}exclude(e){return r.create(this.options.filter(t=>!e.includes(t)))}};ci.create=sm;var li=class extends G{_parse(e){let t=ne.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==I.string&&n.parsedType!==I.number){let s=ne.objectValues(t);return C(n,{expected:ne.joinValues(s),received:n.parsedType,code:A.invalid_type}),Z}if(t.indexOf(e.data)===-1){let s=ne.objectValues(t);return C(n,{received:n.data,code:A.invalid_enum_value,options:s}),Z}return Ge(e.data)}get enum(){return this._def.values}};li.create=(r,e)=>new li({values:r,typeName:v.ZodNativeEnum,...V(e)});var hs=class extends G{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==I.promise&&t.common.async===!1)return C(t,{code:A.invalid_type,expected:I.promise,received:t.parsedType}),Z;let n=t.parsedType===I.promise?t.data:Promise.resolve(t.data);return Ge(n.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}};hs.create=(r,e)=>new hs({type:r,typeName:v.ZodPromise,...V(e)});var St=class extends G{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===v.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:a=>{C(n,a),a.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){let a=s.transform(n.data,i);return n.common.issues.length?{status:"dirty",value:n.data}:n.common.async?Promise.resolve(a).then(o=>this._def.schema._parseAsync({data:o,path:n.path,parent:n})):this._def.schema._parseSync({data:a,path:n.path,parent:n})}if(s.type==="refinement"){let a=o=>{let u=s.refinement(o,i);if(n.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){let o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?Z:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?Z:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Lu(a))return a;let o=s.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>Lu(a)?Promise.resolve(s.transform(a.value,i)).then(o=>({status:t.value,value:o})):a);ne.assertNever(s)}};St.create=(r,e,t)=>new St({schema:r,typeName:v.ZodEffects,effect:e,...V(t)});St.createWithPreprocess=(r,e,t)=>new St({schema:e,effect:{type:"preprocess",transform:r},typeName:v.ZodEffects,...V(t)});var Zt=class extends G{_parse(e){return this._getType(e)===I.undefined?Ge(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Zt.create=(r,e)=>new Zt({innerType:r,typeName:v.ZodOptional,...V(e)});var tn=class extends G{_parse(e){return this._getType(e)===I.null?Ge(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};tn.create=(r,e)=>new tn({innerType:r,typeName:v.ZodNullable,...V(e)});var di=class extends G{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return t.parsedType===I.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};di.create=(r,e)=>new di({innerType:r,typeName:v.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...V(e)});var Sa=class extends G{_parse(e){let{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return ld(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new at(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new at(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Sa.create=(r,e)=>new Sa({innerType:r,typeName:v.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...V(e)});var Ta=class extends G{_parse(e){if(this._getType(e)!==I.nan){let n=this._getOrReturnCtx(e);return C(n,{code:A.invalid_type,expected:I.nan,received:n.parsedType}),Z}return{status:"valid",value:e.data}}};Ta.create=r=>new Ta({typeName:v.ZodNaN,...V(r)});var wN=Symbol("zod_brand"),md=class extends G{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}},Mu=class r extends G{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?Z:i.status==="dirty"?(t.dirty(),pv(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{let s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?Z:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new r({in:e,out:t,typeName:v.ZodPipeline})}},Pa=class extends G{_parse(e){let t=this._def.innerType._parse(e);return Lu(t)&&(t.value=Object.freeze(t.value)),t}};Pa.create=(r,e)=>new Pa({innerType:r,typeName:v.ZodReadonly,...V(e)});var vN={object:tt.lazycreate},v;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(v||(v={}));var xN=ri.create,AN=ya.create,ON=Ta.create,EN=ba.create,SN=_a.create,TN=wa.create,PN=va.create,IN=ni.create,kN=si.create,CN=xa.create,NN=Qr.create,RN=Ht.create,jN=Aa.create,$N=en.create,LN=tt.create,MN=tt.strictCreate,DN=ii.create,BN=dd.create,FN=ai.create,UN=yr.create,zN=hd.create,KN=Oa.create,qN=Ea.create,VN=pd.create,ZN=oi.create,HN=ui.create,GN=ci.create,JN=li.create,WN=hs.create,YN=St.create,XN=Zt.create,QN=tn.create,e1=St.createWithPreprocess,t1=Mu.create;function im(){return{}}function am(r,e){var n,s;let t={type:"array"};return((s=(n=r.type)==null?void 0:n._def)==null?void 0:s.typeName)!==v.ZodAny&&(t.items=B(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&Q(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&Q(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(Q(t,"minItems",r.exactLength.value,r.exactLength.message,e),Q(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function om(r,e){let t={type:"integer",format:"int64"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?Q(t,"minimum",n.value,n.message,e):Q(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Q(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Q(t,"maximum",n.value,n.message,e):Q(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Q(t,"maximum",n.value,n.message,e));break;case"multipleOf":Q(t,"multipleOf",n.value,n.message,e);break}return t}function um(){return{type:"boolean"}}function cm(r,e){return B(r.type._def,e)}var lm=(r,e)=>B(r.innerType._def,e);function dm(r,e){return e.dateStrategy=="integer"?Sv(r,e):{type:"string",format:"date-time"}}var Sv=(r,e)=>{let t={type:"integer",format:"unix-time"};for(let n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"&&Q(t,"minimum",n.value,n.message,e);break;case"max":e.target==="jsonSchema7"&&Q(t,"maximum",n.value,n.message,e);break}return t};function fm(r,e){return{...B(r.innerType._def,e),default:r.defaultValue()}}function hm(r,e){return e.effectStrategy==="input"?B(r.schema._def,e):{}}function pm(r){return{type:"string",enum:r.values}}var Tv=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function mm(r,e){let t=[B(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),B(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,s=[];return t.forEach(i=>{if(Tv(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(n=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){let{additionalProperties:o,...u}=i;a=u}else n=void 0;s.push(a)}}),s.length?{allOf:s,...n}:void 0}function gm(r,e){let t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}var Ia={cuid:"^[cC][^\\s-]{8,}$",cuid2:"^[a-z][a-z0-9]*$",ulid:"^[0-9A-HJKMNP-TV-Z]{26}$",email:"^(?!\\.)(?!.*\\.\\.)([a-zA-Z0-9_+-\\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\\-]*\\.)+[a-zA-Z]{2,}$",emoji:"^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",uuid:"^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$",ipv4:"^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$",ipv6:"^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$"};function Du(r,e){let t={type:"string"};function n(s){return e.patternStrategy==="escape"?Pv(s):s}if(r.checks)for(let s of r.checks)switch(s.kind){case"min":Q(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e);break;case"max":Q(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":ps(t,"email",s.message,e);break;case"format:idn-email":ps(t,"idn-email",s.message,e);break;case"pattern:zod":br(t,Ia.email,s.message,e);break}break;case"url":ps(t,"uri",s.message,e);break;case"uuid":ps(t,"uuid",s.message,e);break;case"regex":br(t,s.regex.source,s.message,e);break;case"cuid":br(t,Ia.cuid,s.message,e);break;case"cuid2":br(t,Ia.cuid2,s.message,e);break;case"startsWith":br(t,"^"+n(s.value),s.message,e);break;case"endsWith":br(t,n(s.value)+"$",s.message,e);break;case"datetime":ps(t,"date-time",s.message,e);break;case"length":Q(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e),Q(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"includes":{br(t,n(s.value),s.message,e);break}case"ip":{s.version!=="v6"&&ps(t,"ipv4",s.message,e),s.version!=="v4"&&ps(t,"ipv6",s.message,e);break}case"emoji":br(t,Ia.emoji,s.message,e);break;case"ulid":{br(t,Ia.ulid,s.message,e);break}case"toLowerCase":case"toUpperCase":case"trim":break;default:}return t}var Pv=r=>Array.from(r).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),ps=(r,e,t,n)=>{var s;r.format||(s=r.anyOf)!=null&&s.some(i=>i.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):Q(r,"format",e,t,n)},br=(r,e,t,n)=>{var s;r.pattern||(s=r.allOf)!=null&&s.some(i=>i.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:e,...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):Q(r,"pattern",e,t,n)};function Bu(r,e){var n,s,i,a,o;if(e.target==="openApi3"&&((n=r.keyType)==null?void 0:n._def.typeName)===v.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((u,c)=>{var l;return{...u,[c]:(l=B(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",c]}))!=null?l:{}}},{}),additionalProperties:!1};let t={type:"object",additionalProperties:(s=B(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]}))!=null?s:{}};if(e.target==="openApi3")return t;if(((i=r.keyType)==null?void 0:i._def.typeName)===v.ZodString&&((a=r.keyType._def.checks)!=null&&a.length)){let u=Object.entries(Du(r.keyType._def,e)).reduce((c,[l,d])=>l==="type"?c:{...c,[l]:d},{});return{...t,propertyNames:u}}else if(((o=r.keyType)==null?void 0:o._def.typeName)===v.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};return t}function ym(r,e){if(e.mapStrategy==="record")return Bu(r,e);let t=B(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=B(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function bm(r){let e=r.values,n=Object.keys(r.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(n.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function _m(){return{not:{}}}function wm(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var ka={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function xm(r,e){if(e.target==="openApi3")return vm(r,e);let t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in ka&&(!n._def.checks||!n._def.checks.length))){let n=t.reduce((s,i)=>{let a=ka[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=t.reduce((s,i)=>{let a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){let s=n.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(i=>!n.includes(i))],[])};return vm(r,e)}var vm=(r,e)=>{let t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>B(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function Am(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:ka[r.innerType._def.typeName],nullable:!0}:{type:[ka[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=B(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}let t=B(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function Om(r,e){let t={type:"number"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"int":t.type="integer",ad(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?Q(t,"minimum",n.value,n.message,e):Q(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),Q(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?Q(t,"maximum",n.value,n.message,e):Q(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),Q(t,"maximum",n.value,n.message,e));break;case"multipleOf":Q(t,"multipleOf",n.value,n.message,e);break}return t}function Em(r,e){var n;let t={type:"object",...Object.entries(r.shape()).reduce((s,[i,a])=>{if(a===void 0||a._def===void 0)return s;let o=B(a._def,{...e,currentPath:[...e.currentPath,"properties",i],propertyPath:[...e.currentPath,"properties",i]});return o===void 0?s:{properties:{...s.properties,[i]:o},required:a.isOptional()?s.required:[...s.required,i]}},{properties:{},required:[]}),additionalProperties:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":(n=B(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]}))!=null?n:!0};return t.required.length||delete t.required,t}var Sm=(r,e)=>{var n;if(e.currentPath.toString()===((n=e.propertyPath)==null?void 0:n.toString()))return B(r.innerType._def,e);let t=B(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}};var Tm=(r,e)=>{if(e.pipeStrategy==="input")return B(r.in._def,e);if(e.pipeStrategy==="output")return B(r.out._def,e);let t=B(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=B(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function Pm(r,e){return B(r.type._def,e)}function Im(r,e){let n={type:"array",uniqueItems:!0,items:B(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&Q(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&Q(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function km(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>B(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:B(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>B(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function Cm(){return{not:{}}}function Nm(){return{}}var Rm=(r,e)=>B(r.innerType._def,e);function B(r,e,t=!1){let n=e.seen.get(r);if(n&&!t){let a=Iv(n,e);if(a!==void 0)return a}let s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);let i=Cv(r,r.typeName,e);return i&&Nv(r,e,i),s.jsonSchema=i,i}var Iv=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:kv(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((t,n)=>e.currentPath[n]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},kv=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},Cv=(r,e,t)=>{switch(e){case v.ZodString:return Du(r,t);case v.ZodNumber:return Om(r,t);case v.ZodObject:return Em(r,t);case v.ZodBigInt:return om(r,t);case v.ZodBoolean:return um();case v.ZodDate:return dm(r,t);case v.ZodUndefined:return Cm();case v.ZodNull:return wm(t);case v.ZodArray:return am(r,t);case v.ZodUnion:case v.ZodDiscriminatedUnion:return xm(r,t);case v.ZodIntersection:return mm(r,t);case v.ZodTuple:return km(r,t);case v.ZodRecord:return Bu(r,t);case v.ZodLiteral:return gm(r,t);case v.ZodEnum:return pm(r);case v.ZodNativeEnum:return bm(r);case v.ZodNullable:return Am(r,t);case v.ZodOptional:return Sm(r,t);case v.ZodMap:return ym(r,t);case v.ZodSet:return Im(r,t);case v.ZodLazy:return B(r.getter()._def,t);case v.ZodPromise:return Pm(r,t);case v.ZodNaN:case v.ZodNever:return _m();case v.ZodEffects:return hm(r,t);case v.ZodAny:return im();case v.ZodUnknown:return Nm();case v.ZodDefault:return fm(r,t);case v.ZodBranded:return cm(r,t);case v.ZodReadonly:return Rm(r,t);case v.ZodCatch:return lm(r,t);case v.ZodPipeline:return Tm(r,t);case v.ZodFunction:case v.ZodVoid:case v.ZodSymbol:return;default:return(n=>{})(e)}},Nv=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t);var jm=r=>{let e=Qp(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};var Fu=(r,e)=>{var o;let t=jm(e),n=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((u,[c,l])=>{var d;return{...u,[c]:(d=B(l._def,{...t,currentPath:[...t.basePath,t.definitionPath,c]},!0))!=null?d:{}}},{}):void 0,s=typeof e=="string"?e:e==null?void 0:e.name,i=(o=B(r._def,s===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,s]},!1))!=null?o:{},a=s===void 0?n?{...i,[t.definitionPath]:n}:i:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...n,[s]:i}};return t.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),a};function Ca(r){let{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:n,azureOpenAIBasePath:s,baseURL:i}=r;if(n&&s&&e)return`${s}/${e}`;if(n){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return i}function Na(r){let e;return r.constructor.name===Zp.name?(e=new Error(r.message),e.name="TimeoutError"):r.constructor.name===Hp.name?(e=new Error(r.message),e.name="AbortError"):e=r,e}function Rv(r){return r.anyOf!==void 0&&Array.isArray(r.anyOf)}function $m(r){var t;let e=["namespace functions {",""];for(let n of r)n.description&&e.push(`// ${n.description}`),Object.keys((t=n.parameters.properties)!=null?t:{}).length>0?(e.push(`type ${n.name} = (_: {`),e.push(Lm(n.parameters,0)),e.push("}) => any;")):e.push(`type ${n.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function Lm(r,e){var n,s;let t=[];for(let[i,a]of Object.entries((n=r.properties)!=null?n:{}))a.description&&e<2&&t.push(`// ${a.description}`),(s=r.required)!=null&&s.includes(i)?t.push(`${i}: ${Uu(a,e)},`):t.push(`${i}?: ${Uu(a,e)},`);return t.map(i=>" ".repeat(e)+i).join(`
`)}function Uu(r,e){if(Rv(r))return r.anyOf.map(t=>Uu(t,e)).join(" | ");switch(r.type){case"string":return r.enum?r.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",Lm(r,e+2),"}"].join(`
`);case"array":return r.items?`${Uu(r.items,e)}[]`:"any[]";default:return""}}function jv(r){return r.role!=="system"&&r.role!=="assistant"&&r.role!=="user"&&r.role!=="function"&&r.role!=="tool"&&console.warn(`Unknown message role: ${r.role}`),r.role}function Bm(r){let e=r._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Tr.isInstance(r))throw new Error("Invalid generic chat message");return jv(r)}default:throw new Error(`Unknown message type: ${e}`)}}function $v(r){var e;switch(r.role){case"assistant":return new ke(r.content||"",{function_call:r.function_call,tool_calls:r.tool_calls});default:return new Tr(r.content||"",(e=r.role)!=null?e:"unknown")}}function Lv(r,e){var i,a;let t=(i=r.role)!=null?i:e,n=(a=r.content)!=null?a:"",s;return r.function_call?s={function_call:r.function_call}:r.tool_calls?s={tool_calls:r.tool_calls}:s={},t==="user"?new Si({content:n}):t==="assistant"?new Qt({content:n,additional_kwargs:s}):t==="system"?new Ti({content:n}):t==="function"?new Pi({content:n,additional_kwargs:s,name:r.name}):t==="tool"?new io({content:n,additional_kwargs:s,tool_call_id:r.tool_call_id}):new Ii({content:n,role:t})}function Mm(r){return r.map(e=>({role:Bm(e),content:e.content,name:e.name,function_call:e.additional_kwargs.function_call,tool_calls:e.additional_kwargs.tool_calls,tool_call_id:e.tool_call_id}))}var Ra=class extends Ls{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){var n,s,i,a,o,u,c,l,d,f,h,m,p,g,y,b,O,E,T,_,F,S,L,te,ie,rt,Ee;if(super(e!=null?e:{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(n=e==null?void 0:e.openAIApiKey)!=null?n:ae("OPENAI_API_KEY"),this.azureOpenAIApiKey=(s=e==null?void 0:e.azureOpenAIApiKey)!=null?s:ae("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=(i=e==null?void 0:e.azureOpenAIApiInstanceName)!=null?i:ae("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=(a=e==null?void 0:e.azureOpenAIApiDeploymentName)!=null?a:ae("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=(o=e==null?void 0:e.azureOpenAIApiVersion)!=null?o:ae("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=(u=e==null?void 0:e.azureOpenAIBasePath)!=null?u:ae("AZURE_OPENAI_BASE_PATH"),this.organization=(l=(c=e==null?void 0:e.configuration)==null?void 0:c.organization)!=null?l:ae("OPENAI_ORGANIZATION"),this.modelName=(d=e==null?void 0:e.modelName)!=null?d:this.modelName,this.modelKwargs=(f=e==null?void 0:e.modelKwargs)!=null?f:{},this.timeout=e==null?void 0:e.timeout,this.temperature=(h=e==null?void 0:e.temperature)!=null?h:this.temperature,this.topP=(m=e==null?void 0:e.topP)!=null?m:this.topP,this.frequencyPenalty=(p=e==null?void 0:e.frequencyPenalty)!=null?p:this.frequencyPenalty,this.presencePenalty=(g=e==null?void 0:e.presencePenalty)!=null?g:this.presencePenalty,this.maxTokens=e==null?void 0:e.maxTokens,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(y=e==null?void 0:e.n)!=null?y:this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=e==null?void 0:e.stop,this.user=e==null?void 0:e.user,this.streaming=(b=e==null?void 0:e.streaming)!=null?b:!1,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.openAIApiKey=(O=this.openAIApiKey)!=null?O:""}this.clientConfig={apiKey:this.openAIApiKey,organization:this.organization,baseURL:(T=t==null?void 0:t.basePath)!=null?T:(E=e==null?void 0:e.configuration)==null?void 0:E.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:(L=(_=t==null?void 0:t.baseOptions)==null?void 0:_.headers)!=null?L:(S=(F=e==null?void 0:e.configuration)==null?void 0:F.baseOptions)==null?void 0:S.headers,defaultQuery:(Ee=(te=t==null?void 0:t.baseOptions)==null?void 0:te.params)!=null?Ee:(rt=(ie=e==null?void 0:e.configuration)==null?void 0:ie.baseOptions)==null?void 0:rt.params,...t,...e==null?void 0:e.configuration}}invocationParams(e){var s;function t(i){return i!==void 0&&i.every(a=>Array.isArray(a.lc_namespace))}return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(s=e==null?void 0:e.stop)!=null?s:this.stop,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:t(e==null?void 0:e.tools)?e==null?void 0:e.tools.map(sd):e==null?void 0:e.tools,tool_choice:e==null?void 0:e.tool_choice,response_format:e==null?void 0:e.response_format,seed:e==null?void 0:e.seed,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,n){var u,c,l,d,f;let s=Mm(e),i={...this.invocationParams(t),messages:s,stream:!0},a,o=await this.completionWithRetry(i,t);for await(let h of o){let m=h==null?void 0:h.choices[0];if(!m)continue;let{delta:p}=m;if(!p)continue;let g=Lv(p,a);a=(u=p.role)!=null?u:a;let y={prompt:(c=t.promptIndex)!=null?c:0,completion:(l=m.index)!=null?l:0};if(typeof g.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}let b={...y};m.finish_reason!==void 0&&(b.finish_reason=m.finish_reason),this.logprobs&&(b.logprobs=m.logprobs);let O=new er({message:g,text:g.content,generationInfo:b});yield O,n==null||n.handleLLMNewToken((d=O.text)!=null?d:"",y,void 0,void 0,void 0,{chunk:O})}if((f=t.signal)!=null&&f.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,n){var o,u,c,l,d,f,h,m,p,g;let s={},i=this.invocationParams(t),a=Mm(e);if(i.stream){let y=this._streamResponseChunks(e,t,n),b={};for await(let S of y){S.message.response_metadata={...S.generationInfo,...S.message.response_metadata};let L=(u=(o=S.generationInfo)==null?void 0:o.completion)!=null?u:0;b[L]===void 0?b[L]=S:b[L]=b[L].concat(S)}let O=Object.entries(b).sort(([S],[L])=>parseInt(S,10)-parseInt(L,10)).map(([S,L])=>L),{functions:E,function_call:T}=this.invocationParams(t),_=await this.getEstimatedTokenCountFromPrompt(e,E,T),F=await this.getNumTokensFromGenerations(O);return s.promptTokens=_,s.completionTokens=F,s.totalTokens=_+F,{generations:O,llmOutput:{estimatedTokenUsage:s}}}else{let y=await this.completionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}),{completion_tokens:b,prompt_tokens:O,total_tokens:E}=(c=y==null?void 0:y.usage)!=null?c:{};b&&(s.completionTokens=((l=s.completionTokens)!=null?l:0)+b),O&&(s.promptTokens=((d=s.promptTokens)!=null?d:0)+O),E&&(s.totalTokens=((f=s.totalTokens)!=null?f:0)+E);let T=[];for(let _ of(h=y==null?void 0:y.choices)!=null?h:[]){let S={text:(p=(m=_.message)==null?void 0:m.content)!=null?p:"",message:$v((g=_.message)!=null?g:{role:"assistant"})};S.generationInfo={..._.finish_reason?{finish_reason:_.finish_reason}:{},..._.logprobs?{logprobs:_.logprobs}:{}},T.push(S)}return{generations:T,llmOutput:{tokenUsage:s}}}}async getEstimatedTokenCountFromPrompt(e,t,n){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&n!=="auto"){let i=$m(t);s+=await this.getNumTokens(i),s+=9}return t&&e.find(i=>i._getType()==="system")&&(s-=4),n==="none"?s+=1:typeof n=="object"&&(s+=await this.getNumTokens(n.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async n=>{var s;return(s=n.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([n.message])).countPerMessage[0]:await this.getNumTokens(n.message.content)}))).reduce((n,s)=>n+s,0)}async getNumTokensFromMessages(e){let t=0,n=0,s=0;this.modelName==="gpt-3.5-turbo-0301"?(n=4,s=-1):(n=3,s=1);let i=await Promise.all(e.map(async a=>{var f,h,m,p,g,y;let o=await this.getNumTokens(a.content),u=await this.getNumTokens(Bm(a)),c=a.name!==void 0?s+await this.getNumTokens(a.name):0,l=o+n+u+c,d=a;if(d._getType()==="function"&&(l-=2),(f=d.additional_kwargs)!=null&&f.function_call&&(l+=3),(h=d==null?void 0:d.additional_kwargs.function_call)!=null&&h.name&&(l+=await this.getNumTokens((m=d.additional_kwargs.function_call)==null?void 0:m.name)),(p=d.additional_kwargs.function_call)!=null&&p.arguments)try{l+=await this.getNumTokens(JSON.stringify(JSON.parse((g=d.additional_kwargs.function_call)==null?void 0:g.arguments)))}catch(b){console.error("Error parsing function arguments",b,JSON.stringify(d.additional_kwargs.function_call)),l+=await this.getNumTokens((y=d.additional_kwargs.function_call)==null?void 0:y.arguments)}return t+=l,l}));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){let n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,n)}catch(s){throw Na(s)}})}_getClientOptions(e){if(!this.client){let n={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},s=Ca(n),i={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new fe(i)}let t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,n)=>{var s,i,a;return n&&n.tokenUsage&&(t.tokenUsage.completionTokens+=(s=n.tokenUsage.completionTokens)!=null?s:0,t.tokenUsage.promptTokens+=(i=n.tokenUsage.promptTokens)!=null?i:0,t.tokenUsage.totalTokens+=(a=n.tokenUsage.totalTokens)!=null?a:0),t},{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){var f;let n,s,i,a;Mv(e)?(n=e.schema,s=e.name,i=e.method,a=e.includeRaw):(n=e,s=t==null?void 0:t.name,i=t==null?void 0:t.method,a=t==null?void 0:t.includeRaw);let o,u;if(i==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),Dm(n)?u=Nu.fromZodSchema(n):u=new Ru;else{let h=s!=null?s:"extract";if(Dm(n)){let m=Fu(n);o=this.bind({tools:[{type:"function",function:{name:h,description:m.description,parameters:m}}],tool_choice:{type:"function",function:{name:h}}}),u=new ga({returnSingle:!0,keyName:h,zodSchema:n})}else{let m;typeof n.name=="string"&&typeof n.parameters=="object"&&n.parameters!=null?(m=n,h=n.name):m={name:h,description:(f=n.description)!=null?f:"",parameters:n},o=this.bind({tools:[{type:"function",function:m}],tool_choice:{type:"function",function:{name:h}}}),u=new ga({returnSingle:!0,keyName:h})}}if(!a)return o.pipe(u);let c=ls.assign({parsed:(h,m)=>u.invoke(h.raw,m)}),l=ls.assign({parsed:()=>null}),d=c.withFallbacks({fallbacks:[l]});return js.from([{raw:o},d])}};function Dm(r){return typeof(r==null?void 0:r.parse)=="function"}function Mv(r){return r!==void 0&&typeof r.schema=="object"}var gd=class extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}},yd=class extends Qi{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e!=null?e:{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1})}async invoke(e,t){return this.call(e,oe(t))}async call(e,t,n){let s;try{s=await this.schema.parseAsync(e)}catch(c){throw new gd("Received tool input did not match expected schema",JSON.stringify(e))}let i=Eh(t),a=await Oe.configure(i.callbacks,this.callbacks,i.tags||n,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),o=await(a==null?void 0:a.handleToolStart(this.toJSON(),typeof s=="string"?s:JSON.stringify(s),void 0,void 0,void 0,void 0,i.runName)),u;try{u=await this._call(s,o,i)}catch(c){throw await(o==null?void 0:o.handleToolError(c)),c}return await(o==null?void 0:o.handleToolEnd(u)),u}},zu=class extends yd{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:ir.object({input:ir.string().optional()}).transform(t=>t.input)})}call(e,t){return super.call(typeof e=="string"||!e?{input:e}:e,t)}};var bd=class extends zu{static lc_name(){return"DallEAPIWrapper"}constructor(e){var i,a,o,u,c,l,d,f;super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A wrapper around OpenAI DALL-E API. Useful for when you need to generate images from a text description. Input should be an image description."}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"dall-e-3"}),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:"vivid"}),Object.defineProperty(this,"quality",{enumerable:!0,configurable:!0,writable:!0,value:"standard"}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:"1024x1024"}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"url"}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=(i=e==null?void 0:e.openAIApiKey)!=null?i:ae("OPENAI_API_KEY"),n=(a=e==null?void 0:e.organization)!=null?a:ae("OPENAI_ORGANIZATION"),s={apiKey:t,organization:n,dangerouslyAllowBrowser:!0};this.client=new fe(s),this.modelName=(o=e==null?void 0:e.modelName)!=null?o:this.modelName,this.style=(u=e==null?void 0:e.style)!=null?u:this.style,this.quality=(c=e==null?void 0:e.quality)!=null?c:this.quality,this.n=(l=e==null?void 0:e.n)!=null?l:this.n,this.size=(d=e==null?void 0:e.size)!=null?d:this.size,this.responseFormat=(f=e==null?void 0:e.responseFormat)!=null?f:this.responseFormat,this.user=e==null?void 0:e.user}async _call(e){let t=await this.client.images.generate({model:this.modelName,prompt:e,n:this.n,size:this.size,response_format:this.responseFormat,style:this.style,quality:this.quality,user:this.user}),n="";return this.responseFormat==="url"?[n]=t.data.map(s=>s.url).filter(s=>s!=="undefined"):[n]=t.data.map(s=>s.b64_json).filter(s=>s!=="undefined"),n}};Object.defineProperty(bd,"toolName",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"});var ms={},Fm=r=>{ms[r]&&delete ms[r]},rn=r=>{switch(!0){case r.modelName.contains("gpt"):ms[r.modelId]||(ms[r.modelId]=new Ra({openAIApiKey:r.apiKey,modelName:r.modelName,maxRetries:2,timeout:5e3,cache:!0,topP:r.topP,presencePenalty:r.topK,temperature:r.temperature}));break;case r.modelName.contains("gemini"):ms[r.modelId]||(ms[r.modelId]=new ru({apiKey:r.apiKey,modelName:r.modelName,topK:r.topK,topP:r.topP,temperature:r.temperature,maxRetries:2,cache:!0,safetySettings:[{category:pn.HARM_CATEGORY_DANGEROUS_CONTENT,threshold:mn.BLOCK_NONE},{category:pn.HARM_CATEGORY_HARASSMENT,threshold:mn.BLOCK_NONE},{category:pn.HARM_CATEGORY_HATE_SPEECH,threshold:mn.BLOCK_NONE},{category:pn.HARM_CATEGORY_SEXUALLY_EXPLICIT,threshold:mn.BLOCK_NONE}]}));break}return ms[r.modelId]};var Ku=r=>{let e=[],t;for(let n of r)t&&t._getType()===n._getType()?t.content+=`
"""
`+n.content:(e.push(n),t=n);return e};var Vu="ai-assistant-view",qu=class extends ut.ItemView{constructor(e,t){super(e),this.plugin=t,this.resetConversation()}resetConversation(){this.messageListEl&&this.messageListEl.empty(),this.conversation=[new Se(this.plugin.settings.systemPrompt),new ke("How can I help you?")]}async onload(){this.renderView()}renderHeader(e){let t=e.createDiv(ue.header);t.createEl("h2",{text:"Use AI",cls:ue.title});let n=t.createDiv({cls:ue.actions}),s=t.createEl("button",{cls:"clickable-icon"});(0,ut.setIcon)(s,"lucide-plus"),n.appendChild(s),this.registerDomEvent(s,"click",()=>{this.resetConversation(),this.renderMessageList(this.contentEl)});let i=t.createEl("button",{cls:"clickable-icon"});(0,ut.setIcon)(i,"lucide-settings"),n.appendChild(i),t.appendChild(n)}renderSystemMessage(e,t){e.createDiv({cls:[ue.messageItem,ue.systemMessage]}).createDiv({cls:ue.messageText,text:t.content})}renderHumanMessage(e,t){let n=e.createDiv({cls:[ue.messageItem,ue.humanMessage]});(0,ut.setIcon)(n.createDiv({cls:ue.avatar}),"lucide-user"),n.createDiv({cls:ue.messageText,text:t.content})}renderAiMessage(e,t){let n=e.createDiv({cls:[ue.messageItem,ue.aiMessage]});(0,ut.setIcon)(n.createDiv({cls:ue.avatar}),"lucide-sparkles");let s=n.createDiv({cls:ue.messageText,text:t.content});return{messageEl:n,messageTextEl:s}}renderMessageItem(e,t){switch(t._getType()){case"human":this.renderHumanMessage(e,t);break;case"ai":this.renderAiMessage(e,t);break;case"system":this.renderSystemMessage(e,t);break}this.contentEl.scrollTop=this.contentEl.scrollHeight}renderMessageList(e){this.messageListEl||(this.messageListEl=e.createDiv({cls:ue.messageList})),this.conversation.forEach(t=>{this.renderMessageItem(this.messageListEl,t)})}async generateAiMessage(){if(this.plugin.settings.models.length===0){new ut.Notice("No models found");return}let e=this.plugin.settings.models[0],t=rn(e),n=Ku(this.conversation),{messageTextEl:s}=this.renderAiMessage(this.messageListEl,new ke("Loading..."));try{let i=await t.stream(n,{}),a="";for await(let o of i)a+=o.content,s.innerHTML=a,this.contentEl.scrollTop=this.contentEl.scrollHeight;this.conversation.push(new ke(a))}catch(i){s.innerHTML="Error"}}async addHumanMessage(e){e=await this.resolveMessageVariables(e);let t=new Se(e);this.conversation.push(t),this.renderMessageItem(this.messageListEl,t)}async resolveMessageVariables(e){var t;if(e.includes("[[page]]")){let n=(t=this.app.workspace.getActiveFile())==null?void 0:t.path;if(!n)return e;let s=this.app.vault.getFileByPath(n);if(!s)return e;let i=n?await this.app.vault.read(s):"";i&&(e=e.replace("[[page]]",i))}if(e.includes("[[selection]]")){let n=this.app.workspace.getActiveViewOfType(ut.MarkdownView);if(!n)return e;let s=n.editor.getSelection();s&&(e=e.replace("[[selection]]",s))}return e}renderUserInputs(e){let t=e.createDiv({cls:ue.inputContainer}),n=t.createEl("div",{cls:ue.textInput});n.setAttribute("contenteditable","true"),n.setAttribute("placeholder","Type a message..."),this.registerDomEvent(n,"keydown",async u=>{let c=u.shiftKey;if(u.key==="Enter"&&!u.shiftKey&&n.innerText.trim().length>0){u.preventDefault(),n.removeAttribute("contenteditable");let l=n.innerText.trim();n.innerHTML="loading...",await this.addHumanMessage(l),await this.generateAiMessage(),n.setAttribute("contenteditable","true"),n.innerHTML=""}}),this.registerDomEvent(n,"focus",()=>{t.addClass(ue.focus)}),this.registerDomEvent(n,"blur",()=>{t.removeClass(ue.focus)});let s=t.createDiv({cls:ue.controls}),a=s.createDiv({cls:ue.attachments}).createEl("button",{cls:[ue.attachButton,"clickable-icon","side-dock-ribbon-action"]});a.innerText="[[page]]",this.registerDomEvent(a,"click",()=>{n.innerHTML+="[[page]]"});let o=s.createEl("button",{cls:[ue.sendButton,"clickable-icon","side-dock-ribbon-action"]});(0,ut.setIcon)(o,"lucide-send"),this.registerDomEvent(o,"click",async()=>{let u=n.innerText.trim();u&&(await this.addHumanMessage(u),await this.generateAiMessage(),n.innerHTML="")})}renderView(){this.contentEl.empty(),this.contentEl.addClass(ue.container),this.renderHeader(this.contentEl),this.renderMessageList(this.contentEl),this.renderUserInputs(this.contentEl)}onunload(){super.onunload()}onPaneMenu(e,t){super.onPaneMenu(e,t),e.addItem(n=>{n.setTitle("Help..."),n.setIcon("globe"),n.onClick(()=>{open("https://twitter.com/duocdev")})})}getViewType(){return Vu}getDisplayText(){return"AI Assistant"}getIcon(){return"lucide-sparkles"}};var Um=require("obsidian"),fi=r=>{let e=r.workspace.getActiveViewOfType(Um.ItemView);return(e==null?void 0:e.getViewType())==="canvas"?e.canvas:null};function Zu(r,e){let t=Object.keys(e).map(n=>Dv(r,n,e[n]));return t.length===1?t[0]:function(){t.forEach(n=>n())}}function Dv(r,e,t){let n=r[e],s=r.hasOwnProperty(e),i=s?n:function(){return Object.getPrototypeOf(r)[e].apply(this,arguments)},a=t(i);return n&&Object.setPrototypeOf(a,n),Object.setPrototypeOf(o,a),r[e]=o,u;function o(...c){return a===i&&r[e]===o&&u(),a.apply(this,c)}function u(){r[e]===o&&(s?r[e]=i:delete r[e]),a!==i&&(a=i,Object.setPrototypeOf(o,n||Function))}}var zm={label:"_label_nz18q_1"};var _d=!1,wd=!1,vd=!1,Bv=(r,e)=>e.menu?(r.register(Zu(e.menu.constructor.prototype,{render:t=>function(...n){let s=t.call(this,...n);if(this.menuEl.children.length===0||this.canvas.selection.size!==1)return s;let i=this.canvas.selection.values().next().value;return Object.prototype.hasOwnProperty.call(i,"path")||Object.prototype.hasOwnProperty.call(i,"bgPath")||r.events.trigger("canvas:node-menu",this,this.canvas,i),s}})),!0):!1,Fv=(r,e)=>{let t=Object.getPrototypeOf(e);return r.register(Zu(t,{addEdge:n=>function(...s){var i,a;return s[0].color=(a=(i=s[0].from)==null?void 0:i.node)==null?void 0:a.color,n.call(this,...s)},showCreationMenu:n=>function(...s){let i=s[0],a=s[1];return r.events.trigger("canvas:creation-menu",i,e,a),n.call(this,...s)}})),!0},Uv=(r,e)=>{let t=e.nodes;if(t.size===0)return!1;let n=Object.getPrototypeOf(t.values().next().value);return r.register(Zu(n,{render:s=>function(...i){var c,l,d;let a=this;if(this.nodeEl.getAttribute("data-patched")!==null)return s.call(this,...i);this.nodeEl.setAttribute("data-patched","true");let o=(d=(c=a.getData())==null?void 0:c.model)!=null?d:(l=a.getData())==null?void 0:l.role;if(!o)return s.call(this,...i);let u=document.createElement("div");return u.textContent=o,u.classList.add(zm.label),this.nodeEl.appendChild(u),s.call(this,...i)},showMenu:s=>function(...i){let a=i[0],o=this;return a.addSeparator(),a.addItem(u=>{u.setTitle("Split list to notes"),u.setIcon("lucide-list"),u.onClick(()=>{r.events.trigger("canvas:split-node",e,o)})}),s.call(this,...i)}})),!0},xd=r=>{console.log("patching all");let e=fi(r.app);return e?(wd||(wd=Bv(r,e)),_d||(_d=Fv(r,e)),vd||(vd=Uv(r,e)),vd&&_d&&wd):!1};var Vm=require("obsidian");var ja=r=>{let e=[];for(let t=0;t<r;t++)e.push((16*Math.random()|0).toString(16));return e.join("")};var Km=async(r,e,t,n,s)=>{if(!r)return;let i=r.getData();i&&(r.importData({edges:[...i.edges,{...s,id:e,fromNode:t.node.id,fromSide:t.side,toNode:n.node.id,toSide:n.side}],nodes:i.nodes}),await r.requestFrame())};var qm=async(r,e)=>{if(!r)return;let t=r.getData();t&&(r.importData({edges:[...t.edges,...e],nodes:t.nodes}),await r.requestFrame())};var Hu=50,hi=80;function qv(r,e,t,n){var l,d,f,h,m,p;let s=e.x+e.width+hi,i=e.y+e.height+hi,a=r.getEdgesForNode(e).filter(g=>g.from.node.id==e.id&&g.from.side==t).map(g=>g.to.node),o=a.reduce((g,y)=>{switch(t){case"left":case"right":return y.y>g.y?y:g;case"top":case"bottom":return y.x>g.x?y:g}},a[0]),u=(d=(l=n==null?void 0:n.size)==null?void 0:l.width)!=null?d:500,c=(h=(f=n==null?void 0:n.size)==null?void 0:f.height)!=null?h:250;switch(t){case"left":s=o?o.x+o.width-u:e.x-u-hi,i=o?o.y+o.height+Hu:e.y+e.height/2-c/2;break;case"right":s=(m=o==null?void 0:o.x)!=null?m:e.x+e.width+hi,i=o?o.y+o.height+Hu:e.y+e.height/2-c/2;break;case"top":s=o?o.x+o.width+Hu:e.x+e.width/2-u/2,i=o?o.y+o.height-c:e.y-c-hi;break;case"bottom":s=o?o.x+o.width+Hu:e.x+e.width/2-u/2,i=(p=o==null?void 0:o.y)!=null?p:e.y+e.height+hi;break}return{x:s,y:i,width:u,height:c}}var pi=async(r,e,t,n,s)=>{var h,m,p,g;let i=r.getEdgesForNode(e).filter(y=>y.to.node.id===e.id),a="bottom",o="top";if(i.length>0){let y=i[0];y.to.side==="left"?(a="right",o="left"):y.to.side==="right"?(a="left",o="right"):y.to.side==="top"?(a="bottom",o="top"):y.to.side==="bottom"&&(a="top",o="bottom")}let{x:u,y:c,width:l,height:d}=qv(r,e,a,t),f=r.createTextNode({pos:{x:u,y:c},size:{height:(m=(h=t==null?void 0:t.size)==null?void 0:h.height)!=null?m:d,width:(g=(p=t==null?void 0:t.size)==null?void 0:p.width)!=null?g:l},text:t==null?void 0:t.text,focus:!1});return n&&f.setData(n),r.deselectAll(),r.addNode(f),await Km(r,ja(16),{side:a,node:e},{side:o,node:f},s),f};var Zm=async(r,e)=>{let t=fi(r);if(!t){new Vm.Notice("No active canvas");return}let s=t.selection.values().next().value;t.deselectAll();let i=await pi(t,s,{size:{height:50,width:250}},{role:"user"});e&&await i.setText(e),await t.requestSave(),await t.requestFrame(),setTimeout(()=>{i.startEditing()},100)};var Wu=require("obsidian");function Vv(r){let t=r.canvas.getEdgesForNode(r).filter(n=>n.to.node.id===r.id).map(n=>n.from.node);return t.sort((n,s)=>s.x-n.x),t}async function Hm(r,e,t=Vv){let n=new Set,s=[{node:r,depth:0}];for(;s.length>0;){let{node:i,depth:a}=s.shift();if(n.has(i.id))continue;if(!await e(i,a))break;n.add(i.id);let u=t(i);for(let c of u)n.has(c.id)||s.push({node:c,depth:a+1})}}var qL=ht(require("electron")),Gu=require("obsidian");async function Zv(r,e,t){var s;let n=await r.vault.read(e);if(t){let i=r.metadataCache.getFileCache(e);if(i){let a=(0,Gu.resolveSubpath)(i,t);if(!a)return console.warn("Failed to get subpath",{file:e,subpath:t}),n;if(a.start||a.end){let o=n.slice(a.start.offset,(s=a.end)==null?void 0:s.offset);return o||(console.warn("Failed to get subpath",{file:e,subpath:t}),n)}}}return n}async function Hv(r){return await r.executeJavaScript("document.body.innerText")}var Gv="https://get-youtube-transcript.fly.dev/transcripts/:id/?format=plain&chunk-size=3000&include-time=true";async function Jv(r){var i;let e=(i=r.match(/(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([^&]+)/))==null?void 0:i[1];if(!e)throw new Error("Failed to get youtube id");let t=Gv.replace(":id",e),n=await fetch(t);if(!n.ok)throw new Error("Failed to get youtube transcript");return(await n.json()).join(" ")}async function Ju(r){let e=r.app,t=r.getData();switch(t.type){case"text":return t.text;case"file":{let n=e.vault.getAbstractFileByPath(t.file);if(n instanceof Gu.TFile){let s=await e.vault.read(n);return r.subpath?await Zv(e,n,t.subpath):`## ${n.basename}
${s}`}throw new Error("Failed to get file content")}case"link":{let n;if(t.url.includes("youtube.com"))n=await Jv(t.url);else{let i=r.nodeEl.querySelector("webview");i&&(n=await Hv(i))}return n!=null?n:t.url}}}var Gm=async r=>{let e=[];return await Hm(r,async(n,s)=>{let i=n.getData(),a=await Ju(n);return a===void 0||a.length===0||a.startsWith("function")||(i.role==="ai"?e.push(new ke(a)):i.role==="system"?e.push(new dn(a)):e.push(new Se(a))),!0}),e.reverse()};var Wv=(r,e,t)=>{if(e.modelName.contains("gpt"))return r.unshift(new dn(t));if(e.modelName.contains("gemini"))return r.unshift(new Se(t))},Yv=async(r,e,t)=>{let n=t.getData();return Object.prototype.hasOwnProperty.call(n,"role")&&n.role==="ai"?t:t.text===""?(t.setData({...t.getData(),role:"ai"}),t):pi(r,t,{},{role:"ai"},{})},Xv=async(r,e,t,n)=>{let s=await Gm(t);Wv(s,e,r);let i=t.getData().role==="ai"&&s[s.length-1].content===t.text;return s[s.length-1]._getType()==="ai"&&e.modelName.contains("gemini")&&(s[s.length-1]=new Se(s[s.length-1]),i=!1),Ku(i?s.slice(0,-1):s)},Qv=async(r,e,t,n)=>{let s=rn(r);if(!s){new Wu.Notice("Model not found");return}try{let i=await s.stream(e,{}),a="";for await(let o of i)a+=o.content,await t.setText(a);t.setData({...t.getData(),status:"generated"})}catch(i){await t.setText("Error: "+i.message)}},e0="#2d9bd2",Jm=async(r,e,t,n)=>{var a;let s=await Yv(t,e,n);await s.setText("Generating..."),s.setData({...s.getData(),status:"generating",model:e.modelName}),s.color=(a=e.color)!=null?a:e0;let i=[];try{i=await Xv(r,e,n,t)}catch(o){new Wu.Notice("Failed to prepare conversation"),await s.setText("Error: "+o.message);return}try{await Qv(e,i,s,t)}catch(o){new Wu.Notice("Failed to generate content"),await s.setText("Error: "+o.message),s.setData({...s.getData(),status:"error"})}finally{await t.requestSave(),await t.requestFrame()}};var Wm=async(r,e,t="right")=>{let n=r.getLeavesOfType(e);if(n.length>0){r.revealLeaf(n[0]);return}let s=await t0(r,e,t);s&&r.revealLeaf(s)},t0=async(r,e,t="right")=>{let n=null;switch(t){case"left":n=r.getLeftLeaf(!1);break;case"center":n=r.getLeaf(!1);break;case"right":default:n=r.getRightLeaf(!1);break}return await(n==null?void 0:n.setViewState({type:e,active:!0})),n};var Ym=r=>{let e=r.split("-")[0],t=Math.random().toString(36).substring(2,15);return`${e}-${t}`};var Yu=Symbol.for("yaml.alias"),Xu=Symbol.for("yaml.document"),Tt=Symbol.for("yaml.map"),Ad=Symbol.for("yaml.pair"),ct=Symbol.for("yaml.scalar"),_r=Symbol.for("yaml.seq"),Ke=Symbol.for("yaml.node.type"),Pt=r=>!!r&&typeof r=="object"&&r[Ke]===Yu,wr=r=>!!r&&typeof r=="object"&&r[Ke]===Xu,It=r=>!!r&&typeof r=="object"&&r[Ke]===Tt,Y=r=>!!r&&typeof r=="object"&&r[Ke]===Ad,J=r=>!!r&&typeof r=="object"&&r[Ke]===ct,kt=r=>!!r&&typeof r=="object"&&r[Ke]===_r;function se(r){if(r&&typeof r=="object")switch(r[Ke]){case Tt:case _r:return!0}return!1}function ee(r){if(r&&typeof r=="object")switch(r[Ke]){case Yu:case Tt:case ct:case _r:return!0}return!1}var Xm=r=>(J(r)||se(r))&&!!r.anchor;var Je=Symbol("break visit"),Qm=Symbol("skip children"),Gt=Symbol("remove node");function Ct(r,e){let t=eg(e);wr(r)?mi(null,r.contents,t,Object.freeze([r]))===Gt&&(r.contents=null):mi(null,r,t,Object.freeze([]))}Ct.BREAK=Je;Ct.SKIP=Qm;Ct.REMOVE=Gt;function mi(r,e,t,n){let s=tg(r,e,t,n);if(ee(s)||Y(s))return rg(r,n,s),mi(r,s,t,n);if(typeof s!="symbol"){if(se(e)){n=Object.freeze(n.concat(e));for(let i=0;i<e.items.length;++i){let a=mi(i,e.items[i],t,n);if(typeof a=="number")i=a-1;else{if(a===Je)return Je;a===Gt&&(e.items.splice(i,1),i-=1)}}}else if(Y(e)){n=Object.freeze(n.concat(e));let i=mi("key",e.key,t,n);if(i===Je)return Je;i===Gt&&(e.key=null);let a=mi("value",e.value,t,n);if(a===Je)return Je;a===Gt&&(e.value=null)}}return s}async function Qu(r,e){let t=eg(e);wr(r)?await gi(null,r.contents,t,Object.freeze([r]))===Gt&&(r.contents=null):await gi(null,r,t,Object.freeze([]))}Qu.BREAK=Je;Qu.SKIP=Qm;Qu.REMOVE=Gt;async function gi(r,e,t,n){let s=await tg(r,e,t,n);if(ee(s)||Y(s))return rg(r,n,s),gi(r,s,t,n);if(typeof s!="symbol"){if(se(e)){n=Object.freeze(n.concat(e));for(let i=0;i<e.items.length;++i){let a=await gi(i,e.items[i],t,n);if(typeof a=="number")i=a-1;else{if(a===Je)return Je;a===Gt&&(e.items.splice(i,1),i-=1)}}}else if(Y(e)){n=Object.freeze(n.concat(e));let i=await gi("key",e.key,t,n);if(i===Je)return Je;i===Gt&&(e.key=null);let a=await gi("value",e.value,t,n);if(a===Je)return Je;a===Gt&&(e.value=null)}}return s}function eg(r){return typeof r=="object"&&(r.Collection||r.Node||r.Value)?Object.assign({Alias:r.Node,Map:r.Node,Scalar:r.Node,Seq:r.Node},r.Value&&{Map:r.Value,Scalar:r.Value,Seq:r.Value},r.Collection&&{Map:r.Collection,Seq:r.Collection},r):r}function tg(r,e,t,n){var s,i,a,o,u;if(typeof t=="function")return t(r,e,n);if(It(e))return(s=t.Map)==null?void 0:s.call(t,r,e,n);if(kt(e))return(i=t.Seq)==null?void 0:i.call(t,r,e,n);if(Y(e))return(a=t.Pair)==null?void 0:a.call(t,r,e,n);if(J(e))return(o=t.Scalar)==null?void 0:o.call(t,r,e,n);if(Pt(e))return(u=t.Alias)==null?void 0:u.call(t,r,e,n)}function rg(r,e,t){let n=e[e.length-1];if(se(n))n.items[r]=t;else if(Y(n))r==="key"?n.key=t:n.value=t;else if(wr(n))n.contents=t;else{let s=Pt(n)?"alias":"scalar";throw new Error(`Cannot replace node with ${s} parent`)}}var r0={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},n0=r=>r.replace(/[!,[\]{}]/g,e=>r0[e]),Jt=class r{constructor(e,t){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},r.defaultYaml,e),this.tags=Object.assign({},r.defaultTags,t)}clone(){let e=new r(this.yaml,this.tags);return e.docStart=this.docStart,e}atDocument(){let e=new r(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:r.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},r.defaultTags);break}return e}add(e,t){this.atNextDocument&&(this.yaml={explicit:r.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},r.defaultTags),this.atNextDocument=!1);let n=e.trim().split(/[ \t]+/),s=n.shift();switch(s){case"%TAG":{if(n.length!==2&&(t(0,"%TAG directive should contain exactly two parts"),n.length<2))return!1;let[i,a]=n;return this.tags[i]=a,!0}case"%YAML":{if(this.yaml.explicit=!0,n.length!==1)return t(0,"%YAML directive should contain exactly one part"),!1;let[i]=n;if(i==="1.1"||i==="1.2")return this.yaml.version=i,!0;{let a=/^\d+\.\d+$/.test(i);return t(6,`Unsupported YAML version ${i}`,a),!1}}default:return t(0,`Unknown directive ${s}`,!0),!1}}tagName(e,t){if(e==="!")return"!";if(e[0]!=="!")return t(`Not a valid tag: ${e}`),null;if(e[1]==="<"){let a=e.slice(2,-1);return a==="!"||a==="!!"?(t(`Verbatim tags aren't resolved, so ${e} is invalid.`),null):(e[e.length-1]!==">"&&t("Verbatim tags must end with a >"),a)}let[,n,s]=e.match(/^(.*!)([^!]*)$/s);s||t(`The ${e} tag has no suffix`);let i=this.tags[n];if(i)try{return i+decodeURIComponent(s)}catch(a){return t(String(a)),null}return n==="!"?e:(t(`Could not resolve tag: ${e}`),null)}tagString(e){for(let[t,n]of Object.entries(this.tags))if(e.startsWith(n))return t+n0(e.substring(n.length));return e[0]==="!"?e:`!<${e}>`}toString(e){let t=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],n=Object.entries(this.tags),s;if(e&&n.length>0&&ee(e.contents)){let i={};Ct(e.contents,(a,o)=>{ee(o)&&o.tag&&(i[o.tag]=!0)}),s=Object.keys(i)}else s=[];for(let[i,a]of n)i==="!!"&&a==="tag:yaml.org,2002:"||(!e||s.some(o=>o.startsWith(a)))&&t.push(`%TAG ${i} ${a}`);return t.join(`
`)}};Jt.defaultYaml={explicit:!1,version:"1.2"};Jt.defaultTags={"!!":"tag:yaml.org,2002:"};function ec(r){if(/[\x00-\x19\s,[\]{}]/.test(r)){let t=`Anchor must not contain whitespace or control characters: ${JSON.stringify(r)}`;throw new Error(t)}return!0}function Od(r){let e=new Set;return Ct(r,{Value(t,n){n.anchor&&e.add(n.anchor)}}),e}function Ed(r,e){for(let t=1;;++t){let n=`${r}${t}`;if(!e.has(n))return n}}function ng(r,e){let t=[],n=new Map,s=null;return{onAnchor:i=>{t.push(i),s||(s=Od(r));let a=Ed(e,s);return s.add(a),a},setAnchors:()=>{for(let i of t){let a=n.get(i);if(typeof a=="object"&&a.anchor&&(J(a.node)||se(a.node)))a.node.anchor=a.anchor;else{let o=new Error("Failed to resolve repeated object (this should not happen)");throw o.source=i,o}}},sourceObjects:n}}function nn(r,e,t,n){if(n&&typeof n=="object")if(Array.isArray(n))for(let s=0,i=n.length;s<i;++s){let a=n[s],o=nn(r,n,String(s),a);o===void 0?delete n[s]:o!==a&&(n[s]=o)}else if(n instanceof Map)for(let s of Array.from(n.keys())){let i=n.get(s),a=nn(r,n,s,i);a===void 0?n.delete(s):a!==i&&n.set(s,a)}else if(n instanceof Set)for(let s of Array.from(n)){let i=nn(r,n,s,s);i===void 0?n.delete(s):i!==s&&(n.delete(s),n.add(i))}else for(let[s,i]of Object.entries(n)){let a=nn(r,n,s,i);a===void 0?delete n[s]:a!==i&&(n[s]=a)}return r.call(e,t,n)}function we(r,e,t){if(Array.isArray(r))return r.map((n,s)=>we(n,String(s),t));if(r&&typeof r.toJSON=="function"){if(!t||!Xm(r))return r.toJSON(e,t);let n={aliasCount:0,count:1,res:void 0};t.anchors.set(r,n),t.onCreate=i=>{n.res=i,delete t.onCreate};let s=r.toJSON(e,t);return t.onCreate&&t.onCreate(s),s}return typeof r=="bigint"&&!(t!=null&&t.keep)?Number(r):r}var sn=class{constructor(e){Object.defineProperty(this,Ke,{value:e})}clone(){let e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(e.range=this.range.slice()),e}toJS(e,{mapAsMap:t,maxAliasCount:n,onAnchor:s,reviver:i}={}){if(!wr(e))throw new TypeError("A document argument is required");let a={anchors:new Map,doc:e,keep:!0,mapAsMap:t===!0,mapKeyWarned:!1,maxAliasCount:typeof n=="number"?n:100},o=we(this,"",a);if(typeof s=="function")for(let{count:u,res:c}of a.anchors.values())s(c,u);return typeof i=="function"?nn(i,{"":o},"",o):o}};var vr=class extends sn{constructor(e){super(Yu),this.source=e,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(e){let t;return Ct(e,{Node:(n,s)=>{if(s===this)return Ct.BREAK;s.anchor===this.source&&(t=s)}}),t}toJSON(e,t){if(!t)return{source:this.source};let{anchors:n,doc:s,maxAliasCount:i}=t,a=this.resolve(s);if(!a){let u=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(u)}let o=n.get(a);if(o||(we(a,null,t),o=n.get(a)),!o||o.res===void 0){let u="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(u)}if(i>=0&&(o.count+=1,o.aliasCount===0&&(o.aliasCount=tc(s,a,n)),o.count*o.aliasCount>i)){let u="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(u)}return o.res}toString(e,t,n){let s=`*${this.source}`;if(e){if(ec(this.source),e.options.verifyAliasOrder&&!e.anchors.has(this.source)){let i=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(i)}if(e.implicitKey)return`${s} `}return s}};function tc(r,e,t){if(Pt(e)){let n=e.resolve(r),s=t&&n&&t.get(n);return s?s.count*s.aliasCount:0}else if(se(e)){let n=0;for(let s of e.items){let i=tc(r,s,t);i>n&&(n=i)}return n}else if(Y(e)){let n=tc(r,e.key,t),s=tc(r,e.value,t);return Math.max(n,s)}return 1}var rc=r=>!r||typeof r!="function"&&typeof r!="object",N=class extends sn{constructor(e){super(ct),this.value=e}toJSON(e,t){return t!=null&&t.keep?this.value:we(this.value,e,t)}toString(){return String(this.value)}};N.BLOCK_FOLDED="BLOCK_FOLDED";N.BLOCK_LITERAL="BLOCK_LITERAL";N.PLAIN="PLAIN";N.QUOTE_DOUBLE="QUOTE_DOUBLE";N.QUOTE_SINGLE="QUOTE_SINGLE";var s0="tag:yaml.org,2002:";function i0(r,e,t){var n;if(e){let s=t.filter(a=>a.tag===e),i=(n=s.find(a=>!a.format))!=null?n:s[0];if(!i)throw new Error(`Tag ${e} not found`);return i}return t.find(s=>{var i;return((i=s.identify)==null?void 0:i.call(s,r))&&!s.format})}function xr(r,e,t){var d,f,h;if(wr(r)&&(r=r.contents),ee(r))return r;if(Y(r)){let m=(f=(d=t.schema[Tt]).createNode)==null?void 0:f.call(d,t.schema,null,t);return m.items.push(r),m}(r instanceof String||r instanceof Number||r instanceof Boolean||typeof BigInt!="undefined"&&r instanceof BigInt)&&(r=r.valueOf());let{aliasDuplicateObjects:n,onAnchor:s,onTagObj:i,schema:a,sourceObjects:o}=t,u;if(n&&r&&typeof r=="object"){if(u=o.get(r),u)return u.anchor||(u.anchor=s(r)),new vr(u.anchor);u={anchor:null,node:null},o.set(r,u)}e!=null&&e.startsWith("!!")&&(e=s0+e.slice(2));let c=i0(r,e,a.tags);if(!c){if(r&&typeof r.toJSON=="function"&&(r=r.toJSON()),!r||typeof r!="object"){let m=new N(r);return u&&(u.node=m),m}c=r instanceof Map?a[Tt]:Symbol.iterator in Object(r)?a[_r]:a[Tt]}i&&(i(c),delete t.onTagObj);let l=c!=null&&c.createNode?c.createNode(t.schema,r,t):typeof((h=c==null?void 0:c.nodeClass)==null?void 0:h.from)=="function"?c.nodeClass.from(t.schema,r,t):new N(r);return e?l.tag=e:c.default||(l.tag=c.tag),u&&(u.node=l),l}function $a(r,e,t){let n=t;for(let s=e.length-1;s>=0;--s){let i=e[s];if(typeof i=="number"&&Number.isInteger(i)&&i>=0){let a=[];a[i]=n,n=a}else n=new Map([[i,n]])}return xr(n,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:r,sourceObjects:new Map})}var yi=r=>r==null||typeof r=="object"&&!!r[Symbol.iterator]().next().done,gs=class extends sn{constructor(e,t){super(e),Object.defineProperty(this,"schema",{value:t,configurable:!0,enumerable:!1,writable:!0})}clone(e){let t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return e&&(t.schema=e),t.items=t.items.map(n=>ee(n)||Y(n)?n.clone(e):n),this.range&&(t.range=this.range.slice()),t}addIn(e,t){if(yi(e))this.add(t);else{let[n,...s]=e,i=this.get(n,!0);if(se(i))i.addIn(s,t);else if(i===void 0&&this.schema)this.set(n,$a(this.schema,s,t));else throw new Error(`Expected YAML collection at ${n}. Remaining path: ${s}`)}}deleteIn(e){let[t,...n]=e;if(n.length===0)return this.delete(t);let s=this.get(t,!0);if(se(s))return s.deleteIn(n);throw new Error(`Expected YAML collection at ${t}. Remaining path: ${n}`)}getIn(e,t){let[n,...s]=e,i=this.get(n,!0);return s.length===0?!t&&J(i)?i.value:i:se(i)?i.getIn(s,t):void 0}hasAllNullValues(e){return this.items.every(t=>{if(!Y(t))return!1;let n=t.value;return n==null||e&&J(n)&&n.value==null&&!n.commentBefore&&!n.comment&&!n.tag})}hasIn(e){let[t,...n]=e;if(n.length===0)return this.has(t);let s=this.get(t,!0);return se(s)?s.hasIn(n):!1}setIn(e,t){let[n,...s]=e;if(s.length===0)this.set(n,t);else{let i=this.get(n,!0);if(se(i))i.setIn(s,t);else if(i===void 0&&this.schema)this.set(n,$a(this.schema,s,t));else throw new Error(`Expected YAML collection at ${n}. Remaining path: ${s}`)}}};gs.maxFlowStringSingleLineLength=60;var sg=r=>r.replace(/^(?!$)(?: $)?/gm,"#");function lt(r,e){return/^\n+$/.test(r)?r.substring(1):e?r.replace(/^(?! *$)/gm,e):r}var Wt=(r,e,t)=>r.endsWith(`
`)?lt(t,e):t.includes(`
`)?`
`+lt(t,e):(r.endsWith(" ")?"":" ")+t;var Sd="flow",nc="block",La="quoted";function Ma(r,e,t="flow",{indentAtStart:n,lineWidth:s=80,minContentWidth:i=20,onFold:a,onOverflow:o}={}){if(!s||s<0)return r;let u=Math.max(1+i,1+s-e.length);if(r.length<=u)return r;let c=[],l={},d=s-e.length;typeof n=="number"&&(n>s-Math.max(2,i)?c.push(0):d=s-n);let f,h,m=!1,p=-1,g=-1,y=-1;t===nc&&(p=ig(r,p,e.length),p!==-1&&(d=p+u));for(let O;O=r[p+=1];){if(t===La&&O==="\\"){switch(g=p,r[p+1]){case"x":p+=3;break;case"u":p+=5;break;case"U":p+=9;break;default:p+=1}y=p}if(O===`
`)t===nc&&(p=ig(r,p,e.length)),d=p+e.length+u,f=void 0;else{if(O===" "&&h&&h!==" "&&h!==`
`&&h!=="	"){let E=r[p+1];E&&E!==" "&&E!==`
`&&E!=="	"&&(f=p)}if(p>=d)if(f)c.push(f),d=f+u,f=void 0;else if(t===La){for(;h===" "||h==="	";)h=O,O=r[p+=1],m=!0;let E=p>y+1?p-2:g-1;if(l[E])return r;c.push(E),l[E]=!0,d=E+u,f=void 0}else m=!0}h=O}if(m&&o&&o(),c.length===0)return r;a&&a();let b=r.slice(0,c[0]);for(let O=0;O<c.length;++O){let E=c[O],T=c[O+1]||r.length;E===0?b=`
${e}${r.slice(0,T)}`:(t===La&&l[E]&&(b+=`${r[E]}\\`),b+=`
${e}${r.slice(E+1,T)}`)}return b}function ig(r,e,t){let n=e,s=e+1,i=r[s];for(;i===" "||i==="	";)if(e<s+t)i=r[++e];else{do i=r[++e];while(i&&i!==`
`);n=e,s=e+1,i=r[s]}return n}var ic=(r,e)=>({indentAtStart:e?r.indent.length:r.indentAtStart,lineWidth:r.options.lineWidth,minContentWidth:r.options.minContentWidth}),ac=r=>/^(%|---|\.\.\.)/m.test(r);function a0(r,e,t){if(!e||e<0)return!1;let n=e-t,s=r.length;if(s<=n)return!1;for(let i=0,a=0;i<s;++i)if(r[i]===`
`){if(i-a>n)return!0;if(a=i+1,s-a<=n)return!1}return!0}function Da(r,e){let t=JSON.stringify(r);if(e.options.doubleQuotedAsJSON)return t;let{implicitKey:n}=e,s=e.options.doubleQuotedMinMultiLineLength,i=e.indent||(ac(r)?"  ":""),a="",o=0;for(let u=0,c=t[u];c;c=t[++u])if(c===" "&&t[u+1]==="\\"&&t[u+2]==="n"&&(a+=t.slice(o,u)+"\\ ",u+=1,o=u,c="\\"),c==="\\")switch(t[u+1]){case"u":{a+=t.slice(o,u);let l=t.substr(u+2,4);switch(l){case"0000":a+="\\0";break;case"0007":a+="\\a";break;case"000b":a+="\\v";break;case"001b":a+="\\e";break;case"0085":a+="\\N";break;case"00a0":a+="\\_";break;case"2028":a+="\\L";break;case"2029":a+="\\P";break;default:l.substr(0,2)==="00"?a+="\\x"+l.substr(2):a+=t.substr(u,6)}u+=5,o=u+1}break;case"n":if(n||t[u+2]==='"'||t.length<s)u+=1;else{for(a+=t.slice(o,u)+`

`;t[u+2]==="\\"&&t[u+3]==="n"&&t[u+4]!=='"';)a+=`
`,u+=2;a+=i,t[u+2]===" "&&(a+="\\"),u+=1,o=u+1}break;default:u+=1}return a=o?a+t.slice(o):t,n?a:Ma(a,i,La,ic(e,!1))}function Td(r,e){if(e.options.singleQuote===!1||e.implicitKey&&r.includes(`
`)||/[ \t]\n|\n[ \t]/.test(r))return Da(r,e);let t=e.indent||(ac(r)?"  ":""),n="'"+r.replace(/'/g,"''").replace(/\n+/g,`$&
${t}`)+"'";return e.implicitKey?n:Ma(n,t,Sd,ic(e,!1))}function bi(r,e){let{singleQuote:t}=e.options,n;if(t===!1)n=Da;else{let s=r.includes('"'),i=r.includes("'");s&&!i?n=Td:i&&!s?n=Da:n=t?Td:Da}return n(r,e)}var Pd;try{Pd=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch(r){Pd=/\n+(?!\n|$)/g}function sc({comment:r,type:e,value:t},n,s,i){let{blockQuote:a,commentString:o,lineWidth:u}=n.options;if(!a||/\n[\t ]+$/.test(t)||/^\s*$/.test(t))return bi(t,n);let c=n.indent||(n.forceBlockIndent||ac(t)?"  ":""),l=a==="literal"?!0:a==="folded"||e===N.BLOCK_FOLDED?!1:e===N.BLOCK_LITERAL?!0:!a0(t,u,c.length);if(!t)return l?`|
`:`>
`;let d,f;for(f=t.length;f>0;--f){let _=t[f-1];if(_!==`
`&&_!=="	"&&_!==" ")break}let h=t.substring(f),m=h.indexOf(`
`);m===-1?d="-":t===h||m!==h.length-1?(d="+",i&&i()):d="",h&&(t=t.slice(0,-h.length),h[h.length-1]===`
`&&(h=h.slice(0,-1)),h=h.replace(Pd,`$&${c}`));let p=!1,g,y=-1;for(g=0;g<t.length;++g){let _=t[g];if(_===" ")p=!0;else if(_===`
`)y=g;else break}let b=t.substring(0,y<g?y+1:g);b&&(t=t.substring(b.length),b=b.replace(/\n+/g,`$&${c}`));let E=(l?"|":">")+(p?c?"2":"1":"")+d;if(r&&(E+=" "+o(r.replace(/ ?[\r\n]+/g," ")),s&&s()),l)return t=t.replace(/\n+/g,`$&${c}`),`${E}
${c}${b}${t}${h}`;t=t.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${c}`);let T=Ma(`${b}${t}${h}`,c,nc,ic(n,!0));return`${E}
${c}${T}`}function o0(r,e,t,n){let{type:s,value:i}=r,{actualString:a,implicitKey:o,indent:u,indentStep:c,inFlow:l}=e;if(o&&i.includes(`
`)||l&&/[[\]{},]/.test(i))return bi(i,e);if(!i||/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(i))return o||l||!i.includes(`
`)?bi(i,e):sc(r,e,t,n);if(!o&&!l&&s!==N.PLAIN&&i.includes(`
`))return sc(r,e,t,n);if(ac(i)){if(u==="")return e.forceBlockIndent=!0,sc(r,e,t,n);if(o&&u===c)return bi(i,e)}let d=i.replace(/\n+/g,`$&
${u}`);if(a){let f=p=>{var g;return p.default&&p.tag!=="tag:yaml.org,2002:str"&&((g=p.test)==null?void 0:g.test(d))},{compat:h,tags:m}=e.doc.schema;if(m.some(f)||h!=null&&h.some(f))return bi(i,e)}return o?d:Ma(d,u,Sd,ic(e,!1))}function ys(r,e,t,n){let{implicitKey:s,inFlow:i}=e,a=typeof r.value=="string"?r:Object.assign({},r,{value:String(r.value)}),{type:o}=r;o!==N.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(a.value)&&(o=N.QUOTE_DOUBLE);let u=l=>{switch(l){case N.BLOCK_FOLDED:case N.BLOCK_LITERAL:return s||i?bi(a.value,e):sc(a,e,t,n);case N.QUOTE_DOUBLE:return Da(a.value,e);case N.QUOTE_SINGLE:return Td(a.value,e);case N.PLAIN:return o0(a,e,t,n);default:return null}},c=u(o);if(c===null){let{defaultKeyType:l,defaultStringType:d}=e.options,f=s&&l||d;if(c=u(f),c===null)throw new Error(`Unsupported default string type ${f}`)}return c}function oc(r,e){let t=Object.assign({blockQuote:!0,commentString:sg,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},r.schema.toStringOptions,e),n;switch(t.collectionStyle){case"block":n=!1;break;case"flow":n=!0;break;default:n=null}return{anchors:new Set,doc:r,flowCollectionPadding:t.flowCollectionPadding?" ":"",indent:"",indentStep:typeof t.indent=="number"?" ".repeat(t.indent):"  ",inFlow:n,options:t}}function u0(r,e){var s,i,a,o;if(e.tag){let u=r.filter(c=>c.tag===e.tag);if(u.length>0)return(s=u.find(c=>c.format===e.format))!=null?s:u[0]}let t,n;if(J(e)){n=e.value;let u=r.filter(c=>{var l;return(l=c.identify)==null?void 0:l.call(c,n)});t=(i=u.find(c=>c.format===e.format))!=null?i:u.find(c=>!c.format)}else n=e,t=r.find(u=>u.nodeClass&&n instanceof u.nodeClass);if(!t){let u=(o=(a=n==null?void 0:n.constructor)==null?void 0:a.name)!=null?o:typeof n;throw new Error(`Tag not resolved for ${u} value`)}return t}function c0(r,e,{anchors:t,doc:n}){if(!n.directives)return"";let s=[],i=(J(r)||se(r))&&r.anchor;i&&ec(i)&&(t.add(i),s.push(`&${i}`));let a=r.tag?r.tag:e.default?null:e.tag;return a&&s.push(n.directives.tagString(a)),s.join(" ")}function Ar(r,e,t,n){var u,c;if(Y(r))return r.toString(e,t,n);if(Pt(r)){if(e.doc.directives)return r.toString(e);if((u=e.resolvedAliases)!=null&&u.has(r))throw new TypeError("Cannot stringify circular structure without alias nodes");e.resolvedAliases?e.resolvedAliases.add(r):e.resolvedAliases=new Set([r]),r=r.resolve(e.doc)}let s,i=ee(r)?r:e.doc.createNode(r,{onTagObj:l=>s=l});s||(s=u0(e.doc.schema.tags,i));let a=c0(i,s,e);a.length>0&&(e.indentAtStart=((c=e.indentAtStart)!=null?c:0)+a.length+1);let o=typeof s.stringify=="function"?s.stringify(i,e,t,n):J(i)?ys(i,e,t,n):i.toString(e,t,n);return a?J(i)||o[0]==="{"||o[0]==="["?`${a} ${o}`:`${a}
${e.indent}${o}`:o}function ag({key:r,value:e},t,n,s){var F,S;let{allNullValues:i,doc:a,indent:o,indentStep:u,options:{commentString:c,indentSeq:l,simpleKeys:d}}=t,f=ee(r)&&r.comment||null;if(d){if(f)throw new Error("With simple keys, key nodes cannot have comments");if(se(r)){let L="With simple keys, collection cannot be used as a key value";throw new Error(L)}}let h=!d&&(!r||f&&e==null&&!t.inFlow||se(r)||(J(r)?r.type===N.BLOCK_FOLDED||r.type===N.BLOCK_LITERAL:typeof r=="object"));t=Object.assign({},t,{allNullValues:!1,implicitKey:!h&&(d||!i),indent:o+u});let m=!1,p=!1,g=Ar(r,t,()=>m=!0,()=>p=!0);if(!h&&!t.inFlow&&g.length>1024){if(d)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");h=!0}if(t.inFlow){if(i||e==null)return m&&n&&n(),g===""?"?":h?`? ${g}`:g}else if(i&&!d||e==null&&h)return g=`? ${g}`,f&&!m?g+=Wt(g,t.indent,c(f)):p&&s&&s(),g;m&&(f=null),h?(f&&(g+=Wt(g,t.indent,c(f))),g=`? ${g}
${o}:`):(g=`${g}:`,f&&(g+=Wt(g,t.indent,c(f))));let y,b,O;ee(e)?(y=!!e.spaceBefore,b=e.commentBefore,O=e.comment):(y=!1,b=null,O=null,e&&typeof e=="object"&&(e=a.createNode(e))),t.implicitKey=!1,!h&&!f&&J(e)&&(t.indentAtStart=g.length+1),p=!1,!l&&u.length>=2&&!t.inFlow&&!h&&kt(e)&&!e.flow&&!e.tag&&!e.anchor&&(t.indent=t.indent.substring(2));let E=!1,T=Ar(e,t,()=>E=!0,()=>p=!0),_=" ";if(f||y||b){if(_=y?`
`:"",b){let L=c(b);_+=`
${lt(L,t.indent)}`}T===""&&!t.inFlow?_===`
`&&(_=`

`):_+=`
${t.indent}`}else if(!h&&se(e)){let L=T[0],te=T.indexOf(`
`),ie=te!==-1,rt=(S=(F=t.inFlow)!=null?F:e.flow)!=null?S:e.items.length===0;if(ie||!rt){let Ee=!1;if(ie&&(L==="&"||L==="!")){let ve=T.indexOf(" ");L==="&"&&ve!==-1&&ve<te&&T[ve+1]==="!"&&(ve=T.indexOf(" ",ve+1)),(ve===-1||te<ve)&&(Ee=!0)}Ee||(_=`
${t.indent}`)}}else(T===""||T[0]===`
`)&&(_="");return g+=_+T,t.inFlow?E&&n&&n():O&&!E?g+=Wt(g,t.indent,c(O)):p&&s&&s(),g}function uc(r,e){(r==="debug"||r==="warn")&&(typeof process!="undefined"&&process.emitWarning?process.emitWarning(e):console.warn(e))}var og="<<";function cc(r,e,{key:t,value:n}){if(r!=null&&r.doc.schema.merge&&l0(t))if(n=Pt(n)?n.resolve(r.doc):n,kt(n))for(let s of n.items)Id(r,e,s);else if(Array.isArray(n))for(let s of n)Id(r,e,s);else Id(r,e,n);else{let s=we(t,"",r);if(e instanceof Map)e.set(s,we(n,s,r));else if(e instanceof Set)e.add(s);else{let i=d0(t,s,r),a=we(n,i,r);i in e?Object.defineProperty(e,i,{value:a,writable:!0,enumerable:!0,configurable:!0}):e[i]=a}}return e}var l0=r=>r===og||J(r)&&r.value===og&&(!r.type||r.type===N.PLAIN);function Id(r,e,t){let n=r&&Pt(t)?t.resolve(r.doc):t;if(!It(n))throw new Error("Merge sources must be maps or map aliases");let s=n.toJSON(null,r,Map);for(let[i,a]of s)e instanceof Map?e.has(i)||e.set(i,a):e instanceof Set?e.add(i):Object.prototype.hasOwnProperty.call(e,i)||Object.defineProperty(e,i,{value:a,writable:!0,enumerable:!0,configurable:!0});return e}function d0(r,e,t){if(e===null)return"";if(typeof e!="object")return String(e);if(ee(r)&&(t!=null&&t.doc)){let n=oc(t.doc,{});n.anchors=new Set;for(let i of t.anchors.keys())n.anchors.add(i.anchor);n.inFlow=!0,n.inStringifyKey=!0;let s=r.toString(n);if(!t.mapKeyWarned){let i=JSON.stringify(s);i.length>40&&(i=i.substring(0,36)+'..."'),uc(t.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${i}. Set mapAsMap: true to use object keys.`),t.mapKeyWarned=!0}return s}return JSON.stringify(e)}function _i(r,e,t){let n=xr(r,void 0,t),s=xr(e,void 0,t);return new pe(n,s)}var pe=class r{constructor(e,t=null){Object.defineProperty(this,Ke,{value:Ad}),this.key=e,this.value=t}clone(e){let{key:t,value:n}=this;return ee(t)&&(t=t.clone(e)),ee(n)&&(n=n.clone(e)),new r(t,n)}toJSON(e,t){let n=t!=null&&t.mapAsMap?new Map:{};return cc(t,n,this)}toString(e,t,n){return e!=null&&e.doc?ag(this,e,t,n):JSON.stringify(this)}};function dc(r,e,t){var i;return(((i=e.inFlow)!=null?i:r.flow)?h0:f0)(r,e,t)}function f0({comment:r,items:e},t,{blockItemPrefix:n,flowChars:s,itemIndent:i,onChompKeep:a,onComment:o}){let{indent:u,options:{commentString:c}}=t,l=Object.assign({},t,{indent:i,type:null}),d=!1,f=[];for(let m=0;m<e.length;++m){let p=e[m],g=null;if(ee(p))!d&&p.spaceBefore&&f.push(""),lc(t,f,p.commentBefore,d),p.comment&&(g=p.comment);else if(Y(p)){let b=ee(p.key)?p.key:null;b&&(!d&&b.spaceBefore&&f.push(""),lc(t,f,b.commentBefore,d))}d=!1;let y=Ar(p,l,()=>g=null,()=>d=!0);g&&(y+=Wt(y,i,c(g))),d&&g&&(d=!1),f.push(n+y)}let h;if(f.length===0)h=s.start+s.end;else{h=f[0];for(let m=1;m<f.length;++m){let p=f[m];h+=p?`
${u}${p}`:`
`}}return r?(h+=`
`+lt(c(r),u),o&&o()):d&&a&&a(),h}function h0({items:r},e,{flowChars:t,itemIndent:n}){let{indent:s,indentStep:i,flowCollectionPadding:a,options:{commentString:o}}=e;n+=i;let u=Object.assign({},e,{indent:n,inFlow:!0,type:null}),c=!1,l=0,d=[];for(let m=0;m<r.length;++m){let p=r[m],g=null;if(ee(p))p.spaceBefore&&d.push(""),lc(e,d,p.commentBefore,!1),p.comment&&(g=p.comment);else if(Y(p)){let b=ee(p.key)?p.key:null;b&&(b.spaceBefore&&d.push(""),lc(e,d,b.commentBefore,!1),b.comment&&(c=!0));let O=ee(p.value)?p.value:null;O?(O.comment&&(g=O.comment),O.commentBefore&&(c=!0)):p.value==null&&(b!=null&&b.comment)&&(g=b.comment)}g&&(c=!0);let y=Ar(p,u,()=>g=null);m<r.length-1&&(y+=","),g&&(y+=Wt(y,n,o(g))),!c&&(d.length>l||y.includes(`
`))&&(c=!0),d.push(y),l=d.length}let{start:f,end:h}=t;if(d.length===0)return f+h;if(!c){let m=d.reduce((p,g)=>p+g.length+2,2);c=e.options.lineWidth>0&&m>e.options.lineWidth}if(c){let m=f;for(let p of d)m+=p?`
${i}${s}${p}`:`
`;return`${m}
${s}${h}`}else return`${f}${a}${d.join(" ")}${a}${h}`}function lc({indent:r,options:{commentString:e}},t,n,s){if(n&&s&&(n=n.replace(/^\n+/,"")),n){let i=lt(e(n),r);t.push(i.trimStart())}}function an(r,e){let t=J(e)?e.value:e;for(let n of r)if(Y(n)&&(n.key===e||n.key===t||J(n.key)&&n.key.value===t))return n}var ge=class extends gs{static get tagName(){return"tag:yaml.org,2002:map"}constructor(e){super(Tt,e),this.items=[]}static from(e,t,n){let{keepUndefined:s,replacer:i}=n,a=new this(e),o=(u,c)=>{if(typeof i=="function")c=i.call(t,u,c);else if(Array.isArray(i)&&!i.includes(u))return;(c!==void 0||s)&&a.items.push(_i(u,c,n))};if(t instanceof Map)for(let[u,c]of t)o(u,c);else if(t&&typeof t=="object")for(let u of Object.keys(t))o(u,t[u]);return typeof e.sortMapEntries=="function"&&a.items.sort(e.sortMapEntries),a}add(e,t){var a;let n;Y(e)?n=e:!e||typeof e!="object"||!("key"in e)?n=new pe(e,e==null?void 0:e.value):n=new pe(e.key,e.value);let s=an(this.items,n.key),i=(a=this.schema)==null?void 0:a.sortMapEntries;if(s){if(!t)throw new Error(`Key ${n.key} already set`);J(s.value)&&rc(n.value)?s.value.value=n.value:s.value=n.value}else if(i){let o=this.items.findIndex(u=>i(n,u)<0);o===-1?this.items.push(n):this.items.splice(o,0,n)}else this.items.push(n)}delete(e){let t=an(this.items,e);return t?this.items.splice(this.items.indexOf(t),1).length>0:!1}get(e,t){var i;let n=an(this.items,e),s=n==null?void 0:n.value;return(i=!t&&J(s)?s.value:s)!=null?i:void 0}has(e){return!!an(this.items,e)}set(e,t){this.add(new pe(e,t),!0)}toJSON(e,t,n){let s=n?new n:t!=null&&t.mapAsMap?new Map:{};t!=null&&t.onCreate&&t.onCreate(s);for(let i of this.items)cc(t,s,i);return s}toString(e,t,n){if(!e)return JSON.stringify(this);for(let s of this.items)if(!Y(s))throw new Error(`Map items must all be pairs; found ${JSON.stringify(s)} instead`);return!e.allNullValues&&this.hasAllNullValues(!1)&&(e=Object.assign({},e,{allNullValues:!0})),dc(this,e,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:e.indent||"",onChompKeep:n,onComment:t})}};var Nt={collection:"map",default:!0,nodeClass:ge,tag:"tag:yaml.org,2002:map",resolve(r,e){return It(r)||e("Expected a mapping for this tag"),r},createNode:(r,e,t)=>ge.from(r,e,t)};var $e=class extends gs{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(e){super(_r,e),this.items=[]}add(e){this.items.push(e)}delete(e){let t=fc(e);return typeof t!="number"?!1:this.items.splice(t,1).length>0}get(e,t){let n=fc(e);if(typeof n!="number")return;let s=this.items[n];return!t&&J(s)?s.value:s}has(e){let t=fc(e);return typeof t=="number"&&t<this.items.length}set(e,t){let n=fc(e);if(typeof n!="number")throw new Error(`Expected a valid index, not ${e}.`);let s=this.items[n];J(s)&&rc(t)?s.value=t:this.items[n]=t}toJSON(e,t){let n=[];t!=null&&t.onCreate&&t.onCreate(n);let s=0;for(let i of this.items)n.push(we(i,String(s++),t));return n}toString(e,t,n){return e?dc(this,e,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(e.indent||"")+"  ",onChompKeep:n,onComment:t}):JSON.stringify(this)}static from(e,t,n){let{replacer:s}=n,i=new this(e);if(t&&Symbol.iterator in Object(t)){let a=0;for(let o of t){if(typeof s=="function"){let u=t instanceof Set?o:String(a++);o=s.call(t,u,o)}i.items.push(xr(o,void 0,n))}}return i}};function fc(r){let e=J(r)?r.value:r;return e&&typeof e=="string"&&(e=Number(e)),typeof e=="number"&&Number.isInteger(e)&&e>=0?e:null}var Rt={collection:"seq",default:!0,nodeClass:$e,tag:"tag:yaml.org,2002:seq",resolve(r,e){return kt(r)||e("Expected a sequence for this tag"),r},createNode:(r,e,t)=>$e.from(r,e,t)};var on={identify:r=>typeof r=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:r=>r,stringify(r,e,t,n){return e=Object.assign({actualString:!0},e),ys(r,e,t,n)}};var bs={identify:r=>r==null,createNode:()=>new N(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new N(null),stringify:({source:r},e)=>typeof r=="string"&&bs.test.test(r)?r:e.options.nullStr};var Ba={identify:r=>typeof r=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:r=>new N(r[0]==="t"||r[0]==="T"),stringify({source:r,value:e},t){if(r&&Ba.test.test(r)){let n=r[0]==="t"||r[0]==="T";if(e===n)return r}return e?t.options.trueStr:t.options.falseStr}};function Le({format:r,minFractionDigits:e,tag:t,value:n}){if(typeof n=="bigint")return String(n);let s=typeof n=="number"?n:Number(n);if(!isFinite(s))return isNaN(s)?".nan":s<0?"-.inf":".inf";let i=JSON.stringify(n);if(!r&&e&&(!t||t==="tag:yaml.org,2002:float")&&/^\d/.test(i)){let a=i.indexOf(".");a<0&&(a=i.length,i+=".");let o=e-(i.length-a-1);for(;o-- >0;)i+="0"}return i}var hc={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF|nan|NaN|NAN))$/,resolve:r=>r.slice(-3).toLowerCase()==="nan"?NaN:r[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:Le},pc={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:r=>parseFloat(r),stringify(r){let e=Number(r.value);return isFinite(e)?e.toExponential():Le(r)}},mc={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(r){let e=new N(parseFloat(r)),t=r.indexOf(".");return t!==-1&&r[r.length-1]==="0"&&(e.minFractionDigits=r.length-t-1),e},stringify:Le};var gc=r=>typeof r=="bigint"||Number.isInteger(r),kd=(r,e,t,{intAsBigInt:n})=>n?BigInt(r):parseInt(r.substring(e),t);function ug(r,e,t){let{value:n}=r;return gc(n)&&n>=0?t+n.toString(e):Le(r)}var yc={identify:r=>gc(r)&&r>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(r,e,t)=>kd(r,2,8,t),stringify:r=>ug(r,8,"0o")},bc={identify:gc,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(r,e,t)=>kd(r,0,10,t),stringify:Le},_c={identify:r=>gc(r)&&r>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(r,e,t)=>kd(r,2,16,t),stringify:r=>ug(r,16,"0x")};var cg=[Nt,Rt,on,bs,Ba,yc,bc,_c,hc,pc,mc];function lg(r){return typeof r=="bigint"||Number.isInteger(r)}var wc=({value:r})=>JSON.stringify(r),p0=[{identify:r=>typeof r=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:r=>r,stringify:wc},{identify:r=>r==null,createNode:()=>new N(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:wc},{identify:r=>typeof r=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true|false$/,resolve:r=>r==="true",stringify:wc},{identify:lg,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(r,e,{intAsBigInt:t})=>t?BigInt(r):parseInt(r,10),stringify:({value:r})=>lg(r)?r.toString():JSON.stringify(r)},{identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:r=>parseFloat(r),stringify:wc}],m0={default:!0,tag:"",test:/^/,resolve(r,e){return e(`Unresolved plain scalar ${JSON.stringify(r)}`),r}},dg=[Nt,Rt].concat(p0,m0);var Fa={identify:r=>r instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(r,e){if(typeof Buffer=="function")return Buffer.from(r,"base64");if(typeof atob=="function"){let t=atob(r.replace(/[\n\r]/g,"")),n=new Uint8Array(t.length);for(let s=0;s<t.length;++s)n[s]=t.charCodeAt(s);return n}else return e("This environment does not support reading binary tags; either Buffer or atob is required"),r},stringify({comment:r,type:e,value:t},n,s,i){let a=t,o;if(typeof Buffer=="function")o=a instanceof Buffer?a.toString("base64"):Buffer.from(a.buffer).toString("base64");else if(typeof btoa=="function"){let u="";for(let c=0;c<a.length;++c)u+=String.fromCharCode(a[c]);o=btoa(u)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(e||(e=N.BLOCK_LITERAL),e!==N.QUOTE_DOUBLE){let u=Math.max(n.options.lineWidth-n.indent.length,n.options.minContentWidth),c=Math.ceil(o.length/u),l=new Array(c);for(let d=0,f=0;d<c;++d,f+=u)l[d]=o.substr(f,u);o=l.join(e===N.BLOCK_LITERAL?`
`:" ")}return ys({comment:r,type:e,value:o},n,s,i)}};function Cd(r,e){var t;if(kt(r))for(let n=0;n<r.items.length;++n){let s=r.items[n];if(!Y(s)){if(It(s)){s.items.length>1&&e("Each pair must have its own sequence indicator");let i=s.items[0]||new pe(new N(null));if(s.commentBefore&&(i.key.commentBefore=i.key.commentBefore?`${s.commentBefore}
${i.key.commentBefore}`:s.commentBefore),s.comment){let a=(t=i.value)!=null?t:i.key;a.comment=a.comment?`${s.comment}
${a.comment}`:s.comment}s=i}r.items[n]=Y(s)?s:new pe(s)}}else e("Expected a sequence for this tag");return r}function Nd(r,e,t){let{replacer:n}=t,s=new $e(r);s.tag="tag:yaml.org,2002:pairs";let i=0;if(e&&Symbol.iterator in Object(e))for(let a of e){typeof n=="function"&&(a=n.call(e,String(i++),a));let o,u;if(Array.isArray(a))if(a.length===2)o=a[0],u=a[1];else throw new TypeError(`Expected [key, value] tuple: ${a}`);else if(a&&a instanceof Object){let c=Object.keys(a);if(c.length===1)o=c[0],u=a[o];else throw new TypeError(`Expected tuple with one key, not ${c.length} keys`)}else o=a;s.items.push(_i(o,u,t))}return s}var Ua={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:Cd,createNode:Nd};var wi=class r extends $e{constructor(){super(),this.add=ge.prototype.add.bind(this),this.delete=ge.prototype.delete.bind(this),this.get=ge.prototype.get.bind(this),this.has=ge.prototype.has.bind(this),this.set=ge.prototype.set.bind(this),this.tag=r.tag}toJSON(e,t){if(!t)return super.toJSON(e);let n=new Map;t!=null&&t.onCreate&&t.onCreate(n);for(let s of this.items){let i,a;if(Y(s)?(i=we(s.key,"",t),a=we(s.value,i,t)):i=we(s,"",t),n.has(i))throw new Error("Ordered maps must not include duplicate keys");n.set(i,a)}return n}static from(e,t,n){let s=Nd(e,t,n),i=new this;return i.items=s.items,i}};wi.tag="tag:yaml.org,2002:omap";var za={collection:"seq",identify:r=>r instanceof Map,nodeClass:wi,default:!1,tag:"tag:yaml.org,2002:omap",resolve(r,e){let t=Cd(r,e),n=[];for(let{key:s}of t.items)J(s)&&(n.includes(s.value)?e(`Ordered maps must not include duplicate keys: ${s.value}`):n.push(s.value));return Object.assign(new wi,t)},createNode:(r,e,t)=>wi.from(r,e,t)};function fg({value:r,source:e},t){return e&&(r?Rd:jd).test.test(e)?e:r?t.options.trueStr:t.options.falseStr}var Rd={identify:r=>r===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new N(!0),stringify:fg},jd={identify:r=>r===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/i,resolve:()=>new N(!1),stringify:fg};var hg={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?\.(?:inf|Inf|INF|nan|NaN|NAN)$/,resolve:r=>r.slice(-3).toLowerCase()==="nan"?NaN:r[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:Le},pg={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:r=>parseFloat(r.replace(/_/g,"")),stringify(r){let e=Number(r.value);return isFinite(e)?e.toExponential():Le(r)}},mg={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(r){let e=new N(parseFloat(r.replace(/_/g,""))),t=r.indexOf(".");if(t!==-1){let n=r.substring(t+1).replace(/_/g,"");n[n.length-1]==="0"&&(e.minFractionDigits=n.length)}return e},stringify:Le};var Ka=r=>typeof r=="bigint"||Number.isInteger(r);function vc(r,e,t,{intAsBigInt:n}){let s=r[0];if((s==="-"||s==="+")&&(e+=1),r=r.substring(e).replace(/_/g,""),n){switch(t){case 2:r=`0b${r}`;break;case 8:r=`0o${r}`;break;case 16:r=`0x${r}`;break}let a=BigInt(r);return s==="-"?BigInt(-1)*a:a}let i=parseInt(r,t);return s==="-"?-1*i:i}function $d(r,e,t){let{value:n}=r;if(Ka(n)){let s=n.toString(e);return n<0?"-"+t+s.substr(1):t+s}return Le(r)}var gg={identify:Ka,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(r,e,t)=>vc(r,2,2,t),stringify:r=>$d(r,2,"0b")},yg={identify:Ka,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(r,e,t)=>vc(r,1,8,t),stringify:r=>$d(r,8,"0")},bg={identify:Ka,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(r,e,t)=>vc(r,0,10,t),stringify:Le},_g={identify:Ka,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(r,e,t)=>vc(r,2,16,t),stringify:r=>$d(r,16,"0x")};var vi=class r extends ge{constructor(e){super(e),this.tag=r.tag}add(e){let t;Y(e)?t=e:e&&typeof e=="object"&&"key"in e&&"value"in e&&e.value===null?t=new pe(e.key,null):t=new pe(e,null),an(this.items,t.key)||this.items.push(t)}get(e,t){let n=an(this.items,e);return!t&&Y(n)?J(n.key)?n.key.value:n.key:n}set(e,t){if(typeof t!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof t}`);let n=an(this.items,e);n&&!t?this.items.splice(this.items.indexOf(n),1):!n&&t&&this.items.push(new pe(e))}toJSON(e,t){return super.toJSON(e,t,Set)}toString(e,t,n){if(!e)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},e,{allNullValues:!0}),t,n);throw new Error("Set items must all have null values")}static from(e,t,n){let{replacer:s}=n,i=new this(e);if(t&&Symbol.iterator in Object(t))for(let a of t)typeof s=="function"&&(a=s.call(t,a,a)),i.items.push(_i(a,null,n));return i}};vi.tag="tag:yaml.org,2002:set";var qa={collection:"map",identify:r=>r instanceof Set,nodeClass:vi,default:!1,tag:"tag:yaml.org,2002:set",createNode:(r,e,t)=>vi.from(r,e,t),resolve(r,e){if(It(r)){if(r.hasAllNullValues(!0))return Object.assign(new vi,r);e("Set items must all have null values")}else e("Expected a mapping for this tag");return r}};function Ld(r,e){let t=r[0],n=t==="-"||t==="+"?r.substring(1):r,s=a=>e?BigInt(a):Number(a),i=n.replace(/_/g,"").split(":").reduce((a,o)=>a*s(60)+s(o),s(0));return t==="-"?s(-1)*i:i}function wg(r){let{value:e}=r,t=a=>a;if(typeof e=="bigint")t=a=>BigInt(a);else if(isNaN(e)||!isFinite(e))return Le(r);let n="";e<0&&(n="-",e*=t(-1));let s=t(60),i=[e%s];return e<60?i.unshift(0):(e=(e-i[0])/s,i.unshift(e%s),e>=60&&(e=(e-i[0])/s,i.unshift(e))),n+i.map(a=>String(a).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}var xc={identify:r=>typeof r=="bigint"||Number.isInteger(r),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(r,e,{intAsBigInt:t})=>Ld(r,t),stringify:wg},Ac={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:r=>Ld(r,!1),stringify:wg},xi={identify:r=>r instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(r){let e=r.match(xi.test);if(!e)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");let[,t,n,s,i,a,o]=e.map(Number),u=e[7]?Number((e[7]+"00").substr(1,3)):0,c=Date.UTC(t,n-1,s,i||0,a||0,o||0,u),l=e[8];if(l&&l!=="Z"){let d=Ld(l,!1);Math.abs(d)<30&&(d*=60),c-=6e4*d}return new Date(c)},stringify:({value:r})=>r.toISOString().replace(/((T00:00)?:00)?\.000Z$/,"")};var Md=[Nt,Rt,on,bs,Rd,jd,gg,yg,bg,_g,hg,pg,mg,Fa,za,Ua,qa,xc,Ac,xi];var vg=new Map([["core",cg],["failsafe",[Nt,Rt,on]],["json",dg],["yaml11",Md],["yaml-1.1",Md]]),xg={binary:Fa,bool:Ba,float:mc,floatExp:pc,floatNaN:hc,floatTime:Ac,int:bc,intHex:_c,intOct:yc,intTime:xc,map:Nt,null:bs,omap:za,pairs:Ua,seq:Rt,set:qa,timestamp:xi},Ag={"tag:yaml.org,2002:binary":Fa,"tag:yaml.org,2002:omap":za,"tag:yaml.org,2002:pairs":Ua,"tag:yaml.org,2002:set":qa,"tag:yaml.org,2002:timestamp":xi};function Oc(r,e){let t=vg.get(e);if(!t)if(Array.isArray(r))t=[];else{let n=Array.from(vg.keys()).filter(s=>s!=="yaml11").map(s=>JSON.stringify(s)).join(", ");throw new Error(`Unknown schema "${e}"; use one of ${n} or define customTags array`)}if(Array.isArray(r))for(let n of r)t=t.concat(n);else typeof r=="function"&&(t=r(t.slice()));return t.map(n=>{if(typeof n!="string")return n;let s=xg[n];if(s)return s;let i=Object.keys(xg).map(a=>JSON.stringify(a)).join(", ");throw new Error(`Unknown custom tag "${n}"; use one of ${i}`)})}var g0=(r,e)=>r.key<e.key?-1:r.key>e.key?1:0,Va=class r{constructor({compat:e,customTags:t,merge:n,resolveKnownTags:s,schema:i,sortMapEntries:a,toStringDefaults:o}){this.compat=Array.isArray(e)?Oc(e,"compat"):e?Oc(null,e):null,this.merge=!!n,this.name=typeof i=="string"&&i||"core",this.knownTags=s?Ag:{},this.tags=Oc(t,this.name),this.toStringOptions=o!=null?o:null,Object.defineProperty(this,Tt,{value:Nt}),Object.defineProperty(this,ct,{value:on}),Object.defineProperty(this,_r,{value:Rt}),this.sortMapEntries=typeof a=="function"?a:a===!0?g0:null}clone(){let e=Object.create(r.prototype,Object.getOwnPropertyDescriptors(this));return e.tags=this.tags.slice(),e}};function Og(r,e){var u;let t=[],n=e.directives===!0;if(e.directives!==!1&&r.directives){let c=r.directives.toString(r);c?(t.push(c),n=!0):r.directives.docStart&&(n=!0)}n&&t.push("---");let s=oc(r,e),{commentString:i}=s.options;if(r.commentBefore){t.length!==1&&t.unshift("");let c=i(r.commentBefore);t.unshift(lt(c,""))}let a=!1,o=null;if(r.contents){if(ee(r.contents)){if(r.contents.spaceBefore&&n&&t.push(""),r.contents.commentBefore){let d=i(r.contents.commentBefore);t.push(lt(d,""))}s.forceBlockIndent=!!r.comment,o=r.contents.comment}let c=o?void 0:()=>a=!0,l=Ar(r.contents,s,()=>o=null,c);o&&(l+=Wt(l,"",i(o))),(l[0]==="|"||l[0]===">")&&t[t.length-1]==="---"?t[t.length-1]=`--- ${l}`:t.push(l)}else t.push(Ar(r.contents,s));if((u=r.directives)!=null&&u.docEnd)if(r.comment){let c=i(r.comment);c.includes(`
`)?(t.push("..."),t.push(lt(c,""))):t.push(`... ${c}`)}else t.push("...");else{let c=r.comment;c&&a&&(c=c.replace(/^\n+/,"")),c&&((!a||o)&&t[t.length-1]!==""&&t.push(""),t.push(lt(i(c),"")))}return t.join(`
`)+`
`}var un=class r{constructor(e,t,n){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,Ke,{value:Xu});let s=null;typeof t=="function"||Array.isArray(t)?s=t:n===void 0&&t&&(n=t,t=void 0);let i=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,uniqueKeys:!0,version:"1.2"},n);this.options=i;let{version:a}=i;n!=null&&n._directives?(this.directives=n._directives.atDocument(),this.directives.yaml.explicit&&(a=this.directives.yaml.version)):this.directives=new Jt({version:a}),this.setSchema(a,n),this.contents=e===void 0?null:this.createNode(e,s,n)}clone(){let e=Object.create(r.prototype,{[Ke]:{value:Xu}});return e.commentBefore=this.commentBefore,e.comment=this.comment,e.errors=this.errors.slice(),e.warnings=this.warnings.slice(),e.options=Object.assign({},this.options),this.directives&&(e.directives=this.directives.clone()),e.schema=this.schema.clone(),e.contents=ee(this.contents)?this.contents.clone(e.schema):this.contents,this.range&&(e.range=this.range.slice()),e}add(e){Ai(this.contents)&&this.contents.add(e)}addIn(e,t){Ai(this.contents)&&this.contents.addIn(e,t)}createAlias(e,t){if(!e.anchor){let n=Od(this);e.anchor=!t||n.has(t)?Ed(t||"a",n):t}return new vr(e.anchor)}createNode(e,t,n){let s;if(typeof t=="function")e=t.call({"":e},"",e),s=t;else if(Array.isArray(t)){let g=b=>typeof b=="number"||b instanceof String||b instanceof Number,y=t.filter(g).map(String);y.length>0&&(t=t.concat(y)),s=t}else n===void 0&&t&&(n=t,t=void 0);let{aliasDuplicateObjects:i,anchorPrefix:a,flow:o,keepUndefined:u,onTagObj:c,tag:l}=n!=null?n:{},{onAnchor:d,setAnchors:f,sourceObjects:h}=ng(this,a||"a"),m={aliasDuplicateObjects:i!=null?i:!0,keepUndefined:u!=null?u:!1,onAnchor:d,onTagObj:c,replacer:s,schema:this.schema,sourceObjects:h},p=xr(e,l,m);return o&&se(p)&&(p.flow=!0),f(),p}createPair(e,t,n={}){let s=this.createNode(e,null,n),i=this.createNode(t,null,n);return new pe(s,i)}delete(e){return Ai(this.contents)?this.contents.delete(e):!1}deleteIn(e){return yi(e)?this.contents==null?!1:(this.contents=null,!0):Ai(this.contents)?this.contents.deleteIn(e):!1}get(e,t){return se(this.contents)?this.contents.get(e,t):void 0}getIn(e,t){return yi(e)?!t&&J(this.contents)?this.contents.value:this.contents:se(this.contents)?this.contents.getIn(e,t):void 0}has(e){return se(this.contents)?this.contents.has(e):!1}hasIn(e){return yi(e)?this.contents!==void 0:se(this.contents)?this.contents.hasIn(e):!1}set(e,t){this.contents==null?this.contents=$a(this.schema,[e],t):Ai(this.contents)&&this.contents.set(e,t)}setIn(e,t){yi(e)?this.contents=t:this.contents==null?this.contents=$a(this.schema,Array.from(e),t):Ai(this.contents)&&this.contents.setIn(e,t)}setSchema(e,t={}){typeof e=="number"&&(e=String(e));let n;switch(e){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new Jt({version:"1.1"}),n={merge:!0,resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=e:this.directives=new Jt({version:e}),n={merge:!1,resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,n=null;break;default:{let s=JSON.stringify(e);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${s}`)}}if(t.schema instanceof Object)this.schema=t.schema;else if(n)this.schema=new Va(Object.assign(n,t));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:e,jsonArg:t,mapAsMap:n,maxAliasCount:s,onAnchor:i,reviver:a}={}){let o={anchors:new Map,doc:this,keep:!e,mapAsMap:n===!0,mapKeyWarned:!1,maxAliasCount:typeof s=="number"?s:100},u=we(this.contents,t!=null?t:"",o);if(typeof i=="function")for(let{count:c,res:l}of o.anchors.values())i(l,c);return typeof a=="function"?nn(a,{"":u},"",u):u}toJSON(e,t){return this.toJS({json:!0,jsonArg:e,mapAsMap:!1,onAnchor:t})}toString(e={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in e&&(!Number.isInteger(e.indent)||Number(e.indent)<=0)){let t=JSON.stringify(e.indent);throw new Error(`"indent" option must be a positive integer, not ${t}`)}return Og(this,e)}};function Ai(r){if(se(r))return!0;throw new Error("Expected a YAML collection as document contents")}var Za=class extends Error{constructor(e,t,n,s){super(),this.name=e,this.code=n,this.message=s,this.pos=t}},jt=class extends Za{constructor(e,t,n){super("YAMLParseError",e,t,n)}},Ha=class extends Za{constructor(e,t,n){super("YAMLWarning",e,t,n)}},Dd=(r,e)=>t=>{if(t.pos[0]===-1)return;t.linePos=t.pos.map(o=>e.linePos(o));let{line:n,col:s}=t.linePos[0];t.message+=` at line ${n}, column ${s}`;let i=s-1,a=r.substring(e.lineStarts[n-1],e.lineStarts[n]).replace(/[\n\r]+$/,"");if(i>=60&&a.length>80){let o=Math.min(i-39,a.length-79);a="\u2026"+a.substring(o),i-=o-1}if(a.length>80&&(a=a.substring(0,79)+"\u2026"),n>1&&/^ *$/.test(a.substring(0,i))){let o=r.substring(e.lineStarts[n-2],e.lineStarts[n-1]);o.length>80&&(o=o.substring(0,79)+`\u2026
`),a=o+a}if(/[^ ]/.test(a)){let o=1,u=t.linePos[1];u&&u.line===n&&u.col>s&&(o=Math.max(1,Math.min(u.col-s,80-i)));let c=" ".repeat(i)+"^".repeat(o);t.message+=`:

${a}
${c}
`}};function Yt(r,{flow:e,indicator:t,next:n,offset:s,onError:i,startOnNewline:a}){let o=!1,u=a,c=a,l="",d="",f=!1,h=!1,m=!1,p=null,g=null,y=null,b=null,O=null;for(let _ of r)switch(m&&(_.type!=="space"&&_.type!=="newline"&&_.type!=="comma"&&i(_.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),m=!1),_.type){case"space":!e&&u&&t!=="doc-start"&&_.source[0]==="	"&&i(_,"TAB_AS_INDENT","Tabs are not allowed as indentation"),c=!0;break;case"comment":{c||i(_,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");let F=_.source.substring(1)||" ";l?l+=d+F:l=F,d="",u=!1;break}case"newline":u?l?l+=_.source:o=!0:d+=_.source,u=!0,f=!0,(p||g)&&(h=!0),c=!0;break;case"anchor":p&&i(_,"MULTIPLE_ANCHORS","A node can have at most one anchor"),_.source.endsWith(":")&&i(_.offset+_.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),p=_,O===null&&(O=_.offset),u=!1,c=!1,m=!0;break;case"tag":{g&&i(_,"MULTIPLE_TAGS","A node can have at most one tag"),g=_,O===null&&(O=_.offset),u=!1,c=!1,m=!0;break}case t:(p||g)&&i(_,"BAD_PROP_ORDER",`Anchors and tags must be after the ${_.source} indicator`),b&&i(_,"UNEXPECTED_TOKEN",`Unexpected ${_.source} in ${e!=null?e:"collection"}`),b=_,u=!1,c=!1;break;case"comma":if(e){y&&i(_,"UNEXPECTED_TOKEN",`Unexpected , in ${e}`),y=_,u=!1,c=!1;break}default:i(_,"UNEXPECTED_TOKEN",`Unexpected ${_.type} token`),u=!1,c=!1}let E=r[r.length-1],T=E?E.offset+E.source.length:s;return m&&n&&n.type!=="space"&&n.type!=="newline"&&n.type!=="comma"&&(n.type!=="scalar"||n.source!=="")&&i(n.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),{comma:y,found:b,spaceBefore:o,comment:l,hasNewline:f,hasNewlineAfterProp:h,anchor:p,tag:g,end:T,start:O!=null?O:T}}function cn(r){if(!r)return null;switch(r.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(r.source.includes(`
`))return!0;if(r.end){for(let e of r.end)if(e.type==="newline")return!0}return!1;case"flow-collection":for(let e of r.items){for(let t of e.start)if(t.type==="newline")return!0;if(e.sep){for(let t of e.sep)if(t.type==="newline")return!0}if(cn(e.key)||cn(e.value))return!0}return!1;default:return!0}}function Ga(r,e,t){if((e==null?void 0:e.type)==="flow-collection"){let n=e.end[0];n.indent===r&&(n.source==="]"||n.source==="}")&&cn(e)&&t(n,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}function Ec(r,e,t){let{uniqueKeys:n}=r.options;if(n===!1)return!1;let s=typeof n=="function"?n:(i,a)=>i===a||J(i)&&J(a)&&i.value===a.value&&!(i.value==="<<"&&r.schema.merge);return e.some(i=>s(i.key,t))}var Eg="All mapping items must start at the same column";function Sg({composeNode:r,composeEmptyNode:e},t,n,s,i){var l,d;let a=(l=i==null?void 0:i.nodeClass)!=null?l:ge,o=new a(t.schema);t.atRoot&&(t.atRoot=!1);let u=n.offset,c=null;for(let f of n.items){let{start:h,key:m,sep:p,value:g}=f,y=Yt(h,{indicator:"explicit-key-ind",next:m!=null?m:p==null?void 0:p[0],offset:u,onError:s,startOnNewline:!0}),b=!y.found;if(b){if(m&&(m.type==="block-seq"?s(u,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in m&&m.indent!==n.indent&&s(u,"BAD_INDENT",Eg)),!y.anchor&&!y.tag&&!p){c=y.end,y.comment&&(o.comment?o.comment+=`
`+y.comment:o.comment=y.comment);continue}(y.hasNewlineAfterProp||cn(m))&&s(m!=null?m:h[h.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else((d=y.found)==null?void 0:d.indent)!==n.indent&&s(u,"BAD_INDENT",Eg);let O=y.end,E=m?r(t,m,y,s):e(t,O,h,null,y,s);t.schema.compat&&Ga(n.indent,m,s),Ec(t,o.items,E)&&s(O,"DUPLICATE_KEY","Map keys must be unique");let T=Yt(p!=null?p:[],{indicator:"map-value-ind",next:g,offset:E.range[2],onError:s,startOnNewline:!m||m.type==="block-scalar"});if(u=T.end,T.found){b&&((g==null?void 0:g.type)==="block-map"&&!T.hasNewline&&s(u,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),t.options.strict&&y.start<T.found.offset-1024&&s(E.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));let _=g?r(t,g,T,s):e(t,u,p,null,T,s);t.schema.compat&&Ga(n.indent,g,s),u=_.range[2];let F=new pe(E,_);t.options.keepSourceTokens&&(F.srcToken=f),o.items.push(F)}else{b&&s(E.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),T.comment&&(E.comment?E.comment+=`
`+T.comment:E.comment=T.comment);let _=new pe(E);t.options.keepSourceTokens&&(_.srcToken=f),o.items.push(_)}}return c&&c<u&&s(c,"IMPOSSIBLE","Map comment with trailing content"),o.range=[n.offset,u,c!=null?c:u],o}function Tg({composeNode:r,composeEmptyNode:e},t,n,s,i){var l;let a=(l=i==null?void 0:i.nodeClass)!=null?l:$e,o=new a(t.schema);t.atRoot&&(t.atRoot=!1);let u=n.offset,c=null;for(let{start:d,value:f}of n.items){let h=Yt(d,{indicator:"seq-item-ind",next:f,offset:u,onError:s,startOnNewline:!0});if(!h.found)if(h.anchor||h.tag||f)f&&f.type==="block-seq"?s(h.end,"BAD_INDENT","All sequence items must start at the same column"):s(u,"MISSING_CHAR","Sequence item without - indicator");else{c=h.end,h.comment&&(o.comment=h.comment);continue}let m=f?r(t,f,h,s):e(t,h.end,d,null,h,s);t.schema.compat&&Ga(n.indent,f,s),u=m.range[2],o.items.push(m)}return o.range=[n.offset,u,c!=null?c:u],o}function Xt(r,e,t,n){let s="";if(r){let i=!1,a="";for(let o of r){let{source:u,type:c}=o;switch(c){case"space":i=!0;break;case"comment":{t&&!i&&n(o,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");let l=u.substring(1)||" ";s?s+=a+l:s=l,a="";break}case"newline":s&&(a+=u),i=!0;break;default:n(o,"UNEXPECTED_TOKEN",`Unexpected ${c} at node end`)}e+=u.length}}return{comment:s,offset:e}}var Bd="Block collections are not allowed within flow collections",Fd=r=>r&&(r.type==="block-map"||r.type==="block-seq");function Pg({composeNode:r,composeEmptyNode:e},t,n,s,i){var g,y;let a=n.start.source==="{",o=a?"flow map":"flow sequence",u=(g=i==null?void 0:i.nodeClass)!=null?g:a?ge:$e,c=new u(t.schema);c.flow=!0;let l=t.atRoot;l&&(t.atRoot=!1);let d=n.offset+n.start.source.length;for(let b=0;b<n.items.length;++b){let O=n.items[b],{start:E,key:T,sep:_,value:F}=O,S=Yt(E,{flow:o,indicator:"explicit-key-ind",next:T!=null?T:_==null?void 0:_[0],offset:d,onError:s,startOnNewline:!1});if(!S.found){if(!S.anchor&&!S.tag&&!_&&!F){b===0&&S.comma?s(S.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${o}`):b<n.items.length-1&&s(S.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${o}`),S.comment&&(c.comment?c.comment+=`
`+S.comment:c.comment=S.comment),d=S.end;continue}!a&&t.options.strict&&cn(T)&&s(T,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(b===0)S.comma&&s(S.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${o}`);else if(S.comma||s(S.start,"MISSING_CHAR",`Missing , between ${o} items`),S.comment){let L="";e:for(let te of E)switch(te.type){case"comma":case"space":break;case"comment":L=te.source.substring(1);break e;default:break e}if(L){let te=c.items[c.items.length-1];Y(te)&&(te=(y=te.value)!=null?y:te.key),te.comment?te.comment+=`
`+L:te.comment=L,S.comment=S.comment.substring(L.length+1)}}if(!a&&!_&&!S.found){let L=F?r(t,F,S,s):e(t,S.end,_,null,S,s);c.items.push(L),d=L.range[2],Fd(F)&&s(L.range,"BLOCK_IN_FLOW",Bd)}else{let L=S.end,te=T?r(t,T,S,s):e(t,L,E,null,S,s);Fd(T)&&s(te.range,"BLOCK_IN_FLOW",Bd);let ie=Yt(_!=null?_:[],{flow:o,indicator:"map-value-ind",next:F,offset:te.range[2],onError:s,startOnNewline:!1});if(ie.found){if(!a&&!S.found&&t.options.strict){if(_)for(let ve of _){if(ve===ie.found)break;if(ve.type==="newline"){s(ve,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}S.start<ie.found.offset-1024&&s(ie.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else F&&("source"in F&&F.source&&F.source[0]===":"?s(F,"MISSING_CHAR",`Missing space after : in ${o}`):s(ie.start,"MISSING_CHAR",`Missing , or : between ${o} items`));let rt=F?r(t,F,ie,s):ie.found?e(t,ie.end,_,null,ie,s):null;rt?Fd(F)&&s(rt.range,"BLOCK_IN_FLOW",Bd):ie.comment&&(te.comment?te.comment+=`
`+ie.comment:te.comment=ie.comment);let Ee=new pe(te,rt);if(t.options.keepSourceTokens&&(Ee.srcToken=O),a){let ve=c;Ec(t,ve.items,te)&&s(L,"DUPLICATE_KEY","Map keys must be unique"),ve.items.push(Ee)}else{let ve=new ge(t.schema);ve.flow=!0,ve.items.push(Ee),c.items.push(ve)}d=rt?rt.range[2]:ie.end}}let f=a?"}":"]",[h,...m]=n.end,p=d;if(h&&h.source===f)p=h.offset+h.source.length;else{let b=o[0].toUpperCase()+o.substring(1),O=l?`${b} must end with a ${f}`:`${b} in block collection must be sufficiently indented and end with a ${f}`;s(d,l?"MISSING_CHAR":"BAD_INDENT",O),h&&h.source.length!==1&&m.unshift(h)}if(m.length>0){let b=Xt(m,p,t.options.strict,s);b.comment&&(c.comment?c.comment+=`
`+b.comment:c.comment=b.comment),c.range=[n.offset,p,b.offset]}else c.range=[n.offset,p,p];return c}function Ud(r,e,t,n,s,i){let a=t.type==="block-map"?Sg(r,e,t,n,i):t.type==="block-seq"?Tg(r,e,t,n,i):Pg(r,e,t,n,i),o=a.constructor;return s==="!"||s===o.tagName?(a.tag=o.tagName,a):(s&&(a.tag=s),a)}function Ig(r,e,t,n,s){var d,f;let i=n?e.directives.tagName(n.source,h=>s(n,"TAG_RESOLVE_FAILED",h)):null,a=t.type==="block-map"?"map":t.type==="block-seq"?"seq":t.start.source==="{"?"map":"seq";if(!n||!i||i==="!"||i===ge.tagName&&a==="map"||i===$e.tagName&&a==="seq"||!a)return Ud(r,e,t,s,i);let o=e.schema.tags.find(h=>h.tag===i&&h.collection===a);if(!o){let h=e.schema.knownTags[i];if(h&&h.collection===a)e.schema.tags.push(Object.assign({},h,{default:!1})),o=h;else return h!=null&&h.collection?s(n,"BAD_COLLECTION_TYPE",`${h.tag} used for ${a} collection, but expects ${h.collection}`,!0):s(n,"TAG_RESOLVE_FAILED",`Unresolved tag: ${i}`,!0),Ud(r,e,t,s,i)}let u=Ud(r,e,t,s,i,o),c=(f=(d=o.resolve)==null?void 0:d.call(o,u,h=>s(n,"TAG_RESOLVE_FAILED",h),e.options))!=null?f:u,l=ee(c)?c:new N(c);return l.range=u.range,l.tag=i,o!=null&&o.format&&(l.format=o.format),l}function zd(r,e,t){let n=r.offset,s=y0(r,e,t);if(!s)return{value:"",type:null,comment:"",range:[n,n,n]};let i=s.mode===">"?N.BLOCK_FOLDED:N.BLOCK_LITERAL,a=r.source?b0(r.source):[],o=a.length;for(let p=a.length-1;p>=0;--p){let g=a[p][1];if(g===""||g==="\r")o=p;else break}if(o===0){let p=s.chomp==="+"&&a.length>0?`
`.repeat(Math.max(1,a.length-1)):"",g=n+s.length;return r.source&&(g+=r.source.length),{value:p,type:i,comment:s.comment,range:[n,g,g]}}let u=r.indent+s.indent,c=r.offset+s.length,l=0;for(let p=0;p<o;++p){let[g,y]=a[p];if(y===""||y==="\r")s.indent===0&&g.length>u&&(u=g.length);else{g.length<u&&t(c+g.length,"MISSING_CHAR","Block scalars with more-indented leading empty lines must use an explicit indentation indicator"),s.indent===0&&(u=g.length),l=p;break}c+=g.length+y.length+1}for(let p=a.length-1;p>=o;--p)a[p][0].length>u&&(o=p+1);let d="",f="",h=!1;for(let p=0;p<l;++p)d+=a[p][0].slice(u)+`
`;for(let p=l;p<o;++p){let[g,y]=a[p];c+=g.length+y.length+1;let b=y[y.length-1]==="\r";if(b&&(y=y.slice(0,-1)),y&&g.length<u){let E=`Block scalar lines must not be less indented than their ${s.indent?"explicit indentation indicator":"first line"}`;t(c-y.length-(b?2:1),"BAD_INDENT",E),g=""}i===N.BLOCK_LITERAL?(d+=f+g.slice(u)+y,f=`
`):g.length>u||y[0]==="	"?(f===" "?f=`
`:!h&&f===`
`&&(f=`

`),d+=f+g.slice(u)+y,f=`
`,h=!0):y===""?f===`
`?d+=`
`:f=`
`:(d+=f+y,f=" ",h=!1)}switch(s.chomp){case"-":break;case"+":for(let p=o;p<a.length;++p)d+=`
`+a[p][0].slice(u);d[d.length-1]!==`
`&&(d+=`
`);break;default:d+=`
`}let m=n+s.length+r.source.length;return{value:d,type:i,comment:s.comment,range:[n,m,m]}}function y0({offset:r,props:e},t,n){if(e[0].type!=="block-scalar-header")return n(e[0],"IMPOSSIBLE","Block scalar header not found"),null;let{source:s}=e[0],i=s[0],a=0,o="",u=-1;for(let f=1;f<s.length;++f){let h=s[f];if(!o&&(h==="-"||h==="+"))o=h;else{let m=Number(h);!a&&m?a=m:u===-1&&(u=r+f)}}u!==-1&&n(u,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${s}`);let c=!1,l="",d=s.length;for(let f=1;f<e.length;++f){let h=e[f];switch(h.type){case"space":c=!0;case"newline":d+=h.source.length;break;case"comment":t&&!c&&n(h,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),d+=h.source.length,l=h.source.substring(1);break;case"error":n(h,"UNEXPECTED_TOKEN",h.message),d+=h.source.length;break;default:{let m=`Unexpected token in block scalar header: ${h.type}`;n(h,"UNEXPECTED_TOKEN",m);let p=h.source;p&&typeof p=="string"&&(d+=p.length)}}}return{mode:i,indent:a,chomp:o,comment:l,length:d}}function b0(r){let e=r.split(/\n( *)/),t=e[0],n=t.match(/^( *)/),i=[n!=null&&n[1]?[n[1],t.slice(n[1].length)]:["",t]];for(let a=1;a<e.length;a+=2)i.push([e[a],e[a+1]]);return i}function Kd(r,e,t){let{offset:n,type:s,source:i,end:a}=r,o,u,c=(f,h,m)=>t(n+f,h,m);switch(s){case"scalar":o=N.PLAIN,u=_0(i,c);break;case"single-quoted-scalar":o=N.QUOTE_SINGLE,u=w0(i,c);break;case"double-quoted-scalar":o=N.QUOTE_DOUBLE,u=v0(i,c);break;default:return t(r,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${s}`),{value:"",type:null,comment:"",range:[n,n+i.length,n+i.length]}}let l=n+i.length,d=Xt(a,l,e,t);return{value:u,type:o,comment:d.comment,range:[n,l,d.offset]}}function _0(r,e){let t="";switch(r[0]){case"	":t="a tab character";break;case",":t="flow indicator character ,";break;case"%":t="directive indicator character %";break;case"|":case">":{t=`block scalar indicator ${r[0]}`;break}case"@":case"`":{t=`reserved character ${r[0]}`;break}}return t&&e(0,"BAD_SCALAR_START",`Plain value cannot start with ${t}`),kg(r)}function w0(r,e){return(r[r.length-1]!=="'"||r.length===1)&&e(r.length,"MISSING_CHAR","Missing closing 'quote"),kg(r.slice(1,-1)).replace(/''/g,"'")}function kg(r){var u;let e,t;try{e=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),t=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch(c){e=/(.*?)[ \t]*\r?\n/sy,t=/[ \t]*(.*?)[ \t]*\r?\n/sy}let n=e.exec(r);if(!n)return r;let s=n[1],i=" ",a=e.lastIndex;for(t.lastIndex=a;n=t.exec(r);)n[1]===""?i===`
`?s+=i:i=`
`:(s+=i+n[1],i=" "),a=t.lastIndex;let o=/[ \t]*(.*)/sy;return o.lastIndex=a,n=o.exec(r),s+i+((u=n==null?void 0:n[1])!=null?u:"")}function v0(r,e){let t="";for(let n=1;n<r.length-1;++n){let s=r[n];if(!(s==="\r"&&r[n+1]===`
`))if(s===`
`){let{fold:i,offset:a}=x0(r,n);t+=i,n=a}else if(s==="\\"){let i=r[++n],a=A0[i];if(a)t+=a;else if(i===`
`)for(i=r[n+1];i===" "||i==="	";)i=r[++n+1];else if(i==="\r"&&r[n+1]===`
`)for(i=r[++n+1];i===" "||i==="	";)i=r[++n+1];else if(i==="x"||i==="u"||i==="U"){let o={x:2,u:4,U:8}[i];t+=O0(r,n+1,o,e),n+=o}else{let o=r.substr(n-1,2);e(n-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${o}`),t+=o}}else if(s===" "||s==="	"){let i=n,a=r[n+1];for(;a===" "||a==="	";)a=r[++n+1];a!==`
`&&!(a==="\r"&&r[n+2]===`
`)&&(t+=n>i?r.slice(i,n+1):s)}else t+=s}return(r[r.length-1]!=='"'||r.length===1)&&e(r.length,"MISSING_CHAR",'Missing closing "quote'),t}function x0(r,e){let t="",n=r[e+1];for(;(n===" "||n==="	"||n===`
`||n==="\r")&&!(n==="\r"&&r[e+2]!==`
`);)n===`
`&&(t+=`
`),e+=1,n=r[e+1];return t||(t=" "),{fold:t,offset:e}}var A0={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"\x85",_:"\xA0",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"};function O0(r,e,t,n){let s=r.substr(e,t),a=s.length===t&&/^[0-9a-fA-F]+$/.test(s)?parseInt(s,16):NaN;if(isNaN(a)){let o=r.substr(e-2,t+2);return n(e-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${o}`),o}return String.fromCodePoint(a)}function qd(r,e,t,n){let{value:s,type:i,comment:a,range:o}=e.type==="block-scalar"?zd(e,r.options.strict,n):Kd(e,r.options.strict,n),u=t?r.directives.tagName(t.source,d=>n(t,"TAG_RESOLVE_FAILED",d)):null,c=t&&u?E0(r.schema,s,u,t,n):e.type==="scalar"?S0(r,s,e,n):r.schema[ct],l;try{let d=c.resolve(s,f=>n(t!=null?t:e,"TAG_RESOLVE_FAILED",f),r.options);l=J(d)?d:new N(d)}catch(d){let f=d instanceof Error?d.message:String(d);n(t!=null?t:e,"TAG_RESOLVE_FAILED",f),l=new N(s)}return l.range=o,l.source=s,i&&(l.type=i),u&&(l.tag=u),c.format&&(l.format=c.format),a&&(l.comment=a),l}function E0(r,e,t,n,s){var o;if(t==="!")return r[ct];let i=[];for(let u of r.tags)if(!u.collection&&u.tag===t)if(u.default&&u.test)i.push(u);else return u;for(let u of i)if((o=u.test)!=null&&o.test(e))return u;let a=r.knownTags[t];return a&&!a.collection?(r.tags.push(Object.assign({},a,{default:!1,test:void 0})),a):(s(n,"TAG_RESOLVE_FAILED",`Unresolved tag: ${t}`,t!=="tag:yaml.org,2002:str"),r[ct])}function S0({directives:r,schema:e},t,n,s){var a;let i=e.tags.find(o=>{var u;return o.default&&((u=o.test)==null?void 0:u.test(t))})||e[ct];if(e.compat){let o=(a=e.compat.find(u=>{var c;return u.default&&((c=u.test)==null?void 0:c.test(t))}))!=null?a:e[ct];if(i.tag!==o.tag){let u=r.tagString(i.tag),c=r.tagString(o.tag),l=`Value may be parsed as either ${u} or ${c}`;s(n,"TAG_RESOLVE_FAILED",l,!0)}}return i}function Cg(r,e,t){if(e){t===null&&(t=e.length);for(let n=t-1;n>=0;--n){let s=e[n];switch(s.type){case"space":case"comment":case"newline":r-=s.source.length;continue}for(s=e[++n];(s==null?void 0:s.type)==="space";)r+=s.source.length,s=e[++n];break}}return r}var T0={composeNode:Vd,composeEmptyNode:Sc};function Vd(r,e,t,n){let{spaceBefore:s,comment:i,anchor:a,tag:o}=t,u,c=!0;switch(e.type){case"alias":u=P0(r,e,n),(a||o)&&n(e,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":u=qd(r,e,o,n),a&&(u.anchor=a.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":u=Ig(T0,r,e,o,n),a&&(u.anchor=a.source.substring(1));break;default:{let l=e.type==="error"?e.message:`Unsupported token (type: ${e.type})`;n(e,"UNEXPECTED_TOKEN",l),u=Sc(r,e.offset,void 0,null,t,n),c=!1}}return a&&u.anchor===""&&n(a,"BAD_ALIAS","Anchor cannot be an empty string"),s&&(u.spaceBefore=!0),i&&(e.type==="scalar"&&e.source===""?u.comment=i:u.commentBefore=i),r.options.keepSourceTokens&&c&&(u.srcToken=e),u}function Sc(r,e,t,n,{spaceBefore:s,comment:i,anchor:a,tag:o,end:u},c){let l={type:"scalar",offset:Cg(e,t,n),indent:-1,source:""},d=qd(r,l,o,c);return a&&(d.anchor=a.source.substring(1),d.anchor===""&&c(a,"BAD_ALIAS","Anchor cannot be an empty string")),s&&(d.spaceBefore=!0),i&&(d.comment=i,d.range[2]=u),d}function P0({options:r},{offset:e,source:t,end:n},s){let i=new vr(t.substring(1));i.source===""&&s(e,"BAD_ALIAS","Alias cannot be an empty string"),i.source.endsWith(":")&&s(e+t.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);let a=e+t.length,o=Xt(n,a,r.strict,s);return i.range=[e,a,o.offset],o.comment&&(i.comment=o.comment),i}function Ng(r,e,{offset:t,start:n,value:s,end:i},a){let o=Object.assign({_directives:e},r),u=new un(void 0,o),c={atRoot:!0,directives:u.directives,options:u.options,schema:u.schema},l=Yt(n,{indicator:"doc-start",next:s!=null?s:i==null?void 0:i[0],offset:t,onError:a,startOnNewline:!0});l.found&&(u.directives.docStart=!0,s&&(s.type==="block-map"||s.type==="block-seq")&&!l.hasNewline&&a(l.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),u.contents=s?Vd(c,s,l,a):Sc(c,l.end,n,null,l,a);let d=u.contents.range[2],f=Xt(i,d,!1,a);return f.comment&&(u.comment=f.comment),u.range=[t,d,f.offset],u}function Ja(r){if(typeof r=="number")return[r,r+1];if(Array.isArray(r))return r.length===2?r:[r[0],r[1]];let{offset:e,source:t}=r;return[e,e+(typeof t=="string"?t.length:1)]}function Rg(r){var s;let e="",t=!1,n=!1;for(let i=0;i<r.length;++i){let a=r[i];switch(a[0]){case"#":e+=(e===""?"":n?`

`:`
`)+(a.substring(1)||" "),t=!0,n=!1;break;case"%":((s=r[i+1])==null?void 0:s[0])!=="#"&&(i+=1),t=!1;break;default:t||(n=!0),t=!1}}return{comment:e,afterEmptyLine:n}}var Wa=class{constructor(e={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(t,n,s,i)=>{let a=Ja(t);i?this.warnings.push(new Ha(a,n,s)):this.errors.push(new jt(a,n,s))},this.directives=new Jt({version:e.version||"1.2"}),this.options=e}decorate(e,t){let{comment:n,afterEmptyLine:s}=Rg(this.prelude);if(n){let i=e.contents;if(t)e.comment=e.comment?`${e.comment}
${n}`:n;else if(s||e.directives.docStart||!i)e.commentBefore=n;else if(se(i)&&!i.flow&&i.items.length>0){let a=i.items[0];Y(a)&&(a=a.key);let o=a.commentBefore;a.commentBefore=o?`${n}
${o}`:n}else{let a=i.commentBefore;i.commentBefore=a?`${n}
${a}`:n}}t?(Array.prototype.push.apply(e.errors,this.errors),Array.prototype.push.apply(e.warnings,this.warnings)):(e.errors=this.errors,e.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:Rg(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(e,t=!1,n=-1){for(let s of e)yield*this.next(s);yield*this.end(t,n)}*next(e){switch(e.type){case"directive":this.directives.add(e.source,(t,n,s)=>{let i=Ja(e);i[0]+=t,this.onError(i,"BAD_DIRECTIVE",n,s)}),this.prelude.push(e.source),this.atDirectives=!0;break;case"document":{let t=Ng(this.options,this.directives,e,this.onError);this.atDirectives&&!t.directives.docStart&&this.onError(e,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(t,!1),this.doc&&(yield this.doc),this.doc=t,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(e.source);break;case"error":{let t=e.source?`${e.message}: ${JSON.stringify(e.source)}`:e.message,n=new jt(Ja(e),"UNEXPECTED_TOKEN",t);this.atDirectives||!this.doc?this.errors.push(n):this.doc.errors.push(n);break}case"doc-end":{if(!this.doc){let n="Unexpected doc-end without preceding document";this.errors.push(new jt(Ja(e),"UNEXPECTED_TOKEN",n));break}this.doc.directives.docEnd=!0;let t=Xt(e.end,e.offset+e.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),t.comment){let n=this.doc.comment;this.doc.comment=n?`${n}
${t.comment}`:t.comment}this.doc.range[2]=t.offset;break}default:this.errors.push(new jt(Ja(e),"UNEXPECTED_TOKEN",`Unsupported token ${e.type}`))}}*end(e=!1,t=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(e){let n=Object.assign({_directives:this.directives},this.options),s=new un(void 0,n);this.atDirectives&&this.onError(t,"MISSING_CHAR","Missing directives-end indicator line"),s.range=[0,t,t],this.decorate(s,!1),yield s}}};var Zd=Symbol("break visit"),I0=Symbol("skip children"),jg=Symbol("remove item");function _s(r,e){"type"in r&&r.type==="document"&&(r={start:r.start,value:r.value}),$g(Object.freeze([]),r,e)}_s.BREAK=Zd;_s.SKIP=I0;_s.REMOVE=jg;_s.itemAtPath=(r,e)=>{let t=r;for(let[n,s]of e){let i=t==null?void 0:t[n];if(i&&"items"in i)t=i.items[s];else return}return t};_s.parentCollection=(r,e)=>{let t=_s.itemAtPath(r,e.slice(0,-1)),n=e[e.length-1][0],s=t==null?void 0:t[n];if(s&&"items"in s)return s;throw new Error("Parent collection not found")};function $g(r,e,t){let n=t(e,r);if(typeof n=="symbol")return n;for(let s of["key","value"]){let i=e[s];if(i&&"items"in i){for(let a=0;a<i.items.length;++a){let o=$g(Object.freeze(r.concat([[s,a]])),i.items[a],t);if(typeof o=="number")a=o-1;else{if(o===Zd)return Zd;o===jg&&(i.items.splice(a,1),a-=1)}}typeof n=="function"&&s==="key"&&(n=n(e,r))}}return typeof n=="function"?n(e,r):n}var Hd="\uFEFF",Gd="",Jd="",Tc="";function Lg(r){switch(r){case Hd:return"byte-order-mark";case Gd:return"doc-mode";case Jd:return"flow-error-end";case Tc:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(r[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}function dt(r){switch(r){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}var Mg="0123456789ABCDEFabcdef".split(""),C0="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()".split(""),Wd=",[]{}".split(""),N0=` ,[]{}
\r	`.split(""),Yd=r=>!r||N0.includes(r),Ya=class{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(e,t=!1){var s;e&&(this.buffer=this.buffer?this.buffer+e:e,this.lineEndPos=null),this.atEnd=!t;let n=(s=this.next)!=null?s:"stream";for(;n&&(t||this.hasChars(1));)n=yield*this.parseNext(n)}atLineEnd(){let e=this.pos,t=this.buffer[e];for(;t===" "||t==="	";)t=this.buffer[++e];return!t||t==="#"||t===`
`?!0:t==="\r"?this.buffer[e+1]===`
`:!1}charAt(e){return this.buffer[this.pos+e]}continueScalar(e){let t=this.buffer[e];if(this.indentNext>0){let n=0;for(;t===" ";)t=this.buffer[++n+e];if(t==="\r"){let s=this.buffer[n+e+1];if(s===`
`||!s&&!this.atEnd)return e+n+1}return t===`
`||n>=this.indentNext||!t&&!this.atEnd?e+n:-1}if(t==="-"||t==="."){let n=this.buffer.substr(e,3);if((n==="---"||n==="...")&&dt(this.buffer[e+3]))return-1}return e}getLine(){let e=this.lineEndPos;return(typeof e!="number"||e!==-1&&e<this.pos)&&(e=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=e),e===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[e-1]==="\r"&&(e-=1),this.buffer.substring(this.pos,e))}hasChars(e){return this.pos+e<=this.buffer.length}setNext(e){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=e,null}peek(e){return this.buffer.substr(this.pos,e)}*parseNext(e){switch(e){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let e=this.getLine();if(e===null)return this.setNext("stream");if(e[0]===Hd&&(yield*this.pushCount(1),e=e.substring(1)),e[0]==="%"){let t=e.length,n=e.indexOf("#");if(n!==-1){let i=e[n-1];(i===" "||i==="	")&&(t=n-1)}for(;;){let i=e[t-1];if(i===" "||i==="	")t-=1;else break}let s=(yield*this.pushCount(t))+(yield*this.pushSpaces(!0));return yield*this.pushCount(e.length-s),this.pushNewline(),"stream"}if(this.atLineEnd()){let t=yield*this.pushSpaces(!0);return yield*this.pushCount(e.length-t),yield*this.pushNewline(),"stream"}return yield Gd,yield*this.parseLineStart()}*parseLineStart(){let e=this.charAt(0);if(!e&&!this.atEnd)return this.setNext("line-start");if(e==="-"||e==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");let t=this.peek(3);if(t==="---"&&dt(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,"doc";if(t==="..."&&dt(this.charAt(3)))return yield*this.pushCount(3),"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!dt(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){let[e,t]=this.peek(2);if(!t&&!this.atEnd)return this.setNext("block-start");if((e==="-"||e==="?"||e===":")&&dt(t)){let n=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=n,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);let e=this.getLine();if(e===null)return this.setNext("doc");let t=yield*this.pushIndicators();switch(e[t]){case"#":yield*this.pushCount(e.length-t);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(Yd),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return t+=yield*this.parseBlockScalarHeader(),t+=yield*this.pushSpaces(!0),yield*this.pushCount(e.length-t),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let e,t,n=-1;do e=yield*this.pushNewline(),e>0?(t=yield*this.pushSpaces(!1),this.indentValue=n=t):t=0,t+=yield*this.pushSpaces(!0);while(e+t>0);let s=this.getLine();if(s===null)return this.setNext("flow");if((n!==-1&&n<this.indentNext&&s[0]!=="#"||n===0&&(s.startsWith("---")||s.startsWith("..."))&&dt(s[3]))&&!(n===this.indentNext-1&&this.flowLevel===1&&(s[0]==="]"||s[0]==="}")))return this.flowLevel=0,yield Jd,yield*this.parseLineStart();let i=0;for(;s[i]===",";)i+=yield*this.pushCount(1),i+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(i+=yield*this.pushIndicators(),s[i]){case void 0:return"flow";case"#":return yield*this.pushCount(s.length-i),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(Yd),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{let a=this.charAt(1);if(this.flowKey||dt(a)||a===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){let e=this.charAt(0),t=this.buffer.indexOf(e,this.pos+1);if(e==="'")for(;t!==-1&&this.buffer[t+1]==="'";)t=this.buffer.indexOf("'",t+2);else for(;t!==-1;){let i=0;for(;this.buffer[t-1-i]==="\\";)i+=1;if(i%2===0)break;t=this.buffer.indexOf('"',t+1)}let n=this.buffer.substring(0,t),s=n.indexOf(`
`,this.pos);if(s!==-1){for(;s!==-1;){let i=this.continueScalar(s+1);if(i===-1)break;s=n.indexOf(`
`,i)}s!==-1&&(t=s-(n[s-1]==="\r"?2:1))}if(t===-1){if(!this.atEnd)return this.setNext("quoted-scalar");t=this.buffer.length}return yield*this.pushToIndex(t+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let e=this.pos;for(;;){let t=this.buffer[++e];if(t==="+")this.blockScalarKeep=!0;else if(t>"0"&&t<="9")this.blockScalarIndent=Number(t)-1;else if(t!=="-")break}return yield*this.pushUntil(t=>dt(t)||t==="#")}*parseBlockScalar(){let e=this.pos-1,t=0,n;e:for(let s=this.pos;n=this.buffer[s];++s)switch(n){case" ":t+=1;break;case`
`:e=s,t=0;break;case"\r":{let i=this.buffer[s+1];if(!i&&!this.atEnd)return this.setNext("block-scalar");if(i===`
`)break}default:break e}if(!n&&!this.atEnd)return this.setNext("block-scalar");if(t>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=t:this.indentNext+=this.blockScalarIndent;do{let s=this.continueScalar(e+1);if(s===-1)break;e=this.buffer.indexOf(`
`,s)}while(e!==-1);if(e===-1){if(!this.atEnd)return this.setNext("block-scalar");e=this.buffer.length}}if(!this.blockScalarKeep)do{let s=e-1,i=this.buffer[s];i==="\r"&&(i=this.buffer[--s]);let a=s;for(;i===" "||i==="	";)i=this.buffer[--s];if(i===`
`&&s>=this.pos&&s+1+t>a)e=s;else break}while(!0);return yield Tc,yield*this.pushToIndex(e+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){let e=this.flowLevel>0,t=this.pos-1,n=this.pos-1,s;for(;s=this.buffer[++n];)if(s===":"){let i=this.buffer[n+1];if(dt(i)||e&&i===",")break;t=n}else if(dt(s)){let i=this.buffer[n+1];if(s==="\r"&&(i===`
`?(n+=1,s=`
`,i=this.buffer[n+1]):t=n),i==="#"||e&&Wd.includes(i))break;if(s===`
`){let a=this.continueScalar(n+1);if(a===-1)break;n=Math.max(n,a-2)}}else{if(e&&Wd.includes(s))break;t=n}return!s&&!this.atEnd?this.setNext("plain-scalar"):(yield Tc,yield*this.pushToIndex(t+1,!0),e?"flow":"doc")}*pushCount(e){return e>0?(yield this.buffer.substr(this.pos,e),this.pos+=e,e):0}*pushToIndex(e,t){let n=this.buffer.slice(this.pos,e);return n?(yield n,this.pos+=n.length,n.length):(t&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(Yd))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{let e=this.flowLevel>0,t=this.charAt(1);if(dt(t)||e&&Wd.includes(t))return e?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let e=this.pos+2,t=this.buffer[e];for(;!dt(t)&&t!==">";)t=this.buffer[++e];return yield*this.pushToIndex(t===">"?e+1:e,!1)}else{let e=this.pos+1,t=this.buffer[e];for(;t;)if(C0.includes(t))t=this.buffer[++e];else if(t==="%"&&Mg.includes(this.buffer[e+1])&&Mg.includes(this.buffer[e+2]))t=this.buffer[e+=3];else break;return yield*this.pushToIndex(e,!1)}}*pushNewline(){let e=this.buffer[this.pos];return e===`
`?yield*this.pushCount(1):e==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(e){let t=this.pos-1,n;do n=this.buffer[++t];while(n===" "||e&&n==="	");let s=t-this.pos;return s>0&&(yield this.buffer.substr(this.pos,s),this.pos=t),s}*pushUntil(e){let t=this.pos,n=this.buffer[t];for(;!e(n);)n=this.buffer[++t];return yield*this.pushToIndex(t,!1)}};var Xa=class{constructor(){this.lineStarts=[],this.addNewLine=e=>this.lineStarts.push(e),this.linePos=e=>{let t=0,n=this.lineStarts.length;for(;t<n;){let i=t+n>>1;this.lineStarts[i]<e?t=i+1:n=i}if(this.lineStarts[t]===e)return{line:t+1,col:1};if(t===0)return{line:0,col:e};let s=this.lineStarts[t-1];return{line:t,col:e-s+1}}}};function $t(r,e){for(let t=0;t<r.length;++t)if(r[t].type===e)return!0;return!1}function Dg(r){for(let e=0;e<r.length;++e)switch(r[e].type){case"space":case"comment":case"newline":break;default:return e}return-1}function Fg(r){switch(r==null?void 0:r.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function Pc(r){var e;switch(r.type){case"document":return r.start;case"block-map":{let t=r.items[r.items.length-1];return(e=t.sep)!=null?e:t.start}case"block-seq":return r.items[r.items.length-1].start;default:return[]}}function Oi(r){var t;if(r.length===0)return[];let e=r.length;e:for(;--e>=0;)switch(r[e].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;((t=r[++e])==null?void 0:t.type)==="space";);return r.splice(e,r.length)}function Bg(r){if(r.start.type==="flow-seq-start")for(let e of r.items)e.sep&&!e.value&&!$t(e.start,"explicit-key-ind")&&!$t(e.sep,"map-value-ind")&&(e.key&&(e.value=e.key),delete e.key,Fg(e.value)?e.value.end?Array.prototype.push.apply(e.value.end,e.sep):e.value.end=e.sep:Array.prototype.push.apply(e.start,e.sep),delete e.sep)}var Qa=class{constructor(e){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new Ya,this.onNewLine=e}*parse(e,t=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(let n of this.lexer.lex(e,t))yield*this.next(n);t||(yield*this.end())}*next(e){if(this.source=e,this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=e.length;return}let t=Lg(e);if(t)if(t==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=t,yield*this.step(),t){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+e.length);break;case"space":this.atNewLine&&e[0]===" "&&(this.indent+=e.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=e.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=e.length}else{let n=`Not a YAML token: ${e}`;yield*this.pop({type:"error",offset:this.offset,message:n,source:e}),this.offset+=e.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){let e=this.peek(1);if(this.type==="doc-end"&&(!e||e.type!=="doc-end")){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!e)return yield*this.stream();switch(e.type){case"document":return yield*this.document(e);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(e);case"block-scalar":return yield*this.blockScalar(e);case"block-map":return yield*this.blockMap(e);case"block-seq":return yield*this.blockSequence(e);case"flow-collection":return yield*this.flowCollection(e);case"doc-end":return yield*this.documentEnd(e)}yield*this.pop()}peek(e){return this.stack[this.stack.length-e]}*pop(e){let t=e!=null?e:this.stack.pop();if(!t)yield{type:"error",offset:this.offset,source:"",message:"Tried to pop an empty stack"};else if(this.stack.length===0)yield t;else{let n=this.peek(1);switch(t.type==="block-scalar"?t.indent="indent"in n?n.indent:0:t.type==="flow-collection"&&n.type==="document"&&(t.indent=0),t.type==="flow-collection"&&Bg(t),n.type){case"document":n.value=t;break;case"block-scalar":n.props.push(t);break;case"block-map":{let s=n.items[n.items.length-1];if(s.value){n.items.push({start:[],key:t,sep:[]}),this.onKeyLine=!0;return}else if(s.sep)s.value=t;else{Object.assign(s,{key:t,sep:[]}),this.onKeyLine=!$t(s.start,"explicit-key-ind");return}break}case"block-seq":{let s=n.items[n.items.length-1];s.value?n.items.push({start:[],value:t}):s.value=t;break}case"flow-collection":{let s=n.items[n.items.length-1];!s||s.value?n.items.push({start:[],key:t,sep:[]}):s.sep?s.value=t:Object.assign(s,{key:t,sep:[]});return}default:yield*this.pop(),yield*this.pop(t)}if((n.type==="document"||n.type==="block-map"||n.type==="block-seq")&&(t.type==="block-map"||t.type==="block-seq")){let s=t.items[t.items.length-1];s&&!s.sep&&!s.value&&s.start.length>0&&Dg(s.start)===-1&&(t.indent===0||s.start.every(i=>i.type!=="comment"||i.indent<t.indent))&&(n.type==="document"?n.end=s.start:n.items.push({start:s.start}),t.items.splice(-1,1))}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{let e={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&e.start.push(this.sourceToken),this.stack.push(e);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(e){if(e.value)return yield*this.lineEnd(e);switch(this.type){case"doc-start":{Dg(e.start)!==-1?(yield*this.pop(),yield*this.step()):e.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":e.start.push(this.sourceToken);return}let t=this.startBlockValue(e);t?this.stack.push(t):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(e){if(this.type==="map-value-ind"){let t=Pc(this.peek(2)),n=Oi(t),s;e.end?(s=e.end,s.push(this.sourceToken),delete e.end):s=[this.sourceToken];let i={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:n,key:e,sep:s}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=i}else yield*this.lineEnd(e)}*blockScalar(e){switch(this.type){case"space":case"comment":case"newline":e.props.push(this.sourceToken);return;case"scalar":if(e.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(e){var n;let t=e.items[e.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,t.value){let s="end"in t.value?t.value.end:void 0,i=Array.isArray(s)?s[s.length-1]:void 0;(i==null?void 0:i.type)==="comment"?s==null||s.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else if(t.sep)t.sep.push(this.sourceToken);else{if(this.atIndentedComment(t.start,e.indent)){let s=e.items[e.items.length-2],i=(n=s==null?void 0:s.value)==null?void 0:n.end;if(Array.isArray(i)){Array.prototype.push.apply(i,t.start),i.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return}if(this.indent>=e.indent){let s=!this.onKeyLine&&this.indent===e.indent&&t.sep&&this.type!=="seq-item-ind",i=[];if(s&&t.sep&&!t.value){let a=[];for(let o=0;o<t.sep.length;++o){let u=t.sep[o];switch(u.type){case"newline":a.push(o);break;case"space":break;case"comment":u.indent>e.indent&&(a.length=0);break;default:a.length=0}}a.length>=2&&(i=t.sep.splice(a[1]))}switch(this.type){case"anchor":case"tag":s||t.value?(i.push(this.sourceToken),e.items.push({start:i}),this.onKeyLine=!0):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"explicit-key-ind":!t.sep&&!$t(t.start,"explicit-key-ind")?t.start.push(this.sourceToken):s||t.value?(i.push(this.sourceToken),e.items.push({start:i})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]}),this.onKeyLine=!0;return;case"map-value-ind":if($t(t.start,"explicit-key-ind"))if(t.sep)if(t.value)e.items.push({start:[],key:null,sep:[this.sourceToken]});else if($t(t.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:i,key:null,sep:[this.sourceToken]}]});else if(Fg(t.key)&&!$t(t.sep,"newline")){let a=Oi(t.start),o=t.key,u=t.sep;u.push(this.sourceToken),delete t.key,delete t.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:o,sep:u}]})}else i.length>0?t.sep=t.sep.concat(i,this.sourceToken):t.sep.push(this.sourceToken);else if($t(t.start,"newline"))Object.assign(t,{key:null,sep:[this.sourceToken]});else{let a=Oi(t.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:null,sep:[this.sourceToken]}]})}else t.sep?t.value||s?e.items.push({start:i,key:null,sep:[this.sourceToken]}):$t(t.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{let a=this.flowScalar(this.type);s||t.value?(e.items.push({start:i,key:a,sep:[]}),this.onKeyLine=!0):t.sep?this.stack.push(a):(Object.assign(t,{key:a,sep:[]}),this.onKeyLine=!0);return}default:{let a=this.startBlockValue(e);if(a){s&&a.type!=="block-seq"&&$t(t.start,"explicit-key-ind")&&e.items.push({start:i}),this.stack.push(a);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(e){var n;let t=e.items[e.items.length-1];switch(this.type){case"newline":if(t.value){let s="end"in t.value?t.value.end:void 0,i=Array.isArray(s)?s[s.length-1]:void 0;(i==null?void 0:i.type)==="comment"?s==null||s.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(t.start,e.indent)){let s=e.items[e.items.length-2],i=(n=s==null?void 0:s.value)==null?void 0:n.end;if(Array.isArray(i)){Array.prototype.push.apply(i,t.start),i.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return;case"anchor":case"tag":if(t.value||this.indent<=e.indent)break;t.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==e.indent)break;t.value||$t(t.start,"seq-item-ind")?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return}if(this.indent>e.indent){let s=this.startBlockValue(e);if(s){this.stack.push(s);return}}yield*this.pop(),yield*this.step()}*flowCollection(e){let t=e.items[e.items.length-1];if(this.type==="flow-error-end"){let n;do yield*this.pop(),n=this.peek(1);while(n&&n.type==="flow-collection")}else if(e.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!t||t.sep?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return;case"map-value-ind":!t||t.value?e.items.push({start:[],key:null,sep:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!t||t.value?e.items.push({start:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{let s=this.flowScalar(this.type);!t||t.value?e.items.push({start:[],key:s,sep:[]}):t.sep?this.stack.push(s):Object.assign(t,{key:s,sep:[]});return}case"flow-map-end":case"flow-seq-end":e.end.push(this.sourceToken);return}let n=this.startBlockValue(e);n?this.stack.push(n):(yield*this.pop(),yield*this.step())}else{let n=this.peek(2);if(n.type==="block-map"&&(this.type==="map-value-ind"&&n.indent===e.indent||this.type==="newline"&&!n.items[n.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&n.type!=="flow-collection"){let s=Pc(n),i=Oi(s);Bg(e);let a=e.end.splice(1,e.end.length);a.push(this.sourceToken);let o={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:i,key:e,sep:a}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=o}else yield*this.lineEnd(e)}}flowScalar(e){if(this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}return{type:e,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(e){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;let t=Pc(e),n=Oi(t);return n.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:n}]}}case"map-value-ind":{this.onKeyLine=!0;let t=Pc(e),n=Oi(t);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:n,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(e,t){return this.type!=="comment"||this.indent<=t?!1:e.every(n=>n.type==="newline"||n.type==="space")}*documentEnd(e){this.type!=="doc-mode"&&(e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(e){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}};function R0(r){let e=r.prettyErrors!==!1;return{lineCounter:r.lineCounter||e&&new Xa||null,prettyErrors:e}}function Ug(r,e={}){let{lineCounter:t,prettyErrors:n}=R0(e),s=new Qa(t==null?void 0:t.addNewLine),i=new Wa(e),a=null;for(let o of i.compose(s.parse(r),!0,r.length))if(!a)a=o;else if(a.options.logLevel!=="silent"){a.errors.push(new jt(o.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return n&&t&&(a.errors.forEach(Dd(r,t)),a.warnings.forEach(Dd(r,t))),a}function Xd(r,e,t){let n;typeof e=="function"?n=e:t===void 0&&e&&typeof e=="object"&&(t=e);let s=Ug(r,t);if(!s)return null;if(s.warnings.forEach(i=>uc(s.options.logLevel,i)),s.errors.length>0){if(s.options.logLevel!=="silent")throw s.errors[0];s.errors=[]}return s.toJS(Object.assign({reviver:n},t))}function zg(r){let e=Xd(r);return $0(e.name)}function $0(r){let e=document.createElement("div"),t=document.createElement("h1");return t.textContent=r,t.style.margin="0",t.style.padding="0",e.appendChild(t),e}var Qd=require("obsidian");var Kg=async(r,e)=>{var a;let t=await Ju(e);if(!t){new Qd.Notice("No content found in the selected node");return}let n=t.split(`
`).filter(o=>o.trim()!=="");if(n.length===0){new Qd.Notice("No list items found in the selected node");return}let s=r.getEdgesForNode(e).filter(o=>o.to.node.id===e.id),i=[];for(let o of n){let u=await pi(r,e,{text:o});for(let c of s)i.push({label:(a=c.label)!=null?a:"",id:ja(16),fromNode:c.from.node.id,fromSide:c.from.side,toNode:u.id,toSide:c.to.side})}i.length>0&&await qm(r,i),r.removeNode(e)};var ws=require("obsidian");var ft=require("obsidian");var qg=["#94D1BE","#EBD2B4","#DAC4F7","#32936F","#32936F","#F08A4B","#F2A541","#06BCC1"],Vg=()=>qg[Math.floor(Math.random()*qg.length)];var Or={advancedField:"_advancedField_1mnnh_1",show:"_show_1mnnh_4",autoFlow:"_autoFlow_1mnnh_7"};var eo=class extends ft.Modal{constructor(e,t){super(e),this.model={...t}}onOpen(){let{contentEl:e}=this;new ft.Setting(e).setName("Model ID").setDesc("This id is used to mention the model in the canvas, chat").addText(s=>{var i;return s.onChange(async a=>{this.model.modelId=a}).setValue((i=this.model.modelId)!=null?i:"")}),new ft.Setting(e).setName("Model name").setDesc("This name is used to call API").addDropdown(s=>s.onChange(async i=>{this.model.modelName=i}).addOptions({"gpt-4-0125-preview":"gpt-4-0125-preview","gpt-4-turbo-preview":"gpt-4-turbo-preview","gpt-4o":"gpt-4o","gemini-1.0-pro-001":"gemini-1.0-pro-001"}).setValue(this.model.modelName)),new ft.Setting(e).setName("API Key").addText(s=>s.setValue(this.model.apiKey).onChange(async i=>{this.model.apiKey=i})),new ft.Setting(e).setName("Advanced settings").setDesc("Only change if you know what you are doing").addToggle(s=>{s.setValue(!1).onChange(i=>{let a=e.getElementsByClassName(Or.advancedField);for(let o=0;o<a.length;o++)a[o].classList.toggle(Or.show,i)})}),new ft.Setting(e).setName("Color").setClass(Or.advancedField).setDesc("The color will be used to display the AI's response").addColorPicker(s=>{var i;return s.setValue((i=this.model.color)!=null?i:Vg()).onChange(async a=>{this.model.color=a})}),new ft.Setting(e).setName("Temperature").setClass(Or.advancedField).addText(s=>{var i;return s.setValue(`${(i=this.model.temperature)!=null?i:""}`).onChange(async a=>{this.model.temperature=parseFloat(a)})}),new ft.Setting(e).setName("TopP").setClass(Or.advancedField).addText(s=>{var i;return s.setValue(`${(i=this.model.topP)!=null?i:""}`).onChange(async a=>{this.model.topP=parseFloat(a)})}),new ft.Setting(e).setName("TopK").setClass(Or.advancedField).addText(s=>{var i;return s.setValue(`${(i=this.model.topK)!=null?i:""}`).onChange(async a=>{this.model.topK=parseFloat(a)})});let t=new ft.Setting(e).setClass("hidden"),n=e.createDiv("modal-button-container");n.createEl("button",{text:"Test connection",cls:"mod-cta"}).addEventListener("click",async()=>{t.settingEl.classList.remove("hidden"),t.setName("Send a test question...");let s=rn(this.model),i="Very short explain about LLMs temperature parameter, 1 sentence.";try{let a=await s.invoke(i);t.setName("Success").setDesc(`Question: ${i}

AI Response: ${a.content}`)}catch(a){t.setName("Error").setDesc(`Error: ${a.message}`)}}),n.createEl("button",{text:"Save",cls:"mod-cta"}).addEventListener("click",async()=>{this.onSaveCb&&this.onSaveCb.call(this,this.model),this.close()})}onSave(e){return this.onSaveCb=e,this}};var ef=class extends ws.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new ws.Setting(e).setName("Models").setDesc("Currently, we support OpenAI GPT, Google Gemini").setHeading().addButton(t=>{t.setButtonText("Add model").onClick(()=>{new eo(this.app,{modelName:"",modelId:"",apiKey:""}).setTitle("Add model").onSave(async n=>{this.plugin.settings.models.push(n),await this.plugin.saveSettings(),this.display()}).open()})}),this.plugin.settings.models.forEach((t,n)=>{let s=new ws.Setting(e);n>0&&s.addExtraButton(i=>{i.setIcon("arrow-up").onClick(async()=>{let a=this.plugin.settings.models[n-1];this.plugin.settings.models[n-1]=this.plugin.settings.models[n],this.plugin.settings.models[n]=a,await this.plugin.saveSettings(),this.display()}).setTooltip("Set as default")}),s.addExtraButton(i=>{i.setIcon("trash").setTooltip("Remove").onClick(async()=>{this.plugin.settings.models.splice(n,1),await this.plugin.saveSettings(),this.display()})}).setName(`${t.modelId}${n===0?" (default)":""}`).addExtraButton(i=>{i.setIcon("edit").onClick(()=>{new eo(this.app,t).setTitle("Edit model").onSave(async a=>{this.plugin.settings.models[n]=a,this.plugin.events.trigger("model-update",a),await this.plugin.saveSettings(),this.display()}).open()})})}),new ws.Setting(e).setName("Default system prompt").setDesc("The system prompt sent with each request to the API.").setClass(Or.autoFlow).addTextArea(t=>{t.inputEl.rows=5,t.setValue(this.plugin.settings.systemPrompt),t.onChange(async n=>{this.plugin.settings.systemPrompt=n,await this.plugin.saveSettings()})}),new ws.Setting(e).setName("Follow me on Twitter").setDesc("@duocdev").addButton(t=>{t.setCta(),t.setButtonText("Document").onClick(()=>{window.open("https://useai.aiocean.io/")})}).addButton(t=>{t.setCta(),t.setButtonText("Follow for update").onClick(()=>{window.open("https://twitter.com/duocdev")})}).addButton(t=>{t.setCta(),t.setButtonText("Bug report").onClick(()=>{window.open("https://aiocean.atlassian.net/servicedesk/customer/portal/5")})}).addButton(t=>{t.buttonEl.outerHTML="<a href='https://paypal.me/duocnguyen' target='_blank'><img style='border:0px;height:35px;' src='https://cdn.ko-fi.com/cdn/kofi3.png?v=3' /></a>"})}},Zg=ef;var tf=`
You are a critical-thinking assistant bot.
Consider the intent of my questions before responding.
Do not restate my information unless I ask for it.
Do not include caveats or disclaimers.
Use step-by-step reasoning. Be brief.`,Hg={models:[],systemPrompt:tf,debug:!1};var Ic=class extends Lt.Plugin{constructor(e,t,n){super(e,t),this.events=new so}async onload(){await this.loadSettings(),await this.migrateSettings(),this.addSettingTab(new Zg(this.app,this)),this.registerCommands(),this.patchObsidian(),this.registerEvents(),this.registerView(Vu,e=>new qu(e,this)),this.addRibbonIcon("lucide-sparkles","AI Assistant",async()=>{await Wm(this.app.workspace,Vu)}),this.registerMarkdownCodeBlockProcessor("useTool",(e,t,n)=>{t.addClass("open-gate-view");let s=zg(e);t.appendChild(s)})}appendAiButton(e,t,n,s){let i=createEl("button","clickable-icon gpt-menu-item"),a=(t==null?void 0:t.role)==="ai"?"Regenerate":"Ask question with AI",o=(t==null?void 0:t.role)==="ai"?"refresh-ccw":"lucide-sparkles";(0,Lt.setTooltip)(i,a,{placement:"top"}),(0,Lt.setIcon)(i,o),i.addEventListener("click",async()=>{this.events.trigger("canvas:node-menu:ask-question",n,s)}),e.menuEl.appendChild(i)}appendUserButton(e){let t=createEl("button","clickable-icon gpt-menu-item");(0,Lt.setTooltip)(t,"add user node",{placement:"top"}),(0,Lt.setIcon)(t,"message-square"),t.addEventListener("click",async()=>{await Zm(this.app)}),e.menuEl.appendChild(t)}isMenuPatched(e){return e.menuEl.querySelector(".gpt-menu-item")!==null}isNodeGenerating(e){return(e==null?void 0:e.status)==="generating"}registerEvents(){this.registerEvent(this.events.on("canvas:node-menu",(e,t,n)=>{let s=n.getData();this.isMenuPatched(e)||this.isNodeGenerating(s)||(this.appendAiButton(e,s,t,n),this.appendUserButton(e))})),this.registerEvent(this.events.on("canvas:node-menu:ask-question",async(e,t)=>{if(this.settings.models.length===0){new Lt.Notice("API key or model is not set. Please set the API key and model in the settings");return}let n=e.getEdgesForNode(t).filter(i=>i.to.node.id===t.id).first(),s;(n==null?void 0:n.label)!==void 0&&(n==null?void 0:n.label)!==""&&(s=this.settings.models.find(i=>i.modelId===n.label)),s||(s=this.settings.models[0]),await Jm(this.settings.systemPrompt,s,e,t)})),this.registerEvent(this.events.on("model-update",async e=>{Fm(e.modelName)})),this.registerEvent(this.events.on("canvas:split-node",async(e,t)=>{await Kg(e,t)})),this.registerEvent(this.events.on("canvas:creation-menu",async(e,t,n)=>{e.addSeparator(),e.addItem(s=>{s.setTitle("Add prompt").setIcon("lucide-list").onClick(()=>{of(this.app,i=>{t.createTextNode({pos:n,size:{height:150,width:300},text:i.prompt,focus:!1}).setData({role:"user"})})})}),e.addItem(s=>{s.setTitle("Add tool").setIcon("lucide-list").onClick(()=>{cf(this.app,i=>{t.createTextNode({pos:n,size:{height:50,width:200},text:i.config,focus:!1}).setData({role:"tool"})})})}),e.addItem(s=>{s.setTitle("Add model").setIcon("lucide-list").onClick(()=>{sf(this.app,i=>{t.createTextNode({pos:n,size:{height:50,width:300},text:i.name,focus:!1}).setData({role:"model"})})})})}))}patchObsidian(){this.app.workspace.onLayoutReady(()=>{if(xd(this))return;let e=this.app.workspace.on("layout-change",()=>{xd(this)&&this.app.workspace.offref(e)});this.registerEvent(e)})}async migrateSettings(){let e=!1;this.settings.models===void 0&&(this.settings.models=[],e=!0),this.settings.systemPrompt===void 0&&(this.settings.systemPrompt=tf,e=!0);for(let t of this.settings.models)t.modelId===void 0&&(t.modelId=Ym(t.modelName),e=!0);e&&await this.saveSettings()}async loadSettings(){this.settings=Object.assign({},Hg,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}registerCommands(){[{id:"split-list-to-note",name:"Split list to notes",icon:"lucide-list",checkCallback:t=>{let n=fi(this.app);if(!n)return!1;let s=n.selection;if(s.size!==1)return!1;let i=s.values().next().value;return t||this.events.trigger("canvas:split-node",n,i),!0}},{id:"continue-writing",name:"Continue writing",editorCallback:async(t,n)=>{let s=this.settings.models[0],i=rn(s),a=t.getValue();console.log(t);try{let o=await i.stream(a,{});for await(let u of o)t.replaceRange(u.content,t.getCursor()),t.refresh()}catch(o){new Lt.Notice("Error generating content")}}}].forEach(t=>this.addCommand(t))}};
/*! Bundled license information:

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@langchain/core/dist/utils/js-sha1/hash.js:
  (*
   * [js-sha1]{@link https://github.com/emn178/js-sha1}
   *
   * @version 0.6.0
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2014-2017
   * @license MIT
   *)

@langchain/core/dist/utils/fast-json-patch/src/helpers.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017-2022 Joachim Wester
   * MIT licensed
   *)

@langchain/core/dist/utils/fast-json-patch/src/duplex.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2013-2021 Joachim Wester
   * MIT license
   *)
*/
